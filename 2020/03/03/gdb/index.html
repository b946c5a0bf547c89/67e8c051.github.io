<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>GDB tips | 无常无相无功;不动不破不空</title><meta name="keywords" content="debug,trace"><meta name="author" content="Homer"><meta name="copyright" content="Homer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="The stack12345678910111213141516171819202122|------------------|  &lt;------ high address|                  |  &lt;------ previous frame|------------------| |    ......        ||   local var1     ||">
<meta property="og:type" content="article">
<meta property="og:title" content="GDB tips">
<meta property="og:url" content="http://yoursite.com/2020/03/03/gdb/index.html">
<meta property="og:site_name" content="无常无相无功;不动不破不空">
<meta property="og:description" content="The stack12345678910111213141516171819202122|------------------|  &lt;------ high address|                  |  &lt;------ previous frame|------------------| |    ......        ||   local var1     ||">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png">
<meta property="article:published_time" content="2020-03-03T14:17:33.000Z">
<meta property="article:modified_time" content="2022-07-28T01:57:46.337Z">
<meta property="article:author" content="Homer">
<meta property="article:tag" content="debug">
<meta property="article:tag" content="trace">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2020/03/03/gdb/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2022-07-28 09:57:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="无常无相无功;不动不破不空" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/fighting-spiri-logot.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-stack"><span class="toc-number">1.</span> <span class="toc-text">The stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#print-userspace-struct"><span class="toc-number">2.</span> <span class="toc-text">print userspace struct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example-to-test"><span class="toc-number">3.</span> <span class="toc-text">example to test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#segment-fault"><span class="toc-number">4.1.</span> <span class="toc-text">segment fault</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Demo"><span class="toc-number">4.1.1.</span> <span class="toc-text">Demo</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OS-settting"><span class="toc-number">5.</span> <span class="toc-text">OS settting</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Core-pattern"><span class="toc-number">5.1.</span> <span class="toc-text">Core pattern</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Core-single"><span class="toc-number">5.2.</span> <span class="toc-text">Core single</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Test-SIGSEGV"><span class="toc-number">5.2.1.</span> <span class="toc-text">Test SIGSEGV</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-ptrace-permissions"><span class="toc-number">5.3.</span> <span class="toc-text">Enable ptrace permissions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Genarate-the-debug-info"><span class="toc-number">6.</span> <span class="toc-text">Genarate the debug info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ubuntu"><span class="toc-number">7.</span> <span class="toc-text">ubuntu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Open-the-core-file"><span class="toc-number">8.</span> <span class="toc-text">Open the core file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attach-the-process"><span class="toc-number">9.</span> <span class="toc-text">attach the process</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb-basic-cmd"><span class="toc-number">10.</span> <span class="toc-text">gdb basic cmd</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set-print-variable-length"><span class="toc-number"></span> <span class="toc-text">set print variable length</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#print-argv"><span class="toc-number">1.</span> <span class="toc-text">print argv</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#threads"><span class="toc-number">1.1.</span> <span class="toc-text">threads</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#or"><span class="toc-number"></span> <span class="toc-text">or</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#debug-with-python"><span class="toc-number">1.</span> <span class="toc-text">debug with python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb-note"><span class="toc-number">2.</span> <span class="toc-text">gdb note</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#User-space"><span class="toc-number">3.</span> <span class="toc-text">User space</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#source-code-directory"><span class="toc-number">4.</span> <span class="toc-text">source code directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gcc-parameters-and-show-macro"><span class="toc-number">5.</span> <span class="toc-text">gcc parameters and show macro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rsync-debug-example"><span class="toc-number">6.</span> <span class="toc-text">rsync debug example</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gen-the-debuginfo"><span class="toc-number">7.</span> <span class="toc-text">gen the debuginfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#build-linux-kernel-module-with-debug-info"><span class="toc-number">8.</span> <span class="toc-text">build linux kernel module with debug info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-userspace-debuginfo"><span class="toc-number">9.</span> <span class="toc-text">The userspace debuginfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb-command-line"><span class="toc-number">10.</span> <span class="toc-text">gdb command line</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">无常无相无功;不动不破不空</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">GDB tips</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-03-03T14:17:33.000Z" title="Created 2020-03-03 22:17:33">2020-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-07-28T01:57:46.337Z" title="Updated 2022-07-28 09:57:46">2022-07-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Scripts/">Scripts</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="The-stack"><a href="#The-stack" class="headerlink" title="The stack"></a>The stack</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">|------------------|  &lt;------ high address</span><br><span class="line">|                  |  &lt;------ previous frame</span><br><span class="line">|------------------| </span><br><span class="line">|    ......        |</span><br><span class="line">|   local var1     |</span><br><span class="line">|   argument <span class="number">1</span>     |</span><br><span class="line">|   argument <span class="number">2</span>     |  &lt;------ caller</span><br><span class="line">|next instruction  |</span><br><span class="line">|   rbp(caller)    |</span><br><span class="line">|------------------|</span><br><span class="line">| local var1       |  &lt;------ callee</span><br><span class="line">|------------------|</span><br><span class="line">|    ......        |</span><br><span class="line">|------------------|  &lt;------ low addr (top stack)</span><br><span class="line"></span><br><span class="line">$ cat /proc/<span class="number">1</span>/stack </span><br><span class="line"><span class="meta">[&lt;ffffffffbc49c28e&gt;]</span> ep_poll+<span class="number">0x23e</span>/<span class="number">0x360</span> &lt;---------------low addr ( top stack )</span><br><span class="line"><span class="meta">[&lt;ffffffffbc49d76d&gt;]</span> SyS_epoll_wait+<span class="number">0xed</span>/<span class="number">0x120</span></span><br><span class="line"><span class="meta">[&lt;ffffffffbc992ed2&gt;]</span> system_call_fastpath+<span class="number">0x25</span>/<span class="number">0x2a</span></span><br><span class="line"><span class="meta">[&lt;ffffffffffffffff&gt;]</span> <span class="number">0xffffffffffffffff</span>  &lt;---------------high addr               </span><br><span class="line"></span><br><span class="line">The latest stack is top stack , it <span class="symbol">&#x27;s</span> from high addr <span class="keyword">to</span> low addr</span><br></pre></td></tr></table></figure>
<h3 id="print-userspace-struct"><a href="#print-userspace-struct" class="headerlink" title="print userspace struct"></a>print userspace struct</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pahole -V a.out</span><br></pre></td></tr></table></figure>

<h3 id="example-to-test"><a href="#example-to-test" class="headerlink" title="example to test"></a><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000016661251">example to test</a></h3><p>In the x86_64 kernel mode, The first six arguments to a function are passed in the following cpu registers, respectively: %rdi, %rsi, %rdx, %rcx, %r8, %r9</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//call_example.c</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  add(<span class="number">333</span>, <span class="number">11</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">22</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ gcc call_example.c -o add -g </span><br><span class="line">$ gdb ./add</span><br><span class="line"></span><br><span class="line">(gdb) bt</span><br><span class="line">#<span class="number">0</span>  main () at call_example.c:<span class="number">6</span></span><br><span class="line"></span><br><span class="line">(gdb) disassemble /mr</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function main:</span><br><span class="line"><span class="number">5</span>	<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">   <span class="number">0x0000555555555139</span> &lt;+<span class="number">0</span>&gt;:	<span class="number">55</span>	push   %rbp</span><br><span class="line">   <span class="number">0x000055555555513a</span> &lt;+<span class="number">1</span>&gt;:	<span class="number">48</span> <span class="number">89</span> e5	mov    %rsp,%rbp</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>	  add(<span class="number">333</span>, <span class="number">11</span>);</span><br><span class="line">   <span class="number">0x000055555555513d</span> &lt;+<span class="number">4</span>&gt;:	be <span class="number">0b</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>	mov    $<span class="number">0xb</span>,%esi</span><br><span class="line">   <span class="number">0x0000555555555142</span> &lt;+<span class="number">9</span>&gt;:	bf <span class="number">4</span>d <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>	mov    $<span class="number">0x14d</span>,%edi</span><br><span class="line">   <span class="number">0x0000555555555147</span> &lt;+<span class="number">14</span>&gt;:	e8 d9 ff ff ff	call   <span class="number">0x555555555125</span> &lt;add&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>	  <span class="keyword">return</span> <span class="number">22</span>;</span><br><span class="line">   <span class="number">0x000055555555514c</span> &lt;+<span class="number">19</span>&gt;:	b8 <span class="number">16</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>	mov    $<span class="number">0x16</span>,%eax</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>	&#125; </span><br><span class="line">=&gt; <span class="number">0x0000555555555151</span> &lt;+<span class="number">24</span>&gt;:	<span class="number">5</span>d	pop    %rbp</span><br><span class="line">   <span class="number">0x0000555555555152</span> &lt;+<span class="number">25</span>&gt;:	c3	ret    </span><br><span class="line"></span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">(gdb) i reg</span><br><span class="line">rax            <span class="number">0x16</span>                <span class="number">22</span>  &lt;-------- <span class="keyword">return</span> value</span><br><span class="line">rbx            <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">rcx            <span class="number">0x7ffff7fa4718</span>      <span class="number">140737353762584</span></span><br><span class="line">rdx            <span class="number">0x14d</span>               <span class="number">333</span> </span><br><span class="line">rsi            <span class="number">0xb</span>                 <span class="number">11</span>  &lt;-------- second argument</span><br><span class="line">rdi            <span class="number">0x14d</span>               <span class="number">333</span> &lt;-------- first argument</span><br><span class="line">rbp            <span class="number">0x7fffffffdfa0</span>      <span class="number">0x7fffffffdfa0</span></span><br><span class="line">rsp            <span class="number">0x7fffffffdfa0</span>      <span class="number">0x7fffffffdfa0</span></span><br><span class="line">r8             <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">r9             <span class="number">0x7ffff7fe21b0</span>      <span class="number">140737354015152</span></span><br><span class="line">r10            <span class="number">0x7</span>                 <span class="number">7</span></span><br><span class="line">r11            <span class="number">0x2</span>                 <span class="number">2</span></span><br><span class="line">r12            <span class="number">0x555555555040</span>      <span class="number">93824992235584</span></span><br><span class="line">r13            <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">r14            <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">r15            <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">rip            <span class="number">0x555555555151</span>      <span class="number">0x555555555151</span> &lt;main+<span class="number">24</span>&gt;</span><br><span class="line">eflags         <span class="number">0x212</span>               [ AF IF ]</span><br><span class="line">cs             <span class="number">0x33</span>                <span class="number">51</span></span><br><span class="line">ss             <span class="number">0x2b</span>                <span class="number">43</span></span><br><span class="line">ds             <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">es             <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">fs             <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line">gs             <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun1</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun2</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun3</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun4</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c,<span class="keyword">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun5</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c,<span class="keyword">int</span> d,<span class="keyword">int</span> e)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun6</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c,<span class="keyword">int</span> d,<span class="keyword">int</span> e,<span class="keyword">int</span> f)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a,b,c,d,e,f;</span><br><span class="line">	a=b=c=d=e=f=<span class="number">2</span>;</span><br><span class="line">	fun1(a);</span><br><span class="line">	fun2(a,b);</span><br><span class="line">	fun3(a,b,c);</span><br><span class="line">	fun4(a,b,c,d);</span><br><span class="line">	fun5(a,b,c,d,e);</span><br><span class="line">	fun6(a,b,c,d,e,f);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ objdump -d test</span><br><span class="line"><span class="number">00000000004004</span>ed &lt;fun1&gt;:</span><br><span class="line">  <span class="number">4004</span>ed:       <span class="number">55</span>                      push   %rbp</span><br><span class="line">  <span class="number">4004</span>ee:       <span class="number">48</span> <span class="number">89</span> e5                mov    %rsp,%rbp</span><br><span class="line">  <span class="number">4004f</span>1:       <span class="number">89</span> <span class="number">7</span>d fc                mov    %edi,<span class="number">-0x4</span>(%rbp)</span><br><span class="line">  <span class="number">4004f</span>4:       <span class="number">5</span>d                      pop    %rbp</span><br><span class="line">  <span class="number">4004f</span>5:       c3                      retq</span><br><span class="line"></span><br><span class="line"><span class="number">00000000004004f</span>6 &lt;fun2&gt;:</span><br><span class="line">  <span class="number">4004f</span>6:       <span class="number">55</span>                      push   %rbp</span><br><span class="line">  <span class="number">4004f</span>7:       <span class="number">48</span> <span class="number">89</span> e5                mov    %rsp,%rbp</span><br><span class="line">  <span class="number">4004f</span>a:       <span class="number">89</span> <span class="number">7</span>d fc                mov    %edi,<span class="number">-0x4</span>(%rbp)</span><br><span class="line">  <span class="number">4004f</span>d:       <span class="number">89</span> <span class="number">75</span> f8                mov    %esi,<span class="number">-0x8</span>(%rbp)</span><br><span class="line">  <span class="number">400500</span>:       <span class="number">5</span>d                      pop    %rbp</span><br><span class="line">  <span class="number">400501</span>:       c3                      retq</span><br><span class="line"></span><br><span class="line"><span class="number">0000000000400502</span> &lt;fun3&gt;:</span><br><span class="line">  <span class="number">400502</span>:       <span class="number">55</span>                      push   %rbp</span><br><span class="line">  <span class="number">400503</span>:       <span class="number">48</span> <span class="number">89</span> e5                mov    %rsp,%rbp</span><br><span class="line">  <span class="number">400506</span>:       <span class="number">89</span> <span class="number">7</span>d fc                mov    %edi,<span class="number">-0x4</span>(%rbp)</span><br><span class="line">  <span class="number">400509</span>:       <span class="number">89</span> <span class="number">75</span> f8                mov    %esi,<span class="number">-0x8</span>(%rbp)</span><br><span class="line">  <span class="number">40050</span>c:       <span class="number">89</span> <span class="number">55</span> f4                mov    %edx,<span class="number">-0xc</span>(%rbp)</span><br><span class="line">  <span class="number">40050f</span>:       <span class="number">5</span>d                      pop    %rbp</span><br><span class="line">  <span class="number">400510</span>:       c3                      retq</span><br><span class="line"></span><br><span class="line"><span class="number">0000000000400511</span> &lt;fun4&gt;:</span><br><span class="line">  <span class="number">400511</span>:       <span class="number">55</span>                      push   %rbp</span><br><span class="line">  <span class="number">400512</span>:       <span class="number">48</span> <span class="number">89</span> e5                mov    %rsp,%rbp</span><br><span class="line">  <span class="number">400515</span>:       <span class="number">89</span> <span class="number">7</span>d fc                mov    %edi,<span class="number">-0x4</span>(%rbp)</span><br><span class="line">  <span class="number">400518</span>:       <span class="number">89</span> <span class="number">75</span> f8                mov    %esi,<span class="number">-0x8</span>(%rbp)</span><br><span class="line">  <span class="number">40051b</span>:       <span class="number">89</span> <span class="number">55</span> f4                mov    %edx,<span class="number">-0xc</span>(%rbp)</span><br><span class="line">  <span class="number">40051</span>e:       <span class="number">89</span> <span class="number">4</span>d f0                mov    %ecx,<span class="number">-0x10</span>(%rbp)</span><br><span class="line">  <span class="number">400521</span>:       <span class="number">5</span>d                      pop    %rbp</span><br><span class="line">  <span class="number">400522</span>:       c3                      retq</span><br><span class="line"></span><br><span class="line"><span class="number">0000000000400523</span> &lt;fun5&gt;:</span><br><span class="line">  <span class="number">400523</span>:       <span class="number">55</span>                      push   %rbp</span><br><span class="line">  <span class="number">400524</span>:       <span class="number">48</span> <span class="number">89</span> e5                mov    %rsp,%rbp</span><br><span class="line">  <span class="number">400527</span>:       <span class="number">89</span> <span class="number">7</span>d fc                mov    %edi,<span class="number">-0x4</span>(%rbp)</span><br><span class="line">  <span class="number">40052</span>a:       <span class="number">89</span> <span class="number">75</span> f8                mov    %esi,<span class="number">-0x8</span>(%rbp)</span><br><span class="line">  <span class="number">40052</span>d:       <span class="number">89</span> <span class="number">55</span> f4                mov    %edx,<span class="number">-0xc</span>(%rbp)</span><br><span class="line">  <span class="number">400530</span>:       <span class="number">89</span> <span class="number">4</span>d f0                mov    %ecx,<span class="number">-0x10</span>(%rbp)</span><br><span class="line">  <span class="number">400533</span>:       <span class="number">44</span> <span class="number">89</span> <span class="number">45</span> ec             mov    %r8d,<span class="number">-0x14</span>(%rbp)</span><br><span class="line">  <span class="number">400537</span>:       <span class="number">5</span>d                      pop    %rbp</span><br><span class="line">  <span class="number">400538</span>:       c3                      retq</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -S -c unlimited</span><br><span class="line"></span><br><span class="line">(gdb) <span class="built_in">break</span> *func_b+0x23</span><br><span class="line">Breakpoint 1 at 0x804898f: file backtrace.c, line 59.</span><br><span class="line"></span><br><span class="line">(gdb) list *func_b+0x23</span><br><span class="line">0x804898f is <span class="keyword">in</span> func_b (backtrace.c:59).</span><br><span class="line">54     int func_b()</span><br><span class="line">55     &#123;</span><br><span class="line">56         <span class="built_in">printf</span>(<span class="string">&quot;This is func_b\n&quot;</span>);</span><br><span class="line">57         /* illegal pointer, si_code = 128 (send by kernel) */</span><br><span class="line">58         int *p = (int *)-1;</span><br><span class="line">59         <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *p);</span><br><span class="line">60     &#125;</span><br><span class="line">61</span><br><span class="line">62     int main(int argc, char *argv[])</span><br><span class="line">63     &#123;</span><br></pre></td></tr></table></figure>

<h4 id="segment-fault"><a href="#segment-fault" class="headerlink" title="segment fault"></a><a target="_blank" rel="noopener" href="https://wiki.debian.org/InterpretingKernelOutputAtProcessCrash">segment fault</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> * Page fault error code bits:</span><br><span class="line"> *</span><br><span class="line"> *   bit 0 ==	 0: no page found	1: protection fault</span><br><span class="line"> *   bit 1 ==	 0: <span class="built_in">read</span> access		1: write access</span><br><span class="line"> *   bit 2 ==	 0: kernel-mode access	1: user-mode access</span><br><span class="line"> *   bit 3 ==				1: use of reserved bit detected</span><br><span class="line"> *   bit 4 ==				1: fault was an instruction fetch</span><br><span class="line"> *   bit 5 ==				1: protection keys block access</span><br><span class="line"> */</span><br><span class="line">enum x86_pf_error_code &#123;</span><br><span class="line">	X86_PF_PROT	=		1 &lt;&lt; 0,</span><br><span class="line">	X86_PF_WRITE	=		1 &lt;&lt; 1,</span><br><span class="line">	X86_PF_USER	=		1 &lt;&lt; 2,</span><br><span class="line">	X86_PF_RSVD	=		1 &lt;&lt; 3,</span><br><span class="line">	X86_PF_INSTR	=		1 &lt;&lt; 4,</span><br><span class="line">	X86_PF_PK	=		1 &lt;&lt; 5,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">#endif /* _ASM_X86_TRAPS_H */</span></span><br></pre></td></tr></table></figure>
<ul>
<li>bit2: 值为 1 时表示是用户态程序内存访问越界，值为 0 时表示是内核态程序内存访问越界</li>
<li>bit1: 值为 1 时表示是写操作导致内存访问越界，值为 0 时表示是读操作导致内存访问越界</li>
<li>bit0: 值为 1 表示没有足够的权限访问非法地址的内容， 值为 0 时表示访问的非法地址根本没有对应的页面，也就是无效地址</li>
</ul>
<h5 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h5><p>err 4</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ cat cpp_crash.cpp</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">void myprint(int* ptr) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    int *ptr = NULL;</span><br><span class="line">    myprint(ptr);</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -S -c unlimited</span><br><span class="line">$ g++ cpp_crash.cpp -o a.out -g -rdynamic -finstrument-functions</span><br><span class="line">$ ./a.out</span><br><span class="line">$ dmesg </span><br><span class="line">a.out[36921]: segfault at 0 ip 00005585d34141d1 sp 00007ffc0e9c19b0 error 4 <span class="keyword">in</span> a.out[5585d3414000+1000]</span><br><span class="line">Code: ff ff f3 0f 1e fa 55 48 89 e5 53 48 83 ec 18 48 89 7d e8 48 8b 45 08 48 89 c6 48 8d 3d e1 ff ff ff e8 c3 fe ff ff 48 8b 45 e8 &lt;8b&gt; 00 89 c6 48 8d 3d 28 0e 00 00 b8 00 00 00 00 e8 9a fe ff ff 48</span><br><span class="line"></span><br><span class="line">$ $ gdb ./a.out core</span><br><span class="line">GNU gdb (Ubuntu 9.2-0ubuntu1~20.04) 9.2</span><br><span class="line">...</span><br><span class="line">Program terminated with signal SIGSEGV, Segmentation fault.</span><br><span class="line"><span class="comment">#0  0x00005585d34141d1 in myprint (ptr=0x0) at cpp_crash.cpp:5</span></span><br><span class="line">5	    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *ptr);</span><br><span class="line">(gdb) </span><br><span class="line"></span><br><span class="line">$ nm -gC a.out </span><br><span class="line">0000000000004018 B __bss_start</span><br><span class="line">                 w __cxa_finalize@@GLIBC_2.2.5</span><br><span class="line">                 U __cyg_profile_func_enter@@GLIBC_2.2.5</span><br><span class="line">                 U __cyg_profile_func_exit@@GLIBC_2.2.5</span><br><span class="line">0000000000004000 D __data_start</span><br><span class="line">0000000000004000 W data_start</span><br><span class="line">0000000000004018 D _edata</span><br><span class="line">0000000000004020 B _end</span><br><span class="line">                 w __gmon_start__</span><br><span class="line">                 U __gxx_personality_v0@@CXXABI_1.3</span><br><span class="line">0000000000002000 R _IO_stdin_used</span><br><span class="line">                 w _ITM_deregisterTMCloneTable</span><br><span class="line">                 w _ITM_registerTMCloneTable</span><br><span class="line">0000000000001320 T __libc_csu_fini</span><br><span class="line">00000000000012b0 T __libc_csu_init</span><br><span class="line">                 U __libc_start_main@@GLIBC_2.2.5</span><br><span class="line">0000000000001227 T main</span><br><span class="line">                 U <span class="built_in">printf</span>@@GLIBC_2.2.5</span><br><span class="line">00000000000010c0 T _start</span><br><span class="line">                 U _Unwind_Resume@@GCC_3.0</span><br><span class="line">00000000000011a9 T myprint(int*)</span><br></pre></td></tr></table></figure>
<p>Got the issue line by gdb</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[Mon May 10 10:57:22 2021] a.out[733]: segfault at 0 ip 000000000040092f sp 00007ffe8e80aa80 error 4 <span class="keyword">in</span> a.out[400000+1000]</span><br><span class="line"></span><br><span class="line"><span class="comment"># calculate the relative address</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123; printf &quot;%x\n&quot;, strtonum(0x40092f-0x400000) &#125;&#x27;</span></span><br><span class="line">92f</span><br><span class="line">$ objdump -d a.out &gt; a.obj</span><br><span class="line"></span><br><span class="line"><span class="comment">## the myprint function</span></span><br><span class="line">$ grep -i 92f a.obj -A 5 -B 11</span><br><span class="line">000000000040090d &lt;_Z7myprintPi&gt;:</span><br><span class="line">  40090d:	55                   	push   %rbp</span><br><span class="line">  40090e:	48 89 e5             	mov    %rsp,%rbp</span><br><span class="line">  400911:	53                   	push   %rbx</span><br><span class="line">  400912:	48 83 ec 18          	sub    <span class="variable">$0x18</span>,%rsp</span><br><span class="line">  400916:	48 89 7d e8          	mov    %rdi,-0x18(%rbp)</span><br><span class="line">  40091a:	48 8b 45 08          	mov    0x8(%rbp),%rax</span><br><span class="line">  40091e:	48 89 c6             	mov    %rax,%rsi</span><br><span class="line">  400921:	bf 0d 09 40 00       	mov    <span class="variable">$0x40090d</span>,%edi</span><br><span class="line">  400926:	e8 b5 fe ff ff       	callq  4007e0 &lt;__cyg_profile_func_enter@plt&gt;</span><br><span class="line">  40092b:	48 8b 45 e8          	mov    -0x18(%rbp),%rax</span><br><span class="line">  40092f:	8b 00                	mov    (%rax),%eax</span><br><span class="line">  400931:	89 c6                	mov    %eax,%esi</span><br><span class="line">  400933:	bf 80 0a 40 00       	mov    <span class="variable">$0x400a80</span>,%edi</span><br><span class="line">  400938:	b8 00 00 00 00       	mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line">  40093d:	e8 6e fe ff ff       	callq  4007b0 &lt;<span class="built_in">printf</span>@plt&gt;</span><br><span class="line">  400942:	48 8b 45 08          	mov    0x8(%rbp),%rax</span><br></pre></td></tr></table></figure>

<p>err 6, not exist addr     </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> *ptr = <span class="literal">NULL</span>;</span><br><span class="line">        *ptr = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>err 6, system protect addr</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> *ptr = (<span class="keyword">int</span> *)<span class="number">0</span>;</span><br><span class="line">        *ptr = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>err 7, write readonly addr</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> *ptr = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">        <span class="built_in">strcpy</span>(ptr, <span class="string">&quot;TEST&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>err 6, stack overflow</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        main();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="OS-settting"><a href="#OS-settting" class="headerlink" title="OS settting"></a>OS settting</h3><h4 id="Core-pattern"><a href="#Core-pattern" class="headerlink" title="Core pattern"></a>Core pattern</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/sys/kernel/core_pattern</span><br><span class="line">/usr/share/apport/apport %p %s %c %d %P %E</span><br><span class="line"><span class="comment">## kernel variable</span></span><br><span class="line">kernel.core_pattern = |/usr/share/apport/apport %p %s %c %d %P %E</span><br><span class="line"><span class="comment">#If the first character of the pattern is a &#x27;|&#x27;, the kernel will treat the rest of the pattern as a command to run.  The core dump will be written to the standard input of that program instead of to a file.</span></span><br><span class="line"></span><br><span class="line">kernel.core_pipe_limit = 0</span><br><span class="line"><span class="comment"># This sysctl is only applicable when core_pattern is configured to pipe core files to a user space helper (when the first character of core_pattern is a &#x27;|&#x27;, see above).  When collecting cores via a pipe to an application, it is occasionally useful for the collecting application to gather data about the crashing process from its /proc/pid directory.  In order to do this safely, the kernel must wait for the collecting process to exit, so as not to remove the crashing processes proc files prematurely.  This in turn creates the possibility that a misbehaving userspace collecting process can block the reaping of a crashed process simply by never exiting.  This sysctl defends against that. It defines how many concurrent crashing processes may be piped to user space applications in parallel.  If this value is exceeded, then those crashing processes above that value are noted via the kernel log and their cores are skipped.  0 is a special value, indicating that unlimited processes may be captured in parallel, but that no waiting will take place (i.e. the collecting process is not guaranteed access to `/proc/&lt;crashing pid&gt;/`).</span></span><br><span class="line"></span><br><span class="line">kernel.core_uses_pid = 0</span><br><span class="line">kernel.core_patternfs.suid_dumpable = 2</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -S -c unlimited</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable genarate the core file</span></span><br><span class="line">$ <span class="built_in">ulimit</span> -c n</span><br></pre></td></tr></table></figure>

<h4 id="Core-single"><a href="#Core-single" class="headerlink" title="Core single"></a>Core single</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">  Standard signals</span><br><span class="line">       Linux supports the standard signals listed below.  Several signal  numbers  are  architecture-dependent,  as</span><br><span class="line">       indicated  <span class="keyword">in</span>  the  <span class="string">&quot;Value&quot;</span> column.  (Where three values are given, the first one is usually valid <span class="keyword">for</span> alpha</span><br><span class="line">       and sparc, the middle one <span class="keyword">for</span> x86, arm, and most other architectures, and the last one  <span class="keyword">for</span>  mips.   (Values</span><br><span class="line">       <span class="keyword">for</span>  parisc  are  not shown; see the Linux kernel <span class="built_in">source</span> <span class="keyword">for</span> signal numbering on that architecture.)  A dash</span><br><span class="line">       (-) denotes that a signal is absent on the corresponding architecture.</span><br><span class="line"></span><br><span class="line">       First the signals described <span class="keyword">in</span> the original POSIX.1-1990 standard.</span><br><span class="line"></span><br><span class="line">       Signal     Value     Action   Comment</span><br><span class="line">       ──────────────────────────────────────────────────────────────────────</span><br><span class="line">       SIGQUIT       3       Core    Quit from keyboard</span><br><span class="line">       SIGILL        4       Core    Illegal Instruction</span><br><span class="line">       SIGABRT       6       Core    Abort signal from abort(3)</span><br><span class="line">       SIGFPE        8       Core    Floating-point exception</span><br><span class="line">       SIGSEGV      11       Core    Invalid memory reference</span><br><span class="line"></span><br><span class="line">       The signals SIGKILL and SIGSTOP cannot be caught, blocked, or ignored.</span><br><span class="line"></span><br><span class="line">       Next the signals not <span class="keyword">in</span> the POSIX.1-1990 standard but described <span class="keyword">in</span> SUSv2 and POSIX.1-2001.</span><br><span class="line"></span><br><span class="line">       Signal       Value     Action   Comment</span><br><span class="line">       ────────────────────────────────────────────────────────────────────</span><br><span class="line">       SIGBUS      10,7,10     Core    Bus error (bad memory access)</span><br><span class="line">       SIGSYS      12,31,12    Core    Bad system call (SVr4);</span><br><span class="line">                                       see also seccomp(2)</span><br><span class="line">       SIGTRAP        5        Core    Trace/breakpoint <span class="built_in">trap</span></span><br><span class="line">       SIGXCPU     24,24,30    Core    CPU time <span class="built_in">limit</span> exceeded (4.2BSD);</span><br><span class="line">                                       see setrlimit(2)</span><br><span class="line">       SIGXFSZ     25,25,31    Core    File size <span class="built_in">limit</span> exceeded (4.2BSD);</span><br><span class="line">                                       see setrlimit(2)</span><br><span class="line">       Up to and including Linux 2.2, the default behavior <span class="keyword">for</span> SIGSYS,  SIGXCPU,  SIGXFSZ,  and  (on  architectures</span><br><span class="line">       other  than  SPARC and MIPS) SIGBUS was to terminate the process (without a core dump).  (On some other UNIX</span><br><span class="line">       systems the default action <span class="keyword">for</span> SIGXCPU and SIGXFSZ is to terminate the process without a core dump.)   Linux</span><br><span class="line">       2.4 conforms to the POSIX.1-2001 requirements <span class="keyword">for</span> these signals, terminating the process with a core dump.</span><br><span class="line"></span><br><span class="line">       Next various other signals.</span><br><span class="line"></span><br><span class="line">       Signal       Value     Action   Comment</span><br><span class="line">       ────────────────────────────────────────────────────────────────────</span><br><span class="line">       SIGIOT         6        Core    IOT <span class="built_in">trap</span>. A synonym <span class="keyword">for</span> SIGABRT</span><br><span class="line">       SIGUNUSED    -,31,-     Core    Synonymous with SIGSYS</span><br><span class="line"></span><br><span class="line">       (Signal 29 is SIGINFO / SIGPWR on an alpha but SIGLOST on a sparc.)</span><br><span class="line"></span><br><span class="line">       SIGEMT  is  not  specified  <span class="keyword">in</span>  POSIX.1-2001, but nevertheless appears on most other UNIX systems, <span class="built_in">where</span> its</span><br><span class="line">       default action is typically to terminate the process with a core dump.</span><br><span class="line"></span><br><span class="line">       SIGPWR (<span class="built_in">which</span> is not specified <span class="keyword">in</span> POSIX.1-2001) is typically ignored by default on those other UNIX  systems</span><br><span class="line">       <span class="built_in">where</span> it appears.</span><br><span class="line"></span><br><span class="line">       SIGIO (<span class="built_in">which</span> is not specified <span class="keyword">in</span> POSIX.1-2001) is ignored by default on several other UNIX systems.</span><br><span class="line"></span><br><span class="line">       Where defined, SIGUNUSED is synonymous with SIGSYS on most architectures.  Since glibc 2.26, SIGUNUSED is no</span><br><span class="line">       longer defined on any architecture.</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">kill</span> -l</span><br><span class="line"> 1) SIGHUP   2) SIGINT   3) SIGQUIT  4) SIGILL   5) SIGTRAP</span><br><span class="line"> 6) SIGABRT  7) SIGBUS   8) SIGFPE   9) SIGKILL 10) SIGUSR1</span><br><span class="line">11) SIGSEGV 12) SIGUSR2 13) SIGPIPE 14) SIGALRM 15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD 18) SIGCONT 19) SIGSTOP 20) SIGTSTP</span><br><span class="line">21) SIGTTIN 22) SIGTTOU 23) SIGURG  24) SIGXCPU 25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF 28) SIGWINCH    29) SIGIO   30) SIGPWR</span><br><span class="line">31) SIGSYS  34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SigPnd: 0000000000000000: Signals Pending (Raised, but waiting to be acted upon potentially because they are blocked).</span><br><span class="line">SigBlk: 0000000056727a01: Signals that are blocked by the process. This can be a temporary thing. The application can be coded <span class="keyword">in</span> such a way to temporarily block a signal. The kernel will <span class="keyword">then</span> delay delivery of that signal until such time as it becomes unblocked or the signals are asked to be delivered.</span><br><span class="line">SigIgn: 0000000000381000: Signals that are ignored by the process. They are simply thrown away. (Except <span class="keyword">for</span> SIGKILL and SIGSTOP, <span class="built_in">which</span> cannot be ignored)</span><br><span class="line">SigCgt: 000000004b817efb: Signals that can be caught by the process.</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 4b817efb | xxd -r -p | xxd -b</span><br><span class="line">01001011 10000001 01111110 11111011</span><br><span class="line"> |  | || |      |  ||||||  ||||| ||</span><br><span class="line"> |  | || |      |  ||||||  ||||| |+--  1 SIGHUP (hangup)</span><br><span class="line"> |  | || |      |  ||||||  ||||| +---  2 SIGINT (interrupt)</span><br><span class="line"> |  | || |      |  ||||||  ||||+-----  4 SIGILL (illegal instruction)</span><br><span class="line"> |  | || |      |  ||||||  |||+------  5 SIGTRAP (trace/<span class="built_in">trap</span>)</span><br><span class="line"> |  | || |      |  ||||||  ||+-------  6 SIGABRT (abort)</span><br><span class="line"> |  | || |      |  ||||||  |+--------  7 SIGEMT (emulation <span class="built_in">trap</span>)</span><br><span class="line"> |  | || |      |  ||||||  +---------  8 SIGFPE (floating point exception)</span><br><span class="line"> |  | || |      |  |||||+------------ 10 SIGBUS (bus error)</span><br><span class="line"> |  | || |      |  ||||+------------- 11 SIGSEGV (segmentation violation)</span><br><span class="line"> |  | || |      |  |||+-------------- 12 SIGSYS (bad system call)</span><br><span class="line"> |  | || |      |  ||+--------------- 13 SIGPIPE (broken pipe)</span><br><span class="line"> |  | || |      |  |+---------------- 14 SIGALRM (alarm)</span><br><span class="line"> |  | || |      |  +----------------- 15 SIGTERM (termination)</span><br><span class="line"> |  | || |      +-------------------- 17 SIGUSR2 (user signal 2)</span><br><span class="line"> |  | || +--------------------------- 24 SIGTSTP (stop -- can be ignored)</span><br><span class="line"> |  | |+----------------------------- 25 SIGCONT (<span class="built_in">continue</span>)</span><br><span class="line"> |  | +------------------------------ 26 SIGTTIN (terminal input)</span><br><span class="line"> |  +-------------------------------- 28 SIGVTALRM (timer expiration)</span><br><span class="line"> +----------------------------------- 31 SIGXFSZ (file size exceeded)</span><br><span class="line"></span><br><span class="line">cat /proc/<span class="variable">$pid</span>/status | grep Sig</span><br><span class="line">SigQ:	6/513952</span><br><span class="line">SigPnd:	0000000000040100</span><br><span class="line">SigBlk:	0000000000000000</span><br><span class="line">SigIgn:	0000000000000000</span><br><span class="line">SigCgt:	0000000180000000</span><br></pre></td></tr></table></figure>

<h5 id="Test-SIGSEGV"><a href="#Test-SIGSEGV" class="headerlink" title="Test SIGSEGV"></a><a target="_blank" rel="noopener" href="http://blog.cuicc.com/blog/2012/09/17/core-dump-and-backtrace/">Test SIGSEGV</a></h5><ul>
<li>kill -11 $pid means send the SIGSEGV to trigger the segment fault</li>
<li>define the invaid point signal code=128 (SI_KERNEL)<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *foo = (<span class="keyword">int</span> *)<span class="number">-1</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *foo);</span><br></pre></td></tr></table></figure></li>
<li>define the empty point and evaluation signal code=1 (SEGV_MAPERR)<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *foo = <span class="literal">NULL</span>;</span><br><span class="line">*foo = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *foo);</span><br></pre></td></tr></table></figure></li>
<li>Malloc the memory and protect it (signal code=2 (SEGV_ACCERR))<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *foo;</span><br><span class="line">posix_memalign(&amp;foo, getpagesize(), getpagesize());</span><br><span class="line"><span class="built_in">memset</span>(foo, <span class="string">&#x27;A&#x27;</span>, getpagesize());</span><br><span class="line">mprotect(foo, getpagesize(), PROT_NONE);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, foo[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h4 id="Enable-ptrace-permissions"><a href="#Enable-ptrace-permissions" class="headerlink" title="Enable ptrace permissions"></a>Enable ptrace permissions</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/sysctl.d/10-ptrace.conf</span><br><span class="line">kernel.yama.ptrace_scope = 0</span><br><span class="line"></span><br><span class="line">0 - classic ptrace permissions: a process can PTRACE_ATTACH to any other</span><br><span class="line">    process running under the same uid, as long as it is dumpable (i.e.</span><br><span class="line">    did not transition uids, start privileged, or have called</span><br><span class="line">    prctl(PR_SET_DUMPABLE...) already). Similarly, PTRACE_TRACEME is</span><br><span class="line">    unchanged.</span><br><span class="line"></span><br><span class="line">1 - restricted ptrace: a process must have a predefined relationship</span><br><span class="line">    with the inferior it wants to call PTRACE_ATTACH on. By default,</span><br><span class="line">    this relationship is that of only its descendants when the above</span><br><span class="line">    classic criteria is also met. To change the relationship, an</span><br><span class="line">    inferior can call prctl(PR_SET_PTRACER, debugger, ...) to <span class="built_in">declare</span></span><br><span class="line">    an allowed debugger PID to call PTRACE_ATTACH on the inferior.</span><br><span class="line">    Using PTRACE_TRACEME is unchanged.</span><br><span class="line"></span><br><span class="line">2 - admin-only attach: only processes with CAP_SYS_PTRACE may use ptrace</span><br><span class="line">    with PTRACE_ATTACH, or through children calling PTRACE_TRACEME.</span><br><span class="line"></span><br><span class="line">3 - no attach: no processes may use ptrace with PTRACE_ATTACH nor via</span><br><span class="line">    PTRACE_TRACEME. Once <span class="built_in">set</span>, this sysctl value cannot be changed.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Genarate-the-debug-info"><a href="#Genarate-the-debug-info" class="headerlink" title="Genarate the debug info"></a>Genarate the debug info</h3><ul>
<li>-g produces debugging information in theOS native format</li>
<li>-ggdb produces debugging information specifically intennded for gdb</li>
<li>-ggdb3 produces extra debugging information, for example: including macro definitions</li>
<li>wall means enable warnning</li>
<li>-O0  turn off all optimization</li>
<li>-O1 ,-O2, -O3  optimization<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure CFLAGS=<span class="string">&quot;-Wall -O2 -ggdb3&quot;</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">### Genarate the core file</span></span><br><span class="line">usage:  gcore [-a] [-o filename] pid</span><br><span class="line">```bash</span><br><span class="line">$ gcore -o /tmp/core -p <span class="variable">$pid</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>for the kernel</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> c &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure>

<h3 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install ubuntu-dbgsym-keyring</span><br></pre></td></tr></table></figure>

<h3 id="Open-the-core-file"><a href="#Open-the-core-file" class="headerlink" title="Open the core file"></a>Open the core file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ gdb ./a.out ./bubble_sort_core</span><br><span class="line"></span><br><span class="line">GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-linux-gnu&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;show configuration&quot;</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">&quot;help&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;apropos word&quot;</span> to search <span class="keyword">for</span> commands related to <span class="string">&quot;word&quot;</span>...</span><br><span class="line">Reading symbols from ./a.out...done.</span><br><span class="line">[New LWP 20410]</span><br><span class="line">Core was generated by `./a.out<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">Program terminated with signal SIGABRT, Aborted.</span></span><br><span class="line"><span class="string">#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51</span></span><br><span class="line"><span class="string">51	../sysdeps/unix/sysv/linux/raise.c: No such file or directory.</span></span><br></pre></td></tr></table></figure>

<h3 id="attach-the-process"><a href="#attach-the-process" class="headerlink" title="attach the process"></a>attach the process</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gdb attach <span class="variable">$PID</span></span><br><span class="line">$ gdb ./the_programA_binray <span class="variable">$pid_of_the_programA</span></span><br></pre></td></tr></table></figure>

<h3 id="gdb-basic-cmd"><a href="#gdb-basic-cmd" class="headerlink" title="gdb basic cmd"></a>gdb basic cmd</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line">break</span><br><span class="line">break +offset</span><br><span class="line">break -offset</span><br><span class="line">break linenum</span><br><span class="line">break filename:linenum</span><br><span class="line">break func_name</span><br><span class="line">break filename:func_name</span><br><span class="line">break <span class="number">*add</span>ress</span><br><span class="line">break <span class="built_in">..</span>. <span class="keyword">if</span> &lt;condition&gt;</span><br><span class="line">break where <span class="keyword">if</span> </span><br><span class="line"></span><br><span class="line">(gdb) break <span class="number">*f</span>unc_b+0x23</span><br><span class="line">Breakpoint 1 at 0x804898f: file backtrace.c, line 59.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">display ## ultra print</span><br><span class="line"><span class="comment">## not work</span></span><br><span class="line">break foo <span class="keyword">if</span> i&gt;0</span><br><span class="line">commands</span><br><span class="line">printf <span class="string">&quot;i is %d\n&quot;</span>, i</span><br><span class="line">continue</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">(gdb) until 5 #<span class="string">&#x27;u&#x27;</span></span><br><span class="line">(gdb) skip function <span class="builtin-name">add</span>   # <span class="keyword">step</span>时跳过add函数</span><br><span class="line">(gdb) <span class="builtin-name">info</span> skip   # 查看skip列表</span><br><span class="line"></span><br><span class="line"><span class="comment">## skip function, not go to internal</span></span><br><span class="line">(gdb) next</span><br><span class="line"></span><br><span class="line"><span class="comment">## not skip, go to the function internal</span></span><br><span class="line">(gdb) <span class="keyword">step</span></span><br><span class="line"></span><br><span class="line">(gdb) continue</span><br><span class="line">(gdb) continue 3 # 跳过3个断点</span><br><span class="line"></span><br><span class="line">(gdb) finish # like <span class="keyword">step</span> out, finish current function</span><br><span class="line"></span><br><span class="line">list</span><br><span class="line">从第一行开始显示源码，继续输入list，可列出后面的源码</span><br><span class="line">list linenum</span><br><span class="line">列出linenum行附近的源码</span><br><span class="line">list function</span><br><span class="line">列出函数function的代码</span><br><span class="line">list filename:linenum</span><br><span class="line">列出文件filename文件中，linenum行出的代码</span><br><span class="line">list filename:function</span><br><span class="line">列出文件filename中，函数function的代码</span><br><span class="line">list +offset/-offset</span><br><span class="line">列出在当前行号的前面或后面的offset行附近的代码。offset为自然数。</span><br><span class="line">list +/-</span><br><span class="line">列出当前行后面或者前面的代码</span><br><span class="line">list linenum1, linenum2</span><br><span class="line">列出行linenum1和linenum2之间的代码</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">info</span> files</span><br><span class="line">显示当前的debug文件，包含程序入口地址，内存分段布局位置信息等</span><br><span class="line"><span class="builtin-name">info</span> breakpoints</span><br><span class="line">显示当前设置的断点列表</span><br><span class="line"><span class="builtin-name">info</span> registers</span><br><span class="line">显示当前寄存器的值，可以简写成i r。指定寄存器名称，可以查看具体寄存器信息：i r rsp</span><br><span class="line"><span class="builtin-name">info</span> all-registers</span><br><span class="line">显示所有寄存器的值。GDB提供四个标准寄存器：pc是程序计数器寄存器，sp是堆栈指针。fp用于记录当前堆栈帧的指针，ps用于记录处理器状态的寄存器，GDB会处理好不同架构系统寄存器不一致问题，比如对于amd64架构，pc对应就是rip寄存器。</span><br><span class="line">引用寄存器内容是将寄存器名前置符作为变量来用。比如符作为变量来用。比如符作为变量来用。比如pc就是程序计数器寄存器值。</span><br><span class="line"><span class="builtin-name">info</span> args</span><br><span class="line">显示当前函数参数</span><br><span class="line"><span class="builtin-name">info</span> locals</span><br><span class="line">显示当前局部变量</span><br><span class="line"><span class="builtin-name">info</span> frame</span><br><span class="line">查看当前栈帧的详细信息，包括rip信息，正在运行的指令所在文件位置</span><br><span class="line"><span class="builtin-name">info</span> variables</span><br><span class="line">查看程序中的变量符号</span><br><span class="line"><span class="builtin-name">info</span> functions</span><br><span class="line">查看程序中的函数符号</span><br><span class="line"><span class="builtin-name">info</span> functions regexp</span><br><span class="line">通过正则匹配来查看程序中的函数符号</span><br><span class="line"><span class="builtin-name">info</span> goroutines</span><br><span class="line">显示当前执行的goroutine列表，带*的表示当前执行的。注意需要加载go runtime支持。</span><br><span class="line"><span class="builtin-name">info</span> stack</span><br><span class="line">查看栈信息</span><br><span class="line"><span class="builtin-name">info</span> proc mappings</span><br><span class="line">可以简写成i proc m。用来查看应用内存映射</span><br><span class="line"><span class="builtin-name">info</span> proc [procid]</span><br><span class="line">显示进程信息</span><br><span class="line"><span class="builtin-name">info</span> proc status</span><br><span class="line">显示进程相关信息，包括user id和group id；进程内有多少线程；虚拟内存的使用；挂起的信号，阻塞的信号，忽略的信号；TTY；消耗的系统和用户时间；堆栈大小；nice值</span><br><span class="line"><span class="builtin-name">info</span> display</span><br><span class="line"><span class="builtin-name">info</span> watchpoints</span><br><span class="line">列出当前所设置了的所有观察点</span><br><span class="line"><span class="builtin-name">info</span> line [linenum]</span><br><span class="line">查看第linenum的代码指令地址信息，不带linenum时，显示的是当前位置的指令地址信息</span><br><span class="line"><span class="builtin-name">info</span> source</span><br><span class="line">显示此源代码的源代码语言</span><br><span class="line"><span class="builtin-name">info</span> sources</span><br><span class="line">显示程序中所有有调试信息的源文件名，一共显示两个列表：一个是其符号信息已经读过的，一个是还未读取过的</span><br><span class="line"><span class="builtin-name">info</span> types</span><br><span class="line">显示程序中所有类型符号</span><br><span class="line"><span class="builtin-name">info</span> types regexp</span><br><span class="line">通过正则匹配来查看程序中的类型符号</span><br><span class="line"></span><br><span class="line">show args</span><br><span class="line">查看命令行参数</span><br><span class="line">show environment [envname]</span><br><span class="line">查看环境变量信息</span><br><span class="line">show paths</span><br><span class="line">查看程序的运行路径</span><br><span class="line">whatis var1</span><br><span class="line">显示变量var1类型</span><br><span class="line">ptype var1</span><br><span class="line">显示变量var1类型，若是var1结构体类型，会显示该结构体定义信息。</span><br><span class="line"></span><br><span class="line">(gdb) where</span><br><span class="line"><span class="comment">#0  _rt0_amd64 ()</span></span><br><span class="line">    at /usr/lib/go/src/runtime/asm_amd64.s:15</span><br><span class="line"><span class="comment">#1  0x0000000000000001 in ?? ()</span></span><br><span class="line"><span class="comment">#2  0x00007fffffffdd2c in ?? ()</span></span><br><span class="line"><span class="comment">#3  0x0000000000000000 in ?? ()</span></span><br><span class="line"></span><br><span class="line">(gdb) watch sum </span><br><span class="line"></span><br><span class="line"><span class="comment">#show the assembly code </span></span><br><span class="line">(gdb) <span class="builtin-name">set</span> disassemble-next-line on</span><br><span class="line">(gdb) disassemble main.main</span><br><span class="line">(gdb) disas /m main.main</span><br><span class="line">(gdb) <span class="builtin-name">set</span> disassembly-flavor intel ## show the AT&amp;A <span class="keyword">to</span> intel mode</span><br><span class="line"></span><br><span class="line">display &lt;expr&gt;</span><br><span class="line">display /&lt;fmt&gt; &lt;expr&gt;</span><br><span class="line">display /&lt;fmt&gt; &lt;addr&gt;</span><br><span class="line"></span><br><span class="line">(gdb) display /i <span class="variable">$pc</span></span><br><span class="line">(gdb) display /3i <span class="variable">$pc</span> # 一次性显示3条指令</span><br><span class="line"></span><br><span class="line">(gdb) backtrace # 显示当前函数的栈帧以及局部变量信息</span><br><span class="line">(gdb) backtrace full # 显示各个函数的栈帧以及局部变量值</span><br><span class="line">(gdb) backtrace full n # 从内向外显示n个栈桢，及其局部变量</span><br><span class="line">(gdb) backtrace full -n # 从外向内显示n个栈桢，及其局部变量</span><br><span class="line"></span><br><span class="line"><span class="comment">#for multithreads</span></span><br><span class="line"><span class="builtin-name">info</span> threads</span><br><span class="line">显示当前可调式的所有线程，线程 ID 前有 “*” 表示当前被调试的线程。</span><br><span class="line">thread threadid</span><br><span class="line">切换线程到线程threadid</span><br><span class="line"><span class="builtin-name">set</span> scheduler-locking [on|off|<span class="keyword">step</span>]</span><br><span class="line">多线程环境下，会存在多个线程运行，这会影响调试某个线程的结果，这个命令可以设置调试的时候多个线程的运行情况，on 表示只有当前调试的线程会继续执行，off 表示不屏蔽任何线程，所有线程都可以执行，<span class="keyword">step</span> 表示在单步执行时，只有当前线程会执行。</span><br><span class="line">thread apply [threadid] [all] args</span><br><span class="line">对线程列表执行命令。比如通过thread apply all bt full可以查看所有线程的局部变量信息。</span><br><span class="line"></span><br><span class="line">x 按十六进制格式显示变量</span><br><span class="line">d 按十进制格式显示变量</span><br><span class="line">u 按十六进制格式显示无符号整型</span><br><span class="line">o 按八进制格式显示变量</span><br><span class="line">t 按二进制格式显示变量</span><br><span class="line">a 按十六进制格式显示变量</span><br><span class="line">c 按字符格式显示变量</span><br><span class="line">f 按浮点数格式显示变量</span><br><span class="line">expr可以是一个变量，也可以是表达式，也可以是寄存器：</span><br><span class="line"></span><br><span class="line">(gdb) p var1 # 打印变量var1</span><br><span class="line">(gdb) p &amp;var1 # 打印变量var1地址</span><br><span class="line">(gdb) p <span class="variable">$rsp</span> # 打印rsp寄存器地址</span><br><span class="line">(gdb) p <span class="variable">$rsp</span> + 8 # 打印rsp加8后的地址信息</span><br><span class="line">(gdb) p 0xc000068fd0 # 打印0xc000068fd0转换成10进制格式</span><br><span class="line">(gdb) p /x 824634150864 # 打印824634150864转换成16进制格式</span><br><span class="line"></span><br><span class="line">例如对于如下代码：int arr[] = &#123;2, 4, 6, 8, 10&#125;;，可以通过如下命令查看arr前三个单元的数据：</span><br><span class="line">(gdb) p <span class="number">*a</span>rr@3</span><br><span class="line"><span class="variable">$2</span> = &#123;2, 4, 6&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xamine命令用来查看内存地址中的值，可以简写成x。examine命令的语法如下所示：</span><br><span class="line"></span><br><span class="line">examine /&lt;n/f/u&gt;</span><br><span class="line"></span><br><span class="line">n 表示显示字段的长度，也就是说从当前地址向后显示几个地址的内容。</span><br><span class="line"></span><br><span class="line">f 表示显示的格式</span><br><span class="line"></span><br><span class="line">d 数字 decimal</span><br><span class="line">u 无符号数字 unsigned decimal</span><br><span class="line">s 字符串 string</span><br><span class="line">c 字符 char</span><br><span class="line">u 无符号整数 unsigned integer</span><br><span class="line">t 二进制 binary</span><br><span class="line">o 八进制格式 octal</span><br><span class="line">x 十六进制格式 hex</span><br><span class="line">f 浮点数格式 float</span><br><span class="line">i 指令 instruction</span><br><span class="line">a 地址 address</span><br><span class="line">u 表示从当前地址往后请求的字节数，默认是4个bytes</span><br><span class="line"></span><br><span class="line">b 一个字节 byte</span><br><span class="line">h 两个字节 halfword</span><br><span class="line">w 四个字节 word</span><br><span class="line">g 八个字节 giantword</span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">(gdb) x/10c 0x4005d4 # 打印前10个字符</span><br><span class="line">(gdb) x/16xb a # 以16进制格式打印数组前a16个byte的值</span><br><span class="line">(gdb) x/16ub a # 以无符号10进制格式打印数组a前16个byte的值</span><br><span class="line">(gdb) x/16tb a # 以2进制格式打印数组前16个abyte的值</span><br><span class="line">(gdb) x/16xw a # 以16进制格式打印数组a前16个word（4个byte）的值</span><br><span class="line">(gdb) x <span class="variable">$rsp</span> # 打印rsp寄存器执行的地址的值</span><br><span class="line">(gdb) x <span class="variable">$rsp</span> + 8 # 打印rsp加8后的地址指向的值</span><br><span class="line">(gdb) x 0xc000068fd0 # 打印内存0xc000068fd0指向的值</span><br><span class="line"></span><br><span class="line">(gdb) <span class="builtin-name">set</span> var <span class="attribute">var1</span>=123 # 设置变量var1值为123</span><br><span class="line">(gdb) <span class="builtin-name">set</span> var <span class="variable">$rax</span>=123 # 设置寄存器值为123</span><br><span class="line">(gdb) <span class="builtin-name">set</span> environment <span class="attribute">envname1</span>=123 # 设置环境变量envname1值为123</span><br><span class="line"></span><br><span class="line">(gdb) help status # 查看所有命令使用示例</span><br><span class="line">(gdb) help x # 查看x命令使用帮助</span><br><span class="line"></span><br><span class="line">(gdb) search func <span class="builtin-name">add</span> # 从当前位置向前搜索add方法</span><br><span class="line">(gdb) rev func <span class="builtin-name">add</span> # 从当前为向后搜索add方法</span><br><span class="line"></span><br><span class="line">(gdb) <span class="builtin-name">set</span> height 0</span><br><span class="line">(gdb) <span class="builtin-name">set</span><span class="built_in"> logging </span>file /tmp/thread_apply_all_bt.txt</span><br><span class="line">(gdb) <span class="builtin-name">set</span><span class="built_in"> logging </span>on</span><br><span class="line">Copying output <span class="keyword">to</span> /tmp/thread_apply_all_bt.txt</span><br><span class="line"></span><br><span class="line">Request a backtrace:</span><br><span class="line"></span><br><span class="line">(gdb) thread apply all bt full</span><br><span class="line"></span><br><span class="line">$ valgrind <span class="attribute">--tool</span>=helgrind ./a.out </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b func_name <span class="keyword">if</span> var_name == 5</span><br></pre></td></tr></table></figure>

<p>info break (i b)<br>i b n</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b main</span><br><span class="line">Breakpoint 1 at 0x564b218ff830: file ./bubble_sort_bug.c, line 29.</span><br><span class="line">(gdb) b <span class="built_in">exit</span></span><br><span class="line">Breakpoint 2 at 0x7f258be23120: file exit.c, line 139.</span><br><span class="line">(gdb) i b</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep y   0x0000564b218ff830 <span class="keyword">in</span> main at ./bubble_sort_bug.c:29</span><br><span class="line">2       breakpoint     keep y   0x00007f258be23120 <span class="keyword">in</span> __GI_exit at exit.c:139</span><br><span class="line">(gdb) i b 2</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">2       breakpoint     keep y   0x00007f258be23120 <span class="keyword">in</span> __GI_exit at exit.c:139</span><br><span class="line">(gdb) b main <span class="keyword">if</span> i==1</span><br><span class="line">Breakpoint 4 at 0x555555554830: file ./bubble_sort_bug.c, line 29.</span><br></pre></td></tr></table></figure>

<p>watch var   It is stopped by the gdb after the write has occurred<br>rwatch var  It is stopped by the gdb after the read has occurred<br>awatch var  It is stopped by the gdb after the read and write have occurred</p>
<p>step  (in function0<br>next  (not go to function)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info b</span><br><span class="line">No breakpoints or watchpoints.</span><br><span class="line">(gdb) watch a <span class="keyword">if</span> a==5 </span><br><span class="line">Hardware watchpoint 3: a</span><br><span class="line">(gdb) info b</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">3       hw watchpoint  keep y                      a</span><br><span class="line">	stop only <span class="keyword">if</span> a==5</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Thread 2 <span class="string">&quot;a.out&quot;</span> hit Hardware watchpoint 3: a</span><br><span class="line"></span><br><span class="line">Old value = 4</span><br><span class="line">New value = 5</span><br><span class="line">thread1_func (p_arg=0x555555554844) at thread1.c:10</span><br><span class="line">10	                sleep(10);</span><br><span class="line">(gdb)</span><br><span class="line"></span><br><span class="line">(gdb) info watchpoints</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">3       hw watchpoint  keep y                      a</span><br><span class="line">	stop only <span class="keyword">if</span> a==5</span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(gdb) watch 0x600850</span><br><span class="line">Cannot watch constant value 0x600850.</span><br><span class="line">(gdb) watch *(int *) 0x600850</span><br><span class="line">Watchpoint 1: *(int *) 6293584 </span><br></pre></td></tr></table></figure>

<p>catch <event><br>tcatch <event>  (temp catch)<br>event: throw,catch,exec,fork,load,unload,exception,exception unhandled,assert,syscall [name | number ],</p>
<p>(gdb) catch syscall open<br>Catchpoint 7 (syscall ‘open’ [2])<br>(gdb) catch syscall 5<br>Catchpoint 8 (syscall ‘fstat’ [5])<br>(gdb) help catch syscall<br>Catch system calls by their names, groups and/or numbers.<br>Arguments say which system calls to catch.  If no arguments are given,<br>every system call will be caught.  Arguments, if given, should be one<br>or more system call names (if your system supports that), system call<br>groups or system call numbers.</p>
<p>for more syscall<br>/usr/include/x86_64-linux-gnu/asm/unistd_64.h</p>
<p>clear #clear all<br>clear function<br>clear linenum</p>
<p>delete beakpoints [range,eg: 1-5]</p>
<p>enable/disable breakpoints [range]<br>enable breakpoints once range<br>enable breakpoints delete range</p>
<p>set logging file the_log_filename<br>set logging on/off<br>set env PATH=/tmp/bin<br>set listsize 25</p>
<h1 id="set-print-variable-length"><a href="#set-print-variable-length" class="headerlink" title="set print variable length"></a>set print variable length</h1><p>set print elements 250<br>set print elements 0 #no limit</p>
<p>set step-mode on<br>This is useful in cases where you may be interested in inspecting the machine instructions of a function which has no symbolic info and do not want GDB to automatically skip over this function.</p>
<p>save br .gdb_20200601<br>-x .gdb_20200601</p>
<p>finish<br>Continue running until just after function in the selected stack frame returns. Print the returned value (if any). This command can be abbreviated as fin.</p>
<p>return</p>
<p>print expr<br>Evaluate the expression expr and display the resulting value. The expression may include calls to functions in the program being debugged.</p>
<p>call expr<br>Evaluate the expression expr without displaying void returned values.<br>You can use this variant of the print command if you want to execute a function from your program that does not return anything (a.k.a. a void function), but without cluttering the output with void returned values that GDB will otherwise print. If the result is not void, it is printed and saved in the value history.<br>It is possible for the function you call via the print or call command to generate a signal (e.g., if there’s a bug in the function, or if you passed it incorrect arguments). What happens in that case is controlled by the set unwindonsignal command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">(gdb) bt</span><br><span class="line"><span class="comment">#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51</span></span><br><span class="line"><span class="comment">#1  0x00007f258be20801 in __GI_abort () at abort.c:79</span></span><br><span class="line"><span class="comment">#2  0x00007f258be69897 in __libc_message (action=action@entry=do_abort, </span></span><br><span class="line">    fmt=fmt@entry=0x7f258bf96988 <span class="string">&quot;*** %s ***: %s terminated\n&quot;</span>) at ../sysdeps/posix/libc_fatal.c:181</span><br><span class="line"><span class="comment">#3  0x00007f258bf14cd1 in __GI___fortify_fail_abort (need_backtrace=need_backtrace@entry=false, </span></span><br><span class="line">    msg=msg@entry=0x7f258bf96966 <span class="string">&quot;stack smashing detected&quot;</span>) at fortify_fail.c:33</span><br><span class="line"><span class="comment">#4  0x00007f258bf14c92 in __stack_chk_fail () at stack_chk_fail.c:29</span></span><br><span class="line"><span class="comment">#5  0x0000564b218ff8e9 in main () at ./bubble_sort_bug.c:43</span></span><br><span class="line"></span><br><span class="line">(gdb) f 2</span><br><span class="line"><span class="comment">#2  0x00007f258be69897 in __libc_message (action=action@entry=do_abort, </span></span><br><span class="line">    fmt=fmt@entry=0x7f258bf96988 <span class="string">&quot;*** %s ***: %s terminated\n&quot;</span>) at ../sysdeps/posix/libc_fatal.c:181</span><br><span class="line">181	../sysdeps/posix/libc_fatal.c: No such file or directory.</span><br><span class="line">(gdb) up</span><br><span class="line"><span class="comment">#3  0x00007f258bf14cd1 in __GI___fortify_fail_abort (need_backtrace=need_backtrace@entry=false, </span></span><br><span class="line">    msg=msg@entry=0x7f258bf96966 <span class="string">&quot;stack smashing detected&quot;</span>) at fortify_fail.c:33</span><br><span class="line">33	fortify_fail.c: No such file or directory.</span><br><span class="line">(gdb) down</span><br><span class="line"><span class="comment">#2  0x00007f258be69897 in __libc_message (action=action@entry=do_abort, </span></span><br><span class="line">    fmt=fmt@entry=0x7f258bf96988 <span class="string">&quot;*** %s ***: %s terminated\n&quot;</span>) at ../sysdeps/posix/libc_fatal.c:181</span><br><span class="line">181	../sysdeps/posix/libc_fatal.c: No such file or directory.</span><br><span class="line"></span><br><span class="line">(gdb) f 5</span><br><span class="line"><span class="comment">#5  0x0000564b218ff8e9 in main () at ./bubble_sort_bug.c:43</span></span><br><span class="line">43	&#125;</span><br><span class="line">(gdb) info f</span><br><span class="line">Stack level 5, frame at 0x7ffd58ea9f80:</span><br><span class="line"> rip = 0x564b218ff8e9 <span class="keyword">in</span> main (./bubble_sort_bug.c:43); saved rip = 0x7f258be01b97</span><br><span class="line"> <span class="built_in">caller</span> of frame at 0x7ffd58ea9e40</span><br><span class="line"> <span class="built_in">source</span> language c.</span><br><span class="line"> Arglist at 0x7ffd58ea9f70, args: </span><br><span class="line"> Locals at 0x7ffd58ea9f70, Previous frame<span class="string">&#x27;s sp is 0x7ffd58ea9f80</span></span><br><span class="line"><span class="string"> Saved registers:</span></span><br><span class="line"><span class="string">  rbx at 0x7ffd58ea9f68, rbp at 0x7ffd58ea9f70, rip at 0x7ffd58ea9f78</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) info args</span></span><br><span class="line"><span class="string">No arguments.</span></span><br><span class="line"><span class="string">(gdb) info locals</span></span><br><span class="line"><span class="string">array = &#123;20424913, 207764369, 232957269, 286304630, 340051919, 418929367, 428095442, 560929304, 622631137, </span></span><br><span class="line"><span class="string">  681405812, 702646332, 717507172, 771731937, 844764348, 871741416, 893622553, 939367001, 953569863, 983680782, </span></span><br><span class="line"><span class="string">  1133421906, 1150235085, 1170267861, 1267699692, 1278859841, 1351132359, 1478380837, 1618765791, 1747714870, </span></span><br><span class="line"><span class="string">  2015283722, 2027462427, 2046956728, 2080576919&#125;</span></span><br><span class="line"><span class="string">i = 36</span></span><br></pre></td></tr></table></figure>

<p>info</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info <span class="built_in">functions</span> thread1_func </span><br><span class="line">All <span class="built_in">functions</span> matching regular expression <span class="string">&quot;thread1_func&quot;</span>:</span><br><span class="line"></span><br><span class="line">File thread1.c:</span><br><span class="line">void *thread1_func(void *);</span><br></pre></td></tr></table></figure>

<p>print</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">(gdb) list</span><br><span class="line">1	<span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">2	<span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line">3</span><br><span class="line">4	void printArray(int arr[], int n)</span><br><span class="line">5	&#123;</span><br><span class="line">6	   <span class="keyword">for</span> (int i=0; i&lt;n; i++) &#123;</span><br><span class="line">7	     arr[i]=arr[i]+i;</span><br><span class="line">8	     <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[i]);</span><br><span class="line">9	   &#125;</span><br><span class="line">10	&#125;</span><br><span class="line">11</span><br><span class="line">12	int main()</span><br><span class="line">13	&#123;</span><br><span class="line">14	    int n = 10;</span><br><span class="line">15	    int arr[n];</span><br><span class="line">16</span><br><span class="line">17	    // Fill whole array with 100.</span><br><span class="line">18	    memset(arr, 10, n*sizeof(arr[0]));</span><br><span class="line">19	    <span class="built_in">printf</span>(<span class="string">&quot;Array after memset()\n&quot;</span>);</span><br><span class="line">20	    printArray(arr, n);</span><br><span class="line">21</span><br><span class="line">22	    <span class="built_in">return</span> 0;</span><br><span class="line">23	&#125;</span><br><span class="line"></span><br><span class="line">(gdb) info b</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep y   0x00000000004005d5 <span class="keyword">in</span> printArray at test2.c:7</span><br><span class="line">	breakpoint already hit 10 <span class="built_in">times</span></span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span><br><span class="line">7	     arr[i]=arr[i]+i;</span><br><span class="line">(gdb) <span class="built_in">print</span> arr</span><br><span class="line"><span class="variable">$13</span> = (int *) 0x7fffffffe0d0</span><br><span class="line">(gdb) <span class="built_in">print</span> *arr</span><br><span class="line"><span class="variable">$14</span> = 168430090</span><br><span class="line">(gdb) <span class="built_in">print</span> *arr@</span><br><span class="line">A syntax error <span class="keyword">in</span> expression, near `<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">(gdb) bt full</span></span><br><span class="line"><span class="string">#0  printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">        i = 3</span></span><br><span class="line"><span class="string">#1  0x00000000004006ec in main () at test2.c:20</span></span><br><span class="line"><span class="string">        n = 10</span></span><br><span class="line"><span class="string">        arr = &#123;168430090, 168430091, 168430092, 168430090, 168430090, 168430090, 168430090, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string">(gdb) p i</span></span><br><span class="line"><span class="string">$15 = 4</span></span><br><span class="line"><span class="string">(gdb) p arr[i]</span></span><br><span class="line"><span class="string">$16 = 168430090</span></span><br><span class="line"><span class="string">(gdb) p arr[20]</span></span><br><span class="line"><span class="string">$17 = -7664</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) c</span></span><br><span class="line"><span class="string">Continuing.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">7	     arr[i]=arr[i]+i;</span></span><br><span class="line"><span class="string">(gdb) p i</span></span><br><span class="line"><span class="string">$20 = 5</span></span><br><span class="line"><span class="string">(gdb) set arr[4]=125</span></span><br><span class="line"><span class="string">(gdb) bt full</span></span><br><span class="line"><span class="string">#0  printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">        i = 5</span></span><br><span class="line"><span class="string">#1  0x00000000004006ec in main () at test2.c:20</span></span><br><span class="line"><span class="string">        n = 10</span></span><br><span class="line"><span class="string">        arr = &#123;168430090, 168430091, 168430092, 168430093, 125, 168430090, 168430090, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) c</span></span><br><span class="line"><span class="string">Continuing.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">7	     arr[i]=arr[i]+i;</span></span><br><span class="line"><span class="string">(gdb) bt full</span></span><br><span class="line"><span class="string">#0  printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">        i = 6</span></span><br><span class="line"><span class="string">#1  0x00000000004006ec in main () at test2.c:20</span></span><br><span class="line"><span class="string">        n = 10</span></span><br><span class="line"><span class="string">        arr = &#123;168430090, 168430091, 168430092, 168430093, 168430094, 168430095, 168430090, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string">(gdb) p i</span></span><br><span class="line"><span class="string">No symbol &quot;i&quot; in current context.</span></span><br><span class="line"><span class="string">(gdb) p $i</span></span><br><span class="line"><span class="string">$24 = 5</span></span><br><span class="line"><span class="string">(gdb) set arr[$i]=10</span></span><br><span class="line"><span class="string">(gdb) set arr[$i++]=11</span></span><br><span class="line"><span class="string">(gdb) p arr[5]</span></span><br><span class="line"><span class="string">$26 = 10</span></span><br><span class="line"><span class="string">(gdb) p arr[6]</span></span><br><span class="line"><span class="string">$27 = 11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) p/t arr[6]</span></span><br><span class="line"><span class="string">$28 = 1011</span></span><br><span class="line"><span class="string">(gdb) p/x arr[6]</span></span><br><span class="line"><span class="string">$29 = 0xb</span></span><br><span class="line"><span class="string">(gdb) p/f arr[6]</span></span><br><span class="line"><span class="string">$30 = 1.54142831e-44</span></span><br><span class="line"><span class="string">(gdb) p/c arr[6]</span></span><br><span class="line"><span class="string">$31 = 11 &#x27;</span>\v<span class="string">&#x27;</span></span><br><span class="line"><span class="string">(gdb) p/d arr[6]</span></span><br><span class="line"><span class="string">$32 = 11</span></span><br><span class="line"><span class="string">(gdb) p/o arr[6]</span></span><br><span class="line"><span class="string">$33 = 013</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">examine (x command)</span></span><br><span class="line"><span class="string">(gdb) p arr</span></span><br><span class="line"><span class="string">$37 = &#123;168430090, 168430091, 168430092, 168430093, 168430094, 10, 11, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string">      __________ same with print format</span></span><br><span class="line"><span class="string">      |</span></span><br><span class="line"><span class="string">x/[n][f][u]</span></span><br><span class="line"><span class="string">   |     |</span></span><br><span class="line"><span class="string"> number  -------------- b. Bytes. h. Halfwords (two bytes). w. Words (four bytes) This is the initial default.  g. Giant words (eight bytes)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) x/10d arr</span></span><br><span class="line"><span class="string">0x7fffffffe0d0:	168430090	168430091	168430092	168430093</span></span><br><span class="line"><span class="string">0x7fffffffe0e0:	168430094	10	11	168430090</span></span><br><span class="line"><span class="string">0x7fffffffe0f0:	168430090	168430090</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) info reg</span></span><br><span class="line"><span class="string">rax            0x400aaae297396d09	4614688658370948361</span></span><br><span class="line"><span class="string">rbx            0x7fffffffe100	140737488347392</span></span><br><span class="line"><span class="string">rcx            0x7fffdfafe9b0	140736946235824</span></span><br><span class="line"><span class="string">rdx            0xa	10</span></span><br><span class="line"><span class="string">rsi            0xa	10</span></span><br><span class="line"><span class="string">rdi            0x7fffffffe0d0	140737488347344</span></span><br><span class="line"><span class="string">rbp            0x7fffffffe0c0	0x7fffffffe0c0</span></span><br><span class="line"><span class="string">rsp            0x7fffffffe090	0x7fffffffe090</span></span><br><span class="line"><span class="string">r8             0xffffffffffffffff	-1</span></span><br><span class="line"><span class="string">r9             0x0	0</span></span><br><span class="line"><span class="string">r10            0x22	34</span></span><br><span class="line"><span class="string">r11            0x246	582</span></span><br><span class="line"><span class="string">r12            0x4004d0	4195536</span></span><br><span class="line"><span class="string">r13            0x7fffffffe210	140737488347664</span></span><br><span class="line"><span class="string">r14            0x0	0</span></span><br><span class="line"><span class="string">r15            0x0	0</span></span><br><span class="line"><span class="string">rip            0x4005da	0x4005da &lt;printArray+29&gt;</span></span><br><span class="line"><span class="string">eflags         0x206	[ PF IF ]</span></span><br><span class="line"><span class="string">cs             0x33	51</span></span><br><span class="line"><span class="string">ss             0x2b	43</span></span><br><span class="line"><span class="string">ds             0x0	0</span></span><br><span class="line"><span class="string">es             0x0	0</span></span><br><span class="line"><span class="string">fs             0x0	0</span></span><br><span class="line"><span class="string">gs             0x0	0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) list</span></span><br><span class="line"><span class="string">1	#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">2	int main()</span></span><br><span class="line"><span class="string">3	&#123;</span></span><br><span class="line"><span class="string">4	        float x = 456.876;</span></span><br><span class="line"><span class="string">5	        printf (&quot;\nx = %f\n&quot;, x);</span></span><br><span class="line"><span class="string">6	        return 0;</span></span><br><span class="line"><span class="string">7	&#125;</span></span><br><span class="line"><span class="string">(gdb) b 4</span></span><br><span class="line"><span class="string">Breakpoint 1 at 0x400535: file float.c, line 4.</span></span><br><span class="line"><span class="string">(gdb) b 5</span></span><br><span class="line"><span class="string">Breakpoint 2 at 0x40053e: file float.c, line 5.</span></span><br><span class="line"><span class="string">(gdb) b 6</span></span><br><span class="line"><span class="string">Breakpoint 3 at 0x400555: file float.c, line 6.</span></span><br><span class="line"><span class="string">(gdb) c</span></span><br><span class="line"><span class="string">The program is not being run.</span></span><br><span class="line"><span class="string">(gdb) start</span></span><br><span class="line"><span class="string">Temporary breakpoint 4 at 0x400535: file float.c, line 4.</span></span><br><span class="line"><span class="string">Starting program: /root/./a.out</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, main () at float.c:4</span></span><br><span class="line"><span class="string">4	        float x = 456.876;</span></span><br><span class="line"><span class="string">(gdb) n</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 2, main () at float.c:5</span></span><br><span class="line"><span class="string">5	        printf (&quot;\nx = %f\n&quot;, x);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) p x</span></span><br><span class="line"><span class="string">$5 = 456.876007</span></span><br><span class="line"><span class="string">(gdb) x/fw &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe12c:	456.876007</span></span><br><span class="line"><span class="string">(gdb) x/tw &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe12c:	01000011111001000111000000100001</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### modify the float to double</span></span><br><span class="line"><span class="string">(gdb) list</span></span><br><span class="line"><span class="string">1	#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">2	int main()</span></span><br><span class="line"><span class="string">3	&#123;</span></span><br><span class="line"><span class="string">4	        //float x = 456.876;</span></span><br><span class="line"><span class="string">5	        double x = 456.876;</span></span><br><span class="line"><span class="string">6	        printf (&quot;\nx = %lf\n&quot;, x);</span></span><br><span class="line"><span class="string">7	        return 0;</span></span><br><span class="line"><span class="string">8	&#125;</span></span><br><span class="line"><span class="string">(gdb) x/1fg &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe128:	456.87599999999998</span></span><br><span class="line"><span class="string">(gdb) x/1tg &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe128:	0100000001111100100011100000010000011000100100110111010010111100</span></span><br><span class="line"><span class="string">(gdb) p x</span></span><br><span class="line"><span class="string">$6 = 456.87599999999998</span></span><br></pre></td></tr></table></figure>



<h3 id="print-argv"><a href="#print-argv" class="headerlink" title="print argv"></a><a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/set-program-args.html">print argv</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -g3 walk1.c -o walk</span><br><span class="line">$ gdb ./walk <span class="comment"># or you could $ gdb -args ./walk /tmp 10</span></span><br><span class="line">Reading symbols from /root/walk...done.</span><br><span class="line"></span><br><span class="line">(gdb) b main</span><br><span class="line">Breakpoint 1 at 0x400bb8: file walk1.c, line 73.</span><br><span class="line">(gdb) r /tmp 10 <span class="comment">#  or you could (gdb) set args /tmp 10</span></span><br><span class="line">Starting program: /root/./walk /tmp 10</span><br><span class="line"></span><br><span class="line">Breakpoint 1, main (argc=3, argv=0x7fffffffe138) at walk1.c:73</span><br><span class="line">73	    <span class="keyword">if</span>(argc != 3)</span><br><span class="line">(gdb) p argc</span><br><span class="line"><span class="variable">$1</span> = 3</span><br><span class="line">(gdb) p argv</span><br><span class="line"><span class="variable">$2</span> = (char **) 0x7fffffffe138</span><br><span class="line">(gdb) p argv[0]</span><br><span class="line"><span class="variable">$3</span> = 0x7fffffffe414 <span class="string">&quot;/root/./walk&quot;</span></span><br><span class="line">(gdb) p argv[1]</span><br><span class="line"><span class="variable">$4</span> = 0x7fffffffe421 <span class="string">&quot;/tmp&quot;</span></span><br><span class="line">(gdb) p argv[2]</span><br><span class="line"><span class="variable">$5</span> = 0x7fffffffe426 <span class="string">&quot;10&quot;</span></span><br><span class="line">(gdb)</span><br><span class="line"></span><br><span class="line"><span class="comment"># attach args</span></span><br><span class="line">$ gdb --args /bin/bash -c <span class="string">&#x27;ls -l&#x27;</span></span><br><span class="line">$ <span class="built_in">set</span> listsize 40</span><br><span class="line">$ p *args@4 </span><br><span class="line"></span><br><span class="line"><span class="comment"># if the software was install by source, you could add --directory for import debug symbol</span></span><br><span class="line"><span class="comment"># re-complie bash</span></span><br><span class="line"></span><br><span class="line">$ gdb --args /usr/<span class="built_in">local</span>/bin/bash -c <span class="string">&#x27;echo [1g]&#x27;</span> --directory ~/tools/bash-4.4</span><br><span class="line">(gdb) la src</span><br><span class="line"></span><br><span class="line"><span class="comment">## if you want disable optimze</span></span><br><span class="line">$ CFLAGS=<span class="string">&quot;-g -O0&quot;</span> CXXFLAGS=<span class="string">&quot;-g -O0&quot;</span> LDFLAGS=<span class="string">&quot;-g&quot;</span>  ./configure --enable-debugger</span><br><span class="line">$ CFLAGS=<span class="string">&quot;-g -O0&quot;</span> CXXFLAGS=<span class="string">&quot;-g -O0&quot;</span> LDFLAGS=<span class="string">&quot;-g&quot;</span>  ./make -j 2</span><br><span class="line"></span><br><span class="line"><span class="comment">## set debug directory</span></span><br><span class="line">(gdb) <span class="built_in">set</span> debug-file-directory &lt;directory&gt;</span><br><span class="line">(gdb) show debug-file-directory</span><br><span class="line">(gdb) <span class="built_in">set</span> debug-file-directory /usr/lib/debug</span><br><span class="line">add-symbol-file filename address</span><br><span class="line">add-symbol-file filename address [ -readnow ] [ -mapped ]</span><br><span class="line">add-symbol-file filename -ssection address ...</span><br></pre></td></tr></table></figure>

<h4 id="threads"><a href="#threads" class="headerlink" title="threads"></a>threads</h4><p>Demo code</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">mutex _mutex;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//g++ -std=c++11 testthread.cpp -o testthread -lpthread -g</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        lock_guard&lt;mutex&gt;lock(_mutex);</span><br><span class="line">        total +=num;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;num:&quot;</span>&lt;&lt;num&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">thread <span class="title">t1</span><span class="params">(fun,<span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="function">thread <span class="title">t2</span><span class="params">(fun,<span class="number">5</span>)</span></span>;</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ gdb ./testthread</span><br><span class="line">$ info threads</span><br><span class="line">$ thread <span class="number">3</span> </span><br><span class="line">$ <span class="built_in">set</span> scheduler-locking on</span><br></pre></td></tr></table></figure>

<p>generate-core-file<br>``bash<br>(gdb) generate-core-file</p>
<h1 id="or"><a href="#or" class="headerlink" title="or"></a>or</h1><p>gcore $pid</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### [golang](https:<span class="comment">//juejin.cn/post/6931942984376139783)</span></span><br><span class="line">```bash</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">func add(a, b int) int &#123;</span><br><span class="line">        <span class="keyword">sum</span> := 0</span><br><span class="line">        <span class="keyword">sum</span> = a + b</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">sum</span></span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">        <span class="keyword">sum</span> := add(10, 20)</span><br><span class="line">        fmt.Println(<span class="keyword">sum</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ go build -gcflags=<span class="string">&quot;-N -l&quot;</span> -o <span class="keyword">test</span> main.go</span><br><span class="line">$ gdb ./<span class="keyword">test</span></span><br><span class="line"></span><br><span class="line">$ gdb <span class="keyword">test</span> 1785 </span><br><span class="line">$ gdb <span class="keyword">test</span> --pid 1785</span><br><span class="line"></span><br><span class="line">$ gdb</span><br><span class="line">(gdb) <span class="keyword">file</span> <span class="keyword">test</span></span><br><span class="line">Reading symbols from <span class="keyword">test</span>...done.</span><br><span class="line">(gdb) attach 1785</span><br><span class="line"></span><br><span class="line">$ gdb <span class="keyword">test</span> -tui</span><br><span class="line"></span><br><span class="line">(gdb) <span class="keyword">run</span> arg1 arg2</span><br><span class="line">or</span><br><span class="line">(gdb) <span class="keyword">set</span> <span class="keyword">args</span> arg1 arg2</span><br><span class="line">(gdb) <span class="keyword">run</span></span><br><span class="line"></span><br><span class="line">(gdb) start</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gdb -p <span class="variable">$pid</span></span><br><span class="line">(gdb) disas readline</span><br></pre></td></tr></table></figure>

<h3 id="debug-with-python"><a href="#debug-with-python" class="headerlink" title="debug with python"></a><a target="_blank" rel="noopener" href="https://mozillazg.com/2017/07/debug-running-python-process-with-gdb.html">debug with python</a></h3><h3 id="gdb-note"><a href="#gdb-note" class="headerlink" title="gdb note"></a>gdb note</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arch/x86/entry/calling<span class="number">.</span>h</span><br><span class="line">x86 function <span class="keyword">call</span> convention, <span class="number">64</span>-bit:</span><br><span class="line">-------------------------------------</span><br><span class="line"> arguments           | callee-saved       | extra caller-saved | return</span><br><span class="line">[callee-clobbered]   |                    | [callee-clobbered] |</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line"><span class="built_in">rdi</span> <span class="built_in">rsi</span> <span class="built_in">rdx</span> <span class="built_in">rcx</span> <span class="built_in">r8</span>-<span class="number">9</span> | <span class="built_in">rbx</span> <span class="built_in">rbp</span> [*] <span class="built_in">r12</span>-<span class="number">15</span> | <span class="built_in">r10</span>-<span class="number">11</span>             | <span class="built_in">rax</span>, <span class="built_in">rdx</span> [**]</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> v1 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">float</span> v2 = <span class="number">0.01</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">long</span> b, <span class="keyword">short</span> c,<span class="keyword">char</span> d, <span class="keyword">long</span> <span class="keyword">long</span> e, <span class="keyword">float</span> f, <span class="keyword">double</span> g, <span class="keyword">int</span> *h, <span class="keyword">float</span> *i, <span class="keyword">char</span> *j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;a: %d, b:%ld, c:%d, d: %c, e: %lld\n&quot;</span></span><br><span class="line">   <span class="string">&quot;f: %.3e, g:%.3e\nh: %p, i: %p, j:%p\n&quot;</span>, a, b, c, d, e, f, g, h, i, j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  func(<span class="number">100</span>, <span class="number">35000L</span>, <span class="number">5</span>, <span class="string">&#x27;A&#x27;</span>, <span class="number">123456789L</span>L, <span class="number">3.14</span>, <span class="number">2.99792458e8</span>, &amp;v1, &amp;v2, <span class="string">&quot;string&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b *func</span><br><span class="line">Breakpoint 1 at 0x40052d: file c_para.c, line 7.</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /root/codes/./c_para</span><br><span class="line"></span><br><span class="line">Breakpoint 1, func (a=0, b=1, c=1629, d=0 <span class="string">&#x27;\000&#x27;</span>, e=0, f=2.21061657e-38, g=0, h=0x76, i=0x601038 &lt;v2&gt;, j=0x4006e7 <span class="string">&quot;string&quot;</span>) at c_para.c:7</span><br><span class="line">7	&#123;</span><br><span class="line">(gdb) i r</span><br><span class="line">rax            0x41b1de784a000000	4733809291562057728</span><br><span class="line">rbx            0x0	0</span><br><span class="line">rcx            0x41	65                     -------&gt; args[3]</span><br><span class="line">rdx            0x5	5                      -------&gt; args[2]</span><br><span class="line">rsi            0x88b8	35000                  -------&gt; args[1]</span><br><span class="line">rdi            0x64	100                    -------&gt; args[0]</span><br><span class="line">rbp            0x7fffffffe400	0x7fffffffe400</span><br><span class="line">rsp            0x7fffffffe3d8	0x7fffffffe3d8</span><br><span class="line">r8             0x75bcd15	123456789      -------&gt; args[4], args[5] and args[6] is the <span class="built_in">float</span> and double <span class="built_in">type</span>, save <span class="keyword">in</span> xmm (128 bits)</span><br><span class="line">r9             0x601034	6295604                -------&gt; args[7]</span><br><span class="line">r10            0x7fffffffdf20	140737488346912</span><br><span class="line">r11            0x7ffff7a2f460	140737348039776</span><br><span class="line">r12            0x400440	4195392</span><br><span class="line">r13            0x7fffffffe4e0	140737488348384</span><br><span class="line">r14            0x0	0</span><br><span class="line">r15            0x0	0</span><br><span class="line">rip            0x40052d	0x40052d &lt;func&gt;</span><br><span class="line">eflags         0x202	[ IF ]</span><br><span class="line">cs             0x33	51</span><br><span class="line">ss             0x2b	43</span><br><span class="line">ds             0x0	0</span><br><span class="line">es             0x0	0</span><br><span class="line">fs             0x0	0</span><br><span class="line">gs             0x0	0</span><br><span class="line"></span><br><span class="line"><span class="comment">#because no enough register, two parameters save in stack (rsp register)</span></span><br><span class="line"><span class="comment">#In the stack begining, there is the function return addr, In x86_64, int and point size is the giant word (32 bits, 4 Bytes)</span></span><br><span class="line">0x7fffffffe3e8-0x7fffffffe3d8=16(dec)</span><br><span class="line"></span><br><span class="line">(gdb) x/3g <span class="variable">$rsp</span></span><br><span class="line">0x7fffffffe3d8:	4195844	6295608</span><br><span class="line">0x7fffffffe3e8:	4196071</span><br><span class="line"></span><br><span class="line"><span class="comment">#$rsp+0xc means The memory location 12 bytes above current stack pointer</span></span><br><span class="line"></span><br><span class="line">6295608=0x601038</span><br><span class="line">(gdb) <span class="built_in">printf</span> <span class="string">&quot;%.2f\n&quot;</span>, *(<span class="built_in">float</span>*)0x601038</span><br><span class="line">0.01</span><br><span class="line"></span><br><span class="line">or </span><br><span class="line">(gdb) <span class="built_in">printf</span> <span class="string">&quot;%.2f\n&quot;</span>, *(<span class="built_in">float</span>*)(*(unsigned long*)(<span class="variable">$rsp</span>+0x8))</span><br><span class="line">0.01</span><br><span class="line"></span><br><span class="line">4196071=0x4006E7</span><br><span class="line">(gdb) p (char*)0x4006E7</span><br><span class="line"><span class="variable">$9</span> = 0x4006e7 <span class="string">&quot;string&quot;</span></span><br><span class="line"></span><br><span class="line">long 8 bytes (64bit OS), 4 bytes (32bit OS)</span><br><span class="line">Add 8 bytes, go to <span class="variable">$rsp</span>+0x10</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line">0x10=16</span><br><span class="line">(gdb) p (char*)(*(unsigned long*)(<span class="variable">$rsp</span>+0x10))</span><br><span class="line"><span class="variable">$11</span> = 0x4006e7 <span class="string">&quot;string&quot;</span></span><br><span class="line"></span><br><span class="line">(gdb) disas func</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> func:</span><br><span class="line">=&gt; 0x000000000040052d &lt;+0&gt;:	push   %rbp</span><br><span class="line">   0x000000000040052e &lt;+1&gt;:	mov    %rsp,%rbp</span><br><span class="line">   0x0000000000400531 &lt;+4&gt;:	sub    <span class="variable">$0x50</span>,%rsp</span><br><span class="line">   0x0000000000400535 &lt;+8&gt;:	mov    %edi,-0x4(%rbp)</span><br><span class="line">   0x0000000000400538 &lt;+11&gt;:	mov    %rsi,-0x10(%rbp)</span><br><span class="line">   0x000000000040053c &lt;+15&gt;:	mov    %ecx,%eax</span><br><span class="line">   0x000000000040053e &lt;+17&gt;:	mov    %r8,-0x20(%rbp)</span><br><span class="line">   0x0000000000400542 &lt;+21&gt;:	movss  %xmm0,-0x18(%rbp)</span><br><span class="line">   0x0000000000400547 &lt;+26&gt;:	movsd  %xmm1,-0x28(%rbp)</span><br><span class="line">   0x000000000040054c &lt;+31&gt;:	mov    %r9,-0x30(%rbp)</span><br><span class="line">   0x0000000000400550 &lt;+35&gt;:	mov    %dx,-0x8(%rbp)</span><br><span class="line">   0x0000000000400554 &lt;+39&gt;:	mov    %al,-0x14(%rbp)</span><br><span class="line">   0x0000000000400557 &lt;+42&gt;:	movss  -0x18(%rbp),%xmm0</span><br><span class="line">   0x000000000040055c &lt;+47&gt;:	cvtps2pd %xmm0,%xmm0</span><br><span class="line">   0x000000000040055f &lt;+50&gt;:	movsbl -0x14(%rbp),%r8d</span><br><span class="line">   0x0000000000400564 &lt;+55&gt;:	movswl -0x8(%rbp),%ecx</span><br><span class="line">   0x0000000000400568 &lt;+59&gt;:	mov    -0x28(%rbp),%rax</span><br><span class="line">   0x000000000040056c &lt;+63&gt;:	mov    -0x20(%rbp),%r9</span><br><span class="line">   0x0000000000400570 &lt;+67&gt;:	mov    -0x10(%rbp),%rdx</span><br><span class="line">   0x0000000000400574 &lt;+71&gt;:	mov    -0x4(%rbp),%esi</span><br><span class="line">   0x0000000000400577 &lt;+74&gt;:	mov    0x18(%rbp),%rdi</span><br><span class="line">   0x000000000040057b &lt;+78&gt;:	mov    %rdi,0x10(%rsp)</span><br><span class="line">   0x0000000000400580 &lt;+83&gt;:	mov    0x10(%rbp),%rdi</span><br><span class="line">   0x0000000000400584 &lt;+87&gt;:	mov    %rdi,0x8(%rsp)</span><br><span class="line">   0x0000000000400589 &lt;+92&gt;:	mov    -0x30(%rbp),%rdi</span><br><span class="line">   0x000000000040058d &lt;+96&gt;:	mov    %rdi,(%rsp)</span><br><span class="line">   0x0000000000400591 &lt;+100&gt;:	mov    %rax,-0x38(%rbp)</span><br><span class="line">   0x0000000000400595 &lt;+104&gt;:	movsd  -0x38(%rbp),%xmm1</span><br><span class="line">   0x000000000040059a &lt;+109&gt;:	mov    <span class="variable">$0x4006a0</span>,%edi</span><br><span class="line">   0x000000000040059f &lt;+114&gt;:	mov    <span class="variable">$0x2</span>,%eax</span><br><span class="line">   0x00000000004005a4 &lt;+119&gt;:	callq  0x400410 &lt;<span class="built_in">printf</span>@plt&gt;</span><br><span class="line">   0x00000000004005a9 &lt;+124&gt;:	leaveq</span><br><span class="line">   0x00000000004005aa &lt;+125&gt;:	retq</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>

<ul>
<li><p>stack</p>
<ul>
<li>LIFO (Last In first out)</li>
<li>push data in stack</li>
<li>pop data out of the stack</li>
</ul>
</li>
<li><p>stack frame</p>
<ul>
<li>Lower to high addr</li>
<li>frame point (FP)<ul>
<li>the start of the last frame<ul>
<li>in the bottom</li>
<li>$rbp register</li>
</ul>
</li>
</ul>
</li>
<li>stack point (SP)<ul>
<li>the end of the last frame<ul>
<li>always in the top addr</li>
<li>$sp register</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>$rip (instruction pointer)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">(gdb) bt</span><br><span class="line"><span class="comment">#0  sum_till_MAX (n=4) at sum.c:14</span></span><br><span class="line"><span class="comment">#1  0x0000000000400698 in sum_till_MAX (n=4) at sum.c:18</span></span><br><span class="line"><span class="comment">#2  0x0000000000400698 in sum_till_MAX (n=3) at sum.c:18</span></span><br><span class="line"><span class="comment">#3  0x0000000000400698 in sum_till_MAX (n=2) at sum.c:18</span></span><br><span class="line"><span class="comment">#4  0x0000000000400698 in sum_till_MAX (n=1) at sum.c:18</span></span><br><span class="line"><span class="comment">#5  0x0000000000400757 in main (argc=2, argv=0x7fffffffe4e8) at sum.c:33</span></span><br><span class="line">(gdb) i r rip rbp</span><br><span class="line">rip            0x400698	0x400698 &lt;sum_till_MAX+43&gt;</span><br><span class="line">rbp            0x7fffffffe370	0x7fffffffe370</span><br><span class="line">(gdb) x/40w <span class="variable">$sp</span></span><br><span class="line">0x7fffffffe350:	0x00000000	0x00000000	0x00000000	0x00000003</span><br><span class="line">0x7fffffffe360:	0x00000000	0x00000000	0x00000003	0x00000000</span><br><span class="line">0x7fffffffe370:	0xffffe3a0	0x00007fff	0x00400698	0x00000000</span><br><span class="line">0x7fffffffe380:	0x00000000	0x00000000	0xffffe405	0x00000002</span><br><span class="line">0x7fffffffe390:	0xffffffff	0xffffffff	0x00000002	0x00000000</span><br><span class="line">0x7fffffffe3a0:	0xffffe3d0	0x00007fff	0x00400698	0x00000000</span><br><span class="line">0x7fffffffe3b0:	0xffffe400	0x00007fff	0x00400580	0x00000001</span><br><span class="line">0x7fffffffe3c0:	0xffffe4e0	0x00007fff	0x00000001	0x00000000</span><br><span class="line">0x7fffffffe3d0:	0xffffe400	0x00007fff	0x00400757	0x00000000</span><br><span class="line">0x7fffffffe3e0:	0xffffe4e8	0x00007fff	0x00400580	0x00000002</span><br><span class="line">(gdb) i frame 1</span><br><span class="line">Stack frame at 0x7fffffffe350:</span><br><span class="line"> rip = 0x400698 <span class="keyword">in</span> sum_till_MAX (sum.c:18); saved rip 0x400698</span><br><span class="line"> called by frame at 0x7fffffffe380, <span class="built_in">caller</span> of frame at 0x7fffffffe320</span><br><span class="line"> <span class="built_in">source</span> language c.</span><br><span class="line"> Arglist at 0x7fffffffe340, args: n=4</span><br><span class="line"> Locals at 0x7fffffffe340, Previous frame<span class="string">&#x27;s sp is 0x7fffffffe350</span></span><br><span class="line"><span class="string"> Saved registers:</span></span><br><span class="line"><span class="string">  rbp at 0x7fffffffe340, rip at 0x7fffffffe348</span></span><br><span class="line"><span class="string">(gdb) x/i $pc</span></span><br><span class="line"><span class="string">=&gt; 0x400698 &lt;sum_till_MAX+43&gt;:	add    %rax,-0x8(%rbp)</span></span><br><span class="line"><span class="string">(gdb) p $sp</span></span><br><span class="line"><span class="string">$7 = (void *) 0x7fffffffe350</span></span><br><span class="line"><span class="string">(gdb) i proc mapping</span></span><br><span class="line"><span class="string">process 1868</span></span><br><span class="line"><span class="string">Mapped address spaces:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          Start Addr           End Addr       Size     Offset objfile</span></span><br><span class="line"><span class="string">            0x400000           0x401000     0x1000        0x0 /root/codes/sum</span></span><br><span class="line"><span class="string">            0x600000           0x601000     0x1000        0x0 /root/codes/sum</span></span><br><span class="line"><span class="string">            0x601000           0x602000     0x1000     0x1000 /root/codes/sum</span></span><br><span class="line"><span class="string">      0x7ffff7a0d000     0x7ffff7bd1000   0x1c4000        0x0 /usr/lib64/libc-2.17.so</span></span><br><span class="line"><span class="string">      0x7ffff7bd1000     0x7ffff7dd0000   0x1ff000   0x1c4000 /usr/lib64/libc-2.17.so</span></span><br><span class="line"><span class="string">      0x7ffff7dd0000     0x7ffff7dd4000     0x4000   0x1c3000 /usr/lib64/libc-2.17.so</span></span><br><span class="line"><span class="string">      0x7ffff7dd4000     0x7ffff7dd6000     0x2000   0x1c7000 /usr/lib64/libc-2.17.so</span></span><br><span class="line"><span class="string">      0x7ffff7dd6000     0x7ffff7ddb000     0x5000        0x0</span></span><br><span class="line"><span class="string">      0x7ffff7ddb000     0x7ffff7dfd000    0x22000        0x0 /usr/lib64/ld-2.17.so</span></span><br><span class="line"><span class="string">      0x7ffff7ff1000     0x7ffff7ff4000     0x3000        0x0</span></span><br><span class="line"><span class="string">      0x7ffff7ff9000     0x7ffff7ffa000     0x1000        0x0</span></span><br><span class="line"><span class="string">      0x7ffff7ffa000     0x7ffff7ffc000     0x2000        0x0 [vdso]</span></span><br><span class="line"><span class="string">      0x7ffff7ffc000     0x7ffff7ffd000     0x1000    0x21000 /usr/lib64/ld-2.17.so</span></span><br><span class="line"><span class="string">      0x7ffff7ffd000     0x7ffff7ffe000     0x1000    0x22000 /usr/lib64/ld-2.17.so</span></span><br><span class="line"><span class="string">      0x7ffff7ffe000     0x7ffff7fff000     0x1000        0x0</span></span><br><span class="line"><span class="string">      0x7ffffffde000     0x7ffffffff000    0x21000        0x0 [stack]</span></span><br><span class="line"><span class="string">  0xffffffffff600000 0xffffffffff601000     0x1000        0x0 [vsyscall]</span></span><br></pre></td></tr></table></figure>

<h3 id="User-space"><a href="#User-space" class="headerlink" title="User space"></a>User space</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gdb /usr/lib64/libc-2.17.so</span></span><br><span class="line"><span class="string">GNU</span> <span class="string">gdb</span> <span class="string">(GDB)</span> <span class="string">Red</span> <span class="string">Hat</span> <span class="string">Enterprise</span> <span class="string">Linux</span> <span class="number">7.6</span><span class="number">.1</span><span class="number">-119.</span><span class="string">el7</span></span><br><span class="line"><span class="string">Copyright</span> <span class="string">(C)</span> <span class="number">2013 </span><span class="string">Free</span> <span class="string">Software</span> <span class="string">Foundation,</span> <span class="string">Inc.</span></span><br><span class="line"><span class="string">License</span> <span class="string">GPLv3+:</span> <span class="string">GNU</span> <span class="string">GPL</span> <span class="string">version</span> <span class="number">3</span> <span class="string">or</span> <span class="string">later</span> <span class="string">&lt;http://gnu.org/licenses/gpl.html&gt;</span></span><br><span class="line"><span class="attr">This is free software:</span> <span class="string">you</span> <span class="string">are</span> <span class="string">free</span> <span class="string">to</span> <span class="string">change</span> <span class="string">and</span> <span class="string">redistribute</span> <span class="string">it.</span></span><br><span class="line"><span class="string">There</span> <span class="string">is</span> <span class="literal">NO</span> <span class="string">WARRANTY,</span> <span class="string">to</span> <span class="string">the</span> <span class="string">extent</span> <span class="string">permitted</span> <span class="string">by</span> <span class="string">law.</span>  <span class="string">Type</span> <span class="string">&quot;show copying&quot;</span></span><br><span class="line"><span class="string">and</span> <span class="string">&quot;show warranty&quot;</span> <span class="string">for</span> <span class="string">details.</span></span><br><span class="line"><span class="string">This</span> <span class="string">GDB</span> <span class="string">was</span> <span class="string">configured</span> <span class="string">as</span> <span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span><span class="string">.</span></span><br><span class="line"><span class="string">For</span> <span class="string">bug</span> <span class="string">reporting</span> <span class="string">instructions,</span> <span class="attr">please see:</span></span><br><span class="line"><span class="string">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span></span><br><span class="line"><span class="string">Reading</span> <span class="string">symbols</span> <span class="string">from</span> <span class="string">/usr/lib64/libc-2.17.so...Reading</span> <span class="string">symbols</span> <span class="string">from</span> <span class="string">/usr/lib/debug/usr/lib64/libc-2.17.so.debug...done.</span></span><br><span class="line"><span class="string">done.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## show the offset</span></span><br><span class="line"><span class="string">(gdb)</span> <span class="string">disas</span> <span class="string">memcmp</span></span><br><span class="line"><span class="attr">Dump of assembler code for function memcmp:</span></span><br><span class="line">   <span class="number">0x000000000008f2f0</span> <span class="string">&lt;+0&gt;:</span>	<span class="string">mov</span>    <span class="number">0x337b51</span><span class="string">(%rip),%rdx</span>        <span class="comment"># 0x3c6e48</span></span><br><span class="line">   <span class="number">0x000000000008f2f7</span> <span class="string">&lt;+7&gt;:</span>	<span class="string">testl</span>  <span class="string">$0x200,0x80(%rdx)</span></span><br><span class="line">   <span class="number">0x000000000008f301</span> <span class="string">&lt;+17&gt;:</span>	<span class="string">jne</span>    <span class="number">0x8f30b</span> <span class="string">&lt;memcmp+27&gt;</span></span><br><span class="line">   <span class="number">0x000000000008f303</span> <span class="string">&lt;+19&gt;:</span>	<span class="string">lea</span>    <span class="number">0x26</span><span class="string">(%rip),%rax</span>        <span class="comment"># 0x8f330 &lt;__memcmp_sse2&gt;</span></span><br><span class="line">   <span class="number">0x000000000008f30a</span> <span class="string">&lt;+26&gt;:</span>	<span class="string">retq</span></span><br><span class="line">   <span class="number">0x000000000008f30b</span> <span class="string">&lt;+27&gt;:</span>	<span class="string">testl</span>  <span class="string">$0x80000,0x80(%rdx)</span></span><br><span class="line">   <span class="number">0x000000000008f315</span> <span class="string">&lt;+37&gt;:</span>	<span class="string">je</span>     <span class="number">0x8f31f</span> <span class="string">&lt;memcmp+47&gt;</span></span><br><span class="line">   <span class="number">0x000000000008f317</span> <span class="string">&lt;+39&gt;:</span>	<span class="string">lea</span>    <span class="number">0xdac92</span><span class="string">(%rip),%rax</span>        <span class="comment"># 0x169fb0 &lt;__memcmp_sse4_1&gt;</span></span><br><span class="line">   <span class="number">0x000000000008f31e</span> <span class="string">&lt;+46&gt;:</span>	<span class="string">retq</span></span><br><span class="line">   <span class="number">0x000000000008f31f</span> <span class="string">&lt;+47&gt;:</span>	<span class="string">lea</span>    <span class="number">0xde5ba</span><span class="string">(%rip),%rax</span>        <span class="comment"># 0x16d8e0 &lt;__memcmp_ssse3&gt;</span></span><br><span class="line">   <span class="number">0x000000000008f326</span> <span class="string">&lt;+54&gt;:</span>	<span class="string">retq</span></span><br><span class="line"><span class="string">End</span> <span class="string">of</span> <span class="string">assembler</span> <span class="string">dump.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="http://tacy.github.io/post/binary/">To</a> retrieve a section header table:readelf -S <object></li>
<li>To retrieve a program header table: readelf -l <object></li>
<li>To retrieve a symbol table: readelf -s <object></li>
<li>To retrieve the ELF file header data: readelf -e <object></li>
<li>To retrieve relocation entries: readelf -r <object></li>
<li>To retrieve a dynamic segment: readelf -d <object></li>
</ul>
<h3 id="source-code-directory"><a href="#source-code-directory" class="headerlink" title="source code directory"></a>source code directory</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) directory /opt/src</span><br></pre></td></tr></table></figure>

<h3 id="gcc-parameters-and-show-macro"><a href="#gcc-parameters-and-show-macro" class="headerlink" title="gcc parameters and show macro"></a><a target="_blank" rel="noopener" href="http://www.lenky.info/archives/2012/08/1910">gcc parameters and show macro</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -Wall -O2 -pg -o t.O2.pg t.c</span><br></pre></td></tr></table></figure>
<ul>
<li>pg: Generate extra code to write profile information suitable for the analysis program gprof.  You must use this option when compiling the source files you want data about, and you must also use it when linking.   </li>
<li>time[=file]: Report the CPU time taken by each subprocess in the compilation sequence</li>
<li>“-Q”:  Makes the compiler print out each function name as it is compiled, and print some statistics about each pass when it finishes.   </li>
<li>fno-inline: Do not expand any functions inline apart from those marked with the “always_inline” attribute.  This is the default when not optimizing.</li>
<li>-g produces debugging information in theOS native format</li>
<li>-ggdb produces debugging information specifically intennded for gdb</li>
<li>-ggdb3 produces extra debugging information, for example: including macro definitions</li>
<li>wall means enable warnning</li>
<li>-O0  turn off all optimization</li>
<li>-O1 ,-O2, -O3  optimization</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">cat t.c</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;t.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> A 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> B (2+A)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">myfunc</span><span class="params">(<span class="keyword">long</span> a, <span class="keyword">long</span> b, <span class="keyword">long</span> c, <span class="keyword">long</span> d,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">long</span> e, <span class="keyword">long</span> f, <span class="keyword">long</span> g, <span class="keyword">long</span> h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> xx = a * b * c * d * e * f * g * h;</span><br><span class="line">    <span class="keyword">long</span> yy = a + b + c + d + e + f + g + h;</span><br><span class="line">    <span class="keyword">long</span> zz = utilfunc(xx, yy, xx % yy);</span><br><span class="line">    <span class="keyword">return</span> zz + <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myfunc(<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>, <span class="number">77</span>, <span class="number">88</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, B);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ cat t.h</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _T_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _T_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">long</span> <span class="title">utilfunc</span><span class="params">(<span class="keyword">long</span> a, <span class="keyword">long</span> b, <span class="keyword">long</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> xx = a + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">long</span> yy = b + <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">long</span> zz = c + <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">long</span> sum = xx + yy + zz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> xx * yy * zz + sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">$ gcc -Wall -O2 -g -o t.O2.g t.c</span><br><span class="line">$ gdb t.O2.g -q</span><br><span class="line">Reading symbols from /home/log_IO1/test/t.O2.g...done.</span><br><span class="line">(gdb) b main</span><br><span class="line">Breakpoint <span class="number">1</span> at <span class="number">0x400440</span>: file t.c, line <span class="number">16.</span></span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: /home/log_IO1/test/t.O2.g</span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">1</span>, main (argc=<span class="number">1</span>, argv=<span class="number">0x7fffffffe288</span>) at t.c:<span class="number">16</span></span><br><span class="line"><span class="number">16</span>	&#123;</span><br><span class="line">Missing separate debuginfos, use: debuginfo-install glibc<span class="number">-2.17</span><span class="number">-307.</span>el7<span class="number">.1</span>.x86_64</span><br><span class="line">(gdb) info macro A</span><br><span class="line">The symbol `A<span class="number">&#x27;</span> has no definition as a C/C++ preprocessor macro</span><br><span class="line">at &lt;user-defined&gt;:<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">### Add -ggdb3</span><br><span class="line"></span><br><span class="line">$ gcc -Wall -O2 -ggdb3 -o t.O2.gdb3.noinline.g t.c</span><br><span class="line">$ gdb t.O2.gdb3.noinline.g -q</span><br><span class="line">Reading symbols from /home/log_IO1/test/t.O2.gdb3.noinline.g...done.</span><br><span class="line">(gdb) b main</span><br><span class="line">Breakpoint <span class="number">1</span> at <span class="number">0x400440</span>: file t.c, line <span class="number">16.</span></span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: /home/log_IO1/test/t.O2.gdb3.noinline.g</span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">1</span>, main (argc=<span class="number">1</span>, argv=<span class="number">0x7fffffffe278</span>) at t.c:<span class="number">16</span></span><br><span class="line"><span class="number">16</span>	&#123;</span><br><span class="line">Missing separate debuginfos, use: debuginfo-install glibc<span class="number">-2.17</span><span class="number">-307.</span>el7<span class="number">.1</span>.x86_64</span><br><span class="line">(gdb)  info macro A</span><br><span class="line">Defined at /home/log_IO1/test/t.c:<span class="number">3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> A 1</span></span><br><span class="line">(gdb)  info macro B</span><br><span class="line">Defined at /home/log_IO1/test/t.c:<span class="number">4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> B (2+A)</span></span><br><span class="line">(gdb) macro expand A</span><br><span class="line">expands to: <span class="number">1</span></span><br><span class="line">(gdb) macro expand B</span><br><span class="line">expands to: (<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line">(gdb) <span class="built_in">list</span> utilfunc</span><br><span class="line"><span class="number">3</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span>	<span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">long</span> <span class="title">utilfunc</span><span class="params">(<span class="keyword">long</span> a, <span class="keyword">long</span> b, <span class="keyword">long</span> c)</span></span></span><br><span class="line"><span class="function">6	</span>&#123;</span><br><span class="line"><span class="number">7</span>	    <span class="keyword">long</span> xx = a + <span class="number">2</span>;</span><br><span class="line"><span class="number">8</span>	    <span class="keyword">long</span> yy = b + <span class="number">3</span>;</span><br><span class="line"><span class="number">9</span>	    <span class="keyword">long</span> zz = c + <span class="number">4</span>;</span><br><span class="line"><span class="number">10</span>	    <span class="keyword">long</span> sum = xx + yy + zz;</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">12</span>	    <span class="keyword">return</span> xx * yy * zz + sum;</span><br><span class="line">(gdb) quit</span><br><span class="line">A debugging session is active.</span><br><span class="line"></span><br><span class="line">	Inferior <span class="number">1</span> [process <span class="number">28148</span>] will be killed.</span><br><span class="line"></span><br><span class="line">Quit anyway? (y <span class="keyword">or</span> n) y</span><br></pre></td></tr></table></figure>

<h3 id="rsync-debug-example"><a href="#rsync-debug-example" class="headerlink" title="rsync debug example"></a>rsync debug example</h3><p>copy the gz file, In rsync-3.0.6 with the z parameter, it use level 0<br>copy the gz file, In rsync-3.1.2 with the z parameter, it use level 6<br>it impact the system speed</p>
<p>In perf ,you could see the diff compress system call</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 3.1.2</span></span><br><span class="line">[.] longest_match</span><br><span class="line">[.] deflate_slow</span><br><span class="line">[.] inflate_fast</span><br><span class="line">[.] md5_process</span><br><span class="line">[.] fill_window</span><br><span class="line">[.] compress_block</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3.0.6</span></span><br><span class="line">[.] match_sums</span><br><span class="line">[.] send_files</span><br><span class="line">matched (inlined)</span><br><span class="line">[.] send_token</span><br><span class="line">send_deflated_token (inlined)</span><br><span class="line">[.] deflate</span><br><span class="line">[.] deflate_stored</span><br><span class="line">[.] md5_process</span><br><span class="line">md5_update (inlined)</span><br></pre></td></tr></table></figure>

<p>You could got the deflate_stored only work for level 0, deflate_slow work for level 6   </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">zlib/deflate.c</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> FASTEST</span></span><br><span class="line">local <span class="keyword">const</span> config configuration_table[<span class="number">2</span>] = &#123;</span><br><span class="line"><span class="comment">/*      good lazy nice chain */</span></span><br><span class="line"><span class="comment">/* 0 */</span> &#123;<span class="number">0</span>,    <span class="number">0</span>,  <span class="number">0</span>,    <span class="number">0</span>, deflate_stored&#125;,  <span class="comment">/* store only */</span></span><br><span class="line"><span class="comment">/* 1 */</span> &#123;<span class="number">4</span>,    <span class="number">4</span>,  <span class="number">8</span>,    <span class="number">4</span>, deflate_fast&#125;&#125;; <span class="comment">/* max speed, no lazy matches */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">local <span class="keyword">const</span> config configuration_table[<span class="number">10</span>] = &#123;</span><br><span class="line"><span class="comment">/*      good lazy nice chain */</span></span><br><span class="line"><span class="comment">/* 0 */</span> &#123;<span class="number">0</span>,    <span class="number">0</span>,  <span class="number">0</span>,    <span class="number">0</span>, deflate_stored&#125;,  <span class="comment">/* store only */</span></span><br><span class="line"><span class="comment">/* 1 */</span> &#123;<span class="number">4</span>,    <span class="number">4</span>,  <span class="number">8</span>,    <span class="number">4</span>, deflate_fast&#125;, <span class="comment">/* max speed, no lazy matches */</span></span><br><span class="line"><span class="comment">/* 2 */</span> &#123;<span class="number">4</span>,    <span class="number">5</span>, <span class="number">16</span>,    <span class="number">8</span>, deflate_fast&#125;,</span><br><span class="line"><span class="comment">/* 3 */</span> &#123;<span class="number">4</span>,    <span class="number">6</span>, <span class="number">32</span>,   <span class="number">32</span>, deflate_fast&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 4 */</span> &#123;<span class="number">4</span>,    <span class="number">4</span>, <span class="number">16</span>,   <span class="number">16</span>, deflate_slow&#125;,  <span class="comment">/* lazy matches */</span></span><br><span class="line"><span class="comment">/* 5 */</span> &#123;<span class="number">8</span>,   <span class="number">16</span>, <span class="number">32</span>,   <span class="number">32</span>, deflate_slow&#125;,</span><br><span class="line"><span class="comment">/* 6 */</span> &#123;<span class="number">8</span>,   <span class="number">16</span>, <span class="number">128</span>, <span class="number">128</span>, deflate_slow&#125;,</span><br><span class="line"><span class="comment">/* 7 */</span> &#123;<span class="number">8</span>,   <span class="number">32</span>, <span class="number">128</span>, <span class="number">256</span>, deflate_slow&#125;,</span><br><span class="line"><span class="comment">/* 8 */</span> &#123;<span class="number">32</span>, <span class="number">128</span>, <span class="number">258</span>, <span class="number">1024</span>, deflate_slow&#125;,</span><br><span class="line"><span class="comment">/* 9 */</span> &#123;<span class="number">32</span>, <span class="number">258</span>, <span class="number">258</span>, <span class="number">4096</span>, deflate_slow&#125;&#125;; <span class="comment">/* max compression */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">##<span class="meta"># the deflate_stored comment</span></span><br><span class="line"><span class="comment">/* ===========================================================================</span></span><br><span class="line"><span class="comment"> * Copy without compression as much as possible from the input stream, return</span></span><br><span class="line"><span class="comment"> * the current block state.</span></span><br><span class="line"><span class="comment"> * This function does not insert new strings in the dictionary since</span></span><br><span class="line"><span class="comment"> * uncompressible data is probably not useful. This function is used</span></span><br><span class="line"><span class="comment"> * only for the level=0 compression option.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span> this function should be optimized to avoid extra copying from</span></span><br><span class="line"><span class="comment"> * window to pending_buf.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>The key function was _tr_flush_block and the key struct is “deflate_state *s;” in zlib/trees.c</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> address on</span><br><span class="line">show <span class="built_in">print</span> address</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> array</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> array on</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> array off</span><br><span class="line">show <span class="built_in">print</span> array</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> elements</span><br><span class="line">show <span class="built_in">print</span> elements</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> null-stop (defualt off)</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> pretty on</span><br><span class="line"></span><br><span class="line">$ grep -Rin <span class="string">&quot;FAR deflate_state&quot;</span> rsync-3.1.2/zlib</span><br><span class="line">rsync-3.1.2/zlib/deflate.h:273:&#125; FAR deflate_state;</span><br><span class="line"></span><br><span class="line">/* A Pos is an index <span class="keyword">in</span> the character window. We use short instead of int to</span><br><span class="line"> * save space <span class="keyword">in</span> the various tables. IPos is used only <span class="keyword">for</span> parameter passing.</span><br><span class="line"> */</span><br><span class="line">typedef struct internal_state &#123;</span><br><span class="line">.....</span><br><span class="line">.....</span><br><span class="line">.....</span><br><span class="line">&#125; FAR deflate_state;</span><br><span class="line"></span><br><span class="line">(gdb) b set_compression</span><br><span class="line">(gdb) b lp_dont_compress</span><br><span class="line">(gdb) b send_deflated_token</span><br><span class="line">(gdb) b init_set_compression</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### found the no compress suffix name</span></span><br><span class="line">(gdb) bt full</span><br><span class="line"><span class="comment">#0  init_set_compression () at token.c:125</span></span><br><span class="line">        f = 0x44e258 <span class="string">&quot;*.gz *.zip *.z *.rpm *.deb *.iso *.bz2 *.t[gb]z *.7z *.mp[34] *.mov *.avi *.ogg *.jpg *.jpeg&quot;</span></span><br><span class="line"></span><br><span class="line">loadparm.c:63</span><br><span class="line"><span class="comment">#define DEFAULT_DONT_COMPRESS &quot;*.gz *.zip *.z *.rpm *.deb *.iso *.bz2&quot; \</span></span><br><span class="line">        <span class="string">&quot; *.t[gb]z *.7z *.mp[34] *.mov *.avi *.ogg *.jpg *.jpeg&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### default rsync version is 3.1.2</span></span><br><span class="line"></span><br><span class="line">$ rm -f linux-5.4.121-1.tar.gz ; gdb --args rsync -zP linux-5.4.121.tar.gz linux-5.4.121-2.tar.gz</span><br><span class="line">GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-119.el7</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span><br><span class="line">Reading symbols from /usr/bin/rsync...Reading symbols from /usr/lib/debug/usr/bin/rsync.debug...done.</span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line">(gdb) b trees.c:908</span><br><span class="line">Breakpoint 1 at 0x565c0: file zlib/trees.c, line 908.</span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: /usr/bin/rsync -zP linux-5.4.121.tar.gz linux-5.4.121-2.tar.gz</span><br><span class="line">[Detaching after fork from child process 36449]</span><br><span class="line">linux-5.4.121.tar.gz</span><br><span class="line">         32,768   0%    0.00kB/s    0:00:00</span><br><span class="line">Breakpoint 1, _tr_flush_block (s=0x5555557df640, buf=0x55555580f4d0 <span class="string">&quot;linux-5.4.121/&quot;</span>, stored_len=53256, last=0) at zlib/trees.c:912</span><br><span class="line">912	&#123;</span><br><span class="line"></span><br><span class="line">(gdb) p *s</span><br><span class="line">or</span><br><span class="line">(gdb) p *((struct internal_state *) s)</span><br><span class="line"><span class="variable">$2</span> = &#123;strm = 0x5555557da7c0 &lt;tx_strm&gt;, status = 113, pending_buf = 0x55555583f500 <span class="string">&quot;&quot;</span>, pending_buf_size = 65536, pending_out = 0x55555583f500 <span class="string">&quot;&quot;</span>, pending = 0, wrap = 0,</span><br><span class="line">  gzhead = 0x0, gzindex = 0, method = 8 <span class="string">&#x27;\b&#x27;</span>, last_flush = 0, w_size = 32768, w_bits = 15, w_mask = 32767, window = 0x55555580f4d0 <span class="string">&quot;linux-5.4.121/&quot;</span>, window_size = 65536,</span><br><span class="line">  prev = 0x55555581f4e0, head = 0x55555582f4f0, ins_h = 8135, hash_size = 32768, hash_bits = 15, hash_mask = 32767, hash_shift = 5, block_start = 0, match_length = 2,</span><br><span class="line">  prev_match = 53234, match_available = 0, strstart = 53256, match_start = 53234, lookahead = 12280, prev_length = 0, max_chain_length = 128, max_lazy_match = 16,</span><br><span class="line">  level = 6</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### print offset</span></span><br><span class="line">(gdb) p &amp;((struct internal_state *)0)-&gt;level</span><br><span class="line"><span class="variable">$3</span> = (int *) 0xb4</span><br><span class="line">oxb4=180</span><br><span class="line"></span><br><span class="line">(gdb) x/181x s</span><br><span class="line">0x5555557df640:	0xc0	0xa7	0x7d	0x55	0x55	0x55	0x00	0x00</span><br><span class="line">0x5555557df648:	0x71	0x00	0x00	0x00	0xff	0x7f	0x00	0x00</span><br><span class="line">0x5555557df650:	0x00	0xf5	0x83	0x55	0x55	0x55	0x00	0x00</span><br><span class="line">0x5555557df658:	0x00	0x00	0x01	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x5555557df660:	0x00	0xf5	0x83	0x55	0x55	0x55	0x00	0x00</span><br><span class="line">0x5555557df668:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x5555557df670:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x5555557df678:	0x00	0x00	0x00	0x00	0x08	0x00	0x00	0x00</span><br><span class="line">0x5555557df680:	0x00	0x00	0x00	0x00	0x00	0x80	0x00	0x00</span><br><span class="line">0x5555557df688:	0x0f	0x00	0x00	0x00	0xff	0x7f	0x00	0x00</span><br><span class="line">0x5555557df690:	0xd0	0xf4	0x80	0x55	0x55	0x55	0x00	0x00</span><br><span class="line">0x5555557df698:	0x00	0x00	0x01	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x5555557df6a0:	0xe0	0xf4	0x81	0x55	0x55	0x55	0x00	0x00</span><br><span class="line">0x5555557df6a8:	0xf0	0xf4	0x82	0x55	0x55	0x55	0x00	0x00</span><br><span class="line">0x5555557df6b0:	0xc7	0x1f	0x00	0x00	0x00	0x80	0x00	0x00</span><br><span class="line">0x5555557df6b8:	0x0f	0x00	0x00	0x00	0xff	0x7f	0x00	0x00</span><br><span class="line">0x5555557df6c0:	0x05	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x5555557df6c8:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x5555557df6d0:	0x02	0x00	0x00	0x00	0xf2	0xcf	0x00	0x00</span><br><span class="line">0x5555557df6d8:	0x00	0x00	0x00	0x00	0x08	0xd0	0x00	0x00</span><br><span class="line">0x5555557df6e0:	0xf2	0xcf	0x00	0x00	0xf8	0x2f	0x00	0x00</span><br><span class="line">0x5555557df6e8:	0x00	0x00	0x00	0x00	0x80	0x00	0x00	0x00</span><br><span class="line">0x5555557df6f0:	0x10	0x00	0x00	0x00	0x06</span><br><span class="line">                                                ^</span><br><span class="line">                                                |</span><br><span class="line">------------------------------------------------- level=6</span><br></pre></td></tr></table></figure>

<h3 id="gen-the-debuginfo"><a href="#gen-the-debuginfo" class="headerlink" title="gen the debuginfo"></a><a target="_blank" rel="noopener" href="http://www.lenky.info/archives/2013/04/2261">gen the debuginfo</a></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># cat t.c </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello world!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">$ objcopy --only-keep-debug t t.debuginfo</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">$ objcopy --only-keep-debug vmlinux.bin vmlinux.debug</span><br><span class="line"></span><br><span class="line">$ objcopy --strip-debug t</span><br><span class="line">$ objcopy --add-gnu-debuglink=t.debuginfo t ### add the .gnu_debuglink section</span><br><span class="line"><span class="keyword">or</span> </span><br><span class="line">$ cp t t.debuginfo</span><br><span class="line">$ strip --only-keep-debug t.debuginfo</span><br><span class="line">##stripe will <span class="keyword">delete</span> the symtab</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line">scriptdir=`dirname <span class="variable">$&#123;0&#125;</span>`</span><br><span class="line">scriptdir=`(<span class="built_in">cd</span> <span class="variable">$&#123;scriptdir&#125;</span>; <span class="built_in">pwd</span>)`</span><br><span class="line">scriptname=`basename <span class="variable">$&#123;0&#125;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> errorexit()</span><br><span class="line">&#123;</span><br><span class="line">  errorcode=<span class="variable">$&#123;1&#125;</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$@</span></span><br><span class="line">  <span class="built_in">exit</span> <span class="variable">$&#123;errorcode&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> usage()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;USAGE <span class="variable">$&#123;scriptname&#125;</span> &lt;tostrip&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">tostripdir=`dirname <span class="string">&quot;<span class="variable">$1</span>&quot;</span>`</span><br><span class="line">tostripfile=`basename <span class="string">&quot;<span class="variable">$1</span>&quot;</span>`</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$&#123;tostripfile&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  usage</span><br><span class="line">  errorexit 0 <span class="string">&quot;tostrip must be specified&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$&#123;tostripdir&#125;</span>&quot;</span></span><br><span class="line"> </span><br><span class="line">debugdir=.debug</span><br><span class="line">debugfile=<span class="string">&quot;<span class="variable">$&#123;tostripfile&#125;</span>.debug&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$&#123;debugdir&#125;</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;creating dir <span class="variable">$&#123;tostripdir&#125;</span>/<span class="variable">$&#123;debugdir&#125;</span>&quot;</span></span><br><span class="line">  mkdir -p <span class="string">&quot;<span class="variable">$&#123;debugdir&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;stripping <span class="variable">$&#123;tostripfile&#125;</span>, putting debug info into <span class="variable">$&#123;debugfile&#125;</span>&quot;</span></span><br><span class="line">objcopy --only-keep-debug <span class="string">&quot;<span class="variable">$&#123;tostripfile&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;debugdir&#125;</span>/<span class="variable">$&#123;debugfile&#125;</span>&quot;</span></span><br><span class="line">strip --strip-debug --strip-unneeded <span class="string">&quot;<span class="variable">$&#123;tostripfile&#125;</span>&quot;</span></span><br><span class="line">objcopy --add-gnu-debuglink=<span class="string">&quot;<span class="variable">$&#123;debugdir&#125;</span>/<span class="variable">$&#123;debugfile&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;tostripfile&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">$ ./cdbi.sh t</span><br><span class="line">$ ls -l .debug/</span><br><span class="line"></span><br><span class="line"><span class="comment">## gdb import the debuginfo, copy to the same dir</span></span><br><span class="line">$ cp -a .debug/ /tmp/</span><br><span class="line">$ cp -a t /tmp/</span><br><span class="line">or </span><br><span class="line">$ cp -a t.debug /tmp/</span><br><span class="line">$ cp -a t /tmp/</span><br><span class="line">or</span><br><span class="line">gdb -s .debug/t.debug -e /tmp/t -q</span><br><span class="line">or</span><br><span class="line"><span class="built_in">set</span> debug-file-directory directories</span><br></pre></td></tr></table></figure>

<h3 id="build-linux-kernel-module-with-debug-info"><a href="#build-linux-kernel-module-with-debug-info" class="headerlink" title="build linux kernel module with debug info"></a>build linux kernel module with debug info</h3><p>Don ‘t need add -g or -ggdb3 flag for compile third-part kernel module</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">$ cat kbleds.c</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  * kbleds.c - Blink keyboard leds until the module is unloaded.</span></span><br><span class="line"><span class="comment"> *   */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kd.h&gt; /* For KDSETLED */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/tty.h&gt; /* For tty_struct */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/vt.h&gt; /* For MAX_NR_CONSOLES */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/vt_kern.h&gt; /* for fg_console */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/console_struct.h&gt; /* For vc_cons */</span></span></span><br><span class="line"></span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;Example module illustrating the use of Keyboard LEDs.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> rday_1;</span><br><span class="line"><span class="keyword">int</span> rday_2 = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span> rday_3 = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">timer_list</span> <span class="title">my_timer</span>;</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">tty_driver</span> *<span class="title">my_driver</span>;</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> kbledstatus = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLINK_DELAY HZ / 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ALL_LEDS_ON 0x07</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RESTORE_LEDS 0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Function my_timer_func blinks the keyboard LEDs periodically by invoking</span></span><br><span class="line"><span class="comment"> *  * command KDSETLED of ioctl() on the keyboard driver. To learn more on virtual</span></span><br><span class="line"><span class="comment"> *   * terminal ioctl operations, please see file:</span></span><br><span class="line"><span class="comment"> *    *   drivers/tty/vt/vt_ioctl.c, function vt_ioctl().</span></span><br><span class="line"><span class="comment"> *     *</span></span><br><span class="line"><span class="comment"> *      * The argument to KDSETLED is alternatively set to 7 (thus causing the led</span></span><br><span class="line"><span class="comment"> *       * mode to be set to LED_SHOW_IOCTL, and all the leds are lit) and to 0xFF</span></span><br><span class="line"><span class="comment"> *        * (any value above 7 switches back the led mode to LED_SHOW_FLAGS, thus</span></span><br><span class="line"><span class="comment"> *         * the LEDs reflect the actual keyboard status).  To learn more on this,</span></span><br><span class="line"><span class="comment"> *          * please see file: drivers/tty/vt/keyboard.c, function setledstate().</span></span><br><span class="line"><span class="comment"> *           */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">my_timer_func</span><span class="params">(struct timer_list *unused)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tty_struct</span> *<span class="title">t</span> = <span class="title">vc_cons</span>[<span class="title">fg_console</span>].<span class="title">d</span>-&gt;<span class="title">port</span>.<span class="title">tty</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (kbledstatus == ALL_LEDS_ON)</span><br><span class="line">        kbledstatus = RESTORE_LEDS;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        kbledstatus = ALL_LEDS_ON;</span><br><span class="line"></span><br><span class="line">    (my_driver-&gt;ops-&gt;ioctl)(t, KDSETLED, kbledstatus);</span><br><span class="line"></span><br><span class="line">    my_timer.expires = jiffies + BLINK_DELAY;</span><br><span class="line">    add_timer(&amp;my_timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __init <span class="title">kbleds_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    pr_info(<span class="string">&quot;kbleds: loading\n&quot;</span>);</span><br><span class="line">    pr_info(<span class="string">&quot;kbleds: fgconsole is %x\n&quot;</span>, fg_console);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_NR_CONSOLES; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vc_cons[i].d)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        pr_info(<span class="string">&quot;poet_atkm: console[%i/%i] #%i, tty %p\n&quot;</span>, i, MAX_NR_CONSOLES,</span><br><span class="line">                vc_cons[i].d-&gt;vc_num, (<span class="keyword">void</span> *)vc_cons[i].d-&gt;port.tty);</span><br><span class="line">    &#125;</span><br><span class="line">    pr_info(<span class="string">&quot;kbleds: finished scanning consoles\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    my_driver = vc_cons[fg_console].d-&gt;port.tty-&gt;driver;</span><br><span class="line">    pr_info(<span class="string">&quot;kbleds: tty driver magic %x\n&quot;</span>, my_driver-&gt;magic);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Set up the LED blink timer the first time. */</span></span><br><span class="line">    timer_setup(&amp;my_timer, my_timer_func, <span class="number">0</span>);</span><br><span class="line">    my_timer.expires = jiffies + BLINK_DELAY;</span><br><span class="line">    add_timer(&amp;my_timer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __exit <span class="title">kbleds_cleanup</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pr_info(<span class="string">&quot;kbleds: unloading...\n&quot;</span>);</span><br><span class="line">    del_timer(&amp;my_timer);</span><br><span class="line">    (my_driver-&gt;ops-&gt;ioctl)(vc_cons[fg_console].d-&gt;port.tty, KDSETLED,</span><br><span class="line">                            RESTORE_LEDS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(kbleds_init);</span><br><span class="line">module_exit(kbleds_cleanup);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//I don&#x27;t know why in the internet demo, there is no .text section when the kenrel module loading</span></span><br><span class="line"><span class="comment">//I found antoher example code has the .text section</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line">$ cat Makefile</span><br><span class="line"><span class="comment"># obj-m specifie we&#x27;re a kernel module.</span></span><br><span class="line">obj-m += test_kmod1.o</span><br><span class="line"><span class="comment"># Set the path to the Kernel build utils.</span></span><br><span class="line">KBUILD=/lib/modules/$(shell uname -r)/build/</span><br><span class="line"><span class="comment">#MY_CFLAGS += -ggdb3 ######## Does kernel module need it ? </span></span><br><span class="line"><span class="comment">#ccflags-y += $&#123;MY_CFLAGS&#125;</span></span><br><span class="line"><span class="comment">#CC += $&#123;MY_CFLAGS&#125;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">default:</span><br><span class="line">	$(MAKE) -C $(KBUILD) M=$(PWD) modules </span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">	$(MAKE) -C $(KBUILD) M=$(PWD) clean</span><br><span class="line"></span><br><span class="line">menuconfig:</span><br><span class="line">	$(MAKE) -C $(KBUILD) M=$(PWD) menuconfig</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line">make -C /lib/modules/3.10.0-1127.el7.x86_64/build/ M=/root/kernel-module modules </span><br><span class="line">make[1]: Entering directory `/usr/src/kernels/3.10.0-1127.el7.x86_64<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  CC [M]  /root/kernel-module/greeter.o</span></span><br><span class="line"><span class="string">  Building modules, stage 2.</span></span><br><span class="line"><span class="string">  MODPOST 1 modules</span></span><br><span class="line"><span class="string">  CC      /root/kernel-module/greeter.mod.o</span></span><br><span class="line"><span class="string">  LD [M]  /root/kernel-module/greeter.ko</span></span><br><span class="line"><span class="string">make[1]: Leaving directory `/usr/src/kernels/3.10.0-1127.el7.x86_64&#x27;</span></span><br><span class="line"></span><br><span class="line">$ insmod kbleds.ko</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /sys/module/kbleds/sections/; cat .text .bss .data</span><br><span class="line">0xffffffffc05c7000</span><br><span class="line">0xffffffffc05c9260</span><br><span class="line">0xffffffffc05c9000</span><br><span class="line"></span><br><span class="line">$ gdb /usr/lib/debug/usr/lib/modules/3.10.0-1127.el7.x86_64/vmlinux /proc/kcore</span><br><span class="line">GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-119.el7</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span><br><span class="line">Reading symbols from /usr/lib/debug/usr/lib/modules/3.10.0-1127.el7.x86_64/vmlinux...done.</span><br><span class="line">[New process 1]</span><br><span class="line">Core was generated by `BOOT_IMAGE=/boot/vmlinuz-3.10.0-1127.el7.x86_64 root=UUID=8035d79a-5216-45db-bae<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">#0  0x0000000000000000 in irq_stack_union ()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                        (.text)                     (.data)                 (.bss)</span></span><br><span class="line"><span class="string">(gdb)  add-symbol-file ./kbleds.ko 0xffffffffc05c7000 -s .data 0xffffffffc05c9000 -s .bss 0xffffffffc05c9260</span></span><br><span class="line"><span class="string">add symbol table from file &quot;./kbleds.ko&quot; at</span></span><br><span class="line"><span class="string">	.text_addr = 0xffffffffc05c7000</span></span><br><span class="line"><span class="string">	.data_addr = 0xffffffffc05c9000</span></span><br><span class="line"><span class="string">	.bss_addr = 0xffffffffc05c9260</span></span><br><span class="line"><span class="string">(y or n) y</span></span><br><span class="line"><span class="string">Reading symbols from /root/kernel-module/kbleds.ko...done.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) p rday_2  ## print the variable</span></span><br><span class="line"><span class="string">$1 = 20</span></span><br><span class="line"><span class="string">(gdb) p rday_3</span></span><br><span class="line"><span class="string">$2 = 30</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ nm kbleds.ko </span></span><br><span class="line"><span class="string">                 U add_timer</span></span><br><span class="line"><span class="string">0000000000000000 T cleanup_module</span></span><br><span class="line"><span class="string">                 U del_timer</span></span><br><span class="line"><span class="string">                 U __fentry__</span></span><br><span class="line"><span class="string">                 U fg_console</span></span><br><span class="line"><span class="string">0000000000000000 T init_module</span></span><br><span class="line"><span class="string">                 U init_timer_key</span></span><br><span class="line"><span class="string">                 U jiffies</span></span><br><span class="line"><span class="string">0000000000000000 t kbleds_cleanup</span></span><br><span class="line"><span class="string">0000000000000000 t kbleds_init</span></span><br><span class="line"><span class="string">0000000000000008 b kbledstatus</span></span><br><span class="line"><span class="string">000000000000008d r __module_depends</span></span><br><span class="line"><span class="string">0000000000000010 b my_driver</span></span><br><span class="line"><span class="string">0000000000000020 b my_timer</span></span><br><span class="line"><span class="string">0000000000000000 t my_timer_func</span></span><br><span class="line"><span class="string">                 U printk</span></span><br><span class="line"><span class="string">0000000000000000 B rday_1</span></span><br><span class="line"><span class="string">0000000000000004 D rday_2</span></span><br><span class="line"><span class="string">0000000000000000 D rday_3</span></span><br><span class="line"><span class="string">0000000000000000 D __this_module</span></span><br><span class="line"><span class="string">000000000000000c r __UNIQUE_ID_description25</span></span><br><span class="line"><span class="string">0000000000000000 r __UNIQUE_ID_license26</span></span><br><span class="line"><span class="string">000000000000004e r __UNIQUE_ID_retpoline11</span></span><br><span class="line"><span class="string">000000000000005a r __UNIQUE_ID_rhelversion10</span></span><br><span class="line"><span class="string">000000000000006a r __UNIQUE_ID_srcversion9</span></span><br><span class="line"><span class="string">0000000000000096 r __UNIQUE_ID_vermagic8</span></span><br><span class="line"><span class="string">                 U vc_cons</span></span><br><span class="line"><span class="string">0000000000000000 r ____versions</span></span><br><span class="line"><span class="string">                 U __x86_indirect_thunk_rax</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ objdump -t kbleds.ko  # all section</span></span><br><span class="line"><span class="string">kbleds.ko:     file format elf64-x86-64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SYMBOL TABLE:</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .note.gnu.build-id	0000000000000000 .note.gnu.build-id</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .text	0000000000000000 .text</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .init.text	0000000000000000 .init.text</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .exit.text	0000000000000000 .exit.text</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .rodata.str1.1	0000000000000000 .rodata.str1.1</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .rodata.str1.8	0000000000000000 .rodata.str1.8</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .modinfo	0000000000000000 .modinfo</span></span><br><span class="line"><span class="string">0000000000000000 l    d  __mcount_loc	0000000000000000 __mcount_loc</span></span><br><span class="line"><span class="string">0000000000000000 l    d  __versions	0000000000000000 __versions</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .data	0000000000000000 .data</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .gnu.linkonce.this_module	0000000000000000 .gnu.linkonce.this_module</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .bss	0000000000000000 .bss</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_info	0000000000000000 .debug_info</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_abbrev	0000000000000000 .debug_abbrev</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_loc	0000000000000000 .debug_loc</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_aranges	0000000000000000 .debug_aranges</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_ranges	0000000000000000 .debug_ranges</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_line	0000000000000000 .debug_line</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_str	0000000000000000 .debug_str</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .comment	0000000000000000 .comment</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .note.GNU-stack	0000000000000000 .note.GNU-stack</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .debug_frame	0000000000000000 .debug_frame</span></span><br><span class="line"><span class="string">0000000000000000 l    df *ABS*	0000000000000000 kbleds.c</span></span><br><span class="line"><span class="string">0000000000000000 l     F .text	0000000000000092 my_timer_func</span></span><br><span class="line"><span class="string">0000000000000008 l     O .bss	0000000000000008 kbledstatus</span></span><br><span class="line"><span class="string">0000000000000010 l     O .bss	0000000000000008 my_driver</span></span><br><span class="line"><span class="string">0000000000000020 l     O .bss	0000000000000050 my_timer</span></span><br><span class="line"><span class="string">0000000000000000 l     F .init.text	00000000000000ee kbleds_init</span></span><br><span class="line"><span class="string">0000000000000000 l     F .exit.text	0000000000000057 kbleds_cleanup</span></span><br><span class="line"><span class="string">0000000000000000 l     O .modinfo	000000000000000c __UNIQUE_ID_license26</span></span><br><span class="line"><span class="string">000000000000000c l     O .modinfo	0000000000000042 __UNIQUE_ID_description25</span></span><br><span class="line"><span class="string">0000000000000000 l    df *ABS*	0000000000000000 kbleds.mod.c</span></span><br><span class="line"><span class="string">000000000000004e l     O .modinfo	000000000000000c __UNIQUE_ID_retpoline11</span></span><br><span class="line"><span class="string">000000000000005a l     O .modinfo	0000000000000010 __UNIQUE_ID_rhelversion10</span></span><br><span class="line"><span class="string">000000000000006a l     O .modinfo	0000000000000023 __UNIQUE_ID_srcversion9</span></span><br><span class="line"><span class="string">000000000000008d l     O .modinfo	0000000000000009 __module_depends</span></span><br><span class="line"><span class="string">0000000000000000 l     O __versions	0000000000000280 ____versions</span></span><br><span class="line"><span class="string">0000000000000096 l     O .modinfo	000000000000003c __UNIQUE_ID_vermagic8</span></span><br><span class="line"><span class="string">0000000000000000 g     O .gnu.linkonce.this_module	0000000000000238 __this_module</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 fg_console</span></span><br><span class="line"><span class="string">0000000000000000 g     F .exit.text	0000000000000057 cleanup_module</span></span><br><span class="line"><span class="string">0000000000000000 g     O .data	0000000000000004 rday_3</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 __fentry__</span></span><br><span class="line"><span class="string">0000000000000000 g     F .init.text	00000000000000ee init_module</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 __x86_indirect_thunk_rax</span></span><br><span class="line"><span class="string">0000000000000004 g     O .data	0000000000000004 rday_2</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 add_timer</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 printk</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 vc_cons</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 jiffies</span></span><br><span class="line"><span class="string">0000000000000000 g     O .bss	0000000000000004 rday_1</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 init_timer_key</span></span><br><span class="line"><span class="string">0000000000000000         *UND*	0000000000000000 del_timer</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ objdump -t -j .text kbleds.ko</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kbleds.ko:     file format elf64-x86-64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SYMBOL TABLE:</span></span><br><span class="line"><span class="string">0000000000000000 l    d  .text	0000000000000000 .text</span></span><br><span class="line"><span class="string">0000000000000000 l     F .text	0000000000000092 my_timer_func</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ objdump -t -j .bss greeter.ko </span></span><br><span class="line"><span class="string">$ objdump -t -j .data greeter.ko </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ grep -E &#x27;</span>kbledstatus|rday<span class="string">&#x27; /proc/kallsyms</span></span><br><span class="line"><span class="string">ffffffffc05c9268 b kbledstatus	[kbleds]</span></span><br><span class="line"><span class="string">ffffffffc05c9000 d rday_3	[kbleds]</span></span><br><span class="line"><span class="string">ffffffffc05c9004 d rday_2	[kbleds]</span></span><br><span class="line"><span class="string">ffffffffc05c9260 b rday_1	[kbleds]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">reference: https://www.linux.com/training-tutorials/kernel-newbie-corner-kernel-and-module-debugging-gdb/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ readelf -WS kbleds.ko | grep &#x27;</span>.text<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  [ 2] .text             PROGBITS        0000000000000000 000070 000092 00  AX  0   0 16</span></span><br><span class="line"><span class="string">  [ 3] .rela.text        RELA            0000000000000000 01c960 000120 18   I 34   2  8</span></span><br><span class="line"><span class="string">  [ 4] .init.text        PROGBITS        0000000000000000 000102 0000ee 00  AX  0   0  1</span></span><br><span class="line"><span class="string">  [ 5] .rela.init.text   RELA            0000000000000000 01ca80 000258 18   I 34   4  8</span></span><br><span class="line"><span class="string">  [ 6] .exit.text        PROGBITS        0000000000000000 0001f0 000057 00  AX  0   0  1</span></span><br><span class="line"><span class="string">  [ 7] .rela.exit.text   RELA            0000000000000000 01ccd8 0000c0 18   I 34   6  8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ readelf -x .text kbleds.ko </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hex dump of section &#x27;</span>.text<span class="string">&#x27;:</span></span><br><span class="line"><span class="string"> NOTE: This section has relocations against it, but these have NOT been applied to this dump.</span></span><br><span class="line"><span class="string">  0x00000000 e8000000 00486305 00000000 48833d00 .....Hc.....H.=.</span></span><br><span class="line"><span class="string">  0x00000010 00000007 554889e5 488d0480 488b04c5 ....UH..H...H...</span></span><br><span class="line"><span class="string">  0x00000020 00000000 488b7848 745648c7 05000000 ....H.xHtVH.....</span></span><br><span class="line"><span class="string">  0x00000030 00070000 00ba0700 0000488b 05000000 ..........H.....</span></span><br><span class="line"><span class="string">  0x00000040 00be324b 0000488b 80a00000 00488b40 ..2K..H......H.@</span></span><br><span class="line"><span class="string">  0x00000050 60e80000 0000488b 05000000 0048c7c7 `.....H......H..</span></span><br><span class="line"><span class="string">  0x00000060 00000000 4805c800 00004889 05000000 ....H.....H.....</span></span><br><span class="line"><span class="string">  0x00000070 00e80000 00005dc3 0f1f8400 00000000 ......].........</span></span><br><span class="line"><span class="string">  0x00000080 48c70500 000000ff 000000ba ff000000 H...............</span></span><br><span class="line"><span class="string">  0x00000090 eba8                                ..</span></span><br><span class="line"><span class="string">or</span></span><br><span class="line"><span class="string"># To a file:</span></span><br><span class="line"><span class="string">objcopy file /dev/null --dump-section .text=text.data</span></span><br><span class="line"><span class="string"># To stdout:</span></span><br><span class="line"><span class="string">objcopy file /dev/null --dump-section .text=/dev/stdout | cat</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ readelf -S kbleds.ko</span></span><br><span class="line"><span class="string">There are 37 section headers, starting at offset 0x334f0:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Section Headers:</span></span><br><span class="line"><span class="string">  [Nr] Name              Type             Address           Offset</span></span><br><span class="line"><span class="string">       Size              EntSize          Flags  Link  Info  Align</span></span><br><span class="line"><span class="string">  [ 0]                   NULL             0000000000000000  00000000</span></span><br><span class="line"><span class="string">       0000000000000000  0000000000000000           0     0     0</span></span><br><span class="line"><span class="string">  [ 1] .note.gnu.build-i NOTE             0000000000000000  00000040</span></span><br><span class="line"><span class="string">       0000000000000024  0000000000000000   A       0     0     4</span></span><br><span class="line"><span class="string">  [ 2] .text             PROGBITS         0000000000000000  00000070</span></span><br><span class="line"><span class="string">       0000000000000092  0000000000000000  AX       0     0     16</span></span><br><span class="line"><span class="string">  [ 3] .rela.text        RELA             0000000000000000  0001c960</span></span><br><span class="line"><span class="string">       0000000000000120  0000000000000018   I      34     2     8</span></span><br><span class="line"><span class="string">  [ 4] .init.text        PROGBITS         0000000000000000  00000102</span></span><br><span class="line"><span class="string">       00000000000000ee  0000000000000000  AX       0     0     1</span></span><br><span class="line"><span class="string">  [ 5] .rela.init.text   RELA             0000000000000000  0001ca80</span></span><br><span class="line"><span class="string">       0000000000000258  0000000000000018   I      34     4     8</span></span><br><span class="line"><span class="string">  [ 6] .exit.text        PROGBITS         0000000000000000  000001f0</span></span><br><span class="line"><span class="string">       0000000000000057  0000000000000000  AX       0     0     1</span></span><br><span class="line"><span class="string">  [ 7] .rela.exit.text   RELA             0000000000000000  0001ccd8</span></span><br><span class="line"><span class="string">       00000000000000c0  0000000000000018   I      34     6     8</span></span><br><span class="line"><span class="string">  [ 8] .rodata.str1.1    PROGBITS         0000000000000000  00000247</span></span><br><span class="line"><span class="string">       0000000000000046  0000000000000001 AMS       0     0     1</span></span><br><span class="line"><span class="string">  [ 9] .rodata.str1.8    PROGBITS         0000000000000000  00000290</span></span><br><span class="line"><span class="string">       0000000000000071  0000000000000001 AMS       0     0     8</span></span><br><span class="line"><span class="string">  [10] .modinfo          PROGBITS         0000000000000000  00000301</span></span><br><span class="line"><span class="string">       00000000000000d2  0000000000000000   A       0     0     1</span></span><br><span class="line"><span class="string">  [11] __mcount_loc      PROGBITS         0000000000000000  000003d8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ readelf  -r kbleds.ko</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Relocation section &#x27;</span>.rela.text<span class="string">&#x27; at offset 0x1c960 contains 12 entries:</span></span><br><span class="line"><span class="string">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</span></span><br><span class="line"><span class="string">000000000001  002b00000002 R_X86_64_PC32     0000000000000000 __fentry__ - 4</span></span><br><span class="line"><span class="string">000000000008  002800000002 R_X86_64_PC32     0000000000000000 fg_console - 4</span></span><br><span class="line"><span class="string">00000000000f  000c00000002 R_X86_64_PC32     0000000000000000 .bss + 3</span></span><br><span class="line"><span class="string">000000000020  00310000000b R_X86_64_32S      0000000000000000 vc_cons + 0</span></span><br><span class="line"><span class="string">00000000002d  000c00000002 R_X86_64_PC32     0000000000000000 .bss + 0</span></span><br><span class="line"><span class="string">00000000003d  000c00000002 R_X86_64_PC32     0000000000000000 .bss + c</span></span><br><span class="line"><span class="string">000000000052  002d00000002 R_X86_64_PC32     0000000000000000 __x86_indirect_thunk_r - 4</span></span><br><span class="line"><span class="string">000000000059  003200000002 R_X86_64_PC32     0000000000000000 jiffies - 4</span></span><br><span class="line"><span class="string">000000000060  000c0000000b R_X86_64_32S      0000000000000000 .bss + 20</span></span><br><span class="line"><span class="string">00000000006d  000c00000002 R_X86_64_PC32     0000000000000000 .bss + 2c</span></span><br><span class="line"><span class="string">000000000072  002f00000002 R_X86_64_PC32     0000000000000000 add_timer - 4</span></span><br><span class="line"><span class="string">000000000083  000c00000002 R_X86_64_PC32     0000000000000000 .bss + 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Relocation section &#x27;</span>.rela.init.text<span class="string">&#x27; at offset 0x1ca80 contains 25 entries:</span></span><br><span class="line"><span class="string">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</span></span><br><span class="line"><span class="string">000000000004  00050000000b R_X86_64_32S      0000000000000000 .rodata.str1.1 + 0</span></span><br><span class="line"><span class="string">000000000011  003000000002 R_X86_64_PC32     0000000000000000 printk - 4</span></span><br><span class="line"><span class="string">000000000017  002800000002 R_X86_64_PC32     0000000000000000 fg_console - 4</span></span><br><span class="line"><span class="string">00000000001e  00050000000b R_X86_64_32S      0000000000000000 .rodata.str1.1 + 13</span></span><br><span class="line"><span class="string">000000000025  003000000002 R_X86_64_PC32     0000000000000000 printk - 4</span></span><br><span class="line"><span class="string">000000000030  00310000000b R_X86_64_32S      0000000000000000 vc_cons + 0</span></span><br><span class="line"><span class="string">000000000050  00060000000b R_X86_64_32S      0000000000000000 .rodata.str1.8 + 48</span></span><br><span class="line"><span class="string">000000000058  003000000002 R_X86_64_PC32     0000000000000000 printk - 4</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h3 id="The-userspace-debuginfo"><a href="#The-userspace-debuginfo" class="headerlink" title="The userspace debuginfo"></a>The userspace debuginfo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">gcc -g -o main main.c</span><br><span class="line">gcc -ggdb3 -o main main.c</span><br><span class="line"></span><br><span class="line"><span class="comment">#Generate the debuginfo</span></span><br><span class="line">$ objcopy --only-keep-debug main main.debug</span><br><span class="line">or</span><br><span class="line">$ cp main main.debug</span><br><span class="line">$ strip --only-keep-debug main.debug</span><br><span class="line"></span><br><span class="line"><span class="comment">#Get the debuginfo</span></span><br><span class="line">objcopy --strip-debug main</span><br><span class="line">or</span><br><span class="line">strip --strip-debug --strip-unneeded main</span><br><span class="line"></span><br><span class="line"><span class="comment">#Add debuglink</span></span><br><span class="line">objcopy --add-gnu-debuglink main.debug main</span><br><span class="line">gdb main</span><br><span class="line"></span><br><span class="line"><span class="comment">#import debug file and bin file</span></span><br><span class="line">gdb -s main.debug -e main</span><br><span class="line"></span><br><span class="line">(gdb) exec-file main</span><br><span class="line">(gdb) symbol-file main.debug</span><br><span class="line">(gdb) <span class="built_in">help</span> exec-file</span><br><span class="line">(gdb) <span class="built_in">help</span> symbol-file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#debuginfod</span></span><br><span class="line">https://developers.redhat.com/blog/2019/10/14/introducing-debuginfod-the-elfutils-debuginfo-server<span class="comment">#how_do_i_use_debuginfod_</span></span><br><span class="line">$ yum copr <span class="built_in">enable</span> fche/elfutils</span><br><span class="line">$ yum -y install elfutils-debuginfod</span><br><span class="line"></span><br><span class="line">$ eu-readelf -n foo | grep Build.ID</span><br><span class="line">$ debuginfod -vv -R /var/tmp/rpmbuild -F /usr/lib/debug</span><br><span class="line">$ <span class="built_in">export</span> DEBUGINFOD_URLS=<span class="string">&quot;http://buildhost:8002/&quot;</span></span><br><span class="line">$ debuginfod-find <span class="built_in">source</span> BUILD-ID /path/to/foo.c</span><br><span class="line"></span><br><span class="line"><span class="comment">#test demo</span></span><br><span class="line">$ gcc -ggdb utmp.c -o utmp</span><br><span class="line">$ readelf -n utmp |grep Build</span><br><span class="line">    Build ID: 77e4050eb5a81022b97d2dc24e1094bbb94aa9f0</span><br><span class="line">$ objcopy --only-keep-debug utmp utmp.debug</span><br><span class="line">$ objcopy --strip-debug utmp</span><br><span class="line">$ sudo mv utmp.debug /usr/lib/debug/.build-id/77/e4050eb5a81022b97d2dc24e1094bbb94aa9f0.debug</span><br><span class="line">$</span><br><span class="line">$ gdb ./utmp</span><br><span class="line">......</span><br><span class="line">Reading symbols from ./utmp...</span><br><span class="line">Reading symbols from /usr/lib/debug/.build-id/77/e4050eb5a81022b97d2dc24e1094bbb94aa9f0.debug...</span><br><span class="line">(gdb) </span><br><span class="line"></span><br><span class="line">$ sudo rm -f /usr/lib/debug/.build-id/77/e4050eb5a81022b97d2dc24e1094bbb94aa9f0.debug</span><br><span class="line">$ gdb ./utmp</span><br><span class="line">......</span><br><span class="line">Reading symbols from ./utmp...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> ./utmp)</span><br><span class="line"></span><br><span class="line"><span class="comment">#custom path</span></span><br><span class="line">$ gdb utmp -s ~/utmp.debug</span><br><span class="line"></span><br><span class="line">$ gdb</span><br><span class="line">(gdb) file utmp</span><br><span class="line">(gdb) symbol ~/utmp.debug</span><br></pre></td></tr></table></figure>

<h3 id="gdb-command-line"><a href="#gdb-command-line" class="headerlink" title="gdb command line"></a>gdb command line</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gdb -q --batch -ex=<span class="string">&quot;disas /m ll_statahead_thread&quot;</span> /lib/modules/3.10.0-1127.el7.x86_64/extra/lustre-client/fs/lustre.ko</span><br></pre></td></tr></table></figure>



</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Homer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/03/03/gdb/">http://yoursite.com/2020/03/03/gdb/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/debug/">debug</a><a class="post-meta__tags" href="/tags/trace/">trace</a></div><div class="post_share"><div class="social-share" data-image="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/03/crash/"><img class="prev-cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">crash practice</div></div></a></div><div class="next-post pull-right"><a href="/2019/12/29/lfs_cmd/"><img class="next-cover" src="https://homerl.github.io/img/hard-disk_223cf.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">lfs command</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/12/08/debug/" title="Linux debug"><img class="cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-08</div><div class="title">Linux debug</div></div></a></div><div><a href="/2020/07/24/bpftrace/" title="bpftrace"><img class="cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-24</div><div class="title">bpftrace</div></div></a></div><div><a href="/2020/03/03/crash/" title="crash practice"><img class="cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-03</div><div class="title">crash practice</div></div></a></div><div><a href="/2019/10/31/bcc/" title="Trace by bcc tools"><img class="cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-10-31</div><div class="title">Trace by bcc tools</div></div></a></div><div><a href="/2018/11/23/perf/" title="perf"><img class="cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-11-23</div><div class="title">perf</div></div></a></div><div><a href="/2018/11/22/ftrace/" title="ftrace"><img class="cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-11-22</div><div class="title">ftrace</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2022 By Homer</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '0b9d5b98d0a972b33cf7',
      clientSecret: '769efc11b32f6c0d03bcbf3ee800dfc4e2690459',
      repo: 'homerl.github.io',
      owner: 'homerl',
      admin: ['homerl'],
      id: 'c9b912b7bed7a390794f4dd392bb0841',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>