<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>bencharmk tools | 无常无相无功;不动不破不空</title><meta name="keywords" content="test"><meta name="author" content="寸劲"><meta name="copyright" content="寸劲"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="stress-ngfilesystem123456789101112131415161718192021222324252627282930313233# bogo ops&#x2F;s (real time) is the value of system performance$ stress-ng  --hdd 16 --hdd-opts rd-rnd --hdd-opts wr-rnd --hdd-o">
<meta property="og:type" content="article">
<meta property="og:title" content="bencharmk tools">
<meta property="og:url" content="http://yoursite.com/2020/03/17/benchmark-tools/index.html">
<meta property="og:site_name" content="无常无相无功;不动不破不空">
<meta property="og:description" content="stress-ngfilesystem123456789101112131415161718192021222324252627282930313233# bogo ops&#x2F;s (real time) is the value of system performance$ stress-ng  --hdd 16 --hdd-opts rd-rnd --hdd-opts wr-rnd --hdd-o">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://homerl.github.io/img/kisspng-computer-icons-benchmarking-computer-software-clip-5ad795b068f297.2882681215240780004299.jpg">
<meta property="article:published_time" content="2020-03-17T09:06:14.000Z">
<meta property="article:modified_time" content="2022-05-12T07:17:52.001Z">
<meta property="article:author" content="寸劲">
<meta property="article:tag" content="test">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://homerl.github.io/img/kisspng-computer-icons-benchmarking-computer-software-clip-5ad795b068f297.2882681215240780004299.jpg"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2020/03/17/benchmark-tools/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2022-05-12 15:17:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="无常无相无功;不动不破不空" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/fighting-spiri-logot.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#stress-ng"><span class="toc-number">1.</span> <span class="toc-text">stress-ng</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#filesystem"><span class="toc-number">1.1.</span> <span class="toc-text">filesystem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU"><span class="toc-number">1.2.</span> <span class="toc-text">CPU</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MEM"><span class="toc-number">1.3.</span> <span class="toc-text">MEM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OS"><span class="toc-number">1.4.</span> <span class="toc-text">OS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mix"><span class="toc-number">1.5.</span> <span class="toc-text">mix</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#the-others-test"><span class="toc-number">1.6.</span> <span class="toc-text">the others test</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run"><span class="toc-number"></span> <span class="toc-text">run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run.</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#cpu-method"><span class="toc-number">0.0.1.</span> <span class="toc-text">cpu-method</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#class"><span class="toc-number">0.0.2.</span> <span class="toc-text">class</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#performance-info"><span class="toc-number">0.1.</span> <span class="toc-text">performance info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Verify-mode"><span class="toc-number">0.2.</span> <span class="toc-text">Verify mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Generating-major-page-faults"><span class="toc-number">0.3.</span> <span class="toc-text">Generating major page faults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test-case"><span class="toc-number">1.</span> <span class="toc-text">test case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Emulate-simulate-some-errors-to-test-the-block-device"><span class="toc-number">2.</span> <span class="toc-text">Emulate&#x2F;simulate some errors to test the block device</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dm-delay"><span class="toc-number">2.1.</span> <span class="toc-text">dm-delay</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dm-linear"><span class="toc-number">2.2.</span> <span class="toc-text">dm-linear</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dm-flakey"><span class="toc-number">2.3.</span> <span class="toc-text">dm-flakey</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fio-randseed"><span class="toc-number">2.4.</span> <span class="toc-text">fio randseed</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fio-can-verify-the-file-contents-after-each-iteration-of-the-job"><span class="toc-number">2.5.</span> <span class="toc-text">fio can verify the file contents after each iteration of the job</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fio-metadata"><span class="toc-number">2.6.</span> <span class="toc-text">fio metadata</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#io-uring"><span class="toc-number">2.7.</span> <span class="toc-text">io_uring</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-benchmark"><span class="toc-number">3.</span> <span class="toc-text">redis benchmark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linpack-xtreme-1-1-5-amd64-in-linux"><span class="toc-number">4.</span> <span class="toc-text">linpack-xtreme-1.1.5-amd64 in linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAW-HDD-test"><span class="toc-number">5.</span> <span class="toc-text">RAW HDD test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Network"><span class="toc-number">6.</span> <span class="toc-text">Network</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pkggen-kernel-mode"><span class="toc-number">6.1.</span> <span class="toc-text">pkggen kernel mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nc-test"><span class="toc-number">6.2.</span> <span class="toc-text">nc test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iperf3"><span class="toc-number">6.3.</span> <span class="toc-text">iperf3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#qperf"><span class="toc-number">6.4.</span> <span class="toc-text">qperf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#netperf"><span class="toc-number">6.5.</span> <span class="toc-text">netperf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sockperf"><span class="toc-number">6.6.</span> <span class="toc-text">sockperf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis"><span class="toc-number">6.7.</span> <span class="toc-text">redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RFC6349-TCP-benchmark"><span class="toc-number">6.8.</span> <span class="toc-text">RFC6349 TCP benchmark</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ab"><span class="toc-number">6.9.</span> <span class="toc-text">ab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bash-and-gnu"><span class="toc-number">6.10.</span> <span class="toc-text">bash and gnu</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#another-tools"><span class="toc-number">7.</span> <span class="toc-text">another tools</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://homerl.github.io/img/kisspng-computer-icons-benchmarking-computer-software-clip-5ad795b068f297.2882681215240780004299.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">无常无相无功;不动不破不空</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">bencharmk tools</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-03-17T09:06:14.000Z" title="Created 2020-03-17 17:06:14">2020-03-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-05-12T07:17:52.001Z" title="Updated 2022-05-12 15:17:52">2022-05-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Benchmark/">Benchmark</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="stress-ng"><a href="#stress-ng" class="headerlink" title="stress-ng"></a>stress-ng</h3><h4 id="filesystem"><a href="#filesystem" class="headerlink" title="filesystem"></a>filesystem</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bogo ops/s (real time) is the value of system performance</span></span><br><span class="line"></span><br><span class="line">$ stress-ng  --hdd 16 --hdd-opts rd-rnd --hdd-opts wr-rnd --hdd-opts fadv-rnd --hdd-write-size 128k --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line">stress-ng: info:  [67477] dispatching hogs: 16 hdd</span><br><span class="line">stress-ng: info:  [67477] successful run completed <span class="keyword">in</span> 60.17s (1 min, 0.17 secs)</span><br><span class="line">stress-ng: info:  [67477] stressor       bogo ops real time  usr time  sys time   bogo ops/s   bogo ops/s</span><br><span class="line">stress-ng: info:  [67477]                           (secs)    (secs)    (secs)   (real time) (usr+sys time)</span><br><span class="line">stress-ng: info:  [67477] hdd            19033866     60.12    381.16    575.50    316618.18     19896.17</span><br><span class="line">stress-ng: info:  [67477] <span class="keyword">for</span> a 60.17s run time:</span><br><span class="line">stress-ng: info:  [67477]     962.79s available CPU time</span><br><span class="line">stress-ng: info:  [67477]     381.24s user time   ( 39.60%)</span><br><span class="line">stress-ng: info:  [67477]     575.57s system time ( 59.78%)</span><br><span class="line">stress-ng: info:  [67477]     956.81s total time  ( 99.38%)</span><br><span class="line">stress-ng: info:  [67477] load average: 11.29 4.72 1.86</span><br><span class="line"></span><br><span class="line"><span class="comment"># meta</span></span><br><span class="line">$ stress-ng --sequential 16 --class filesystem --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line">stress-ng: info:  [27612] apparmor stressor will be skipped, AppArmor is not available</span><br><span class="line">stress-ng: info:  [27612] dispatching hogs: 16 <span class="built_in">chdir</span>, 16 chmod, 16 chown, 16 copy-file, 16 dentry, 16 dir, 16 dirdeep, 16 dnotify, 16 dup, 16 eventfd, 16 fallocate, 16 fanotify, 16 fcntl, 16 fiemap, 16 filename, 16 flock, 16 fstat, 16 getdent, 16 handle, 16 inotify, 16 io, 16 iomix, 16 ioprio, 16 lease, 16 link, 16 locka, 16 lockf, 16 lockofd, 16 mknod, 16 open, 16 procfs, 16 rename, 16 symlink, 16 sync-file, 16 utime, 16 xattr</span><br><span class="line"></span><br><span class="line"><span class="comment">#syscall test, no real IO</span></span><br><span class="line">$ stress-ng --<span class="built_in">chdir</span> 8 --chmod 8 --chown 8 --fcntl 8 --filename 8 --flock 8 --fstat 8 --getdent 8 --handle 8 --io 8 -- lockf 8 --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># parallel running</span></span><br><span class="line"><span class="comment"># if you want test IO performance, got the high IO loading from these.</span></span><br><span class="line">$ stress-ng --fallocate 8 --xattr 8 --dir 8 --mknod 8 --symlink 8 --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># a lot of NFS not support xattr</span></span><br><span class="line">$ stress-ng --fallocate 8 --dir 8 --mknod 8 --symlink 8 --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># the high IO loading test could got the high IOPS in ext4 with SATA SSD</span></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sdb               0.00 100284.00    0.00 15955.50     0.00   452.52    58.08    97.34    6.05    0.00    6.05   0.06  95.05</span><br></pre></td></tr></table></figure>

<h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --cpu <span class="variable">$cores_num</span> --timeout 900</span><br></pre></td></tr></table></figure>

<h4 id="MEM"><a href="#MEM" class="headerlink" title="MEM"></a>MEM</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --vm 4 --timeout 900s</span><br><span class="line">$ stress-ng --vm-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.9;&#125;&#x27;</span> &lt; /proc/meminfo)k --vm-keep -m 1 -t 30s --metrics-brief</span><br><span class="line">$ stress-ng --mincore 5 --mincore-random --malloc 2 --malloc-bytes 10g --mremap 2 --mremap-bytes 10g --memfd 2 --memfd-bytes 10g --vm-bytes 10g -m 2  -t 600s --metrics-brief</span><br></pre></td></tr></table></figure>

<h4 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --mq 0 -t 30s --<span class="built_in">times</span>  --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># The matrix stressor is a good way to exercise the CPU floating point operations as well as memory and processor data cache. Of all the tests, this one generally heats x86 CPUs the best.</span></span><br><span class="line">$ stress-ng --matrix 0 -t 1m --<span class="built_in">times</span> --metrics-brief</span><br></pre></td></tr></table></figure>

<h4 id="mix"><a href="#mix" class="headerlink" title="mix"></a>mix</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --cpu 2 --matrix 1 --mq 3</span><br><span class="line">$ stress-ng --all 2</span><br><span class="line"></span><br><span class="line">$ stress-ng --seq 1 -x numa,matrix,hdd</span><br><span class="line"><span class="comment">#        --sequential N</span></span><br><span class="line">sequentially run all the stressors one by one <span class="keyword">for</span> a default of 60 seconds. The number of instances of each of the individual stressors to be started is N.  If N  is  less than  zero, <span class="keyword">then</span> the number of CPUs online is used <span class="keyword">for</span> the number of instances.  If N is zero, <span class="keyword">then</span> the number of CPUs <span class="keyword">in</span> the system is used.  Use the --timeout option to specify the duration to run each stressor.</span><br></pre></td></tr></table></figure>

<h4 id="the-others-test"><a href="#the-others-test" class="headerlink" title="the others test"></a>the others test</h4><p>$ stress-ng –seq 1 -x nuam, –sched fifo  -t 30s –times –metrics-brief<br>$ stress-ng –vm 16 –vm-bytes 90% -t 1h –metrics-brief<br>$ stress-ng –cpu 8 –cpu-ops 800000<br>$ stress-ng –cpu 4 –cpu-method fft –cpu-ops 10000 –metrics-brief<br>$ stress-ng –cpu 0 –cpu-method all -t 1h<br>$ stress-ng –random 64<br>#run 64 stressors that are randomly chosen from all the available stressors.</p>
<p>$ stress-ng –cpu 64 –cpu-method all –verify -t 10m –metrics-brief<br>#run 64 instances of all the different cpu stressors and verify that the computations are correct for 10 minutes with a bogo operations summary at the end.</p>
<p>$ stress-ng –sequential 8 –class io -t 5m –times</p>
<h1 id="run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run"><a href="#run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run" class="headerlink" title="run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run."></a>run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run.</h1><p>$ stress-ng –all 0 –maximize –aggressive<br>#run all the stressors (1 instance of each per CPU) simultaneously, maximize the settings (memory sizes, file allocations, etc.) and select the  most  demanding/aggressive options.</p>
<p>$        stress-ng –sequential 4 –class vm –exclude bigheap,brk,stack<br>#run 4 instances of the VM stressors one after each other, excluding the bigheap, brk and stack stressors</p>
<p>$ stress-ng –taskset 0,2-3 –cpu 3<br>#run 3 instances of the CPU stressor and pin them to CPUs 0, 2 and 3.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">##### cpu-cache</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">$</span> <span class="string">stress-ng</span> <span class="string">--sequential</span> <span class="number">8</span> <span class="string">--class</span> <span class="string">cpu-cache</span> <span class="string">-t</span> <span class="string">5m</span></span><br><span class="line"><span class="attr">stress-ng: info:</span>  [<span class="number">13341</span>] <span class="string">apparmor</span> <span class="string">stressor</span> <span class="string">will</span> <span class="string">be</span> <span class="string">skipped,</span> <span class="string">AppArmor</span> <span class="string">is</span> <span class="string">not</span> <span class="string">available</span></span><br><span class="line"><span class="attr">stress-ng: info:</span>  [<span class="number">13341</span>] <span class="attr">dispatching hogs:</span> <span class="number">8</span> <span class="string">bsearch,</span> <span class="number">8</span> <span class="string">cache,</span> <span class="number">8</span> <span class="string">heapsort,</span> <span class="number">8</span> <span class="string">hsearch,</span> <span class="number">8</span> <span class="string">icache,</span> <span class="number">8</span> <span class="string">lockbus,</span> <span class="number">8</span> <span class="string">lsearch,</span> <span class="number">8</span> <span class="string">malloc,</span> <span class="number">8</span> <span class="string">matrix,</span> <span class="number">8</span> <span class="string">membarrier,</span> <span class="number">8</span> <span class="string">memcpy,</span> <span class="number">8</span> <span class="string">mergesort,</span> <span class="number">8</span> <span class="string">qsort,</span> <span class="number">8</span> <span class="string">str,</span> <span class="number">8</span> <span class="string">stream,</span> <span class="number">8</span> <span class="string">tsearch,</span> <span class="number">8</span> <span class="string">vecmath,</span> <span class="number">8</span> <span class="string">wcs,</span> <span class="number">8</span> <span class="string">zlib</span></span><br><span class="line"></span><br><span class="line"><span class="string">$</span> <span class="string">stress-ng</span> <span class="string">--cpu</span> <span class="number">4</span> <span class="string">--cache-level</span> <span class="number">2</span> <span class="string">--cache-ways</span> <span class="number">4</span> <span class="string">-t</span> <span class="string">30s</span> <span class="string">--metrics-brief</span></span><br><span class="line"><span class="string">$</span> <span class="string">stress-ng</span> <span class="string">--cpu</span> <span class="number">4</span> <span class="string">--cache-level</span> <span class="number">3</span> <span class="string">--cache-ways</span> <span class="number">4</span> <span class="string">-t</span> <span class="string">30s</span> <span class="string">--metrics-brief</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="string">$</span> <span class="string">stress-ng</span> <span class="string">--all</span> <span class="number">0</span> <span class="string">--class</span> <span class="string">cpu-cache</span> <span class="string">-t</span> <span class="string">5m</span> <span class="string">--metrics-brief</span></span><br></pre></td></tr></table></figure>

<h5 id="cpu-method"><a href="#cpu-method" class="headerlink" title="cpu-method"></a>cpu-method</h5><p>$ stress-ng –cpu 1 –cpu-method matrixprod -t 1m –metrics-brief<br>$ for m in double longdouble matrixprod nsqrt cfloat clongdouble decimal32 decimal128 explog bitops ln2 int64 int128 ackermann int128decimal128 gray euler fibonacci; do stress-ng –cpu 0 –cpu-method $m -t 10s –metrics-brief; done</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># float</span></span><br><span class="line">double           <span class="number">1000</span> iterations of a mix of double precision floating point operations</span><br><span class="line">longdouble       <span class="number">1000</span> iterations of a mix of long double precision floating point operations</span><br><span class="line">matrixprod       matrix  product  of  two  <span class="number">128</span> × <span class="number">128</span> matrices of double floats. Testing on <span class="number">64</span> <span class="keyword">bit </span>x86 hardware <span class="keyword">shows </span>that this is provides a good mix of memory, <span class="keyword">cache </span><span class="keyword">and </span>floating point operations <span class="keyword">and </span>is probably the <span class="keyword">best </span>CPU method to use to make a CPU run hot.</span><br><span class="line">nsqrt            compute sqrt() of long doubles using Newton-Raphson</span><br><span class="line">cfloat           <span class="number">1000</span> iterations of a mix of floating point complex operations</span><br><span class="line"><span class="keyword">clongdouble </span>     <span class="number">1000</span> iterations of a mix of long double floating point complex operations</span><br><span class="line">decimal32        <span class="number">1000</span> iterations of a mix of <span class="number">32</span> <span class="keyword">bit </span>decimal floating point operations (GCC only)</span><br><span class="line">decimal128       <span class="number">1000</span> iterations of a mix of <span class="number">128</span> <span class="keyword">bit </span>decimal floating point operations (GCC only)</span><br><span class="line">explog           iterate on n = exp(log(n) ÷ <span class="number">1</span>.<span class="number">00002</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#int</span></span><br><span class="line">int64            <span class="number">1000</span> iterations of a mix of <span class="number">64</span> <span class="keyword">bit </span>integer operations</span><br><span class="line">int128           <span class="number">1000</span> iterations of a mix of <span class="number">128</span> <span class="keyword">bit </span>integer operations (GCC only)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------performance test--------------------------</span><br><span class="line"><span class="comment">#logic</span></span><br><span class="line"><span class="keyword">jmp </span>             Simple unoptimised <span class="built_in">compare</span> &gt;, &lt;, == <span class="keyword">and </span><span class="keyword">jmp </span><span class="keyword">branching</span></span><br><span class="line"><span class="keyword">ackermann </span>       Ackermann function: compute A(<span class="number">3</span>, <span class="number">10</span>), where:</span><br><span class="line">                 A(m, n) = n + <span class="number">1</span> if m = <span class="number">0</span>;</span><br><span class="line">                 A(m - <span class="number">1</span>, <span class="number">1</span>) if m &gt; <span class="number">0</span> <span class="keyword">and </span>n = <span class="number">0</span>;</span><br><span class="line">                 A(m - <span class="number">1</span>, A(m, n - <span class="number">1</span>)) if m &gt; <span class="number">0</span> <span class="keyword">and </span>n &gt; <span class="number">0</span></span><br><span class="line"><span class="comment"># bit</span></span><br><span class="line"><span class="keyword">bitops </span>          various <span class="keyword">bit </span>operations from <span class="keyword">bithack, </span>namely: reverse <span class="keyword">bits, </span>parity check, <span class="keyword">bit </span><span class="built_in">count</span>, round to nearest power of <span class="number">2</span></span><br><span class="line"><span class="comment"># int</span></span><br><span class="line">gray             calculate <span class="keyword">binary </span>to gray code <span class="keyword">and </span>gray code <span class="keyword">back </span>to <span class="keyword">binary </span>for integers from <span class="number">0</span> to <span class="number">65535</span> </span><br><span class="line">fibonacci        compute Fibonacci sequence of <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>...</span><br><span class="line"></span><br><span class="line"><span class="comment">#float</span></span><br><span class="line">euler            compute e using n = (<span class="number">1</span> + (<span class="number">1</span> ÷ n)) ↑ n </span><br><span class="line">ln2              compute ln(<span class="number">2</span>) <span class="keyword">based </span>on series:</span><br><span class="line"><span class="comment">#mix</span></span><br><span class="line">int128decimal32 <span class="number">1000</span> iterations of a mix of <span class="number">128</span> <span class="keyword">bit </span>integer <span class="keyword">and </span><span class="number">128</span> <span class="keyword">bit </span>decimal floating point operations (GCC only)</span><br><span class="line"><span class="comment">#rand hash</span></span><br><span class="line">djb2a            <span class="number">128</span> rounds of hash DJB2a (Dan <span class="keyword">Bernstein </span>hash using the <span class="keyword">xor </span>variant) on <span class="number">128</span> to <span class="number">1</span> <span class="keyword">bytes </span>of <span class="built_in">random</span> strings</span><br><span class="line"><span class="keyword">dither </span>          Floyd–Steinberg <span class="keyword">dithering </span>of a <span class="number">1024</span> × <span class="number">768</span> <span class="built_in">random</span> image from <span class="number">8</span> <span class="keyword">bits </span>down to <span class="number">1</span> <span class="keyword">bit </span>of depth.</span><br><span class="line">crc16            compute <span class="number">1024</span> rounds of CCITT CRC16 on <span class="built_in">random</span> data</span><br><span class="line"></span><br><span class="line">-----------------------------------END--------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">#C</span></span><br><span class="line">callfunc         recursively call <span class="number">8</span> argument C function to a depth of <span class="number">1024</span> calls <span class="keyword">and </span>unwind</span><br><span class="line"></span><br><span class="line"><span class="comment">#random, hash</span></span><br><span class="line"><span class="keyword">jenkin </span>       <span class="keyword">Jenkin&#x27;s </span>integer hash on <span class="number">128</span> rounds of <span class="number">128</span>..<span class="number">1</span> <span class="keyword">bytes </span>of <span class="built_in">random</span> data</span><br><span class="line">hanoi         solve a <span class="number">21</span> <span class="keyword">disc </span>Towers of Hanoi stack using the recursive solution</span><br><span class="line">              hamming          compute Hamming H(<span class="number">8</span>,<span class="number">4</span>) codes on <span class="number">262144</span> lots of <span class="number">4</span> <span class="keyword">bit </span>data. This turns <span class="number">4</span> <span class="keyword">bit </span>data into <span class="number">8</span> <span class="keyword">bit </span>Hamming code containing <span class="number">4</span> parity <span class="keyword">bits. </span>For data <span class="keyword">bits </span> d1..d4,</span><br><span class="line">                               parity <span class="keyword">bits </span>are computed as:</span><br><span class="line">                                 p1 = d2 + d3 + d4</span><br><span class="line">                                 p2 = d1 + d3 + d4</span><br><span class="line">                                 p3 = d1 + d2 + d4</span><br><span class="line">                                 p4 = d1 + d2 + d3</span><br><span class="line">correlate        perform a <span class="number">16384</span> × <span class="number">1024</span> correlation of <span class="built_in">random</span> doubles</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--memthrash-method method</span><br><span class="line">              specify a memthrash stress method. Available memthrash stress methods are described</span><br><span class="line">              as follows:</span><br><span class="line"></span><br><span class="line">              Method           Description</span><br><span class="line">              all              iterate over all the <span class="keyword">below </span>memthrash methods</span><br><span class="line">              chunk1           memset <span class="number">1</span> <span class="keyword">byte </span><span class="keyword">chunks </span>of <span class="built_in">random</span> data into <span class="built_in">random</span> locations</span><br><span class="line">              chunk8           memset <span class="number">8</span> <span class="keyword">byte </span><span class="keyword">chunks </span>of <span class="built_in">random</span> data into <span class="built_in">random</span> locations</span><br><span class="line">              chunk64          memset <span class="number">64</span> <span class="keyword">byte </span><span class="keyword">chunks </span>of <span class="built_in">random</span> data into <span class="built_in">random</span> locations</span><br><span class="line">              chunk256         memset <span class="number">256</span> <span class="keyword">byte </span><span class="keyword">chunks </span>of <span class="built_in">random</span> data into <span class="built_in">random</span> locations</span><br><span class="line">              chunkpage        memset page size <span class="keyword">chunks </span>of <span class="built_in">random</span> data into <span class="built_in">random</span> locations</span><br><span class="line">              flip             flip (invert) all <span class="keyword">bits </span>in ramdom locations</span><br><span class="line">              flush            flush <span class="keyword">cache </span>line in <span class="built_in">random</span> locations</span><br><span class="line">              lock             lock randomly choosing locations (Intel x86 CPUs only)</span><br><span class="line">              matrix           treat memory as a <span class="number">2</span> × <span class="number">2</span> matrix <span class="keyword">and </span><span class="keyword">swap </span><span class="built_in">random</span> elements</span><br><span class="line">              memset           memset the memory with <span class="built_in">random</span> data</span><br><span class="line">              mfence           stores with write serialization (Intel x86 CPUs only)</span><br><span class="line">              <span class="keyword">prefetch </span>        <span class="keyword">prefetch </span>data <span class="built_in">at</span> <span class="built_in">random</span> memory locations</span><br><span class="line">              <span class="built_in">random</span>           randomly  run any of the memthrash methods except for <span class="string">&#x27;random&#x27;</span> <span class="keyword">and</span></span><br><span class="line"><span class="keyword"> </span>                              <span class="string">&#x27;all&#x27;</span></span><br><span class="line">              spinread         spin loop read the same <span class="built_in">random</span> location <span class="number">2</span>^<span class="number">19</span> times</span><br><span class="line">              spinwrite        spin loop write the same <span class="built_in">random</span> location <span class="number">2</span>^<span class="number">19</span> times</span><br></pre></td></tr></table></figure>

<h5 id="class"><a href="#class" class="headerlink" title="class"></a>class</h5><p>The stress-ng stressors are grouped together in different classes:</p>
<p>cpu - CPU intensive<br>cpu-cache - stress CPU instruction and/or data caches<br>device - raw device driver stressors<br>io - generic input/output<br>interrupt - high interrupt load generators<br>filesystem - file system activity<br>memory - stack, heap, memory mapping, shared memory stressors<br>network - TCP/IP, UDP and UNIX domain socket stressors<br>os - core kernel stressors<br>pipe - pipe and UNIX socket stressors<br>scheduler - force high levels of context switching<br>security - AppArmor stressor<br>vm - Virtual Memory stressor (paging and memory)</p>
<p>–matrix-method method<br>       specify a matrix stress method. Available matrix stress methods are described as follows:</p>
<pre><code>   Method           Description
   all              iterate over all the below matrix stress methods
   add              add two N × N matrices

   copy             copy one N × N matrix to another
   div              divide an N × N matrix by a scalar
   hadamard         Hadamard product of two N × N matrices
   frobenius        Frobenius product of two N × N matrices
   mean             arithmetic mean of two N × N matrices
   mult             multiply an N × N matrix by a scalar
   prod             product of two N × N matrices
   sub              subtract one N × N matrix from another N × N matrix
   trans            transpose an N × N matrix</code></pre>
<h4 id="performance-info"><a href="#performance-info" class="headerlink" title="performance info"></a>performance info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --mq 0 -t 30s --<span class="built_in">times</span> --perf</span><br><span class="line">stress-ng: info:  [68895] dispatching hogs: 16 mq</span><br><span class="line">^Cstress-ng: info:  [68895] unsuccessful run completed <span class="keyword">in</span> 15.95s</span><br><span class="line">stress-ng: info:  [68895] mq:</span><br><span class="line">stress-ng: info:  [68895]            667,942,869,088 CPU Cycles                    41.88 B/sec</span><br><span class="line">stress-ng: info:  [68895]            343,598,563,312 Instructions                  21.54 B/sec (0.514 instr. per cycle)</span><br><span class="line">stress-ng: info:  [68895]              4,273,568,592 Cache References               0.27 B/sec</span><br><span class="line">stress-ng: info:  [68895]                108,195,424 Cache Misses                   6.78 M/sec ( 2.53%)</span><br><span class="line">stress-ng: info:  [68895]             62,069,485,136 Branch Instructions            3.89 B/sec</span><br><span class="line">stress-ng: info:  [68895]              1,391,055,360 Branch Misses                 87.21 M/sec ( 2.24%)</span><br><span class="line">stress-ng: info:  [68895]              4,911,414,496 Bus Cycles                     0.31 B/sec</span><br><span class="line">stress-ng: info:  [68895]            510,787,333,888 Total Cycles                  32.02 B/sec</span><br><span class="line">stress-ng: info:  [68895]                      3,184 Page Faults Minor            199.61 /sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Page Faults Major              0.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                  3,924,080 Context Switches               0.25 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    718,208 CPU Migrations                45.03 K/sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Alignment Faults               0.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                      3,088 Page Faults User             193.60 /sec</span><br><span class="line">stress-ng: info:  [68895]                         96 Page Faults Kernel             6.02 /sec</span><br><span class="line">stress-ng: info:  [68895]                 92,731,952 System Call Enter              5.81 M/sec</span><br><span class="line">stress-ng: info:  [68895]                 92,731,952 System Call Exit               5.81 M/sec</span><br><span class="line">stress-ng: info:  [68895]                 54,434,816 Kmalloc                        3.41 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    399,904 Kmalloc Node                  25.07 K/sec</span><br><span class="line">stress-ng: info:  [68895]                231,994,672 Kfree                         14.54 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    139,904 Kmem Cache Alloc               8.77 K/sec</span><br><span class="line">stress-ng: info:  [68895]                     88,848 Kmem Cache Alloc Node          5.57 K/sec</span><br><span class="line">stress-ng: info:  [68895]                    181,568 Kmem Cache Free               11.38 K/sec</span><br><span class="line">stress-ng: info:  [68895]                     59,856 MM Page Alloc                  3.75 K/sec</span><br><span class="line">stress-ng: info:  [68895]                    158,720 MM Page Free                   9.95 K/sec</span><br><span class="line">stress-ng: info:  [68895]                  8,842,656 RCU Utilization                0.55 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    764,352 Sched Migrate Task            47.92 K/sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Sched Move NUMA                0.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                  6,617,648 Sched Wakeup                   0.41 M/sec</span><br><span class="line">stress-ng: info:  [68895]                         16 Signal Generate                1.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                         80 Signal Deliver                 5.02 /sec</span><br><span class="line">stress-ng: info:  [68895]                        672 IRQ Entry                     42.13 /sec</span><br><span class="line">stress-ng: info:  [68895]                        672 IRQ Exit                      42.13 /sec</span><br><span class="line">stress-ng: info:  [68895]                    664,704 Soft IRQ Entry                41.67 K/sec</span><br><span class="line">stress-ng: info:  [68895]                    664,704 Soft IRQ Exit                 41.67 K/sec</span><br><span class="line">stress-ng: info:  [68895]                         16 Writeback Dirty Inode          1.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Writeback Dirty Page           0.00 /sec</span><br><span class="line">stress-ng: info:  [68895] <span class="keyword">for</span> a 15.95s run time:</span><br><span class="line">stress-ng: info:  [68895]     255.21s available CPU time</span><br><span class="line">stress-ng: info:  [68895]      25.73s user time   ( 10.08%)</span><br><span class="line">stress-ng: info:  [68895]     181.50s system time ( 71.12%)</span><br><span class="line">stress-ng: info:  [68895]     207.23s total time  ( 81.20%)</span><br><span class="line">stress-ng: info:  [68895] load average: 5.35 1.73 1.08</span><br></pre></td></tr></table></figure>

<h4 id="Verify-mode"><a href="#Verify-mode" class="headerlink" title="Verify mode"></a>Verify mode</h4><p>Some stressors have a verification mode. A stress test is run and the results are checked, if the results are incorrect then stress-ng will flag up a warning error message. Suppose we want to run some exhaustive memory checks on a blob of virtually mapped memory via the vm stressor, enable the –verify mode and this will sanity check that the read/write results on the memory:</p>
<p>$ stress-ng –vm 1 –vm-bytes 2G –verify -v<br>Note that not all stressors have a verify mode, and enabling it will reduce the bogo op stats as there is an extra verification step being invoked.</p>
<h4 id="Generating-major-page-faults"><a href="#Generating-major-page-faults" class="headerlink" title="Generating major page faults"></a>Generating major page faults</h4><p>You can generate major page faults (by accessing a page is not loaded in memory at the time of the fault) and see the page fault rate using:<br>$ stress-ng –fault 0 –perf -t 1m</p>
<p>or with newer kernels use the userfaultfd stressor to force even more major faults:<br>$ stress-ng –userfaultfd 0 –perf -t 1m</p>
<p>Running timers at high frequency can generate a large interrupt load. The timer stressor with an appropriately selected timer frequency can be used to force many hundreds of thousands of interrupts per second, for example, 32 instances at 1MHz:<br>$ stress-ng –timer 32 –timer-freq 1000000</p>
<h3 id="test-case"><a href="#test-case" class="headerlink" title="test case"></a>test case</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -------all cores CPU case1:------</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> jmp bitops fibonacci euler ln2 int128decimal32 djb2a crc16; <span class="keyword">do</span> stress-ng --cpu 0 --cpu-method <span class="variable">$m</span> -t 240s --metrics-brief; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> -------4 cores CPU case1:------</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> jmp bitops fibonacci euler ln2 int128decimal32 djb2a crc16; <span class="keyword">do</span> stress-ng --cpu 4 --cpu-method <span class="variable">$m</span> -t 240s --metrics-brief; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> -------mem test1:---------</span><br><span class="line">stress-ng --malloc 1 --malloc-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k  --vm-keep -m 1 --vm-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k --mremap 2 --mremap-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k --memfd 2 --memfd-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k -t 600s --metrics-brief</span><br><span class="line"><span class="built_in">echo</span> -------mem test2:---------</span><br><span class="line">stress-ng --mincore 0 --mincore-random -t 600s --metrics-brief</span><br><span class="line"><span class="built_in">echo</span> -------mem test3:---------</span><br><span class="line">stress-ng --vm-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.9;&#125;&#x27;</span> /proc/meminfo)k --vm-keep -m 1 -t 600s --metrics-brief</span><br></pre></td></tr></table></figure>

<h3 id="Emulate-simulate-some-errors-to-test-the-block-device"><a href="#Emulate-simulate-some-errors-to-test-the-block-device" class="headerlink" title="Emulate/simulate some errors to test the block device"></a>Emulate/simulate some errors to test the block device</h3><h4 id="dm-delay"><a href="#dm-delay" class="headerlink" title="dm-delay"></a><a target="_blank" rel="noopener" href="https://enodev.fr/posts/emulate-a-slow-block-device-with-dm-delay.html#">dm-delay</a></h4><p>Device-Mapper’s “delay” target delays reads and/or writes and maps them to different devices.</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$ sudo modprobe brd rd_nr=<span class="number">1</span> rd_size=<span class="number">1048576</span></span><br><span class="line"></span><br><span class="line">[random]</span><br><span class="line">readwrite=randread</span><br><span class="line">blocksize=<span class="number">4</span>k</span><br><span class="line">ioengine=sync</span><br><span class="line">filename=/dev/ram0</span><br><span class="line">time_based=<span class="number">1</span></span><br><span class="line">runtime=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">DDR <span class="number">1333</span></span><br><span class="line">Jobs: <span class="number">1</span> (f=<span class="number">1</span>): [r(<span class="number">1</span>)][<span class="number">100.0</span>%][r=<span class="number">1471</span>MiB/s,w=<span class="number">0</span>KiB/s][r=<span class="number">377</span>k,w=<span class="number">0</span> IOPS][eta <span class="number">00</span>m:<span class="number">00</span>s]</span><br><span class="line">rw: (groupid=<span class="number">0</span>, jobs=<span class="number">1</span>): err= <span class="number">0</span>: pid=<span class="number">13487</span>: Thu Jun  <span class="number">4</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">25</span> <span class="number">2020</span></span><br><span class="line">   read: IOPS=<span class="number">361</span>k, BW=<span class="number">1411</span>MiB/s (<span class="number">1480</span>MB/s)(<span class="number">13.8</span>GiB/<span class="number">10001</span>msec)</span><br><span class="line">    clat (nsec): min=<span class="number">790</span>, max=<span class="number">124854</span>, avg=<span class="number">1563.39</span>, stdev=<span class="number">935.07</span></span><br><span class="line">     lat (nsec): min=<span class="number">984</span>, max=<span class="number">125042</span>, avg=<span class="number">1757.85</span>, stdev=<span class="number">978.84</span></span><br><span class="line">    clat percentiles (nsec):</span><br><span class="line">     |  <span class="number">1.00</span>th=[ <span class="number">1240</span>],  <span class="number">5.00</span>th=[ <span class="number">1304</span>], <span class="number">10.00</span>th=[ <span class="number">1336</span>], <span class="number">20.00</span>th=[ <span class="number">1368</span>],</span><br><span class="line">     | <span class="number">30.00</span>th=[ <span class="number">1384</span>], <span class="number">40.00</span>th=[ <span class="number">1400</span>], <span class="number">50.00</span>th=[ <span class="number">1432</span>], <span class="number">60.00</span>th=[ <span class="number">1464</span>],</span><br><span class="line">     | <span class="number">70.00</span>th=[ <span class="number">1496</span>], <span class="number">80.00</span>th=[ <span class="number">1560</span>], <span class="number">90.00</span>th=[ <span class="number">1752</span>], <span class="number">95.00</span>th=[ <span class="number">2352</span>],</span><br><span class="line">     | <span class="number">99.00</span>th=[ <span class="number">3376</span>], <span class="number">99.50</span>th=[ <span class="number">4080</span>], <span class="number">99.90</span>th=[<span class="number">14784</span>], <span class="number">99.95</span>th=[<span class="number">24960</span>],</span><br><span class="line">     | <span class="number">99.99</span>th=[<span class="number">31360</span>]</span><br><span class="line">   bw (  MiB/s): min= <span class="number">1004</span>, max= <span class="number">1476</span>, per=<span class="number">99.79</span>%, avg=<span class="number">1408.26</span>, stdev=<span class="number">144.72</span>, samples=<span class="number">19</span></span><br><span class="line">   iops        : min=<span class="number">257224</span>, max=<span class="number">377934</span>, avg=<span class="number">360514.11</span>, stdev=<span class="number">37048.52</span>, samples=<span class="number">19</span></span><br><span class="line">  lat (nsec)   : <span class="number">1000</span>=<span class="number">0.01</span>%</span><br><span class="line">  lat (usec)   : <span class="number">2</span>=<span class="number">91.75</span>%, <span class="number">4</span>=<span class="number">7.64</span>%, <span class="number">10</span>=<span class="number">0.49</span>%, <span class="number">20</span>=<span class="number">0.03</span>%, <span class="number">50</span>=<span class="number">0.09</span>%</span><br><span class="line">  lat (usec)   : <span class="number">100</span>=<span class="number">0.01</span>%, <span class="number">250</span>=<span class="number">0.01</span>%</span><br><span class="line">  cpu          : usr=<span class="number">27.40</span>%, sys=<span class="number">72.48</span>%, ctx=<span class="number">954</span>, majf=<span class="number">0</span>, minf=<span class="number">9</span></span><br><span class="line">  IO depths    : <span class="number">1</span>=<span class="number">100.0</span>%, <span class="number">2</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">0.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     submit    : <span class="number">0</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">100.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.0</span>%, <span class="number">64</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     complete  : <span class="number">0</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">100.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.0</span>%, <span class="number">64</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     issued rwt: total=<span class="number">3613043</span>,<span class="number">0</span>,<span class="number">0</span>, short=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, dropped=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">     latency   : target=<span class="number">0</span>, window=<span class="number">0</span>, percentile=<span class="number">100.00</span>%, depth=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">Run status group <span class="number">0</span> (all jobs):</span><br><span class="line">   READ: bw=<span class="number">1411</span>MiB/s (<span class="number">1480</span>MB/s), <span class="number">1411</span>MiB/s<span class="number">-1411</span>MiB/s (<span class="number">1480</span>MB/s<span class="number">-1480</span>MB/s), io=<span class="number">13.8</span>GiB (<span class="number">14.8</span>GB), run=<span class="number">10001</span><span class="number">-10001</span>msec</span><br><span class="line"></span><br><span class="line"># Create device delaying rw operation <span class="keyword">for</span> <span class="number">500</span>ms</span><br><span class="line">$ echo <span class="string">&quot;0 $(blockdev --getsz /dev/ram0) delay /dev/ram0 0 500&quot;</span> | dmsetup create delayed</span><br><span class="line">$ ls -l /dev/mapper/delayed </span><br><span class="line">lrwxrwxrwx <span class="number">1</span> root root <span class="number">7</span> <span class="number">6</span>   <span class="number">4</span> <span class="number">22</span>:<span class="number">47</span> /dev/mapper/delayed -&gt; ../dm<span class="number">-0</span></span><br><span class="line"></span><br><span class="line">[random]</span><br><span class="line">filename=/dev/dm<span class="number">-0</span></span><br><span class="line">readwrite=randread</span><br><span class="line">blocksize=<span class="number">4</span>k</span><br><span class="line">ioengine=sync</span><br><span class="line">time_based=<span class="number">1</span></span><br><span class="line">runtime=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">Starting <span class="number">1</span> process</span><br><span class="line">Jobs: <span class="number">1</span> (f=<span class="number">1</span>): [r(<span class="number">1</span>)][<span class="number">100.0</span>%][r=<span class="number">8</span>KiB/s,w=<span class="number">0</span>KiB/s][r=<span class="number">2</span>,w=<span class="number">0</span> IOPS][eta <span class="number">00</span>m:<span class="number">00</span>s]</span><br><span class="line">random: (groupid=<span class="number">0</span>, jobs=<span class="number">1</span>): err= <span class="number">0</span>: pid=<span class="number">13873</span>: Thu Jun  <span class="number">4</span> <span class="number">22</span>:<span class="number">56</span>:<span class="number">44</span> <span class="number">2020</span></span><br><span class="line">   read: IOPS=<span class="number">1</span>, BW=<span class="number">8007</span>B/s (<span class="number">8007</span>B/s)(<span class="number">80.0</span>KiB/<span class="number">10231</span>msec)</span><br><span class="line">    clat (msec): min=<span class="number">503</span>, max=<span class="number">516</span>, avg=<span class="number">511.50</span>, stdev= <span class="number">2.97</span></span><br><span class="line">     lat (msec): min=<span class="number">503</span>, max=<span class="number">516</span>, avg=<span class="number">511.50</span>, stdev= <span class="number">2.97</span></span><br><span class="line">    clat percentiles (msec):</span><br><span class="line">     |  <span class="number">1.00</span>th=[  <span class="number">506</span>],  <span class="number">5.00</span>th=[  <span class="number">506</span>], <span class="number">10.00</span>th=[  <span class="number">510</span>], <span class="number">20.00</span>th=[  <span class="number">510</span>],</span><br><span class="line">     | <span class="number">30.00</span>th=[  <span class="number">514</span>], <span class="number">40.00</span>th=[  <span class="number">514</span>], <span class="number">50.00</span>th=[  <span class="number">514</span>], <span class="number">60.00</span>th=[  <span class="number">514</span>],</span><br><span class="line">     | <span class="number">70.00</span>th=[  <span class="number">514</span>], <span class="number">80.00</span>th=[  <span class="number">514</span>], <span class="number">90.00</span>th=[  <span class="number">514</span>], <span class="number">95.00</span>th=[  <span class="number">518</span>],</span><br><span class="line">     | <span class="number">99.00</span>th=[  <span class="number">518</span>], <span class="number">99.50</span>th=[  <span class="number">518</span>], <span class="number">99.90</span>th=[  <span class="number">518</span>], <span class="number">99.95</span>th=[  <span class="number">518</span>],</span><br><span class="line">     | <span class="number">99.99</span>th=[  <span class="number">518</span>]</span><br><span class="line">   bw (  KiB/s): min=    <span class="number">8</span>, max=    <span class="number">8</span>, per=<span class="number">100.00</span>%, avg= <span class="number">8.00</span>, stdev= <span class="number">0.00</span>, samples=<span class="number">19</span></span><br><span class="line">   iops        : min=    <span class="number">2</span>, max=    <span class="number">2</span>, avg= <span class="number">2.00</span>, stdev= <span class="number">0.00</span>, samples=<span class="number">19</span></span><br><span class="line">  lat (msec)   : <span class="number">750</span>=<span class="number">100.00</span>%</span><br><span class="line">  cpu          : usr=<span class="number">0.00</span>%, sys=<span class="number">0.02</span>%, ctx=<span class="number">20</span>, majf=<span class="number">0</span>, minf=<span class="number">6</span></span><br><span class="line">  IO depths    : <span class="number">1</span>=<span class="number">100.0</span>%, <span class="number">2</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">0.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     submit    : <span class="number">0</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">100.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.0</span>%, <span class="number">64</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     complete  : <span class="number">0</span>=<span class="number">0.0</span>%, <span class="number">4</span>=<span class="number">100.0</span>%, <span class="number">8</span>=<span class="number">0.0</span>%, <span class="number">16</span>=<span class="number">0.0</span>%, <span class="number">32</span>=<span class="number">0.0</span>%, <span class="number">64</span>=<span class="number">0.0</span>%, &gt;=<span class="number">64</span>=<span class="number">0.0</span>%</span><br><span class="line">     issued rwt: total=<span class="number">20</span>,<span class="number">0</span>,<span class="number">0</span>, short=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, dropped=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">     latency   : target=<span class="number">0</span>, window=<span class="number">0</span>, percentile=<span class="number">100.00</span>%, depth=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">Run status group <span class="number">0</span> (all jobs):</span><br><span class="line">   READ: bw=<span class="number">8007</span>B/s (<span class="number">8007</span>B/s), <span class="number">8007</span>B/s<span class="number">-8007</span>B/s (<span class="number">8007</span>B/s<span class="number">-8007</span>B/s), io=<span class="number">80.0</span>KiB (<span class="number">81.9</span>kB), run=<span class="number">10231</span><span class="number">-10231</span>msec</span><br><span class="line"></span><br><span class="line">Disk stats (read/write):</span><br><span class="line">    dm<span class="number">-0</span>: ios=<span class="number">20</span>/<span class="number">0</span>, merge=<span class="number">0</span>/<span class="number">0</span>, ticks=<span class="number">9720</span>/<span class="number">0</span>, in_queue=<span class="number">10140</span>, util=<span class="number">99.14</span>%, aggrios=<span class="number">0</span>/<span class="number">0</span>, aggrmerge=<span class="number">0</span>/<span class="number">0</span>, aggrticks=<span class="number">0</span>/<span class="number">0</span>, aggrin_queue=<span class="number">0</span>, aggrutil=<span class="number">0.00</span>%</span><br><span class="line">  ram0: ios=<span class="number">0</span>/<span class="number">0</span>, merge=<span class="number">0</span>/<span class="number">0</span>, ticks=<span class="number">0</span>/<span class="number">0</span>, in_queue=<span class="number">0</span>, util=<span class="number">0.00</span>%</span><br><span class="line"></span><br><span class="line"># Create a block device that delays reads <span class="keyword">for</span> <span class="number">500</span> ms <span class="keyword">and</span> writes <span class="keyword">for</span> <span class="number">300</span> ms</span><br><span class="line">size=$(blockdev --getsize /dev/ram0) # Size <span class="keyword">in</span> <span class="number">512</span>-bytes sectors</span><br><span class="line">$ echo <span class="string">&quot;0 $(blockdev --getsize /dev/ram0) delay /dev/ram0 0 500 /dev/ram0 0 300&quot;</span> | dmsetup create delayed</span><br><span class="line"></span><br><span class="line">$ dmsetup remove /dev/mapper/delayed</span><br></pre></td></tr></table></figure>
<h4 id="dm-linear"><a href="#dm-linear" class="headerlink" title="dm-linear"></a>dm-linear</h4><p>The dm-linear target maps a linear range of blocks of the device-mapper device onto a linear range of a backend device. dm-linear is the basic building block of logical volume managers such as LVM.</p>
<h4 id="dm-flakey"><a href="#dm-flakey" class="headerlink" title="dm-flakey"></a>dm-flakey</h4><p>This target is the same as the linear target except that it exhibits unreliable behaviour periodically.  It’s been found useful in simulating failing devices for testing purposes.</p>
<ul>
<li>drop_writes All write I/Os are silently ignored and dropped. Read I/Os are handled correctly.</li>
<li>error_writes All write I/Os are failed with an error signaled. Read I/Os are handled correctly.</li>
<li>corrupt_bio_byte During the down time, replace the Nth byte of the data of each read or write block I/O with a specified value.<br>The default error mode is to fail all I/O requests during the down time of the simulation cycle.</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">tabled parameters:</span><br><span class="line">&lt;dev path&gt; &lt;offset&gt; &lt;up interval&gt; &lt;down interval&gt;  [&lt;num_features&gt; [&lt;feature arguments&gt;]]</span><br><span class="line">$ dmsetup create test --table <span class="string">&#x27;0 123 flakey /dev/sda1 0 4 8&#x27;</span></span><br><span class="line">$  file /dev/mapper/dm_test0 </span><br><span class="line">/dev/mapper/dm_test0: symbolic link <span class="keyword">to</span> <span class="built_in">..</span>/dm-0</span><br><span class="line"></span><br><span class="line">[random]</span><br><span class="line"><span class="attribute">filename</span>=/dev/dm-0</span><br><span class="line"><span class="comment">#readwrite=randrw</span></span><br><span class="line"><span class="attribute">readwrite</span>=randread</span><br><span class="line"><span class="attribute">blocksize</span>=4k</span><br><span class="line"><span class="attribute">ioengine</span>=sync</span><br><span class="line"><span class="attribute">time_based</span>=1</span><br><span class="line"><span class="attribute">runtime</span>=130</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fio-3.1</span><br><span class="line">Starting 1 process</span><br><span class="line">fio: io_u <span class="builtin-name">error</span> on file /dev/dm-0: Input/output error: read <span class="attribute">offset</span>=0, <span class="attribute">buflen</span>=4096</span><br><span class="line">random: <span class="literal">No</span> I/O performed by sync, perhaps try <span class="attribute">--debug</span>=io option <span class="keyword">for</span> details?</span><br><span class="line">fio: <span class="attribute">pid</span>=16261, <span class="attribute">err</span>=5/file:io_u.c:1756, <span class="attribute">func</span>=io_u error, <span class="attribute">error</span>=Input/output error</span><br><span class="line"></span><br><span class="line">random: (<span class="attribute">groupid</span>=0, <span class="attribute">jobs</span>=1): err= 5 (file:io_u.c:1756, <span class="attribute">func</span>=io_u error, <span class="attribute">error</span>=Input/output error): <span class="attribute">pid</span>=16261: Fri Jun  5 00:29:08 2020</span><br><span class="line">  cpu          : <span class="attribute">usr</span>=0.00%, <span class="attribute">sys</span>=0.00%, <span class="attribute">ctx</span>=0, <span class="attribute">majf</span>=0, <span class="attribute">minf</span>=17</span><br><span class="line">  IO depths    : <span class="attribute">1</span>=100.0%, <span class="attribute">2</span>=0.0%, <span class="attribute">4</span>=0.0%, <span class="attribute">8</span>=0.0%, <span class="attribute">16</span>=0.0%, <span class="attribute">32</span>=0.0%, &gt;=<span class="attribute">64</span>=0.0%</span><br><span class="line">     submit    : <span class="attribute">0</span>=0.0%, <span class="attribute">4</span>=100.0%, <span class="attribute">8</span>=0.0%, <span class="attribute">16</span>=0.0%, <span class="attribute">32</span>=0.0%, <span class="attribute">64</span>=0.0%, &gt;=<span class="attribute">64</span>=0.0%</span><br><span class="line">     complete  : <span class="attribute">0</span>=50.0%, <span class="attribute">4</span>=50.0%, <span class="attribute">8</span>=0.0%, <span class="attribute">16</span>=0.0%, <span class="attribute">32</span>=0.0%, <span class="attribute">64</span>=0.0%, &gt;=<span class="attribute">64</span>=0.0%</span><br><span class="line">     issued rwt: <span class="attribute">total</span>=1,0,0, <span class="attribute">short</span>=0,0,0, <span class="attribute">dropped</span>=0,0,0</span><br><span class="line">     latency   : <span class="attribute">target</span>=0, <span class="attribute">window</span>=0, <span class="attribute">percentile</span>=100.00%, <span class="attribute">depth</span>=1</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">Run</span> status<span class="built_in"> group </span>0 (all jobs):</span><br><span class="line"></span><br><span class="line">Disk stats (read/write):</span><br><span class="line">    dm-0: <span class="attribute">ios</span>=0/0, <span class="attribute">merge</span>=0/0, <span class="attribute">ticks</span>=0/0, <span class="attribute">in_queue</span>=0, <span class="attribute">util</span>=0.00%, <span class="attribute">aggrios</span>=0/0, <span class="attribute">aggrmerge</span>=0/0, <span class="attribute">aggrticks</span>=0/0, <span class="attribute">aggrin_queue</span>=0, <span class="attribute">aggrutil</span>=0.00%</span><br><span class="line">  sda: <span class="attribute">ios</span>=0/0, <span class="attribute">merge</span>=0/0, <span class="attribute">ticks</span>=0/0, <span class="attribute">in_queue</span>=0, <span class="attribute">util</span>=0.00%</span><br><span class="line"></span><br><span class="line">[18800.528564] buffer_io_error: 110 callbacks suppressed</span><br><span class="line">[18800.528569] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 0, async<span class="built_in"> page </span>read</span><br><span class="line">[18800.528582] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 1, async<span class="built_in"> page </span>read</span><br><span class="line">[18800.528587] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 2, async<span class="built_in"> page </span>read</span><br><span class="line">[18800.528591] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 3, async<span class="built_in"> page </span>read</span><br><span class="line">[18800.528596] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 4, async<span class="built_in"> page </span>read</span><br><span class="line">[18800.528600] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 5, async<span class="built_in"> page </span>read</span><br><span class="line">[18800.528604] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 6, async<span class="built_in"> page </span>read</span><br><span class="line">[18800.528608] Buffer I/O <span class="builtin-name">error</span> on dev dm-0, logical block 7, async<span class="built_in"> page </span>read</span><br></pre></td></tr></table></figure>
<p>$ dmsetup suspend /dev/dm-0<br>$ dmsetup resume /dev/dm-0</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dm-linear</span><br><span class="line">dm-zoned</span><br><span class="line">(dm-dust)[https:<span class="regexp">//</span>www.kernel.org<span class="regexp">/doc/</span>Documentation<span class="regexp">/device-mapper/</span>dm-dust.txt]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### fio</span></span><br><span class="line"><span class="comment">#### multi-nodes test</span></span><br></pre></td></tr></table></figure>
<p>cat test_hosts<br>test-0<br>test-1<br>test-2<br>test-3<br>…<br>test-n</p>
<p>##start fio server in test-0 until test-n<br>test-0 $ fio –server –daemon=/tmp/fio.pid<br>test-1 $ fio –server –daemon=/tmp/fio.pid<br>….<br>test-n $ fio –server –daemon=/tmp/fio.pid</p>
<p>$ fio –client=test_hosts /config/fio_read_1.cfg</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### [the fio demo](https://github.com/axboe/fio/issues/1110)</span><br></pre></td></tr></table></figure>
<p>slat (usec): min=4, max=6154, avg=48.82, stdev=56.38：    </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">- slat</span><br><span class="line">  - Submission latency (min being the minimum, max being the maximum, avg being the average, stdev being the standard deviation). This is the time it took <span class="keyword">to</span> submit the I/O. </span><br><span class="line">    - <span class="keyword">For</span> sync I/O this row is <span class="keyword">not</span> displayed as the slat is really the completion latency (since queue/complete is one operation there). </span><br><span class="line">    - This value can be <span class="keyword">in</span> nanoseconds, microseconds <span class="keyword">or</span> milliseconds — fio will choose the most appropriate base <span class="keyword">and</span> <span class="builtin-name">print</span> that (<span class="keyword">in</span> the example above nanoseconds was the best scale). </span><br><span class="line">    - Note: <span class="keyword">in</span> --minimal mode latencies are always expressed <span class="keyword">in</span> microseconds.</span><br><span class="line">- clat</span><br><span class="line">  - Completion latency (after submission <span class="keyword">to</span> completion). Same names as slat, this denotes the time <span class="keyword">from</span> submission <span class="keyword">to</span> completion of the I/O pieces. <span class="keyword">For</span> sync I/O, clat will usually be equal (<span class="keyword">or</span> very close) <span class="keyword">to</span> 0, as the time <span class="keyword">from</span> submit <span class="keyword">to</span> complete is basically just CPU time (I/O has already been done, see slat explanation).</span><br><span class="line">  - <span class="keyword">For</span> sync I/O, clat will usually be equal (<span class="keyword">or</span> very close) <span class="keyword">to</span> 0, as the time <span class="keyword">from</span> submit <span class="keyword">to</span> complete is basically just CPU time (I/O has already been done, see slat explanation).</span><br><span class="line">- lat</span><br><span class="line">  - Total latency. Same names as slat <span class="keyword">and</span> clat, this denotes the time <span class="keyword">from</span> when fio created the I/O unit <span class="keyword">to</span> completion of the I/O operation.</span><br><span class="line">```bash</span><br><span class="line">[global]</span><br><span class="line"><span class="attribute">directory</span>=./</span><br><span class="line"><span class="attribute">iodepth</span>=8</span><br><span class="line"><span class="attribute">rwmixread</span>=50</span><br><span class="line"><span class="attribute">numjobs</span>=32</span><br><span class="line"><span class="attribute">size</span>=100M</span><br><span class="line"><span class="attribute">norandommap</span>=1</span><br><span class="line">group_reporting</span><br><span class="line">refill_buffers</span><br><span class="line"><span class="attribute">end_fsync</span>=1</span><br><span class="line"><span class="attribute">disable_slat</span>=1</span><br><span class="line">exitall</span><br><span class="line"><span class="attribute">timeout</span>=36000</span><br><span class="line"><span class="attribute">direct</span>=0</span><br><span class="line"><span class="attribute">nrfiles</span>=8</span><br><span class="line"><span class="attribute">bssplit</span>=4k/10:32k/20:64k/20:128k/20:256k/20:1024k/10</span><br><span class="line">[job1]</span><br><span class="line"><span class="attribute">rw</span>=write</span><br><span class="line"><span class="attribute">ioengine</span>=libaio</span><br><span class="line">[job2]</span><br><span class="line"><span class="attribute">rw</span>=read</span><br><span class="line"><span class="attribute">ioengine</span>=libaio</span><br><span class="line">[job3]</span><br><span class="line"><span class="attribute">rw</span>=randread</span><br><span class="line"><span class="attribute">ioengine</span>=libaio</span><br><span class="line">[job4]</span><br><span class="line"><span class="attribute">rw</span>=randwrite</span><br><span class="line"><span class="attribute">ioengine</span>=libaio</span><br><span class="line">[job5]</span><br><span class="line"><span class="attribute">rw</span>=randrw</span><br><span class="line"><span class="attribute">ioengine</span>=libaio</span><br><span class="line">[job6]</span><br><span class="line"><span class="attribute">rw</span>=write</span><br><span class="line"><span class="attribute">ioengine</span>=posixaio</span><br><span class="line">[job7]</span><br><span class="line"><span class="attribute">rw</span>=read</span><br><span class="line"><span class="attribute">ioengine</span>=posixaio</span><br><span class="line">[job8]</span><br><span class="line"><span class="attribute">rw</span>=randread</span><br><span class="line"><span class="attribute">ioengine</span>=posixaio</span><br><span class="line">[job9]</span><br><span class="line"><span class="attribute">rw</span>=randwrite</span><br><span class="line"><span class="attribute">ioengine</span>=posixaio</span><br><span class="line">[job10]</span><br><span class="line"><span class="attribute">rw</span>=randrw</span><br><span class="line"><span class="attribute">ioengine</span>=posixaio</span><br><span class="line">[job11]</span><br><span class="line"><span class="attribute">rw</span>=write</span><br><span class="line"><span class="attribute">ioengine</span>=sync</span><br><span class="line">[job12]</span><br><span class="line"><span class="attribute">rw</span>=read</span><br><span class="line"><span class="attribute">ioengine</span>=sync</span><br><span class="line">[job13]</span><br><span class="line"><span class="attribute">rw</span>=randread</span><br><span class="line"><span class="attribute">ioengine</span>=sync</span><br><span class="line">[job14]</span><br><span class="line"><span class="attribute">rw</span>=randwrite</span><br><span class="line"><span class="attribute">ioengine</span>=sync</span><br><span class="line">[job15]</span><br><span class="line"><span class="attribute">rw</span>=randrw</span><br><span class="line"><span class="attribute">ioengine</span>=sync</span><br><span class="line">[job16]</span><br><span class="line"><span class="attribute">rw</span>=write</span><br><span class="line"><span class="attribute">ioengine</span>=psync</span><br><span class="line">[job17]</span><br><span class="line"><span class="attribute">rw</span>=read</span><br><span class="line"><span class="attribute">ioengine</span>=psync</span><br><span class="line">[job18]</span><br><span class="line"><span class="attribute">rw</span>=randread</span><br><span class="line"><span class="attribute">ioengine</span>=psync</span><br><span class="line">[job19]</span><br><span class="line"><span class="attribute">rw</span>=randwrite</span><br><span class="line"><span class="attribute">ioengine</span>=psync</span><br><span class="line">[job20]</span><br><span class="line"><span class="attribute">rw</span>=randrw</span><br><span class="line"><span class="attribute">ioengine</span>=psync</span><br><span class="line">[job21]</span><br><span class="line"><span class="attribute">rw</span>=write</span><br><span class="line"><span class="attribute">ioengine</span>=vsync</span><br><span class="line">[job22]</span><br><span class="line"><span class="attribute">rw</span>=read</span><br><span class="line"><span class="attribute">ioengine</span>=vsync</span><br><span class="line">[job23]</span><br><span class="line"><span class="attribute">rw</span>=randread</span><br><span class="line"><span class="attribute">ioengine</span>=vsync</span><br><span class="line">[job24]</span><br><span class="line"><span class="attribute">rw</span>=randwrite</span><br><span class="line"><span class="attribute">ioengine</span>=vsync</span><br><span class="line">[job25]</span><br><span class="line"><span class="attribute">rw</span>=randrw</span><br><span class="line"><span class="attribute">ioengine</span>=vsync</span><br></pre></td></tr></table></figure>

<h4 id="fio-randseed"><a href="#fio-randseed" class="headerlink" title="fio randseed"></a>fio randseed</h4><p>randseed=int<br>Seed the random number generators based on this seed value, to be able to control what sequence of output is being generated. If not set, the random sequence depends on the randrepeat setting.</p>
<p>If you don ‘t want rand read/write the same location, please add this parameter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ fio -rw=randread -ioengine=libaio -name=rw -numjobs=1 -runtime=10 -filename=/dev/sda1 --debug=random | head</span><br><span class="line">fio: <span class="built_in">set</span> debug option random</span><br><span class="line">rw: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">random   37670 off rand 259043585</span><br><span class="line">random   37670 off rand 3179521932</span><br><span class="line">random   37670 off rand 3621444214</span><br><span class="line">random   37670 off rand 2018697059</span><br><span class="line">random   37670 off rand 1726199243</span><br><span class="line">random   37670 off rand 3608323581</span><br><span class="line">fio: pid=37670, got signal=13</span><br><span class="line"></span><br><span class="line">$ fio -rw=randread -ioengine=libaio -name=rw -numjobs=1 -runtime=10 -filename=/dev/sda1 --debug=random | head</span><br><span class="line">fio: <span class="built_in">set</span> debug option random</span><br><span class="line">rw: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">random   37700 off rand 259043585</span><br><span class="line">random   37700 off rand 3179521932</span><br><span class="line">random   37700 off rand 3621444214</span><br><span class="line">random   37700 off rand 2018697059</span><br><span class="line">random   37700 off rand 1726199243</span><br><span class="line">random   37700 off rand 3608323581</span><br><span class="line">fio: pid=37700, got signal=13</span><br><span class="line"></span><br><span class="line"><span class="comment">## Add random randseed</span></span><br><span class="line">$ fio -rw=randread -ioengine=libaio -name=rw -numjobs=1 -runtime=10 -filename=/dev/sda1 --debug=random --randseed=1111 | head</span><br><span class="line">fio: <span class="built_in">set</span> debug option random</span><br><span class="line">rw: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">random   37735 off rand 467479607</span><br><span class="line">random   37735 off rand 3308212373</span><br><span class="line">random   37735 off rand 3651680361</span><br><span class="line">random   37735 off rand 4287149593</span><br><span class="line">random   37735 off rand 348379764</span><br><span class="line">random   37735 off rand 1909948585</span><br><span class="line">fio: pid=37735, got signal=13</span><br></pre></td></tr></table></figure>

<h4 id="fio-can-verify-the-file-contents-after-each-iteration-of-the-job"><a href="#fio-can-verify-the-file-contents-after-each-iteration-of-the-job" class="headerlink" title="fio can verify the file contents after each iteration of the job"></a>fio can verify the file contents after each iteration of the job</h4><p>–verify=crc64<br>–do_verify=1 (enable verify, default enabled)<br>–verify_pattern=’xxxxxx’<br>–verify=meta(This  option  is deprecated)    </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">verify</span>=str</span><br><span class="line">       <span class="keyword">If</span> writing <span class="keyword">to</span> a file, fio can verify the file contents after each iteration of the job. Each verification method also implies</span><br><span class="line">       verification  of special header, which is written <span class="keyword">to</span> the beginning of each block. This header also includes meta information,</span><br><span class="line">       like offset of the block, block number, timestamp when block was written, etc. verify can  be  combined  with  verify_pattern</span><br><span class="line">       option. The allowed values are:</span><br><span class="line">              crc64  Use an experimental crc64 sum of the data<span class="built_in"> area </span><span class="keyword">and</span> store it <span class="keyword">in</span> the header of each block.</span><br><span class="line">              crc32c Use  a  crc32c sum of the data<span class="built_in"> area </span><span class="keyword">and</span> store it <span class="keyword">in</span> the header of each block. This will automatically use hard‐</span><br><span class="line">                     ware acceleration (e.g. SSE4.2 on an x86 <span class="keyword">or</span> CRC crypto extensions on ARM64) but  will  fall  back  <span class="keyword">to</span>  software</span><br><span class="line">                     crc32c <span class="keyword">if</span> none is found. Generally the fastest checksum fio supports when<span class="built_in"> hardware </span>accelerated.</span><br><span class="line">              crc32c-intel</span><br><span class="line">                     Synonym <span class="keyword">for</span> crc32c.</span><br><span class="line">              crc32  Use a crc32 sum of the data<span class="built_in"> area </span><span class="keyword">and</span> store it <span class="keyword">in</span> the header of each block.</span><br></pre></td></tr></table></figure>

<h4 id="fio-metadata"><a href="#fio-metadata" class="headerlink" title="fio metadata"></a>fio metadata</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--ioengine=posixaio --openfiles=10000 --numjobs=<span class="variable">$DP_NUM</span> --filesize=64k --lockfile=readwrite</span><br></pre></td></tr></table></figure>

<h4 id="io-uring"><a href="#io-uring" class="headerlink" title="io_uring"></a>io_uring</h4><p><a target="_blank" rel="noopener" href="https://github.com/Linkerist/blog/issues/25">以上是AIO的不足之一，分析AIO缘何不足，需要较大的篇幅，这里按下不表直接总结结论。</a></p>
<p>这类接口，尽管形式多种多样，但它们都有一个共同的特征，就是同步，即在读写IO时，系统调用会阻塞住等待，在数据读取或写入后才返回结果。<br>同步导致的后果就是caller 在阻塞的同时无法继续执行其他的操作，只能等待IO结果返回，其实caller本可以利用这段时间继续往后执行。</p>
<p>仅支持direct IO。在采用AIO的时候，只能使用O_DIRECT，不能借助文件系统缓存来缓存当前的IO请求，还存在size对齐（直接操作磁盘，所有写入内存块数量必须是文件系统块大小的倍数，而且要与内存页大小对齐。）等限制，直接影响了aio在很多场景的使用。<br>仍然可能被阻塞。语义不完备。即使应用层主观上，希望系统层采用异步IO，但是客观上，有时候还是可能会被阻塞。io_getevents(2)调用read_events读取AIO的完成events，read_events中的wait_event_interruptible_hrtimeout等待aio_read_events，如果条件不成立（events未完成）则调用__wait_event_hrtimeout进入睡眠（当然，支持用户态设置最大等待时间）。<br>拷贝开销大。每个IO提交需要拷贝64+8字节，每个IO完成需要拷贝32字节，总共104字节的拷贝。这个拷贝开销是否可以承受，和单次IO大小有关：如果需要发送的IO本身就很大，相较之下，这点消耗可以忽略，而在大量小IO的场景下，这样的拷贝影响比较大。<br>API不友好。每一个IO至少需要两次系统调用才能完成（submit和wait-for-completion)，需要非常小心地使用完成事件以避免丢事件。<br>系统调用开销大。也正是因为上一条，io_submit/io_getevents造成了较大的系统调用开销，在存在spectre/meltdown（CPU熔断幽灵漏洞，CVE-2017-5754）的机器上，若如果要避免漏洞问题，系统调用性能则会大幅下降。在存储场景下，高频系统调用的性能影响较大。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 1 &gt; /proc/sys/vm/block_dump</span><br><span class="line">$ fio --name=randread --rw=randread --bs=4K --ioengine=io_uring --sqthread_poll=1 --size=1000G --numjobs=1 --filename=/dev/disk/by-id/ata-ST31000340NS_9QJ1CAAA-part1 --direct=1 --group_reporting</span><br><span class="line"></span><br><span class="line">fio(2039789): READ block 21187832 on sdb1 (8 sectors)</span><br><span class="line">fio(2039789): READ block 27664240 on sdb1 (8 sectors)</span><br><span class="line">fio(2039789): READ block 20709568 on sdb1 (8 sectors)</span><br><span class="line">fio(2039789): READ block 17529624 on sdb1 (8 sectors)</span><br><span class="line">fio(2039789): READ block 27647664 on sdb1 (8 sectors)</span><br></pre></td></tr></table></figure>

<h3 id="redis-benchmark"><a href="#redis-benchmark" class="headerlink" title="redis benchmark"></a>redis benchmark</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download http://rpms.remirepo.net/enterprise/7/remi/x86_64/redis-6.2.0-1.el7.remi.x86_64.rpm</span></span><br><span class="line"><span class="comment"># not save to disk</span></span><br><span class="line"><span class="comment"># /etc/redis.conf</span></span><br><span class="line">port 6111</span><br><span class="line">save <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#logfile /var/log/redis/redis.log</span></span><br><span class="line"><span class="comment">#pidfile /var/run/redis_6379.pid</span></span><br><span class="line"></span><br><span class="line">$ redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 91G mem, 3 x cores, 2xcores redis-benchmark, 1xcores redis server</span></span><br><span class="line">$ redis-benchmark -r 1000000000 --threads 2 -n 30000000 -t <span class="built_in">set</span>,get,incr -d 1 -p 6666</span><br><span class="line"></span><br><span class="line"><span class="comment"># 40G mem, memory compression ?</span></span><br><span class="line">$ redis-benchmark -r 1000000000 --threads 2 -n 30000000 -t <span class="built_in">set</span>,get,incr -d 1024 -p 6001</span><br><span class="line"></span><br><span class="line"><span class="comment"># -r &lt;keyspacelen&gt;   Use random keys for SET/GET/INCR, random values for SADD Using this option the benchmark will expand the string __rand_int__inside an argument with a 12 digits number in the specified range from 0 to keyspacelen-1. The substitution changes every time a command is executed. Default tests use this to hit random keys in the specified range.</span></span><br><span class="line">$ cat demo</span><br><span class="line">protected-mode yes</span><br><span class="line">tcp-backlog 511</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 300</span><br><span class="line">daemonize no</span><br><span class="line">loglevel notice</span><br><span class="line">databases 16</span><br><span class="line">always-show-logo no</span><br><span class="line">set-proc-title yes</span><br><span class="line">proc-title-template <span class="string">&quot;&#123;title&#125; &#123;listen-addr&#125; &#123;server-mode&#125;&quot;</span></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">rdb-del-sync-files no</span><br><span class="line">dir /var/lib/redis</span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line">replica-read-only yes</span><br><span class="line">repl-diskless-sync no</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line">repl-diskless-load disabled</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">replica-priority 100</span><br><span class="line">acllog-max-len 128</span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line">lazyfree-lazy-user-del no</span><br><span class="line">lazyfree-lazy-user-flush no</span><br><span class="line">oom-score-adj no</span><br><span class="line">oom-score-adj-values 0 200 800</span><br><span class="line">disable-thp yes</span><br><span class="line">appendonly no</span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">aof-load-truncated yes</span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line">lua-time-limit 5000</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line">notify-keyspace-events <span class="string">&quot;&quot;</span></span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line">activerehashing yes</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit replica 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line">hz 10</span><br><span class="line">save <span class="string">&quot;&quot;</span></span><br><span class="line">dynamic-hz yes</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line">rdb-save-incremental-fsync yes</span><br><span class="line">jemalloc-bg-thread yes</span><br><span class="line"></span><br><span class="line"><span class="comment">### start redis-server</span></span><br><span class="line">pkill redis-server</span><br><span class="line">i=6001</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="comment">#echo numactl -C $line redis-server demo --port $i</span></span><br><span class="line">  numactl -C <span class="variable">$line</span> redis-server demo --port <span class="variable">$i</span> &amp;</span><br><span class="line">  ((i++))</span><br><span class="line"><span class="keyword">done</span> &lt; server_cpu</span><br><span class="line"></span><br><span class="line"><span class="comment">#### run redis-benchmark</span></span><br><span class="line">[[ ! -d /tmp/reids ]] &amp;&amp; mkdir /tmp/redis</span><br><span class="line">i=6001</span><br><span class="line">total=30000000000</span><br><span class="line">incr_num=20</span><br><span class="line">dsize=2</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="comment">#echo numactl -C $line redis-benchmark -r 1000000000 --threads 2 -n $((total/dsize)) -t set,get,incr -d $dsize -p $i</span></span><br><span class="line">  (numactl -C <span class="variable">$line</span> redis-benchmark -r 1000000000 --threads 2 -n 100000000 -t <span class="built_in">set</span>,get,incr -d <span class="variable">$dsize</span> -p <span class="variable">$i</span> &gt; /tmp/redis/redis_<span class="variable">$i</span> 2&gt;&amp;1) &amp;</span><br><span class="line">  ((i++))</span><br><span class="line">  ((dsize=dsize+incr_num))</span><br><span class="line"><span class="keyword">done</span> &lt; client_cpu</span><br></pre></td></tr></table></figure>

<h3 id="linpack-xtreme-1-1-5-amd64-in-linux"><a href="#linpack-xtreme-1-1-5-amd64-in-linux" class="headerlink" title="linpack-xtreme-1.1.5-amd64 in linux"></a><a target="_blank" rel="noopener" href="https://www.ngohq.com/linpack-xtreme.html">linpack-xtreme-1.1.5-amd64 in linux</a></h3><p>Auto calculte the problem size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ mem_var=$(awk <span class="string">&#x27;/MemAvailable/ &#123;printf &quot;%d\n&quot;, $2/1024/1024&#125;&#x27;</span> /proc/meminfo)</span><br><span class="line">$ cpu_cores=$(grep MHz /proc/cpuinfo  -c)</span><br><span class="line">$ test_size=$(awk -v cpu_cores=<span class="variable">$cpu_cores</span> -v mem_var=<span class="variable">$mem_var</span> <span class="string">&#x27;BEGIN&#123;print sqrt(((mem_var-0.067*cpu_cores)/18)*2)*35000&#125;&#x27;</span>)</span><br><span class="line">                                                                                             |              |       |</span><br><span class="line">                                                      one thread will take 0.067GB memory-----              |       |</span><br><span class="line">                                                                 problem size-------------------------------|--------</span><br><span class="line">                                                                                                            |</span><br><span class="line">                                                                                                            |</span><br><span class="line">                                                                                                            |</span><br><span class="line">take away the threads mem size, 35000 problem size will take 18Gx1 memory, 7000 problem will take 18G*2------</span><br><span class="line">105000 will take 18G*4, 140000 = 18G*8</span><br><span class="line"></span><br><span class="line">$ cat default</span><br><span class="line">Linpack data file</span><br><span class="line">Linpack Xtreme v1.1.5 by Regeneration</span><br><span class="line">1</span><br><span class="line"><span class="variable">$test_size</span> <span class="comment"># problem size</span></span><br><span class="line"><span class="variable">$test_size</span> <span class="comment"># leading dimensions</span></span><br><span class="line">1 <span class="comment"># number of times to run LINPACK</span></span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<p>AMD EPYC2(2x 7742, 16 x 32G DDR 3200MHz) proportion to the performance not across the extra NUMA, and internal NUMA has the impact too<br>If the benchmark malloc 90% memory or more, the EPYC2 will from 2000GFLOPS down to 1000+GFLOPS, only half performance<br>It ‘s not used be in the random Memory-intensive tasks, maybe single socket is the better choice<br>In the same case(90%+ mem), the EPYC2 has the long latency than intel system   </p>
<h3 id="RAW-HDD-test"><a href="#RAW-HDD-test" class="headerlink" title="RAW HDD test"></a>RAW HDD test</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">rw=randrw</span><br><span class="line">ioengine=sync</span><br><span class="line">numjobs=16</span><br><span class="line">bssplit=4K/100</span><br><span class="line">group_reporting</span><br><span class="line">[sda]</span><br><span class="line">filename=/dev/sda1</span><br><span class="line">[sdd]</span><br><span class="line">filename=/dev/sdb1</span><br><span class="line">....</span><br><span class="line">    AVG                     r/s     w/s     r_wait  w_wait  await</span><br><span class="line">NLSAS HUH721010AL5200  LS14 168.115 169.279 114.973 213.678 196.862</span><br><span class="line">NLSAS ST10000NM0256    TT56 128.233 128.964 290.436 852.015 425.779</span><br><span class="line">ATA   TOSHIBA MG04ACA4 FK3D 134.124 134.696 308.223 198.647 219.238</span><br><span class="line">ATA   HGST HUH721010AL LT14 155.018 155.74  157.973 781.01  219.257</span><br><span class="line">NLSAS WUH721818AL4204  C240 202.284 203.696 81.3992 405.879 268.257</span><br><span class="line">NLSAS WUH721818AL4204  C240 203.899 205.263 80.6991 379.694 255.109</span><br></pre></td></tr></table></figure>
<p>if numjobs large than 1, it could not use to test seq throughput for this device, but it could test the connection bandwidth.  </p>
<h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><h4 id="pkggen-kernel-mode"><a href="#pkggen-kernel-mode" class="headerlink" title="pkggen kernel mode"></a>pkggen kernel mode</h4><p>No more diff between 1GbE with 10GbE (BCM57800)<br><a target="_blank" rel="noopener" href="https://lwn.net/Articles/629155/">The problem, Jesper said, is that the kernel developers have focused on scaling out to large numbers of cores. In the process, they have been able to hide regressions in per-core efficiency. The networking stack, as a result, works well for many workloads, but workloads that are especially latency-sensitive have suffered. The kernel, today, can only forward something between 1M and 2M packets per core every second, while some of the bypass alternatives approach a rate of 15M packets per core per second. Then there is the cost of performing a system call. On a system with SELinux and auditing enabled, that cost is just over 75ns — over the time budget on its own. Disabling auditing and SELinux reduces the time required to just under 42ns, which is better, but that is still a big part of the time budget. There are ways of amortizing that cost over multiple packets; they include system calls like sendmmsg(), recvmmsg(), sendfile(), and splice().</a><br>10GbE Full-duplex, about 2M    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Result: OK: 958748771(c958745900+d2871) usec, 2000000000 (42byte,0frags)</span><br><span class="line">  2086052pps 700Mb/sec (700913472bps) errors: 0</span><br><span class="line"></span><br><span class="line">Result: OK: 939714052(c939699215+d14836) usec, 2000000000 (42byte,0frags)</span><br><span class="line">  2128307pps 715Mb/sec (715111152bps) errors: 0</span><br><span class="line"></span><br><span class="line">pgset <span class="string">&quot;count 2000000000&quot;</span></span><br><span class="line">pgset <span class="string">&quot;delay 0&quot;</span></span><br><span class="line">pgset <span class="string">&quot;clone_skb 0&quot;</span></span><br><span class="line">pgset <span class="string">&quot;pkt_size 8&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pgset <span class="string">&quot;count 2000000000&quot;</span></span><br><span class="line">pgset <span class="string">&quot;delay 0&quot;</span></span><br><span class="line">pgset <span class="string">&quot;clone_skb 0&quot;</span></span><br><span class="line">pgset <span class="string">&quot;pkt_size 8&quot;</span></span><br><span class="line"></span><br><span class="line">Result: OK: 184502252(c184496912+d5340) usec, 274564113 (42byte,0frags)</span><br><span class="line">  1488134pps 500Mb/sec (500013024bps) errors: 0</span><br><span class="line"></span><br><span class="line">Result: OK: 183209415(c183209277+d138) usec, 272639542 (42byte,0frags)</span><br><span class="line">  1488130pps 500Mb/sec (500011680bps) errors: 0</span><br></pre></td></tr></table></figure>

<h4 id="nc-test"><a href="#nc-test" class="headerlink" title="nc test"></a>nc test</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Server $ nc -l 22222 &lt; /dev/zero</span><br><span class="line">Client $ nc <span class="variable">$serverip</span> 22222 &gt; /dev/null</span><br></pre></td></tr></table></figure>

<h4 id="iperf3"><a href="#iperf3" class="headerlink" title="iperf3"></a>iperf3</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Server $ iperf3 -s -D -p 520<span class="variable">$i</span></span><br><span class="line">Client $ iperf3 -c <span class="variable">$client_ip</span> -P 1 -t 360000 -p 520<span class="variable">$i</span></span><br></pre></td></tr></table></figure>

<h4 id="qperf"><a href="#qperf" class="headerlink" title="qperf"></a>qperf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Server $ qperf -lp <span class="variable">$port</span> &amp;</span><br><span class="line">Client $ qperf -lp <span class="variable">$port</span> -t 36000 -oo msg_size:1K:4K:*2 <span class="variable">$server_ip</span> tcp_bw</span><br><span class="line"><span class="comment">#or</span></span><br><span class="line">Client $ qperf -lp <span class="variable">$port</span> -t 60 -oo msg_size:64:1024K:*4 <span class="variable">$server_ip</span> tcp_lat</span><br></pre></td></tr></table></figure>

<h4 id="netperf"><a href="#netperf" class="headerlink" title="netperf"></a>netperf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Server $ taskset -c 5 netserver &amp;</span><br><span class="line">Client $ netperf -H <span class="variable">$ipaddr</span> -l 200 -t TCP_STREAM</span><br><span class="line"></span><br><span class="line">Server $ numactl -C 2 netserver -D  -4 -v 2 -p 5000 -f -L 192.168.12.201</span><br><span class="line">Client $ numactl -N 0 ./netperf -n 6 -p 5000 -H 192.168.12.201 -c -C -t TCP_STREAM -l 15 -T 2,2 -- -m $((<span class="number">2</span>**<span class="variable">$i</span>))</span><br><span class="line">Client $ numactl -N 0 ./netperf -n 6 -p 5000 -H 192.168.12.201 -c -C -t TCP_RR -l 20 -T 2,2 -- -m $((<span class="number">2</span>**<span class="variable">$i</span>))</span><br><span class="line">Client $ numactl -N 0 ./netperf -n 6 -p 5000 -H 192.168.12.201 -c -C -t UDP_RR -l 20 -T 2,2 -- -m $((<span class="number">2</span>**<span class="variable">$i</span>))</span><br></pre></td></tr></table></figure>

<h4 id="sockperf"><a href="#sockperf" class="headerlink" title="sockperf"></a>sockperf</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./sockperf<span class="built_in"> server </span>--tcp -p 11111</span><br><span class="line">./sockperf<span class="built_in"> server </span>-p 11111 #udp</span><br><span class="line">numactl -C 2 /opt/sockperf/bin/sockperf tp -m 256  -i 192.168.12.201 -p 11111 -t 20</span><br><span class="line">numactl -C 2 /opt/sockperf/bin/sockperf pp -m 256  -i 192.168.12.201 -p 11111 -t 20</span><br></pre></td></tr></table></figure>

<h4 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Server $ LD_PRELOAD=libvma.so VMA_STATS_FD_NUM=500 redis-server --port 7777  --protected-mode no --maxmemory 12000mb --maxmemory-samples 10 --maxmemory-policy allkeys-lru</span><br><span class="line">Client $ numactl -C 2 redis-benchmark -r 10000000 -n 20000000 -t get,<span class="built_in">set</span>,lpush,lpop -P 16 -q -h 192.168.12.201 -p 7777 -d 16</span><br></pre></td></tr></table></figure>

<h4 id="RFC6349-TCP-benchmark"><a href="#RFC6349-TCP-benchmark" class="headerlink" title="RFC6349 TCP benchmark"></a><a target="_blank" rel="noopener" href="https://www.viavisolutions.com/zh-cn/literature/rfc-6349-testing-truespeed-viavi-solutions-experience-your-network-your-custom-application-notes-zh.pdf">RFC6349 TCP benchmark</a></h4><ul>
<li>RFC 4821 through PLPMTUD make sure network path mtu</li>
<li>benchmark RRT(Round-Trip Time) and BB(bottle neck bandwidth)<ul>
<li>example:RRT=25ms, bandwidth=45Mbps, window=64KB, receiver take 12.5ms to sender BDP(bandwidth-delay product) = BB * RRT /8 = 140.625 KB, double sender ‘s window size</li>
<li>TCP global synchronization</li>
<li>RWND(Receive Window)</li>
<li>CWND(Congestion Window)</li>
<li>LFN(Long fat network)</li>
<li>RTD(round-trip delay time)</li>
<li>TDP(Tail drop polocy)</li>
<li>tcp transfer time<ul>
<li>In the 500Mbps netowrk, start 5x transmit services, each transmit means 100Mbps, actually, the 5 x tansmit bandwith are not balancing. 5 x sender transfer 100MB file.<ul>
<li>500MB/(500Mbps/8)=8 sec, in fact, the test use 12sec, that means 12sec/8sec=1.5, 1.5x late than the theoretically</li>
</ul>
</li>
</ul>
</li>
<li>tcp efficiency<ul>
<li>(total bytes - retrans bytes)/total bytes * 100 = 98%, in our data center , there are 2 percent tcp retrans. that too bad in some times.</li>
</ul>
</li>
<li>tcp cache latency percent, (test average rrt - base rrt)/base rrt * 100, if base rrt= 25ms, in the test, the average rrt=32ms, (32-25)/25*100=28%, tcp RTD increase 28%(congestion)</li>
</ul>
</li>
<li>if the tcp performance not reach your expect<ul>
<li>re-gen tcp connection, and modify tcp rwnd size, mtu size</li>
<li>speed limit cause tail drop polocy and cause too many tcp retrans</li>
<li>the maximum tcp cache size, it limit by OS memory size, and to check tcp queue</li>
<li>socket buffer size, a lot of OS could modify the each connection receive and transmit buffer limit. the socket buffer must be large enough.</li>
</ul>
</li>
</ul>
<h4 id="ab"><a href="#ab" class="headerlink" title="ab"></a>ab</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ab -n 10000 -c 300 http://xx.xx.xx.xx/test.php</span><br></pre></td></tr></table></figure>

<h4 id="bash-and-gnu"><a href="#bash-and-gnu" class="headerlink" title="bash and gnu"></a><a target="_blank" rel="noopener" href="https://plantegg.github.io/">bash and gnu</a></h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ ./openssl speed -multi <span class="variable">$cores</span> -seconds 300 -bytes 1048576 aes-256-ige whirlpool des-ede3 sha512 hmac # after 1.1.1h</span><br><span class="line">$ bash -c <span class="string">&#x27;echo &quot;7^999999&quot; | bc &gt; /dev/null&#x27;</span></span><br><span class="line">$ bash -c <span class="string">&#x27;echo &quot;scale=5000; 4*a(1)&quot; | bc -l -q &gt;/dev/null&#x27;</span> #pi</span><br><span class="line">$ perf stat -e branch-instructions,branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,ref-cycles,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-stores,L1-icache-load-misses,LLC-load-misses,LLC-loads,LLC-store-misses,LLC-stores,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,dTLB-store-misses,dTLB-stores,iTLB-load-misses,iTLB-loads,node-load-misses,node-loads,node-store-misses,node-stores -- bash -c <span class="string">&#x27;echo &quot;7^999999&quot; | bc &gt; /dev/null&#x27;</span></span><br><span class="line"></span><br><span class="line">$ taskset -c 11 sysbench cpu <span class="attribute">--threads</span>=1 <span class="attribute">--events</span>=50000  run</span><br><span class="line">$ sysbench <span class="attribute">--test</span>=<span class="string">&#x27;/usr/share/doc/sysbench/tests/db/select.lua&#x27;</span> <span class="attribute">--oltp_tables_count</span>=1 <span class="attribute">--report-interval</span>=1 <span class="attribute">--oltp-table-size</span>=10000000  <span class="attribute">--mysql-port</span>=3307 <span class="attribute">--mysql-db</span>=sysbench_single <span class="attribute">--mysql-user</span>=root <span class="attribute">--mysql-password</span>=<span class="string">&#x27;Bj6f9g96!@#&#x27;</span>  <span class="attribute">--max-requests</span>=0   <span class="attribute">--oltp_skip_trx</span>=on <span class="attribute">--oltp_auto_inc</span>=on  <span class="attribute">--oltp_range_size</span>=5  <span class="attribute">--mysql-table-engine</span>=innodb <span class="attribute">--rand-init</span>=on   <span class="attribute">--max-time</span>=300 <span class="attribute">--mysql-host</span>=x86.51 <span class="attribute">--num-threads</span>=4 run</span><br><span class="line"></span><br><span class="line">$ numactl -C 7 -m 0 ./bin/stream  -W 5 -N 5 -M 64M</span><br><span class="line">$ numactl -C 7 -m 1 ./bin/stream  -W 5 -N 5 -M 64M</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 8 127); <span class="keyword">do</span> echo core:<span class="variable">$i</span>; numactl -C <span class="variable">$i</span> -m 0 ./bin/lat_mem_rd -W 5 -N 5 -t 64M; done &gt;lat.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment">#CPU cache</span></span><br><span class="line">$ numactl <span class="attribute">--membind</span>=0 <span class="attribute">--cpunodebind</span>=0 ./bin/lat_mem_rd 2000 64</span><br><span class="line">$ numactl -C 0 -m 0 ./bin/lat_mem_rd -W 5 -N 5 -t 2000M #-t test TLB miss <span class="keyword">and</span> Cache miss <span class="keyword">for</span> memory latency</span><br><span class="line"></span><br><span class="line"><span class="comment">#当数据集非常大的时候，时间空间局部性较低时缓存的工作效率很低；</span></span><br><span class="line"><span class="comment">#当缓存工作效率高的时候，局部性非常高，这意味着，根据定义，大多数缓存在大多数时间都处于空闲状态。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#假设主频2.6G的CPU，每个指令只需要 0.38ns</span></span><br><span class="line"><span class="comment">#每次内存寻址需要 100ns</span></span><br><span class="line"><span class="comment">#一次 CPU 上下文切换（系统调用）需要大约 1500ns，也就是 1.5us（这个数字参考了这篇文章，采用的是单核 CPU 线程平均时间）</span></span><br><span class="line"><span class="comment">#SSD 随机读取耗时为 150us</span></span><br><span class="line"><span class="comment">#从内存中读取 1MB 的连续数据，耗时大约为 250us</span></span><br><span class="line"><span class="comment">#同一个数据中心网络上跑一个来回需要 0.5ms</span></span><br><span class="line"><span class="comment">#从 SSD 读取 1MB 的顺序数据，大约需要 1ms （是内存速度的四分之一）</span></span><br><span class="line"><span class="comment">#磁盘寻址时间为 10ms</span></span><br><span class="line"><span class="comment">#从磁盘读取 1MB 连续数据需要 20ms</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/QNgMS0gOXhZml8l_towAbw">mem-lat.c</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ONE p = (char **)*p;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FIVE    ONE ONE ONE ONE ONE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TEN FIVE FIVE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FIFTY   TEN TEN TEN TEN TEN</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HUNDRED FIFTY FIFTY</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">usage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Usage: ./mem-lat -b xxx -n xxx -s xxx\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;   -b buffer size in KB\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;   -n number of read\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;   -s stride skipped before the next access\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please don&#x27;t use non-decimal based number\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> i, j, size, tmp;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> memsize = <span class="number">0x800000</span>; <span class="comment">/* 1/4 LLC size of skylake, 1/5 of broadwell */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> count = <span class="number">1048576</span>; <span class="comment">/* memsize / 64 * 8 */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> stride = <span class="number">64</span>; <span class="comment">/* skipped amount of memory before the next access */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> sec, usec;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv1</span>, <span class="title">tv2</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timezone</span> <span class="title">tz</span>;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> *indices;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (argc-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*argv)[<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>) &#123;  <span class="comment">/* look at first char of next */</span></span><br><span class="line">            <span class="keyword">switch</span> ((*argv)[<span class="number">1</span>]) &#123;   <span class="comment">/* look at second */</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">                    argv++;</span><br><span class="line">                    argc--;</span><br><span class="line">                    memsize = atoi(*argv) * <span class="number">1024</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">                    argv++;</span><br><span class="line">                    argc--;</span><br><span class="line">                    count = atoi(*argv);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">                    argv++;</span><br><span class="line">                    argc--;</span><br><span class="line">                    stride = atoi(*argv);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    usage();</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        argv++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">char</span>* mem = mmap(<span class="literal">NULL</span>, memsize, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANON, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// trick3: init pointer chasing, per stride=8 byte</span></span><br><span class="line">    size = memsize / stride;</span><br><span class="line">    indices = <span class="built_in">malloc</span>(size * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        indices[i] = i;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// trick 2: fill mem with pointer references</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size - <span class="number">1</span>; i++)</span><br><span class="line">        *(<span class="keyword">char</span> **)&amp;mem[indices[i]*stride]= (<span class="keyword">char</span>*)&amp;mem[indices[i+<span class="number">1</span>]*stride];</span><br><span class="line">    *(<span class="keyword">char</span> **)&amp;mem[indices[size<span class="number">-1</span>]*stride]= (<span class="keyword">char</span>*)&amp;mem[indices[<span class="number">0</span>]*stride];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// shuffle indices</span></span><br><span class="line">    <span class="comment">/* for (i = 0; i &lt; size; i++) &#123;</span></span><br><span class="line"><span class="comment">         j = i +  rand() % (size - i);</span></span><br><span class="line"><span class="comment">         if (i != j) &#123;</span></span><br><span class="line"><span class="comment">             tmp = indices[i];</span></span><br><span class="line"><span class="comment">             indices[i] = indices[j];</span></span><br><span class="line"><span class="comment">             indices[j] = tmp;</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">     &#125; */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> **p = (<span class="keyword">char</span> **) mem;</span><br><span class="line">    <span class="comment">//register char **p = (char **)mem;</span></span><br><span class="line"></span><br><span class="line">    tmp = count / <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    gettimeofday (&amp;tv1, &amp;tz);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; tmp; ++i) &#123;</span><br><span class="line">        HUNDRED;  <span class="comment">//trick 1</span></span><br><span class="line">    &#125;</span><br><span class="line">    gettimeofday (&amp;tv2, &amp;tz);</span><br><span class="line">    <span class="keyword">if</span> (tv2.tv_usec &lt; tv1.tv_usec) &#123;</span><br><span class="line">        usec = <span class="number">1000000</span> + tv2.tv_usec - tv1.tv_usec;</span><br><span class="line">        sec = tv2.tv_sec - tv1.tv_sec - <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        usec = tv2.tv_usec - tv1.tv_usec;</span><br><span class="line">        sec = tv2.tv_sec - tv1.tv_sec;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Buffer size: %ld KB, stride %d, time %d.%06d s, latency %.2f ns\n&quot;</span>, </span><br><span class="line">            memsize/<span class="number">1024</span>, stride, sec, usec, (sec * <span class="number">1000000</span>  + usec) * <span class="number">1000.0</span> / (tmp *<span class="number">100</span>));</span><br><span class="line">    munmap(mem, memsize);</span><br><span class="line">    <span class="built_in">free</span>(indices);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">work=./mem-lat</span><br><span class="line">buffer_size=<span class="number">1</span></span><br><span class="line">stride=<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i in `seq <span class="number">1</span> <span class="number">15</span>`; <span class="keyword">do</span></span><br><span class="line">    taskset -ac <span class="number">0</span> $work -b $buffer_size -s $stride</span><br><span class="line">    buffer_size=$(($buffer_size*<span class="number">2</span>))</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><a href="">pause.c</a></p>
<ul>
<li>Decrease the switch context</li>
<li>The another HT logic core could be use</li>
<li>Keep power save</li>
<li>The PAUSE instruction is first introduced for Intel Pentium 4 processor to improve the performance of “spin-wait loop”. The PAUSE instruction is typically used with software threads executing on two logical processors located in the same processor core, waiting for a lock to be released. Such short wait loops tend to last between tens and a few hundreds of cycles. When the wait loop is expected to last for thousands of cycles or more, it is preferable to yield to the operating system by calling one of the OS synchronization API functions, such as WaitForSingleObject on Windows OS.</li>
<li>An Intel® processor suffers a severe performance penalty when exiting the loop because it detects a possible memory order violation. The PAUSE instruction provides a hint to the processor that the code sequence is a spin-wait loop. The processor uses this hint to avoid the memory order violation in most situations. The PAUSE instruction can improve the performance of the processors supporting Intel Hyper-Threading Technology when executing “spin-wait loops”. With pause instruction, processors are able to avoid the memory order violation and pipeline flush, and reduce power consumption through pipeline stall.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">$ perf stat -e branch-instructions,branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,ref-cycles,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-stores,L1-icache-load-misses,LLC-load-misses,LLC-loads,LLC-store-misses,LLC-stores,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,dTLB-store-misses,dTLB-stores,iTLB-load-misses,iTLB-loads,node-load-misses,node-loads,node-store-misses,node-stores ./pause</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TIMES 5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">rdtsc</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> low, high;</span><br><span class="line">    <span class="function"><span class="keyword">asm</span> <span class="title">volatile</span><span class="params">(<span class="string">&quot;rdtsc&quot;</span> : <span class="string">&quot;=a&quot;</span> (low), <span class="string">&quot;=d&quot;</span> (high) )</span></span>;</span><br><span class="line">    <span class="keyword">return</span> ((low) | (high) &lt;&lt; <span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pause_test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; TIMES; i++) &#123;</span><br><span class="line">        <span class="keyword">asm</span>(</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span>\</span><br><span class="line">                <span class="string">&quot;pause\n&quot;</span></span><br><span class="line">                ::</span><br><span class="line">                :);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">pause_cycle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> start, finish, elapsed;</span><br><span class="line">    start = rdtsc();</span><br><span class="line">    pause_test();</span><br><span class="line">    finish = rdtsc();</span><br><span class="line">    elapsed = finish - start;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Pause的cycles约为:%ld\n&quot;</span>, elapsed / <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pause_cycle();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">unsigned</span> <span class="keyword">long</span> count=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      count++;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ perf top --<span class="keyword">asm</span>-raw -p  <span class="number">70832</span></span><br><span class="line"></span><br><span class="line">       │         __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"> <span class="number">12.03</span> │     f3     <span class="number">90</span>                   pause</span><br><span class="line">       │         __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"> <span class="number">25.51</span> │     f3     <span class="number">90</span>                   pause</span><br><span class="line">       │         __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"> <span class="number">23.43</span> │     f3     <span class="number">90</span>                   pause</span><br><span class="line">       │         __asm__ __volatile__(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"> <span class="number">24.81</span> │     f3     <span class="number">90</span>                   pause</span><br><span class="line"> <span class="number">14.22</span> │     eb     f6                   jmp    <span class="number">400400</span> &lt;main&gt;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<p>intel x86 cpu bound and memory bound</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ sudo perf stat -e branch-instructions,branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,ref-cycles,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-stores,L1-icache-load-misses,LLC-load-misses,LLC-loads,LLC-store-misses,LLC-stores,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,dTLB-store-misses,dTLB-stores,iTLB-load-misses,iTLB-loads,node-load-misses,node-loads,node-store-misses,node-stores -a ./memory_bound</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;emmintrin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">memory_bound</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">register</span> <span class="keyword">unsigned</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">register</span> <span class="keyword">char</span> b;</span><br><span class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;(<span class="number">1u</span>&lt;&lt;<span class="number">24</span>);i++) &#123;</span><br><span class="line">                <span class="comment">// evict cacheline containing a</span></span><br><span class="line">                 _mm_clflush(&amp;a);</span><br><span class="line">                 b = a;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpu_bound</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">register</span> <span class="keyword">unsigned</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;(<span class="number">1u</span>&lt;&lt;<span class="number">31</span>);i++) &#123;</span><br><span class="line">                __asm__ (<span class="string">&quot;nop\nnop\nnop&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">10</span>; ++i)&#123;</span><br><span class="line">                 <span class="comment">//cpu_bound();</span></span><br><span class="line">                 memory_bound();</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="another-tools"><a href="#another-tools" class="headerlink" title="another tools"></a>another tools</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/intel/lmbench">lmbench</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/travisdowns/uarch-bench">uarch-bench</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/tsuna/contextswitch">contextswitch</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">寸劲</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/03/17/benchmark-tools/">http://yoursite.com/2020/03/17/benchmark-tools/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/test/">test</a></div><div class="post_share"><div class="social-share" data-image="https://homerl.github.io/img/kisspng-computer-icons-benchmarking-computer-software-clip-5ad795b068f297.2882681215240780004299.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/24/c/"><img class="prev-cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">C lang</div></div></a></div><div class="next-post pull-right"><a href="/2020/03/03/crash/"><img class="next-cover" src="https://homerl.github.io/img/PROPELLER-2-1-1024x1024.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">crash practice</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/07/22/network-benchmark-result/" title="Network bencharmk results"><img class="cover" src="https://homerl.github.io/img/kisspng-computer-icons-benchmarking-computer-software-clip-5ad795b068f297.2882681215240780004299.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-22</div><div class="title">Network bencharmk results</div></div></a></div><div><a href="/2019/04/28/consistency-test/" title="Test hardware and filesystem data consistency"><img class="cover" src="https://homerl.github.io/img/kisspng-computer-icons-benchmarking-computer-software-clip-5ad795b068f297.2882681215240780004299.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-04-28</div><div class="title">Test hardware and filesystem data consistency</div></div></a></div><div><a href="/2018/07/12/storage_benchmark/" title="storage benchmark"><img class="cover" src="https://homerl.github.io/img/kisspng-computer-icons-benchmarking-computer-software-clip-5ad795b068f297.2882681215240780004299.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-12</div><div class="title">storage benchmark</div></div></a></div><div><a href="/2018/04/09/mpi-benchmark/" title="MPI benchmark"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-04-09</div><div class="title">MPI benchmark</div></div></a></div><div><a href="/2016/03/22/ha/" title="High availability test"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2016-03-22</div><div class="title">High availability test</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2022 By 寸劲</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '0b9d5b98d0a972b33cf7',
      clientSecret: '769efc11b32f6c0d03bcbf3ee800dfc4e2690459',
      repo: 'homerl.github.io',
      owner: 'homerl',
      admin: ['homerl'],
      id: '453b8ea92588e65b55264b53eb3c4fa4',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>