<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>bencharmk tools | 己不由心，身又岂能由己</title><meta name="keywords" content="test"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="stress-ngfilesystem123456789101112131415161718192021222324252627282930313233# bogo ops&#x2F;s (real time) is the value of system performance$ stress-ng  --hdd 16 --hdd-opts rd-rnd --hdd-opts wr-rnd --hdd-o">
<meta property="og:type" content="article">
<meta property="og:title" content="bencharmk tools">
<meta property="og:url" content="http://yoursite.com/2020/03/17/benchmark-tools/index.html">
<meta property="og:site_name" content="己不由心，身又岂能由己">
<meta property="og:description" content="stress-ngfilesystem123456789101112131415161718192021222324252627282930313233# bogo ops&#x2F;s (real time) is the value of system performance$ stress-ng  --hdd 16 --hdd-opts rd-rnd --hdd-opts wr-rnd --hdd-o">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg">
<meta property="article:published_time" content="2020-03-17T09:06:14.000Z">
<meta property="article:modified_time" content="2020-10-09T12:22:41.104Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="test">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2020/03/17/benchmark-tools/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-10-09 20:22:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/244247-guts.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#stress-ng"><span class="toc-number">1.</span> <span class="toc-text">stress-ng</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#filesystem"><span class="toc-number">1.1.</span> <span class="toc-text">filesystem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU"><span class="toc-number">1.2.</span> <span class="toc-text">CPU</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MEM"><span class="toc-number">1.3.</span> <span class="toc-text">MEM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OS"><span class="toc-number">1.4.</span> <span class="toc-text">OS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mix"><span class="toc-number">1.5.</span> <span class="toc-text">mix</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#the-others-test"><span class="toc-number">1.6.</span> <span class="toc-text">the others test</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run"><span class="toc-number"></span> <span class="toc-text">run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run.</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#cpu-method"><span class="toc-number">0.0.1.</span> <span class="toc-text">cpu-method</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#class"><span class="toc-number">0.0.2.</span> <span class="toc-text">class</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#performance-info"><span class="toc-number">0.1.</span> <span class="toc-text">performance info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Verify-mode"><span class="toc-number">0.2.</span> <span class="toc-text">Verify mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Generating-major-page-faults"><span class="toc-number">0.3.</span> <span class="toc-text">Generating major page faults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test-case"><span class="toc-number">1.</span> <span class="toc-text">test case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Emulate-some-error-to-test-the-block-device"><span class="toc-number">2.</span> <span class="toc-text">Emulate some error to test the block device</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dm-delay"><span class="toc-number">2.1.</span> <span class="toc-text">dm-delay</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dm-linear"><span class="toc-number">2.2.</span> <span class="toc-text">dm-linear</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dm-flakey"><span class="toc-number">2.3.</span> <span class="toc-text">dm-flakey</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">己不由心，身又岂能由己</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">bencharmk tools</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-03-17T09:06:14.000Z" title="Created 2020-03-17 17:06:14">2020-03-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-10-09T12:22:41.104Z" title="Updated 2020-10-09 20:22:41">2020-10-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Benchmark/">Benchmark</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="stress-ng"><a href="#stress-ng" class="headerlink" title="stress-ng"></a>stress-ng</h3><h4 id="filesystem"><a href="#filesystem" class="headerlink" title="filesystem"></a>filesystem</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># bogo ops/s (real time) is the value of system performance</span><br><br>$ stress-ng  --hdd 16 --hdd-opts rd-rnd --hdd-opts wr-rnd --hdd-opts fadv-rnd --hdd-write-size 128k --timeout 60 --<span class="hljs-built_in">times</span> --metrics-brief<br>stress-ng: info:  [67477] dispatching hogs: 16 hdd<br>stress-ng: info:  [67477] successful run completed <span class="hljs-keyword">in</span> 60.17s (1 min, 0.17 secs)<br>stress-ng: info:  [67477] stressor       bogo ops real time  usr time  sys time   bogo ops/s   bogo ops/s<br>stress-ng: info:  [67477]                           (secs)    (secs)    (secs)   (real time) (usr+sys time)<br>stress-ng: info:  [67477] hdd            19033866     60.12    381.16    575.50    316618.18     19896.17<br>stress-ng: info:  [67477] <span class="hljs-keyword">for</span> a 60.17s run time:<br>stress-ng: info:  [67477]     962.79s available CPU time<br>stress-ng: info:  [67477]     381.24s user time   ( 39.60%)<br>stress-ng: info:  [67477]     575.57s system time ( 59.78%)<br>stress-ng: info:  [67477]     956.81s total time  ( 99.38%)<br>stress-ng: info:  [67477] load average: 11.29 4.72 1.86<br><br><span class="hljs-comment"># meta</span><br>$ stress-ng --sequential 16 --class filesystem --timeout 60 --<span class="hljs-built_in">times</span> --metrics-brief<br>stress-ng: info:  [27612] apparmor stressor will be skipped, AppArmor is not available<br>stress-ng: info:  [27612] dispatching hogs: 16 <span class="hljs-built_in">chdir</span>, 16 chmod, 16 chown, 16 copy-file, 16 dentry, 16 dir, 16 dirdeep, 16 dnotify, 16 dup, 16 eventfd, 16 fallocate, 16 fanotify, 16 fcntl, 16 fiemap, 16 filename, 16 flock, 16 fstat, 16 getdent, 16 handle, 16 inotify, 16 io, 16 iomix, 16 ioprio, 16 lease, 16 link, 16 locka, 16 lockf, 16 lockofd, 16 mknod, 16 open, 16 procfs, 16 rename, 16 symlink, 16 sync-file, 16 utime, 16 xattr<br><br><span class="hljs-comment">#syscall test, no real IO</span><br>$ stress-ng --<span class="hljs-built_in">chdir</span> 8 --chmod 8 --chown 8 --fcntl 8 --filename 8 --flock 8 --fstat 8 --getdent 8 --handle 8 --io 8 -- lockf 8 --timeout 60 --<span class="hljs-built_in">times</span> --metrics-brief<br><br><span class="hljs-comment"># parallel running</span><br><span class="hljs-comment"># if you want test IO performance, got the high IO loading from these.</span><br>$ stress-ng --fallocate 8 --xattr 8 --dir 8 --mknod 8 --symlink 8 --timeout 60 --<span class="hljs-built_in">times</span> --metrics-brief<br><br><span class="hljs-comment"># a lot of NFS not support xattr</span><br>$ stress-ng --fallocate 8 --dir 8 --mknod 8 --symlink 8 --timeout 60 --<span class="hljs-built_in">times</span> --metrics-brief<br><br><span class="hljs-comment"># the high IO loading test could got the high IOPS in ext4 with SATA SSD</span><br>Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util<br>sdb               0.00 100284.00    0.00 15955.50     0.00   452.52    58.08    97.34    6.05    0.00    6.05   0.06  95.05<br></code></pre></td></tr></table></figure>

<h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ stress-ng --cpu <span class="hljs-variable">$cores_num</span> --timeout 900<br></code></pre></td></tr></table></figure>

<h4 id="MEM"><a href="#MEM" class="headerlink" title="MEM"></a>MEM</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ stress-ng --vm 4 --timeout 900s<br>$ stress-ng --vm-bytes $(awk <span class="hljs-string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.9;&#125;&#x27;</span> &lt; /proc/meminfo)k --vm-keep -m 1 -t 30s --metrics-brief<br>$ stress-ng --mincore 5 --mincore-random --malloc 2 --malloc-bytes 10g --mremap 2 --mremap-bytes 10g --memfd 2 --memfd-bytes 10g --vm-bytes 10g -m 2  -t 600s --metrics-brief<br></code></pre></td></tr></table></figure>

<h4 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ stress-ng --mq 0 -t 30s --<span class="hljs-built_in">times</span>  --metrics-brief<br><br><span class="hljs-comment"># The matrix stressor is a good way to exercise the CPU floating point operations as well as memory and processor data cache. Of all the tests, this one generally heats x86 CPUs the best.</span><br>$ stress-ng --matrix 0 -t 1m --<span class="hljs-built_in">times</span> --metrics-brief<br></code></pre></td></tr></table></figure>

<h4 id="mix"><a href="#mix" class="headerlink" title="mix"></a>mix</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ stress-ng --cpu 2 --matrix 1 --mq 3<br>$ stress-ng --all 2<br><br>$ stress-ng --seq 1 -x numa,matrix,hdd<br><span class="hljs-comment">#        --sequential N</span><br>sequentially run all the stressors one by one <span class="hljs-keyword">for</span> a default of 60 seconds. The number of instances of each of the individual stressors to be started is N.  If N  is  less than  zero, <span class="hljs-keyword">then</span> the number of CPUs online is used <span class="hljs-keyword">for</span> the number of instances.  If N is zero, <span class="hljs-keyword">then</span> the number of CPUs <span class="hljs-keyword">in</span> the system is used.  Use the --timeout option to specify the duration to run each stressor.<br></code></pre></td></tr></table></figure>

<h4 id="the-others-test"><a href="#the-others-test" class="headerlink" title="the others test"></a>the others test</h4><p>$ stress-ng –seq 1 -x nuam, –sched fifo  -t 30s –times –metrics-brief<br>$ stress-ng –vm 16 –vm-bytes 90% -t 1h –metrics-brief<br>$ stress-ng –cpu 8 –cpu-ops 800000<br>$ stress-ng –cpu 4 –cpu-method fft –cpu-ops 10000 –metrics-brief<br>$ stress-ng –cpu 0 –cpu-method all -t 1h<br>$ stress-ng –random 64<br>#run 64 stressors that are randomly chosen from all the available stressors.</p>
<p>$ stress-ng –cpu 64 –cpu-method all –verify -t 10m –metrics-brief<br>#run 64 instances of all the different cpu stressors and verify that the computations are correct for 10 minutes with a bogo operations summary at the end.</p>
<p>$ stress-ng –sequential 8 –class io -t 5m –times</p>
<h1 id="run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run"><a href="#run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run" class="headerlink" title="run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run."></a>run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run.</h1><p>$ stress-ng –all 0 –maximize –aggressive<br>#run all the stressors (1 instance of each per CPU) simultaneously, maximize the settings (memory sizes, file allocations, etc.) and select the  most  demanding/aggressive options.</p>
<p>$        stress-ng –sequential 4 –class vm –exclude bigheap,brk,stack<br>#run 4 instances of the VM stressors one after each other, excluding the bigheap, brk and stack stressors</p>
<p>$ stress-ng –taskset 0,2-3 –cpu 3<br>#run 3 instances of the CPU stressor and pin them to CPUs 0, 2 and 3.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-comment">##### cpu-cache</span><br><span class="hljs-string">```bash</span><br><span class="hljs-string">$</span> <span class="hljs-string">stress-ng</span> <span class="hljs-string">--sequential</span> <span class="hljs-number">8</span> <span class="hljs-string">--class</span> <span class="hljs-string">cpu-cache</span> <span class="hljs-string">-t</span> <span class="hljs-string">5m</span><br><span class="hljs-attr">stress-ng: info:</span>  [<span class="hljs-number">13341</span>] <span class="hljs-string">apparmor</span> <span class="hljs-string">stressor</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">skipped,</span> <span class="hljs-string">AppArmor</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">available</span><br><span class="hljs-attr">stress-ng: info:</span>  [<span class="hljs-number">13341</span>] <span class="hljs-attr">dispatching hogs:</span> <span class="hljs-number">8</span> <span class="hljs-string">bsearch,</span> <span class="hljs-number">8</span> <span class="hljs-string">cache,</span> <span class="hljs-number">8</span> <span class="hljs-string">heapsort,</span> <span class="hljs-number">8</span> <span class="hljs-string">hsearch,</span> <span class="hljs-number">8</span> <span class="hljs-string">icache,</span> <span class="hljs-number">8</span> <span class="hljs-string">lockbus,</span> <span class="hljs-number">8</span> <span class="hljs-string">lsearch,</span> <span class="hljs-number">8</span> <span class="hljs-string">malloc,</span> <span class="hljs-number">8</span> <span class="hljs-string">matrix,</span> <span class="hljs-number">8</span> <span class="hljs-string">membarrier,</span> <span class="hljs-number">8</span> <span class="hljs-string">memcpy,</span> <span class="hljs-number">8</span> <span class="hljs-string">mergesort,</span> <span class="hljs-number">8</span> <span class="hljs-string">qsort,</span> <span class="hljs-number">8</span> <span class="hljs-string">str,</span> <span class="hljs-number">8</span> <span class="hljs-string">stream,</span> <span class="hljs-number">8</span> <span class="hljs-string">tsearch,</span> <span class="hljs-number">8</span> <span class="hljs-string">vecmath,</span> <span class="hljs-number">8</span> <span class="hljs-string">wcs,</span> <span class="hljs-number">8</span> <span class="hljs-string">zlib</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">stress-ng</span> <span class="hljs-string">--cpu</span> <span class="hljs-number">4</span> <span class="hljs-string">--cache-level</span> <span class="hljs-number">2</span> <span class="hljs-string">--cache-ways</span> <span class="hljs-number">4</span> <span class="hljs-string">-t</span> <span class="hljs-string">30s</span> <span class="hljs-string">--metrics-brief</span><br><span class="hljs-string">$</span> <span class="hljs-string">stress-ng</span> <span class="hljs-string">--cpu</span> <span class="hljs-number">4</span> <span class="hljs-string">--cache-level</span> <span class="hljs-number">3</span> <span class="hljs-string">--cache-ways</span> <span class="hljs-number">4</span> <span class="hljs-string">-t</span> <span class="hljs-string">30s</span> <span class="hljs-string">--metrics-brief</span><br><span class="hljs-string">...</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">stress-ng</span> <span class="hljs-string">--all</span> <span class="hljs-number">0</span> <span class="hljs-string">--class</span> <span class="hljs-string">cpu-cache</span> <span class="hljs-string">-t</span> <span class="hljs-string">5m</span> <span class="hljs-string">--metrics-brief</span><br></code></pre></td></tr></table></figure>

<h5 id="cpu-method"><a href="#cpu-method" class="headerlink" title="cpu-method"></a>cpu-method</h5><p>$ stress-ng –cpu 1 –cpu-method matrixprod -t 1m –metrics-brief<br>$ for m in double longdouble matrixprod nsqrt cfloat clongdouble decimal32 decimal128 explog bitops ln2 int64 int128 ackermann int128decimal128 gray euler fibonacci; do stress-ng –cpu 0 –cpu-method $m -t 10s –metrics-brief; done</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment"># float</span><br>double           <span class="hljs-number">1000</span> iterations of a mix of double precision floating point operations<br>longdouble       <span class="hljs-number">1000</span> iterations of a mix of long double precision floating point operations<br>matrixprod       matrix  product  of  two  <span class="hljs-number">128</span> × <span class="hljs-number">128</span> matrices of double floats. Testing on <span class="hljs-number">64</span> <span class="hljs-keyword">bit </span>x86 hardware <span class="hljs-keyword">shows </span>that this is provides a good mix of memory, <span class="hljs-keyword">cache </span><span class="hljs-keyword">and </span>floating point operations <span class="hljs-keyword">and </span>is probably the <span class="hljs-keyword">best </span>CPU method to use to make a CPU run hot.<br>nsqrt            compute sqrt() of long doubles using Newton-Raphson<br>cfloat           <span class="hljs-number">1000</span> iterations of a mix of floating point complex operations<br><span class="hljs-keyword">clongdouble </span>     <span class="hljs-number">1000</span> iterations of a mix of long double floating point complex operations<br>decimal32        <span class="hljs-number">1000</span> iterations of a mix of <span class="hljs-number">32</span> <span class="hljs-keyword">bit </span>decimal floating point operations (GCC only)<br>decimal128       <span class="hljs-number">1000</span> iterations of a mix of <span class="hljs-number">128</span> <span class="hljs-keyword">bit </span>decimal floating point operations (GCC only)<br>explog           iterate on n = exp(log(n) ÷ <span class="hljs-number">1</span>.<span class="hljs-number">00002</span>)<br><br><br><span class="hljs-comment">#int</span><br>int64            <span class="hljs-number">1000</span> iterations of a mix of <span class="hljs-number">64</span> <span class="hljs-keyword">bit </span>integer operations<br>int128           <span class="hljs-number">1000</span> iterations of a mix of <span class="hljs-number">128</span> <span class="hljs-keyword">bit </span>integer operations (GCC only)<br><br><br><br>------------------------performance test--------------------------<br><span class="hljs-comment">#logic</span><br><span class="hljs-keyword">jmp </span>             Simple unoptimised <span class="hljs-built_in">compare</span> &gt;, &lt;, == <span class="hljs-keyword">and </span><span class="hljs-keyword">jmp </span><span class="hljs-keyword">branching</span><br><span class="hljs-keyword">ackermann </span>       Ackermann function: compute A(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>), where:<br>                 A(m, n) = n + <span class="hljs-number">1</span> if m = <span class="hljs-number">0</span>;<br>                 A(m - <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) if m &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and </span>n = <span class="hljs-number">0</span>;<br>                 A(m - <span class="hljs-number">1</span>, A(m, n - <span class="hljs-number">1</span>)) if m &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and </span>n &gt; <span class="hljs-number">0</span><br><span class="hljs-comment"># bit</span><br><span class="hljs-keyword">bitops </span>          various <span class="hljs-keyword">bit </span>operations from <span class="hljs-keyword">bithack, </span>namely: reverse <span class="hljs-keyword">bits, </span>parity check, <span class="hljs-keyword">bit </span><span class="hljs-built_in">count</span>, round to nearest power of <span class="hljs-number">2</span><br><span class="hljs-comment"># int</span><br>gray             calculate <span class="hljs-keyword">binary </span>to gray code <span class="hljs-keyword">and </span>gray code <span class="hljs-keyword">back </span>to <span class="hljs-keyword">binary </span>for integers from <span class="hljs-number">0</span> to <span class="hljs-number">65535</span> <br>fibonacci        compute Fibonacci sequence of <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>...<br><br><span class="hljs-comment">#float</span><br>euler            compute e using n = (<span class="hljs-number">1</span> + (<span class="hljs-number">1</span> ÷ n)) ↑ n <br>ln2              compute ln(<span class="hljs-number">2</span>) <span class="hljs-keyword">based </span>on series:<br><span class="hljs-comment">#mix</span><br>int128decimal32 <span class="hljs-number">1000</span> iterations of a mix of <span class="hljs-number">128</span> <span class="hljs-keyword">bit </span>integer <span class="hljs-keyword">and </span><span class="hljs-number">128</span> <span class="hljs-keyword">bit </span>decimal floating point operations (GCC only)<br><span class="hljs-comment">#rand hash</span><br>djb2a            <span class="hljs-number">128</span> rounds of hash DJB2a (Dan <span class="hljs-keyword">Bernstein </span>hash using the <span class="hljs-keyword">xor </span>variant) on <span class="hljs-number">128</span> to <span class="hljs-number">1</span> <span class="hljs-keyword">bytes </span>of <span class="hljs-built_in">random</span> strings<br><span class="hljs-keyword">dither </span>          Floyd–Steinberg <span class="hljs-keyword">dithering </span>of a <span class="hljs-number">1024</span> × <span class="hljs-number">768</span> <span class="hljs-built_in">random</span> image from <span class="hljs-number">8</span> <span class="hljs-keyword">bits </span>down to <span class="hljs-number">1</span> <span class="hljs-keyword">bit </span>of depth.<br>crc16            compute <span class="hljs-number">1024</span> rounds of CCITT CRC16 on <span class="hljs-built_in">random</span> data<br><br>-----------------------------------END--------------------------<br><br><span class="hljs-comment">#C</span><br>callfunc         recursively call <span class="hljs-number">8</span> argument C function to a depth of <span class="hljs-number">1024</span> calls <span class="hljs-keyword">and </span>unwind<br><br><span class="hljs-comment">#random, hash</span><br><span class="hljs-keyword">jenkin </span>       <span class="hljs-keyword">Jenkin&#x27;s </span>integer hash on <span class="hljs-number">128</span> rounds of <span class="hljs-number">128</span>..<span class="hljs-number">1</span> <span class="hljs-keyword">bytes </span>of <span class="hljs-built_in">random</span> data<br>hanoi         solve a <span class="hljs-number">21</span> <span class="hljs-keyword">disc </span>Towers of Hanoi stack using the recursive solution<br>              hamming          compute Hamming H(<span class="hljs-number">8</span>,<span class="hljs-number">4</span>) codes on <span class="hljs-number">262144</span> lots of <span class="hljs-number">4</span> <span class="hljs-keyword">bit </span>data. This turns <span class="hljs-number">4</span> <span class="hljs-keyword">bit </span>data into <span class="hljs-number">8</span> <span class="hljs-keyword">bit </span>Hamming code containing <span class="hljs-number">4</span> parity <span class="hljs-keyword">bits. </span>For data <span class="hljs-keyword">bits </span> d1..d4,<br>                               parity <span class="hljs-keyword">bits </span>are computed as:<br>                                 p1 = d2 + d3 + d4<br>                                 p2 = d1 + d3 + d4<br>                                 p3 = d1 + d2 + d4<br>                                 p4 = d1 + d2 + d3<br>correlate        perform a <span class="hljs-number">16384</span> × <span class="hljs-number">1024</span> correlation of <span class="hljs-built_in">random</span> doubles<br><br><br>--memthrash-method method<br>              specify a memthrash stress method. Available memthrash stress methods are described<br>              as follows:<br><br>              Method           Description<br>              all              iterate over all the <span class="hljs-keyword">below </span>memthrash methods<br>              chunk1           memset <span class="hljs-number">1</span> <span class="hljs-keyword">byte </span><span class="hljs-keyword">chunks </span>of <span class="hljs-built_in">random</span> data into <span class="hljs-built_in">random</span> locations<br>              chunk8           memset <span class="hljs-number">8</span> <span class="hljs-keyword">byte </span><span class="hljs-keyword">chunks </span>of <span class="hljs-built_in">random</span> data into <span class="hljs-built_in">random</span> locations<br>              chunk64          memset <span class="hljs-number">64</span> <span class="hljs-keyword">byte </span><span class="hljs-keyword">chunks </span>of <span class="hljs-built_in">random</span> data into <span class="hljs-built_in">random</span> locations<br>              chunk256         memset <span class="hljs-number">256</span> <span class="hljs-keyword">byte </span><span class="hljs-keyword">chunks </span>of <span class="hljs-built_in">random</span> data into <span class="hljs-built_in">random</span> locations<br>              chunkpage        memset page size <span class="hljs-keyword">chunks </span>of <span class="hljs-built_in">random</span> data into <span class="hljs-built_in">random</span> locations<br>              flip             flip (invert) all <span class="hljs-keyword">bits </span>in ramdom locations<br>              flush            flush <span class="hljs-keyword">cache </span>line in <span class="hljs-built_in">random</span> locations<br>              lock             lock randomly choosing locations (Intel x86 CPUs only)<br>              matrix           treat memory as a <span class="hljs-number">2</span> × <span class="hljs-number">2</span> matrix <span class="hljs-keyword">and </span><span class="hljs-keyword">swap </span><span class="hljs-built_in">random</span> elements<br>              memset           memset the memory with <span class="hljs-built_in">random</span> data<br>              mfence           stores with write serialization (Intel x86 CPUs only)<br>              <span class="hljs-keyword">prefetch </span>        <span class="hljs-keyword">prefetch </span>data <span class="hljs-built_in">at</span> <span class="hljs-built_in">random</span> memory locations<br>              <span class="hljs-built_in">random</span>           randomly  run any of the memthrash methods except for <span class="hljs-string">&#x27;random&#x27;</span> <span class="hljs-keyword">and</span><br><span class="hljs-keyword"> </span>                              <span class="hljs-string">&#x27;all&#x27;</span><br>              spinread         spin loop read the same <span class="hljs-built_in">random</span> location <span class="hljs-number">2</span>^<span class="hljs-number">19</span> times<br>              spinwrite        spin loop write the same <span class="hljs-built_in">random</span> location <span class="hljs-number">2</span>^<span class="hljs-number">19</span> times<br></code></pre></td></tr></table></figure>

<h5 id="class"><a href="#class" class="headerlink" title="class"></a>class</h5><p>The stress-ng stressors are grouped together in different classes:</p>
<p>cpu - CPU intensive<br>cpu-cache - stress CPU instruction and/or data caches<br>device - raw device driver stressors<br>io - generic input/output<br>interrupt - high interrupt load generators<br>filesystem - file system activity<br>memory - stack, heap, memory mapping, shared memory stressors<br>network - TCP/IP, UDP and UNIX domain socket stressors<br>os - core kernel stressors<br>pipe - pipe and UNIX socket stressors<br>scheduler - force high levels of context switching<br>security - AppArmor stressor<br>vm - Virtual Memory stressor (paging and memory)</p>
<p>–matrix-method method<br>       specify a matrix stress method. Available matrix stress methods are described as follows:</p>
<pre><code>   Method           Description
   all              iterate over all the below matrix stress methods
   add              add two N × N matrices

   copy             copy one N × N matrix to another
   div              divide an N × N matrix by a scalar
   hadamard         Hadamard product of two N × N matrices
   frobenius        Frobenius product of two N × N matrices
   mean             arithmetic mean of two N × N matrices
   mult             multiply an N × N matrix by a scalar
   prod             product of two N × N matrices
   sub              subtract one N × N matrix from another N × N matrix
   trans            transpose an N × N matrix</code></pre>
<h4 id="performance-info"><a href="#performance-info" class="headerlink" title="performance info"></a>performance info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ stress-ng --mq 0 -t 30s --<span class="hljs-built_in">times</span> --perf<br>stress-ng: info:  [68895] dispatching hogs: 16 mq<br>^Cstress-ng: info:  [68895] unsuccessful run completed <span class="hljs-keyword">in</span> 15.95s<br>stress-ng: info:  [68895] mq:<br>stress-ng: info:  [68895]            667,942,869,088 CPU Cycles                    41.88 B/sec<br>stress-ng: info:  [68895]            343,598,563,312 Instructions                  21.54 B/sec (0.514 instr. per cycle)<br>stress-ng: info:  [68895]              4,273,568,592 Cache References               0.27 B/sec<br>stress-ng: info:  [68895]                108,195,424 Cache Misses                   6.78 M/sec ( 2.53%)<br>stress-ng: info:  [68895]             62,069,485,136 Branch Instructions            3.89 B/sec<br>stress-ng: info:  [68895]              1,391,055,360 Branch Misses                 87.21 M/sec ( 2.24%)<br>stress-ng: info:  [68895]              4,911,414,496 Bus Cycles                     0.31 B/sec<br>stress-ng: info:  [68895]            510,787,333,888 Total Cycles                  32.02 B/sec<br>stress-ng: info:  [68895]                      3,184 Page Faults Minor            199.61 /sec<br>stress-ng: info:  [68895]                          0 Page Faults Major              0.00 /sec<br>stress-ng: info:  [68895]                  3,924,080 Context Switches               0.25 M/sec<br>stress-ng: info:  [68895]                    718,208 CPU Migrations                45.03 K/sec<br>stress-ng: info:  [68895]                          0 Alignment Faults               0.00 /sec<br>stress-ng: info:  [68895]                      3,088 Page Faults User             193.60 /sec<br>stress-ng: info:  [68895]                         96 Page Faults Kernel             6.02 /sec<br>stress-ng: info:  [68895]                 92,731,952 System Call Enter              5.81 M/sec<br>stress-ng: info:  [68895]                 92,731,952 System Call Exit               5.81 M/sec<br>stress-ng: info:  [68895]                 54,434,816 Kmalloc                        3.41 M/sec<br>stress-ng: info:  [68895]                    399,904 Kmalloc Node                  25.07 K/sec<br>stress-ng: info:  [68895]                231,994,672 Kfree                         14.54 M/sec<br>stress-ng: info:  [68895]                    139,904 Kmem Cache Alloc               8.77 K/sec<br>stress-ng: info:  [68895]                     88,848 Kmem Cache Alloc Node          5.57 K/sec<br>stress-ng: info:  [68895]                    181,568 Kmem Cache Free               11.38 K/sec<br>stress-ng: info:  [68895]                     59,856 MM Page Alloc                  3.75 K/sec<br>stress-ng: info:  [68895]                    158,720 MM Page Free                   9.95 K/sec<br>stress-ng: info:  [68895]                  8,842,656 RCU Utilization                0.55 M/sec<br>stress-ng: info:  [68895]                    764,352 Sched Migrate Task            47.92 K/sec<br>stress-ng: info:  [68895]                          0 Sched Move NUMA                0.00 /sec<br>stress-ng: info:  [68895]                  6,617,648 Sched Wakeup                   0.41 M/sec<br>stress-ng: info:  [68895]                         16 Signal Generate                1.00 /sec<br>stress-ng: info:  [68895]                         80 Signal Deliver                 5.02 /sec<br>stress-ng: info:  [68895]                        672 IRQ Entry                     42.13 /sec<br>stress-ng: info:  [68895]                        672 IRQ Exit                      42.13 /sec<br>stress-ng: info:  [68895]                    664,704 Soft IRQ Entry                41.67 K/sec<br>stress-ng: info:  [68895]                    664,704 Soft IRQ Exit                 41.67 K/sec<br>stress-ng: info:  [68895]                         16 Writeback Dirty Inode          1.00 /sec<br>stress-ng: info:  [68895]                          0 Writeback Dirty Page           0.00 /sec<br>stress-ng: info:  [68895] <span class="hljs-keyword">for</span> a 15.95s run time:<br>stress-ng: info:  [68895]     255.21s available CPU time<br>stress-ng: info:  [68895]      25.73s user time   ( 10.08%)<br>stress-ng: info:  [68895]     181.50s system time ( 71.12%)<br>stress-ng: info:  [68895]     207.23s total time  ( 81.20%)<br>stress-ng: info:  [68895] load average: 5.35 1.73 1.08<br></code></pre></td></tr></table></figure>

<h4 id="Verify-mode"><a href="#Verify-mode" class="headerlink" title="Verify mode"></a>Verify mode</h4><p>Some stressors have a verification mode. A stress test is run and the results are checked, if the results are incorrect then stress-ng will flag up a warning error message. Suppose we want to run some exhaustive memory checks on a blob of virtually mapped memory via the vm stressor, enable the –verify mode and this will sanity check that the read/write results on the memory:</p>
<p>$ stress-ng –vm 1 –vm-bytes 2G –verify -v<br>Note that not all stressors have a verify mode, and enabling it will reduce the bogo op stats as there is an extra verification step being invoked.</p>
<h4 id="Generating-major-page-faults"><a href="#Generating-major-page-faults" class="headerlink" title="Generating major page faults"></a>Generating major page faults</h4><p>You can generate major page faults (by accessing a page is not loaded in memory at the time of the fault) and see the page fault rate using:<br>$ stress-ng –fault 0 –perf -t 1m</p>
<p>or with newer kernels use the userfaultfd stressor to force even more major faults:<br>$ stress-ng –userfaultfd 0 –perf -t 1m</p>
<p>Running timers at high frequency can generate a large interrupt load. The timer stressor with an appropriately selected timer frequency can be used to force many hundreds of thousands of interrupts per second, for example, 32 instances at 1MHz:<br>$ stress-ng –timer 32 –timer-freq 1000000</p>
<h3 id="test-case"><a href="#test-case" class="headerlink" title="test case"></a>test case</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -------all cores CPU case1:------<br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> jmp bitops fibonacci euler ln2 int128decimal32 djb2a crc16; <span class="hljs-keyword">do</span> stress-ng --cpu 0 --cpu-method <span class="hljs-variable">$m</span> -t 240s --metrics-brief; <span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> -------4 cores CPU case1:------<br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> jmp bitops fibonacci euler ln2 int128decimal32 djb2a crc16; <span class="hljs-keyword">do</span> stress-ng --cpu 4 --cpu-method <span class="hljs-variable">$m</span> -t 240s --metrics-brief; <span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> -------mem test1:---------<br>stress-ng --malloc 1 --malloc-bytes $(awk <span class="hljs-string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k  --vm-keep -m 1 --vm-bytes $(awk <span class="hljs-string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k --mremap 2 --mremap-bytes $(awk <span class="hljs-string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k --memfd 2 --memfd-bytes $(awk <span class="hljs-string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k -t 600s --metrics-brief<br><span class="hljs-built_in">echo</span> -------mem test2:---------<br>stress-ng --mincore 0 --mincore-random -t 600s --metrics-brief<br><span class="hljs-built_in">echo</span> -------mem test3:---------<br>stress-ng --vm-bytes $(awk <span class="hljs-string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.9;&#125;&#x27;</span> /proc/meminfo)k --vm-keep -m 1 -t 600s --metrics-brief<br></code></pre></td></tr></table></figure>

<h3 id="Emulate-some-error-to-test-the-block-device"><a href="#Emulate-some-error-to-test-the-block-device" class="headerlink" title="Emulate some error to test the block device"></a>Emulate some error to test the block device</h3><h4 id="dm-delay"><a href="#dm-delay" class="headerlink" title="dm-delay"></a><a target="_blank" rel="noopener" href="https://enodev.fr/posts/emulate-a-slow-block-device-with-dm-delay.html#">dm-delay</a></h4><p>Device-Mapper’s “delay” target delays reads and/or writes and maps them to different devices.</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">$ sudo modprobe brd rd_nr=<span class="hljs-number">1</span> rd_size=<span class="hljs-number">1048576</span><br><br>[random]<br>readwrite=randread<br>blocksize=<span class="hljs-number">4</span>k<br>ioengine=sync<br>filename=/dev/ram0<br>time_based=<span class="hljs-number">1</span><br>runtime=<span class="hljs-number">10</span><br><br>DDR <span class="hljs-number">1333</span><br>Jobs: <span class="hljs-number">1</span> (f=<span class="hljs-number">1</span>): [r(<span class="hljs-number">1</span>)][<span class="hljs-number">100.0</span>%][r=<span class="hljs-number">1471</span>MiB/s,w=<span class="hljs-number">0</span>KiB/s][r=<span class="hljs-number">377</span>k,w=<span class="hljs-number">0</span> IOPS][eta <span class="hljs-number">00</span>m:<span class="hljs-number">00</span>s]<br>rw: (groupid=<span class="hljs-number">0</span>, jobs=<span class="hljs-number">1</span>): err= <span class="hljs-number">0</span>: pid=<span class="hljs-number">13487</span>: Thu Jun  <span class="hljs-number">4</span> <span class="hljs-number">22</span>:<span class="hljs-number">43</span>:<span class="hljs-number">25</span> <span class="hljs-number">2020</span><br>   read: IOPS=<span class="hljs-number">361</span>k, BW=<span class="hljs-number">1411</span>MiB/s (<span class="hljs-number">1480</span>MB/s)(<span class="hljs-number">13.8</span>GiB/<span class="hljs-number">10001</span>msec)<br>    clat (nsec): min=<span class="hljs-number">790</span>, max=<span class="hljs-number">124854</span>, avg=<span class="hljs-number">1563.39</span>, stdev=<span class="hljs-number">935.07</span><br>     lat (nsec): min=<span class="hljs-number">984</span>, max=<span class="hljs-number">125042</span>, avg=<span class="hljs-number">1757.85</span>, stdev=<span class="hljs-number">978.84</span><br>    clat percentiles (nsec):<br>     |  <span class="hljs-number">1.00</span>th=[ <span class="hljs-number">1240</span>],  <span class="hljs-number">5.00</span>th=[ <span class="hljs-number">1304</span>], <span class="hljs-number">10.00</span>th=[ <span class="hljs-number">1336</span>], <span class="hljs-number">20.00</span>th=[ <span class="hljs-number">1368</span>],<br>     | <span class="hljs-number">30.00</span>th=[ <span class="hljs-number">1384</span>], <span class="hljs-number">40.00</span>th=[ <span class="hljs-number">1400</span>], <span class="hljs-number">50.00</span>th=[ <span class="hljs-number">1432</span>], <span class="hljs-number">60.00</span>th=[ <span class="hljs-number">1464</span>],<br>     | <span class="hljs-number">70.00</span>th=[ <span class="hljs-number">1496</span>], <span class="hljs-number">80.00</span>th=[ <span class="hljs-number">1560</span>], <span class="hljs-number">90.00</span>th=[ <span class="hljs-number">1752</span>], <span class="hljs-number">95.00</span>th=[ <span class="hljs-number">2352</span>],<br>     | <span class="hljs-number">99.00</span>th=[ <span class="hljs-number">3376</span>], <span class="hljs-number">99.50</span>th=[ <span class="hljs-number">4080</span>], <span class="hljs-number">99.90</span>th=[<span class="hljs-number">14784</span>], <span class="hljs-number">99.95</span>th=[<span class="hljs-number">24960</span>],<br>     | <span class="hljs-number">99.99</span>th=[<span class="hljs-number">31360</span>]<br>   bw (  MiB/s): min= <span class="hljs-number">1004</span>, max= <span class="hljs-number">1476</span>, per=<span class="hljs-number">99.79</span>%, avg=<span class="hljs-number">1408.26</span>, stdev=<span class="hljs-number">144.72</span>, samples=<span class="hljs-number">19</span><br>   iops        : min=<span class="hljs-number">257224</span>, max=<span class="hljs-number">377934</span>, avg=<span class="hljs-number">360514.11</span>, stdev=<span class="hljs-number">37048.52</span>, samples=<span class="hljs-number">19</span><br>  lat (nsec)   : <span class="hljs-number">1000</span>=<span class="hljs-number">0.01</span>%<br>  lat (usec)   : <span class="hljs-number">2</span>=<span class="hljs-number">91.75</span>%, <span class="hljs-number">4</span>=<span class="hljs-number">7.64</span>%, <span class="hljs-number">10</span>=<span class="hljs-number">0.49</span>%, <span class="hljs-number">20</span>=<span class="hljs-number">0.03</span>%, <span class="hljs-number">50</span>=<span class="hljs-number">0.09</span>%<br>  lat (usec)   : <span class="hljs-number">100</span>=<span class="hljs-number">0.01</span>%, <span class="hljs-number">250</span>=<span class="hljs-number">0.01</span>%<br>  cpu          : usr=<span class="hljs-number">27.40</span>%, sys=<span class="hljs-number">72.48</span>%, ctx=<span class="hljs-number">954</span>, majf=<span class="hljs-number">0</span>, minf=<span class="hljs-number">9</span><br>  IO depths    : <span class="hljs-number">1</span>=<span class="hljs-number">100.0</span>%, <span class="hljs-number">2</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">4</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">8</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">16</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">32</span>=<span class="hljs-number">0.0</span>%, &gt;=<span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%<br>     submit    : <span class="hljs-number">0</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">4</span>=<span class="hljs-number">100.0</span>%, <span class="hljs-number">8</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">16</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">32</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%, &gt;=<span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%<br>     complete  : <span class="hljs-number">0</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">4</span>=<span class="hljs-number">100.0</span>%, <span class="hljs-number">8</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">16</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">32</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%, &gt;=<span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%<br>     issued rwt: total=<span class="hljs-number">3613043</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, short=<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, dropped=<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>     latency   : target=<span class="hljs-number">0</span>, window=<span class="hljs-number">0</span>, percentile=<span class="hljs-number">100.00</span>%, depth=<span class="hljs-number">1</span><br><br>Run status group <span class="hljs-number">0</span> (all jobs):<br>   READ: bw=<span class="hljs-number">1411</span>MiB/s (<span class="hljs-number">1480</span>MB/s), <span class="hljs-number">1411</span>MiB/s<span class="hljs-number">-1411</span>MiB/s (<span class="hljs-number">1480</span>MB/s<span class="hljs-number">-1480</span>MB/s), io=<span class="hljs-number">13.8</span>GiB (<span class="hljs-number">14.8</span>GB), run=<span class="hljs-number">10001</span><span class="hljs-number">-10001</span>msec<br><br># Create device delaying rw operation <span class="hljs-keyword">for</span> <span class="hljs-number">500</span>ms<br>$ echo <span class="hljs-string">&quot;0 $(blockdev --getsz /dev/ram0) delay /dev/ram0 0 500&quot;</span> | dmsetup create delayed<br>$ ls -l /dev/mapper/delayed <br>lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">7</span> <span class="hljs-number">6</span>   <span class="hljs-number">4</span> <span class="hljs-number">22</span>:<span class="hljs-number">47</span> /dev/mapper/delayed -&gt; ../dm<span class="hljs-number">-0</span><br><br>[random]<br>filename=/dev/dm<span class="hljs-number">-0</span><br>readwrite=randread<br>blocksize=<span class="hljs-number">4</span>k<br>ioengine=sync<br>time_based=<span class="hljs-number">1</span><br>runtime=<span class="hljs-number">10</span><br><br>Starting <span class="hljs-number">1</span> process<br>Jobs: <span class="hljs-number">1</span> (f=<span class="hljs-number">1</span>): [r(<span class="hljs-number">1</span>)][<span class="hljs-number">100.0</span>%][r=<span class="hljs-number">8</span>KiB/s,w=<span class="hljs-number">0</span>KiB/s][r=<span class="hljs-number">2</span>,w=<span class="hljs-number">0</span> IOPS][eta <span class="hljs-number">00</span>m:<span class="hljs-number">00</span>s]<br>random: (groupid=<span class="hljs-number">0</span>, jobs=<span class="hljs-number">1</span>): err= <span class="hljs-number">0</span>: pid=<span class="hljs-number">13873</span>: Thu Jun  <span class="hljs-number">4</span> <span class="hljs-number">22</span>:<span class="hljs-number">56</span>:<span class="hljs-number">44</span> <span class="hljs-number">2020</span><br>   read: IOPS=<span class="hljs-number">1</span>, BW=<span class="hljs-number">8007</span>B/s (<span class="hljs-number">8007</span>B/s)(<span class="hljs-number">80.0</span>KiB/<span class="hljs-number">10231</span>msec)<br>    clat (msec): min=<span class="hljs-number">503</span>, max=<span class="hljs-number">516</span>, avg=<span class="hljs-number">511.50</span>, stdev= <span class="hljs-number">2.97</span><br>     lat (msec): min=<span class="hljs-number">503</span>, max=<span class="hljs-number">516</span>, avg=<span class="hljs-number">511.50</span>, stdev= <span class="hljs-number">2.97</span><br>    clat percentiles (msec):<br>     |  <span class="hljs-number">1.00</span>th=[  <span class="hljs-number">506</span>],  <span class="hljs-number">5.00</span>th=[  <span class="hljs-number">506</span>], <span class="hljs-number">10.00</span>th=[  <span class="hljs-number">510</span>], <span class="hljs-number">20.00</span>th=[  <span class="hljs-number">510</span>],<br>     | <span class="hljs-number">30.00</span>th=[  <span class="hljs-number">514</span>], <span class="hljs-number">40.00</span>th=[  <span class="hljs-number">514</span>], <span class="hljs-number">50.00</span>th=[  <span class="hljs-number">514</span>], <span class="hljs-number">60.00</span>th=[  <span class="hljs-number">514</span>],<br>     | <span class="hljs-number">70.00</span>th=[  <span class="hljs-number">514</span>], <span class="hljs-number">80.00</span>th=[  <span class="hljs-number">514</span>], <span class="hljs-number">90.00</span>th=[  <span class="hljs-number">514</span>], <span class="hljs-number">95.00</span>th=[  <span class="hljs-number">518</span>],<br>     | <span class="hljs-number">99.00</span>th=[  <span class="hljs-number">518</span>], <span class="hljs-number">99.50</span>th=[  <span class="hljs-number">518</span>], <span class="hljs-number">99.90</span>th=[  <span class="hljs-number">518</span>], <span class="hljs-number">99.95</span>th=[  <span class="hljs-number">518</span>],<br>     | <span class="hljs-number">99.99</span>th=[  <span class="hljs-number">518</span>]<br>   bw (  KiB/s): min=    <span class="hljs-number">8</span>, max=    <span class="hljs-number">8</span>, per=<span class="hljs-number">100.00</span>%, avg= <span class="hljs-number">8.00</span>, stdev= <span class="hljs-number">0.00</span>, samples=<span class="hljs-number">19</span><br>   iops        : min=    <span class="hljs-number">2</span>, max=    <span class="hljs-number">2</span>, avg= <span class="hljs-number">2.00</span>, stdev= <span class="hljs-number">0.00</span>, samples=<span class="hljs-number">19</span><br>  lat (msec)   : <span class="hljs-number">750</span>=<span class="hljs-number">100.00</span>%<br>  cpu          : usr=<span class="hljs-number">0.00</span>%, sys=<span class="hljs-number">0.02</span>%, ctx=<span class="hljs-number">20</span>, majf=<span class="hljs-number">0</span>, minf=<span class="hljs-number">6</span><br>  IO depths    : <span class="hljs-number">1</span>=<span class="hljs-number">100.0</span>%, <span class="hljs-number">2</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">4</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">8</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">16</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">32</span>=<span class="hljs-number">0.0</span>%, &gt;=<span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%<br>     submit    : <span class="hljs-number">0</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">4</span>=<span class="hljs-number">100.0</span>%, <span class="hljs-number">8</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">16</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">32</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%, &gt;=<span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%<br>     complete  : <span class="hljs-number">0</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">4</span>=<span class="hljs-number">100.0</span>%, <span class="hljs-number">8</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">16</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">32</span>=<span class="hljs-number">0.0</span>%, <span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%, &gt;=<span class="hljs-number">64</span>=<span class="hljs-number">0.0</span>%<br>     issued rwt: total=<span class="hljs-number">20</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, short=<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, dropped=<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>     latency   : target=<span class="hljs-number">0</span>, window=<span class="hljs-number">0</span>, percentile=<span class="hljs-number">100.00</span>%, depth=<span class="hljs-number">1</span><br><br>Run status group <span class="hljs-number">0</span> (all jobs):<br>   READ: bw=<span class="hljs-number">8007</span>B/s (<span class="hljs-number">8007</span>B/s), <span class="hljs-number">8007</span>B/s<span class="hljs-number">-8007</span>B/s (<span class="hljs-number">8007</span>B/s<span class="hljs-number">-8007</span>B/s), io=<span class="hljs-number">80.0</span>KiB (<span class="hljs-number">81.9</span>kB), run=<span class="hljs-number">10231</span><span class="hljs-number">-10231</span>msec<br><br>Disk stats (read/write):<br>    dm<span class="hljs-number">-0</span>: ios=<span class="hljs-number">20</span>/<span class="hljs-number">0</span>, merge=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>, ticks=<span class="hljs-number">9720</span>/<span class="hljs-number">0</span>, in_queue=<span class="hljs-number">10140</span>, util=<span class="hljs-number">99.14</span>%, aggrios=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>, aggrmerge=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>, aggrticks=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>, aggrin_queue=<span class="hljs-number">0</span>, aggrutil=<span class="hljs-number">0.00</span>%<br>  ram0: ios=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>, merge=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>, ticks=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>, in_queue=<span class="hljs-number">0</span>, util=<span class="hljs-number">0.00</span>%<br><br># Create a block device that delays reads <span class="hljs-keyword">for</span> <span class="hljs-number">500</span> ms <span class="hljs-keyword">and</span> writes <span class="hljs-keyword">for</span> <span class="hljs-number">300</span> ms<br>size=$(blockdev --getsize /dev/ram0) # Size <span class="hljs-keyword">in</span> <span class="hljs-number">512</span>-bytes sectors<br>$ echo <span class="hljs-string">&quot;0 $(blockdev --getsize /dev/ram0) delay /dev/ram0 0 500 /dev/ram0 0 300&quot;</span> | dmsetup create delayed<br><br>$ dmsetup remove /dev/mapper/delayed<br></code></pre></td></tr></table></figure>
<h4 id="dm-linear"><a href="#dm-linear" class="headerlink" title="dm-linear"></a>dm-linear</h4><p>The dm-linear target maps a linear range of blocks of the device-mapper device onto a linear range of a backend device. dm-linear is the basic building block of logical volume managers such as LVM.</p>
<h4 id="dm-flakey"><a href="#dm-flakey" class="headerlink" title="dm-flakey"></a>dm-flakey</h4><p>This target is the same as the linear target except that it exhibits unreliable behaviour periodically.  It’s been found useful in simulating failing devices for testing purposes.</p>
<ul>
<li>drop_writes All write I/Os are silently ignored and dropped. Read I/Os are handled correctly.</li>
<li>error_writes All write I/Os are failed with an error signaled. Read I/Os are handled correctly.</li>
<li>corrupt_bio_byte During the down time, replace the Nth byte of the data of each read or write block I/O with a specified value.<br>The default error mode is to fail all I/O requests during the down time of the simulation cycle.</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs routeros">tabled parameters:<br>&lt;dev path&gt; &lt;offset&gt; &lt;up interval&gt; &lt;down interval&gt;  [&lt;num_features&gt; [&lt;feature arguments&gt;]]<br>$ dmsetup create test --table <span class="hljs-string">&#x27;0 123 flakey /dev/sda1 0 4 8&#x27;</span><br>$  file /dev/mapper/dm_test0 <br>/dev/mapper/dm_test0: symbolic link <span class="hljs-keyword">to</span> <span class="hljs-built_in">..</span>/dm-0<br><br>[random]<br><span class="hljs-attribute">filename</span>=/dev/dm-0<br><span class="hljs-comment">#readwrite=randrw</span><br><span class="hljs-attribute">readwrite</span>=randread<br><span class="hljs-attribute">blocksize</span>=4k<br><span class="hljs-attribute">ioengine</span>=sync<br><span class="hljs-attribute">time_based</span>=1<br><span class="hljs-attribute">runtime</span>=130<br><br><br>fio-3.1<br>Starting 1 process<br>fio: io_u <span class="hljs-builtin-name">error</span> on file /dev/dm-0: Input/output error: read <span class="hljs-attribute">offset</span>=0, <span class="hljs-attribute">buflen</span>=4096<br>random: <span class="hljs-literal">No</span> I/O performed by sync, perhaps try <span class="hljs-attribute">--debug</span>=io option <span class="hljs-keyword">for</span> details?<br>fio: <span class="hljs-attribute">pid</span>=16261, <span class="hljs-attribute">err</span>=5/file:io_u.c:1756, <span class="hljs-attribute">func</span>=io_u error, <span class="hljs-attribute">error</span>=Input/output error<br><br>random: (<span class="hljs-attribute">groupid</span>=0, <span class="hljs-attribute">jobs</span>=1): err= 5 (file:io_u.c:1756, <span class="hljs-attribute">func</span>=io_u error, <span class="hljs-attribute">error</span>=Input/output error): <span class="hljs-attribute">pid</span>=16261: Fri Jun  5 00:29:08 2020<br>  cpu          : <span class="hljs-attribute">usr</span>=0.00%, <span class="hljs-attribute">sys</span>=0.00%, <span class="hljs-attribute">ctx</span>=0, <span class="hljs-attribute">majf</span>=0, <span class="hljs-attribute">minf</span>=17<br>  IO depths    : <span class="hljs-attribute">1</span>=100.0%, <span class="hljs-attribute">2</span>=0.0%, <span class="hljs-attribute">4</span>=0.0%, <span class="hljs-attribute">8</span>=0.0%, <span class="hljs-attribute">16</span>=0.0%, <span class="hljs-attribute">32</span>=0.0%, &gt;=<span class="hljs-attribute">64</span>=0.0%<br>     submit    : <span class="hljs-attribute">0</span>=0.0%, <span class="hljs-attribute">4</span>=100.0%, <span class="hljs-attribute">8</span>=0.0%, <span class="hljs-attribute">16</span>=0.0%, <span class="hljs-attribute">32</span>=0.0%, <span class="hljs-attribute">64</span>=0.0%, &gt;=<span class="hljs-attribute">64</span>=0.0%<br>     complete  : <span class="hljs-attribute">0</span>=50.0%, <span class="hljs-attribute">4</span>=50.0%, <span class="hljs-attribute">8</span>=0.0%, <span class="hljs-attribute">16</span>=0.0%, <span class="hljs-attribute">32</span>=0.0%, <span class="hljs-attribute">64</span>=0.0%, &gt;=<span class="hljs-attribute">64</span>=0.0%<br>     issued rwt: <span class="hljs-attribute">total</span>=1,0,0, <span class="hljs-attribute">short</span>=0,0,0, <span class="hljs-attribute">dropped</span>=0,0,0<br>     latency   : <span class="hljs-attribute">target</span>=0, <span class="hljs-attribute">window</span>=0, <span class="hljs-attribute">percentile</span>=100.00%, <span class="hljs-attribute">depth</span>=1<br><br><span class="hljs-builtin-name">Run</span> status<span class="hljs-built_in"> group </span>0 (all jobs):<br><br>Disk stats (read/write):<br>    dm-0: <span class="hljs-attribute">ios</span>=0/0, <span class="hljs-attribute">merge</span>=0/0, <span class="hljs-attribute">ticks</span>=0/0, <span class="hljs-attribute">in_queue</span>=0, <span class="hljs-attribute">util</span>=0.00%, <span class="hljs-attribute">aggrios</span>=0/0, <span class="hljs-attribute">aggrmerge</span>=0/0, <span class="hljs-attribute">aggrticks</span>=0/0, <span class="hljs-attribute">aggrin_queue</span>=0, <span class="hljs-attribute">aggrutil</span>=0.00%<br>  sda: <span class="hljs-attribute">ios</span>=0/0, <span class="hljs-attribute">merge</span>=0/0, <span class="hljs-attribute">ticks</span>=0/0, <span class="hljs-attribute">in_queue</span>=0, <span class="hljs-attribute">util</span>=0.00%<br><br>[18800.528564] buffer_io_error: 110 callbacks suppressed<br>[18800.528569] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 0, async<span class="hljs-built_in"> page </span>read<br>[18800.528582] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 1, async<span class="hljs-built_in"> page </span>read<br>[18800.528587] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 2, async<span class="hljs-built_in"> page </span>read<br>[18800.528591] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 3, async<span class="hljs-built_in"> page </span>read<br>[18800.528596] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 4, async<span class="hljs-built_in"> page </span>read<br>[18800.528600] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 5, async<span class="hljs-built_in"> page </span>read<br>[18800.528604] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 6, async<span class="hljs-built_in"> page </span>read<br>[18800.528608] Buffer I/O <span class="hljs-builtin-name">error</span> on dev dm-0, logical block 7, async<span class="hljs-built_in"> page </span>read<br></code></pre></td></tr></table></figure>
<p>$ dmsetup suspend /dev/dm-0<br>$ dmsetup resume /dev/dm-0</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs makefile">dm-linear<br>dm-zoned<br><span class="hljs-section">(dm-dust)[https://www.kernel.org/doc/Documentation/device-mapper/dm-dust.txt]</span><br><br><br>the fio demo<br>```bash<br>[global]<br>directory=./<br>iodepth=8<br>rwmixread=50<br>numjobs=32<br>size=100M<br>norandommap=1<br>group_reporting<br>refill_buffers<br>end_fsync=1<br>disable_slat=1<br>exitall<br>timeout=36000<br>direct=0<br>nrfiles=8<br>bssplit=4k/10:32k/20:64k/20:128k/20:256k/20:1024k/10<br>[job1]<br>rw=write<br>ioengine=libaio<br>[job2]<br>rw=read<br>ioengine=libaio<br>[job3]<br>rw=randread<br>ioengine=libaio<br>[job4]<br>rw=randwrite<br>ioengine=libaio<br>[job5]<br>rw=randrw<br>ioengine=libaio<br>[job6]<br>rw=write<br>ioengine=posixaio<br>[job7]<br>rw=read<br>ioengine=posixaio<br>[job8]<br>rw=randread<br>ioengine=posixaio<br>[job9]<br>rw=randwrite<br>ioengine=posixaio<br>[job10]<br>rw=randrw<br>ioengine=posixaio<br>[job11]<br>rw=write<br>ioengine=sync<br>[job12]<br>rw=read<br>ioengine=sync<br>[job13]<br>rw=randread<br>ioengine=sync<br>[job14]<br>rw=randwrite<br>ioengine=sync<br>[job15]<br>rw=randrw<br>ioengine=sync<br>[job16]<br>rw=write<br>ioengine=psync<br>[job17]<br>rw=read<br>ioengine=psync<br>[job18]<br>rw=randread<br>ioengine=psync<br>[job19]<br>rw=randwrite<br>ioengine=psync<br>[job20]<br>rw=randrw<br>ioengine=psync<br>[job21]<br>rw=write<br>ioengine=vsync<br>[job22]<br>rw=read<br>ioengine=vsync<br>[job23]<br>rw=randread<br>ioengine=vsync<br>[job24]<br>rw=randwrite<br>ioengine=vsync<br>[job25]<br>rw=randrw<br>ioengine=vsync<br></code></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/03/17/benchmark-tools/">http://yoursite.com/2020/03/17/benchmark-tools/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/test/">test</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/24/system_tools/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">System tools</div></div></a></div><div class="next-post pull-right"><a href="/2020/03/16/network_hardware/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">network topology</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2019/04/28/consistency-test/" title="Test hardware and filesystem data consistency"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-04-28</div><div class="title">Test hardware and filesystem data consistency</div></div></a></div><div><a href="/2020/07/22/network-benchmark-result/" title="Network bencharmk results"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-22</div><div class="title">Network bencharmk results</div></div></a></div><div><a href="/2018/07/12/storage_benchmark/" title="storage benchmark"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-12</div><div class="title">storage benchmark</div></div></a></div><div><a href="/2016/03/22/ha/" title="High availability test"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2016-03-22</div><div class="title">High availability test</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '0b9d5b98d0a972b33cf7',
      clientSecret: '769efc11b32f6c0d03bcbf3ee800dfc4e2690459',
      repo: 'homerl.github.io',
      owner: 'homerl',
      admin: ['homerl'],
      id: '453b8ea92588e65b55264b53eb3c4fa4',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>