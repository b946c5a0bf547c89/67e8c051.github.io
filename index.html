<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>b946c5a0bf547c89</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="b946c5a0bf547c89">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="b946c5a0bf547c89">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ginger">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="b946c5a0bf547c89" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">b946c5a0bf547c89</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/hello-world/" class="article-date">
  <time datetime="2020-09-27T14:33:20.031Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/27/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
        
          <p class="article-more-link">
            <a href="/2020/09/27/hello-world/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/09/27/hello-world/" data-id="ckg0we46c000ta1o6cjhzbo7z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-bpftrace" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/24/bpftrace/" class="article-date">
  <time datetime="2020-07-24T06:13:15.000Z" itemprop="datePublished">2020-07-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tools/">tools</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/24/bpftrace/">bpftrace</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="bcc-tools"><a href="#bcc-tools" class="headerlink" title="bcc tools"></a>bcc tools</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ ./vfsstat 5 10</span><br><span class="line">TIME         READ/s  WRITE/s CREATE/s   OPEN/s  FSYNC/s</span><br><span class="line">14:34:53:       575        7        0      537        0</span><br><span class="line">14:34:58:       850        9        0      792        0</span><br><span class="line">14:35:03:       842        8        0      791        0</span><br><span class="line">14:35:08:       580        8        0      535        0</span><br><span class="line">14:35:13:       839        8        0      789        0</span><br><span class="line"></span><br><span class="line">$  bpftrace -e <span class="string">&#x27;kprobe:vfs_* &#123; @[probe] = count() &#125;&#x27;</span></span><br><span class="line">Attaching 53 probes...</span><br><span class="line">^C</span><br><span class="line">@[kprobe:vfs_llseek]: 1</span><br><span class="line">@[kprobe:vfs_fsync_range]: 33</span><br><span class="line">@[kprobe:vfs_iter_write]: 61</span><br><span class="line">@[kprobe:vfs_statfs]: 93</span><br><span class="line">@[kprobe:vfs_statx_fd]: 469</span><br><span class="line">@[kprobe:vfs_statx]: 2299</span><br><span class="line">@[kprobe:vfs_getattr_nosec]: 2872</span><br><span class="line">@[kprobe:vfs_getattr]: 2873</span><br><span class="line">@[kprobe:vfs_write]: 3754</span><br><span class="line">@[kprobe:vfs_open]: 4965</span><br><span class="line">@[kprobe:vfs_read]: 8020</span><br></pre></td></tr></table></figure>

<h3 id="list-all-events"><a href="#list-all-events" class="headerlink" title="list all events"></a>list all events</h3>
        
          <p class="article-more-link">
            <a href="/2020/07/24/bpftrace/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/24/bpftrace/" data-id="ckg0we47u005da1o6au7pa55j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bpf/" rel="tag">bpf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/debug/" rel="tag">debug</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-network-benchmark-result" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/22/network-benchmark-result/" class="article-date">
  <time datetime="2020-07-22T09:04:45.000Z" itemprop="datePublished">2020-07-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/benchmark/">benchmark</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/22/network-benchmark-result/">Network bencharmk results</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Hardware info</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">01:00.0 Ethernet controller: Broadcom Inc. and subsidiaries NetXtreme II BCM57800 1/10 Gigabit Ethernet (rev 10)</span><br><span class="line">01:00.1 Ethernet controller: Broadcom Inc. and subsidiaries NetXtreme II BCM57800 1/10 Gigabit Ethernet (rev 10)</span><br><span class="line">01:00.2 Ethernet controller: Broadcom Inc. and subsidiaries NetXtreme II BCM57800 1/10 Gigabit Ethernet (rev 10)</span><br><span class="line">01:00.3 Ethernet controller: Broadcom Inc. and subsidiaries NetXtreme II BCM57800 1/10 Gigabit Ethernet (rev 10)</span><br><span class="line"></span><br><span class="line">$ ethtool -i em2</span><br><span class="line">driver: bnx2x</span><br><span class="line">version: 1.713.36-0 storm 7.13.1.0</span><br><span class="line">firmware-version: FFV15.05.12 bc 7.14.16</span><br><span class="line">expansion-rom-version:</span><br><span class="line">bus-info: 0000:01:00.1</span><br><span class="line">supports-statistics: yes</span><br><span class="line">supports-test: yes</span><br><span class="line">supports-eeprom-access: yes</span><br><span class="line">supports-register-dump: yes</span><br><span class="line">supports-priv-flags: yes</span><br><span class="line"></span><br><span class="line">$ ethtool -k em2</span><br><span class="line">Features <span class="keyword">for</span> em2:</span><br><span class="line">rx-checksumming: on</span><br><span class="line">tx-checksumming: on</span><br><span class="line">	tx-checksum-ipv4: on</span><br><span class="line">	tx-checksum-ip-generic: off [fixed]</span><br><span class="line">	tx-checksum-ipv6: on</span><br><span class="line">	tx-checksum-fcoe-crc: off [fixed]</span><br><span class="line">	tx-checksum-sctp: off [fixed]</span><br><span class="line">scatter-gather: on</span><br><span class="line">	tx-scatter-gather: on</span><br><span class="line">	tx-scatter-gather-fraglist: off [fixed]</span><br><span class="line">tcp-segmentation-offload: on</span><br><span class="line">	tx-tcp-segmentation: on</span><br><span class="line">	tx-tcp-ecn-segmentation: on</span><br><span class="line">	tx-tcp6-segmentation: on</span><br><span class="line">	tx-tcp-mangleid-segmentation: off</span><br><span class="line">udp-fragmentation-offload: off [fixed]</span><br><span class="line">generic-segmentation-offload: on</span><br><span class="line">generic-receive-offload: on</span><br><span class="line">large-receive-offload: on</span><br><span class="line">rx-vlan-offload: on [fixed]</span><br><span class="line">tx-vlan-offload: on</span><br><span class="line">ntuple-filters: off [fixed]</span><br><span class="line">receive-hashing: on</span><br><span class="line">highdma: on [fixed]</span><br><span class="line">rx-vlan-filter: on</span><br><span class="line">vlan-challenged: off [fixed]</span><br><span class="line">tx-lockless: off [fixed]</span><br><span class="line">netns-local: off [fixed]</span><br><span class="line">tx-gso-robust: off [fixed]</span><br><span class="line">tx-fcoe-segmentation: off [fixed]</span><br><span class="line">tx-gre-segmentation: on</span><br><span class="line">tx-ipip-segmentation: on</span><br><span class="line">tx-sit-segmentation: on</span><br><span class="line">tx-udp_tnl-segmentation: on</span><br><span class="line">fcoe-mtu: off [fixed]</span><br><span class="line">tx-nocache-copy: off</span><br><span class="line">loopback: off</span><br><span class="line">rx-fcs: off [fixed]</span><br><span class="line">rx-all: off [fixed]</span><br><span class="line">tx-vlan-stag-hw-insert: off [fixed]</span><br><span class="line">rx-vlan-stag-hw-parse: off [fixed]</span><br><span class="line">rx-vlan-stag-filter: off [fixed]</span><br><span class="line">busy-poll: off [fixed]</span><br><span class="line">tx-gre-csum-segmentation: on</span><br><span class="line">tx-udp_tnl-csum-segmentation: on</span><br><span class="line">tx-gso-partial: on</span><br><span class="line">tx-sctp-segmentation: off [fixed]</span><br><span class="line">rx-gro-hw: off</span><br><span class="line">l2-fwd-offload: off [fixed]</span><br><span class="line">hw-tc-offload: off [fixed]</span><br><span class="line">rx-udp_tunnel-port-offload: on</span><br><span class="line"></span><br><span class="line">cat /proc/net/bonding/bond0</span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: IEEE 802.3ad Dynamic link aggregation</span><br><span class="line">Transmit Hash Policy: layer3+4 (1)</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">802.3ad info</span><br><span class="line">LACP rate: fast</span><br><span class="line">Min links: 0</span><br><span class="line">Aggregator selection policy (ad_select): stable</span><br><span class="line">System priority: 65535</span><br><span class="line">System MAC address: 18:66:da:91:a1:c2</span><br><span class="line">Active Aggregator Info:</span><br><span class="line">	Aggregator ID: 1</span><br><span class="line">	Number of ports: 2</span><br><span class="line">	Actor Key: 15</span><br><span class="line">	Partner Key: 5697</span><br><span class="line">	Partner Mac Address: a0:a3:3b:a8:47:f1</span><br><span class="line"></span><br><span class="line">Slave Interface: em1</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 18:66:da:91:a1:c2</span><br><span class="line">Slave queue ID: 0</span><br><span class="line">Aggregator ID: 1</span><br><span class="line">Actor Churn State: none</span><br><span class="line">Partner Churn State: none</span><br><span class="line">Actor Churned Count: 0</span><br><span class="line">Partner Churned Count: 0</span><br><span class="line">details actor lacp pdu:</span><br><span class="line">    system priority: 65535</span><br><span class="line">    system mac address: 18:66:da:91:a1:c2</span><br><span class="line">    port key: 15</span><br><span class="line">    port priority: 255</span><br><span class="line">    port number: 1</span><br><span class="line">    port state: 63</span><br><span class="line">details partner lacp pdu:</span><br><span class="line">    system priority: 32768</span><br><span class="line">    system mac address: a0:a3:3b:a8:47:f1</span><br><span class="line">    oper key: 5697</span><br><span class="line">    port priority: 32768</span><br><span class="line">    port number: 72</span><br><span class="line">    port state: 61</span><br><span class="line"></span><br><span class="line">Slave Interface: em2</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 18:66:da:91:a1:c4</span><br><span class="line">Slave queue ID: 0</span><br><span class="line">Aggregator ID: 1</span><br><span class="line">Actor Churn State: none</span><br><span class="line">Partner Churn State: none</span><br><span class="line">Actor Churned Count: 0</span><br><span class="line">Partner Churned Count: 0</span><br><span class="line">details actor lacp pdu:</span><br><span class="line">    system priority: 65535</span><br><span class="line">    system mac address: 18:66:da:91:a1:c2</span><br><span class="line">    port key: 15</span><br><span class="line">    port priority: 255</span><br><span class="line">    port number: 2</span><br><span class="line">    port state: 63</span><br><span class="line">details partner lacp pdu:</span><br><span class="line">    system priority: 32768</span><br><span class="line">    system mac address: a0:a3:3b:a8:47:f1</span><br><span class="line">    oper key: 5697</span><br><span class="line">    port priority: 32768</span><br><span class="line">    port number: 24</span><br><span class="line">    port state: 61</span><br><span class="line"></span><br><span class="line">$ uname -r</span><br><span class="line">3.10.0-1062.18.1.el7.x86_64</span><br></pre></td></tr></table></figure>

<h3 id="Network-syscall-performance"><a href="#Network-syscall-performance" class="headerlink" title="Network syscall performance"></a>Network syscall performance</h3><h4 id="net-rx-action"><a href="#net-rx-action" class="headerlink" title="net_rx_action"></a>net_rx_action</h4><h5 id="default-config"><a href="#default-config" class="headerlink" title="default config"></a>default config</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   nsecs               : count     distribution</span><br><span class="line">     0 -&gt; 1          : 0        |                                        |</span><br><span class="line">     2 -&gt; 3          : 0        |                                        |</span><br><span class="line">     4 -&gt; 7          : 0        |                                        |</span><br><span class="line">     8 -&gt; 15         : 0        |                                        |</span><br><span class="line">    16 -&gt; 31         : 0        |                                        |</span><br><span class="line">    32 -&gt; 63         : 0        |                                        |</span><br><span class="line">    64 -&gt; 127        : 0        |                                        |</span><br><span class="line">   128 -&gt; 255        : 194      |                                        |</span><br><span class="line">   256 -&gt; 511        : 69595    |**                                      |</span><br><span class="line">   512 -&gt; 1023       : 166594   |******                                  |</span><br><span class="line">  1024 -&gt; 2047       : 1073825  |****************************************|</span><br><span class="line">  2048 -&gt; 4095       : 1060807  |*************************************** |</span><br><span class="line">  4096 -&gt; 8191       : 365389   |*************                           |</span><br><span class="line">  8192 -&gt; 16383      : 35479    |*                                       |</span><br><span class="line"> 16384 -&gt; 32767      : 3227     |                                        |</span><br><span class="line"> 32768 -&gt; 65535      : 64       |                                        |</span><br><span class="line"> 65536 -&gt; 131071     : 1        |                                        |</span><br><span class="line">131072 -&gt; 262143     : 0        |                                        |</span><br><span class="line">262144 -&gt; 524287     : 0        |                                        |</span><br><span class="line">524288 -&gt; 1048575    : 208      |                                        |</span><br></pre></td></tr></table></figure>

<h5 id="default-config-and-set-the-maxinum-ring-buffer"><a href="#default-config-and-set-the-maxinum-ring-buffer" class="headerlink" title="default config and set the maxinum ring buffer"></a>default config and set the maxinum ring buffer</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">nsecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 0        |                                        |</span><br><span class="line">         2 -&gt; 3          : 0        |                                        |</span><br><span class="line">         4 -&gt; 7          : 0        |                                        |</span><br><span class="line">         8 -&gt; 15         : 0        |                                        |</span><br><span class="line">        16 -&gt; 31         : 0        |                                        |</span><br><span class="line">        32 -&gt; 63         : 0        |                                        |</span><br><span class="line">        64 -&gt; 127        : 0        |                                        |</span><br><span class="line">       128 -&gt; 255        : 981      |                                        |</span><br><span class="line">       256 -&gt; 511        : 360423   |**                                      |</span><br><span class="line">       512 -&gt; 1023       : 826344   |******                                  |</span><br><span class="line">      1024 -&gt; 2047       : 5415487  |****************************************|</span><br><span class="line">      2048 -&gt; 4095       : 5400175  |*************************************** |</span><br><span class="line">      4096 -&gt; 8191       : 1886042  |*************                           |</span><br><span class="line">      8192 -&gt; 16383      : 228200   |*                                       |</span><br><span class="line">     16384 -&gt; 32767      : 17444    |                                        |</span><br><span class="line">     32768 -&gt; 65535      : 685      |                                        |</span><br><span class="line">     65536 -&gt; 131071     : 0        |                                        |</span><br><span class="line">    131072 -&gt; 262143     : 0        |                                        |</span><br><span class="line">    262144 -&gt; 524287     : 0        |                                        |</span><br><span class="line">    524288 -&gt; 1048575    : 1132     |                                        |</span><br></pre></td></tr></table></figure>
<h5 id="modify-sysctl-conf-and-the-default-ring-buffer"><a href="#modify-sysctl-conf-and-the-default-ring-buffer" class="headerlink" title="modify sysctl.conf and the default ring buffer"></a>modify sysctl.conf and the default ring buffer</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">     nsecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 0        |                                        |</span><br><span class="line">         2 -&gt; 3          : 0        |                                        |</span><br><span class="line">         4 -&gt; 7          : 0        |                                        |</span><br><span class="line">         8 -&gt; 15         : 0        |                                        |</span><br><span class="line">        16 -&gt; 31         : 0        |                                        |</span><br><span class="line">        32 -&gt; 63         : 0        |                                        |</span><br><span class="line">        64 -&gt; 127        : 0        |                                        |</span><br><span class="line">       128 -&gt; 255        : 277      |                                        |</span><br><span class="line">       256 -&gt; 511        : 359712   |****                                    |</span><br><span class="line">       512 -&gt; 1023       : 2159666  |*****************************           |</span><br><span class="line">      1024 -&gt; 2047       : 1922971  |**************************              |</span><br><span class="line">      2048 -&gt; 4095       : 2900044  |****************************************|</span><br><span class="line">      4096 -&gt; 8191       : 867530   |***********                             |</span><br><span class="line">      8192 -&gt; 16383      : 98313    |*                                       |</span><br><span class="line">     16384 -&gt; 32767      : 4252     |                                        |</span><br><span class="line">     32768 -&gt; 65535      : 126      |                                        |</span><br><span class="line">     65536 -&gt; 131071     : 9        |                                        |</span><br><span class="line">    131072 -&gt; 262143     : 0        |                                        |</span><br><span class="line">    262144 -&gt; 524287     : 0        |                                        |</span><br><span class="line">    524288 -&gt; 1048575    : 1476     |                                        |</span><br><span class="line">   1048576 -&gt; 2097151    : 1        |                                        |</span><br><span class="line">Detaching...</span><br><span class="line"></span><br><span class="line">Average:        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class="line">Average:        bond0 375553.38 374625.60 2487152.11 2487119.93      0.00      0.00      2.04</span><br><span class="line">Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:          em3      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:          em1 194263.43 193304.15 1286454.93 1286414.18      0.00      0.00      1.05</span><br><span class="line">Average:          em4      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:          em2 181289.94 181321.45 1200697.18 1200705.74      0.00      0.00      0.98</span><br><span class="line"></span><br><span class="line">Average:     atmptf/s  estres/s retrans/s isegerr/s   orsts/s</span><br><span class="line">Average:         0.00      0.00      1.27      0.00      0.00</span><br></pre></td></tr></table></figure>

<h5 id="modify-sysctl-conf-and-the-maxinum-ring-buffer"><a href="#modify-sysctl-conf-and-the-maxinum-ring-buffer" class="headerlink" title="modify sysctl.conf and the maxinum ring buffer"></a>modify sysctl.conf and the maxinum ring buffer</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">./funclatency net_rx_action</span><br><span class="line">Tracing 1 <span class="built_in">functions</span> <span class="keyword">for</span> <span class="string">&quot;net_rx_action&quot;</span>... Hit Ctrl-C to end.</span><br><span class="line">^C</span><br><span class="line">     nsecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 0        |                                        |</span><br><span class="line">         2 -&gt; 3          : 0        |                                        |</span><br><span class="line">         4 -&gt; 7          : 0        |                                        |</span><br><span class="line">         8 -&gt; 15         : 0        |                                        |</span><br><span class="line">        16 -&gt; 31         : 0        |                                        |</span><br><span class="line">        32 -&gt; 63         : 0        |                                        |</span><br><span class="line">        64 -&gt; 127        : 0        |                                        |</span><br><span class="line">       128 -&gt; 255        : 359      |                                        |</span><br><span class="line">       256 -&gt; 511        : 629512   |********                                |</span><br><span class="line">       512 -&gt; 1023       : 2571487  |********************************        |</span><br><span class="line">      1024 -&gt; 2047       : 2720136  |**********************************      |</span><br><span class="line">      2048 -&gt; 4095       : 3120474  |****************************************|</span><br><span class="line">      4096 -&gt; 8191       : 657204   |********                                |</span><br><span class="line">      8192 -&gt; 16383      : 114649   |*                                       |</span><br><span class="line">     16384 -&gt; 32767      : 7222     |                                        |</span><br><span class="line">     32768 -&gt; 65535      : 177      |                                        |</span><br><span class="line">     65536 -&gt; 131071     : 12       |                                        |</span><br><span class="line">    131072 -&gt; 262143     : 0        |                                        |</span><br><span class="line">    262144 -&gt; 524287     : 0        |                                        |</span><br><span class="line">    524288 -&gt; 1048575    : 2070     |                                        |</span><br><span class="line">   1048576 -&gt; 2097151    : 3        |                                        |</span><br><span class="line">Detaching...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Average:        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class="line">Average:        bond0 363638.62 362216.28 2404216.56 2404239.59      0.00      0.00      2.00</span><br><span class="line">Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:          em3      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:          em1 182095.82 181514.64 1202063.97 1202059.47      0.00      0.00      1.02</span><br><span class="line">Average:          em4      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:          em2 181542.80 180701.64 1202152.59 1202180.12      0.00      0.00      0.99</span><br><span class="line"></span><br><span class="line">Average:     atmptf/s  estres/s retrans/s isegerr/s   orsts/s</span><br><span class="line">Average:         0.00      0.00      1.02      0.00      0.00</span><br><span class="line"></span><br><span class="line">again</span><br><span class="line">./funclatency net_rx_action</span><br><span class="line">Tracing 1 <span class="built_in">functions</span> <span class="keyword">for</span> <span class="string">&quot;net_rx_action&quot;</span>... Hit Ctrl-C to end.</span><br><span class="line">^C</span><br><span class="line">     nsecs               : count     distribution</span><br><span class="line">         0 -&gt; 1          : 0        |                                        |</span><br><span class="line">         2 -&gt; 3          : 0        |                                        |</span><br><span class="line">         4 -&gt; 7          : 0        |                                        |</span><br><span class="line">         8 -&gt; 15         : 0        |                                        |</span><br><span class="line">        16 -&gt; 31         : 0        |                                        |</span><br><span class="line">        32 -&gt; 63         : 0        |                                        |</span><br><span class="line">        64 -&gt; 127        : 0        |                                        |</span><br><span class="line">       128 -&gt; 255        : 1251     |                                        |</span><br><span class="line">       256 -&gt; 511        : 1054301  |*********                               |</span><br><span class="line">       512 -&gt; 1023       : 4311900  |*************************************   |</span><br><span class="line">      1024 -&gt; 2047       : 4468684  |**************************************  |</span><br><span class="line">      2048 -&gt; 4095       : 4609367  |****************************************|</span><br><span class="line">      4096 -&gt; 8191       : 902735   |*******                                 |</span><br><span class="line">      8192 -&gt; 16383      : 156803   |*                                       |</span><br><span class="line">     16384 -&gt; 32767      : 14726    |                                        |</span><br><span class="line">     32768 -&gt; 65535      : 313      |                                        |</span><br><span class="line">     65536 -&gt; 131071     : 23       |                                        |</span><br><span class="line">    131072 -&gt; 262143     : 1        |                                        |</span><br><span class="line">    262144 -&gt; 524287     : 1        |                                        |</span><br><span class="line">    524288 -&gt; 1048575    : 3230     |                                        |</span><br><span class="line">   1048576 -&gt; 2097151    : 2        |                                        |</span><br><span class="line">Detaching...</span><br></pre></td></tr></table></figure>

<h5 id="the-sysctl-conf"><a href="#the-sysctl-conf" class="headerlink" title="the sysctl.conf"></a>the sysctl.conf</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_fastopen=3</span><br><span class="line">vm.min_free_kbytes=270336</span><br><span class="line">kernel.numa_balancing=0</span><br><span class="line">fs.pipe-max-size=104857600</span><br><span class="line">net.core.busy_poll = 50</span><br><span class="line">net.core.busy_read = 50</span><br><span class="line">kernel.sched_migration_cost_ns=5000000</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/07/22/network-benchmark-result/" data-id="ckg0we46k001ja1o6hc2zf9ez" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bcc/" rel="tag">bcc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/network/" rel="tag">network</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test/" rel="tag">test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mdadm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/01/mdadm/" class="article-date">
  <time datetime="2020-06-01T04:40:20.000Z" itemprop="datePublished">2020-06-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mdraid/">mdraid</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/01/mdadm/">backup the mdraid info</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="How-to-backup-mdraid-info-by-dd"><a href="#How-to-backup-mdraid-info-by-dd" class="headerlink" title="How to backup mdraid info by dd"></a><a target="_blank" rel="noopener" href="https://raid.wiki.kernel.org/index.php/RAID_superblock_formats">How to backup mdraid info by dd</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">md8 : active raid1 sde1[1] sda1[0]</span><br><span class="line">      468717568 blocks super 1.2 [2/2] [UU]</span><br><span class="line">      bitmap: 0/4 pages [0KB], 65536KB chunk</span><br><span class="line"></span><br><span class="line">$ dd <span class="keyword">if</span>=/dev/sda1 of=./sda1 bs=1M count=1</span><br><span class="line"></span><br><span class="line">$ hexdump -C sda1 | head -n 20</span><br><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">Per-Array Identification &amp; Configuration area:16 Bytes</span><br><span class="line">                                                  0xc~0xf: padding block 0 </span><br><span class="line">00001000  <span class="built_in">fc</span> 4e 2b a9 01 00 00 00      01 00 00 00 00 00 00 00  |.N+.............|</span><br><span class="line">Magic num: a92b4efc Major version:1    0x8~0xb bit fearure_map:value 1 offset 0  raid map is used</span><br><span class="line">                                                   value 2 offset 1  raid recovery is progress</span><br><span class="line">                                                   value 4 offset 2 raid reshape is <span class="keyword">in</span> progress</span><br><span class="line">                                                   the others: undefined/reserved</span><br><span class="line"></span><br><span class="line">section: Per-Array Identification &amp; Configuration area 84 Bytes  </span><br><span class="line">          &lt;----------------------uuid--------------------&gt; 0x10-0x1f 16</span><br><span class="line">00001010  cb df 6a 02 54 1a 01 76  9b 9c 29 fe ab 08 8c a0  |..j.T..v..).....|</span><br><span class="line">/dev/sda1: UUID=<span class="string">&quot;cbdf6a02-541a-0176-9b9c-29feab088ca0&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;--------------------------name <span class="keyword">for</span> the array------------&gt; 0x20-0x3f 32</span><br><span class="line">00001020  74 65 73 74 2d 74 65 73  74 2d 61 31 31 2d 32 2e  |test-test-a11-2.|</span><br><span class="line">00001030  74 65 73 74 2e 73 7a 2e  68 70 63 3a 38 00 00 00  |test.sz.hpc:8...|</span><br><span class="line"></span><br><span class="line">ctime(lower 40bit are secs,high 24 bits are microsecs)</span><br><span class="line">                    |               raid1       0 means left asymmetric</span><br><span class="line">                    |                 |            |</span><br><span class="line">00001040  10 77 cc 5e 00 00 00 00  01 00 00 00 00 00 00 00  |.w.^............|a</span><br><span class="line"></span><br><span class="line">         size of component devices(<span class="keyword">in</span> <span class="comment"># of 512-byte sectors),echo $((16#37e02000))=937435136</span></span><br><span class="line">                     |             chucksize not used <span class="keyword">in</span> raid1,linear,multipath</span><br><span class="line">                     |                  |        raid disk(02 means low bit, only 2 x devs to mirror)</span><br><span class="line">00001050  00 20 e0 37 00 00 00 00  00 00 00 00 02 00 00 00  |. .7............|</span><br><span class="line"></span><br><span class="line">          of sectors after superblock that bitmap starts</span><br><span class="line">               |     </span><br><span class="line">00001060  08 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"></span><br><span class="line">Section: RAID-Reshape In-Process Metadata Storage/Recovery area 28 Bytes</span><br><span class="line">         he new RAID level being reshaped-to</span><br><span class="line">                           |       Next address of the array to reshape</span><br><span class="line">                                              |</span><br><span class="line">00001060              00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">     	change <span class="keyword">in</span> <span class="comment"># of raid disks</span></span><br><span class="line">               |   new layout <span class="keyword">for</span> array</span><br><span class="line">               |           |      New chunk size; padding block</span><br><span class="line">               |           |            |           |</span><br><span class="line">00001070  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Section: This-Component-Device Information area 64Bytes</span><br><span class="line"> the sector <span class="comment"># upon which data starts, sectors in the device that are used for data</span></span><br><span class="line">                     |                        |</span><br><span class="line">00001080  00 08 04 00 00 00 00 00  00 20 e0 37 00 00 00 00  |......... .7....|</span><br><span class="line">of the sector upon <span class="built_in">which</span> this superblock starts</span><br><span class="line">                     |              sectors before this offset (from data_offset) have been recovered</span><br><span class="line">00001090  08 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"></span><br><span class="line">           dev_number</span><br><span class="line">               |      Number of read-errors that were corrected by re-writing</span><br><span class="line">               |           |                uuid</span><br><span class="line">000010a0  00 00 00 00 00 00 00 00  07 a8 e4 bf b5 6f c7 d6  |.............o..|</span><br><span class="line">                   uuid           devflags  Padding block 2(1 bit)</span><br><span class="line">                    |              |  Padding block 2 (7 bit)</span><br><span class="line">000010b0  90 d1 9b 62 bf 89 <span class="built_in">cd</span> e7  00 00 08 00 10 00 00 00  |...b............|</span><br><span class="line"></span><br><span class="line">Section: Array-State Information area 64Btes</span><br><span class="line">Time of last superblock update    Event Count <span class="keyword">for</span> the Array</span><br><span class="line">                     |                        |</span><br><span class="line">000010c0  5a 73 d4 5e 00 00 00 00  e6 05 00 00 00 00 00 00  |Zs.^............|</span><br><span class="line"></span><br><span class="line">      Event Count <span class="keyword">for</span> the Array    sb_csum        max_dev 0x80=128</span><br><span class="line">                     |                  |           |</span><br><span class="line">000010d0  ff ff ff ff ff ff ff ff  cf 29 76 cf 80 00 00 00  |.........)v.....|</span><br><span class="line"></span><br><span class="line">&lt;----32Bytes------------zero---------padding-------------&gt;</span><br><span class="line">000010e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000010f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"></span><br><span class="line">Section: Device-Roles (Positions-in-Array) area</span><br><span class="line">Length: Variable number of bytes (but at least 768 bytes?)</span><br><span class="line">2 Bytes per device <span class="keyword">in</span> the array, including both spare-devices and faulty-devices</span><br><span class="line">*</span><br><span class="line">00001100  00 00 01 00 ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br><span class="line">00001110  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">          of sectors after superblock that bitmap starts</span><br><span class="line">               |</span><br><span class="line">00001060  08 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br></pre></td></tr></table></figure>

<p>In mdraid superblock, you could see bitmap starts at 8 x 512B=4096<br>You could see bitm magic num start at 0x1000=4096</p>
<p>You could see the data update from 0x1200, so you could backup first 4608 Bytes in raid1<br>dd if=/dev/sdb1 of=sdb1_superblock bs=1 count=4608</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00001000  fc 4e 2b a9 01 00 00 00  01 00 00 00 00 00 00 00  |.N+.............|</span><br><span class="line">00001010  a3 00 8f 75 49 1d ee e6  38 e6 cb d0 e5 3b 8b d2  |...uI...8....;..|</span><br><span class="line">00001020  74 65 73 74 2d 74 65 73  74 2d 61 31 31 2d 32 2e  |test-test-a11-2.|</span><br><span class="line">00001030  74 65 73 74 2e 73 7a 2e  68 70 63 3a 30 00 00 00  |test.sz.hpc:0...|</span><br><span class="line">00001040  16 71 cc 5e 00 00 00 00  01 00 00 00 00 00 00 00  |.q.^............|</span><br><span class="line">00001050  00 00 49 ba 00 00 00 00  00 00 00 00 02 00 00 00  |..I.............|</span><br><span class="line">00001060  08 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00001070  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00001080  00 08 04 00 00 00 00 00  00 00 49 ba 00 00 00 00  |..........I.....|</span><br><span class="line">00001090  08 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000010a0  00 00 00 00 00 00 00 00  d5 31 5f 6a c9 58 c2 a0  |.........1_j.X..|</span><br><span class="line">000010b0  55 50 81 dc 35 4b d1 e3  00 00 08 00 10 00 00 00  |UP..5K..........|</span><br><span class="line">000010c0  5a 99 d4 5e 00 00 00 00  0b 0d 00 00 00 00 00 00  |Z..^............|</span><br><span class="line">000010d0  ff ff ff ff ff ff ff ff  b5 64 59 a7 80 00 00 00  |.........dY.....|</span><br><span class="line">000010e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00001100  00 00 01 00 ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br><span class="line">00001110  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br><span class="line">*</span><br><span class="line">00001200  e8 0f a4 c4 ee 8d 1a 13  fd 81 a0 d0 6b ef c3 10  |............k...|</span><br><span class="line">00001210  3f 90 15 39 9d 95 0d 1d  07 32 03 df 28 16 cc 06  |?..9.....2..(...|</span><br><span class="line">00001220  40 e6 dc 82 43 13 36 1e  c8 9c 3b fd f9 00 e5 15  |@...C.6...;.....|</span><br><span class="line">00001230  99 73 43 71 81 a1 b7 19  73 ee 5b 74 8e 3b 65 09  |.sCq....s.[t.;e.|</span><br><span class="line">00001240  ce fd 51 d7 43 6d ca 07  b9 3f 03 7c ff 61 79 1f  |..Q.Cm...?.|.ay.|</span><br><span class="line">00001250  f7 e7 a3 4f 3e 6e be 16  fe fc f8 d5              |...O&gt;n......|</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/01/mdadm/" data-id="ckg0we46i001da1o62278f79u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/block/" rel="tag">block</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/raid/" rel="tag">raid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-syscall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/24/syscall/" class="article-date">
  <time datetime="2020-03-24T08:29:06.000Z" itemprop="datePublished">2020-03-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/others/">others</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/24/syscall/">syscall</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="syscalls"><a href="#syscalls" class="headerlink" title="syscalls"></a>syscalls</h3><p>Get these names from <a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/include/linux/syscalls.h">syscalls.h</a></p>
        
          <p class="article-more-link">
            <a href="/2020/03/24/syscall/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/24/syscall/" data-id="ckg0we470002ha1o660mm3ti3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/calls/" rel="tag">calls</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/posix/" rel="tag">posix</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-system_tools" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/24/system_tools/" class="article-date">
  <time datetime="2020-03-24T08:29:06.000Z" itemprop="datePublished">2020-03-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tools/">tools</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/24/system_tools/">System tools</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="FIO-write"><a href="#FIO-write" class="headerlink" title="FIO write"></a>FIO write</h3><p>if not support fallocate, fio will switch to fadvise64 to write file<br>looks like fadvise64 cause a lot of file system fragment.</p>
<h3 id="10-billion-or-more-files-in-the-posix-filesystem-directory"><a href="#10-billion-or-more-files-in-the-posix-filesystem-directory" class="headerlink" title="10 billion or more files in the posix filesystem directory"></a>10 billion or more files in the posix filesystem directory</h3><p>ls take a long time, maybe three days or more<br>I moidfy form some C demo files just list some files, the program will exit , not full list</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">$ time ./walk /tank/<span class="built_in">test</span>/dir1 1000 | wc -l</span><br><span class="line">1000</span><br><span class="line"></span><br><span class="line">real    0m0.016s</span><br><span class="line">user    0m0.000s</span><br><span class="line">sys     0m0.016s</span><br><span class="line">$ <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">$ time ls /tank/<span class="built_in">test</span>/dir1/ | wc -l</span><br><span class="line">858601</span><br><span class="line"></span><br><span class="line">real    0m3.320s</span><br><span class="line">user    0m2.841s</span><br><span class="line">sys     0m0.476s</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *fullpath;</span><br><span class="line"><span class="keyword">int</span> global_count=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">readfile</span><span class="params">(<span class="keyword">char</span> *k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//printf (&quot;print global_count value: %d\n&quot;,global_count);</span></span><br><span class="line">    DIR * dp;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> * <span class="title">dirrp</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">buf</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    p = fullpath + <span class="built_in">strlen</span>(fullpath);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">-1</span> == lstat(fullpath,&amp;buf))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s[lstat]%s\n&quot;</span>,fullpath,strerror(errno));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(S_ISDIR(buf.st_mode)==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;file: %s \n&quot;</span>,k); <span class="comment">// output file name</span></span><br><span class="line">        global_count--;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;/&#x27;</span> != *(p<span class="number">-1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">	*p++ = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">	*p = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;dir %s:\n&quot;</span>,fullpath); <span class="comment">//output dir name</span></span><br><span class="line">    global_count--;</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> == (dp=opendir(fullpath)))</span><br><span class="line">    &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s[opendir]%s\n&quot;</span>,fullpath,strerror(errno));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">NULL</span> != (dirrp=readdir(dp)))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((global_count &lt;= <span class="number">1</span> ))</span><br><span class="line">           <span class="keyword">goto</span> goout;</span><br><span class="line">	<span class="keyword">if</span>((<span class="built_in">strcmp</span>(dirrp-&gt;d_name,<span class="string">&quot;.&quot;</span>)==<span class="number">0</span>) || (<span class="built_in">strcmp</span>(dirrp-&gt;d_name,<span class="string">&quot;..&quot;</span>)==<span class="number">0</span>))</span><br><span class="line">	    <span class="keyword">continue</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(p,dirrp-&gt;d_name);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="number">0</span> == readfile(p))</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    p[<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( <span class="number">-1</span> == closedir(dp))</span><br><span class="line">    &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s[closedir]%s\n&quot;</span>,fullpath,strerror(errno));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">goout:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Usage:%s &lt;Dir name&gt; &lt;List number&gt;\n&quot;</span>,argv[<span class="number">0</span>]+<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fullpath = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>)*PATH_MAX);</span><br><span class="line">    <span class="built_in">memset</span>(fullpath,<span class="number">0</span>,PATH_MAX);</span><br><span class="line">    global_count=atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">strcpy</span>(fullpath,argv[<span class="number">1</span>]);</span><br><span class="line">    readfile(fullpath);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="C-convert-string-to-number"><a href="#C-convert-string-to-number" class="headerlink" title="C convert string to number"></a>C convert string to number</h5><p>int atoi(const char *nptr);<br>global_count=atoi(argv[2]);</p>
<h5 id="memset"><a href="#memset" class="headerlink" title="memset"></a><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/memset-c-example/">memset</a></h5><p>void *memset(void *ptr, int x, size_t n);<br>// ptr ==&gt; Starting address of memory to be filled<br>// x   ==&gt; Value to be filled<br>// n   ==&gt; Number of bytes to be filled starting<br>//         from ptr to be filled</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C program to demonstrate working of memset() </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span> arr[], <span class="keyword">int</span> n)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) </span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[i]); </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">int</span> arr[n]; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Fill whole array with 0. </span></span><br><span class="line">    <span class="built_in">memset</span>(arr, <span class="number">0</span>, n*<span class="keyword">sizeof</span>(arr[<span class="number">0</span>])); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Array after memset()\n&quot;</span>); </span><br><span class="line">    printArray(arr, n); </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">char</span> str[<span class="number">50</span>] = <span class="string">&quot;GeeksForGeeks is for programming geeks.&quot;</span>; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nBefore memset(): %s\n&quot;</span>, str); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Fill 8 characters starting from str[13] with &#x27;.&#x27; </span></span><br><span class="line">    <span class="built_in">memset</span>(str + <span class="number">13</span>, <span class="string">&#x27;.&#x27;</span>, <span class="number">8</span>*<span class="keyword">sizeof</span>(<span class="keyword">char</span>)); </span><br><span class="line">  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;After memset():  %s&quot;</span>, str); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<h5 id="Some-struct"><a href="#Some-struct" class="headerlink" title="Some struct"></a>Some struct</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/include/dirent.h</span></span><br><span class="line"></span><br><span class="line">/* This is the data <span class="built_in">type</span> of directory stream objects.</span><br><span class="line">   The actual structure is opaque to users.  */</span><br><span class="line">typedef struct __dirstream DIR;</span><br><span class="line"></span><br><span class="line">struct __dirstream   </span><br><span class="line">   &#123;   </span><br><span class="line">    void *__fd;    </span><br><span class="line">    char *__data;    </span><br><span class="line">    int __entry_data;    </span><br><span class="line">    char *__ptr;    </span><br><span class="line">    int __entry_ptr;    </span><br><span class="line">    size_t __allocation;    </span><br><span class="line">    size_t __size;    </span><br><span class="line">    __libc_lock_define (, __lock)    </span><br><span class="line">   &#125;; </span><br><span class="line"></span><br><span class="line">struct dirent   </span><br><span class="line">&#123;   </span><br><span class="line"> long d_ino; /* inode number */</span><br><span class="line"> off_t d_off; /* offset to this dirent */</span><br><span class="line"> unsigned short d_reclen; /* length of this d_name */</span><br><span class="line"> unsigned char d_type; /* the <span class="built_in">type</span> of d_name */</span><br><span class="line">long d_ino; / char d_name [NAME_MAX+1]; /* file name (null-terminated) */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># /usr/include/asm/stat.h</span></span><br><span class="line"><span class="comment">#define STAT64_HAS_BROKEN_ST_INO        1</span></span><br><span class="line"></span><br><span class="line">/* This matches struct stat64 <span class="keyword">in</span> glibc2.1, hence the absolutely</span><br><span class="line"> * insane amounts of padding around dev_t<span class="string">&#x27;s.</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">struct stat64 &#123;</span></span><br><span class="line"><span class="string">        unsigned long long      st_dev;</span></span><br><span class="line"><span class="string">        unsigned char   __pad0[4];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned long   __st_ino;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned int    st_mode;</span></span><br><span class="line"><span class="string">        unsigned int    st_nlink;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned long   st_uid;</span></span><br><span class="line"><span class="string">        unsigned long   st_gid;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned long long      st_rdev;</span></span><br><span class="line"><span class="string">        unsigned char   __pad3[4];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        long long       st_size;</span></span><br><span class="line"><span class="string">        unsigned long   st_blksize;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        /* Number 512-byte blocks allocated. */</span></span><br><span class="line"><span class="string">        unsigned long long      st_blocks;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned long   st_atime;</span></span><br><span class="line"><span class="string">        unsigned long   st_atime_nsec;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned long   st_mtime;</span></span><br><span class="line"><span class="string">        unsigned int    st_mtime_nsec;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned long   st_ctime;</span></span><br><span class="line"><span class="string">        unsigned long   st_ctime_nsec;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        unsigned long long      st_ino;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/* We don&#x27;</span>t need to memset the whole thing just to initialize the padding */</span><br><span class="line"><span class="comment">#define INIT_STRUCT_STAT64_PADDING(st) do &#123;             \</span></span><br><span class="line">        memset(&amp;st.__pad0, 0, sizeof(st.__pad0));       \</span><br><span class="line">        memset(&amp;st.__pad3, 0, sizeof(st.__pad3));       \</span><br><span class="line">&#125; <span class="keyword">while</span> (0)</span><br><span class="line"></span><br><span class="line"><span class="comment">#else /* __i386__ */</span></span><br><span class="line"></span><br><span class="line">struct <span class="built_in">stat</span> &#123;</span><br><span class="line">        unsigned long   st_dev;</span><br><span class="line">        unsigned long   st_ino;</span><br><span class="line">        unsigned long   st_nlink;</span><br><span class="line"></span><br><span class="line">        unsigned int    st_mode;</span><br><span class="line">        unsigned int    st_uid;</span><br><span class="line">        unsigned int    st_gid;</span><br><span class="line">        unsigned int    __pad0;</span><br><span class="line">        unsigned long   st_rdev;</span><br><span class="line">        long            st_size;</span><br><span class="line">        long            st_blksize;</span><br><span class="line">        long            st_blocks;      /* Number 512-byte blocks allocated. */</span><br><span class="line"></span><br><span class="line">        unsigned long   st_atime;</span><br><span class="line">        unsigned long   st_atime_nsec;</span><br><span class="line">        unsigned long   st_mtime;</span><br><span class="line">        unsigned long   st_mtime_nsec;</span><br><span class="line">        unsigned long   st_ctime;</span><br><span class="line">        unsigned long   st_ctime_nsec;</span><br><span class="line">        long            __unused[3];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="lstat"><a href="#lstat" class="headerlink" title="lstat"></a><a target="_blank" rel="noopener" href="http://codewiki.wikidot.com/c:system-calls:lstat">lstat</a></h5><p>int lstat(const char *path, struct stat *buf);<br>lstat is a system call that is used to determine information about a file based on its filename.<br>lstat is exactly the same as the stat system call. The only difference between the two is when the filename refers to a link. When this is the case, lstat returns information about the link itself, whereas stat returns information about the actual file.    </p>
<p>const char *path    The file path of the file that is being inquired. This can be both relative and absolute.<br>struct stat *buf    A structure where data about the file will be stored. A detailed look at all of the fields in this structure can be found in the struct stat page.<br>return value    Returns a negative value on failure.</p>
<h5 id="File-type"><a href="#File-type" class="headerlink" title="File type"></a>File type</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">/usr/include/linux/stat.h</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFMT  00170000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFSOCK 0140000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFLNK  0120000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFREG  0100000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFBLK  0060000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFDIR  0040000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFCHR  0020000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IFIFO  0010000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISUID  0004000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISGID  0002000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISVTX  0001000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISLNK(m)      (((m) &amp; S_IFMT) == S_IFLNK) # is link ?</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISREG(m)      (((m) &amp; S_IFMT) == S_IFREG) # is file ? </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISDIR(m)      (((m) &amp; S_IFMT) == S_IFDIR) # is dir ? # S_ISDIR(buf.st_mode)==1 means is dir,  ==0 means not dir</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISCHR(m)      (((m) &amp; S_IFMT) == S_IFCHR) # is char ?</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISBLK(m)      (((m) &amp; S_IFMT) == S_IFBLK) # is blk ?</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISFIFO(m)     (((m) &amp; S_IFMT) == S_IFIFO) # is fifo ? </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_ISSOCK(m)     (((m) &amp; S_IFMT) == S_IFSOCK) # is socket ?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Here is the permission bit</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IRWXU 00700</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IRUSR 00400</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IWUSR 00200</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IXUSR 00100</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IRWXG 00070</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IRGRP 00040</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IWGRP 00020</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IXGRP 00010</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IRWXO 00007</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IROTH 00004</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IWOTH 00002</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_IXOTH 00001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> abc;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">buf</span>;</span></span><br><span class="line">    stat(<span class="string">&quot;/home&quot;</span>, &amp;buf);</span><br><span class="line">    abc = buf.st_mode &amp; S_IFDIR;</span><br><span class="line">    <span class="keyword">if</span>(abc == S_IFDIR) </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;It&#x27;s a directory.\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span> you could </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(S_ISDIR(buf.st_mode)==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;file: %s \n&quot;</span>,k); <span class="comment">// output file name</span></span><br><span class="line">    global_count--;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/24/system_tools/" data-id="ckg0we472002la1o6gydd7f94" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/system/" rel="tag">system</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-benchmark-tools" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/17/benchmark-tools/" class="article-date">
  <time datetime="2020-03-17T09:06:14.000Z" itemprop="datePublished">2020-03-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/benchmark/">benchmark</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/17/benchmark-tools/">bencharmk tools</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="stress-ng"><a href="#stress-ng" class="headerlink" title="stress-ng"></a>stress-ng</h3><h4 id="filesystem"><a href="#filesystem" class="headerlink" title="filesystem"></a>filesystem</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bogo ops/s (real time) is the value of system performance</span></span><br><span class="line"></span><br><span class="line">$ stress-ng  --hdd 16 --hdd-opts rd-rnd --hdd-opts wr-rnd --hdd-opts fadv-rnd --hdd-write-size 128k --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line">stress-ng: info:  [67477] dispatching hogs: 16 hdd</span><br><span class="line">stress-ng: info:  [67477] successful run completed <span class="keyword">in</span> 60.17s (1 min, 0.17 secs)</span><br><span class="line">stress-ng: info:  [67477] stressor       bogo ops real time  usr time  sys time   bogo ops/s   bogo ops/s</span><br><span class="line">stress-ng: info:  [67477]                           (secs)    (secs)    (secs)   (real time) (usr+sys time)</span><br><span class="line">stress-ng: info:  [67477] hdd            19033866     60.12    381.16    575.50    316618.18     19896.17</span><br><span class="line">stress-ng: info:  [67477] <span class="keyword">for</span> a 60.17s run time:</span><br><span class="line">stress-ng: info:  [67477]     962.79s available CPU time</span><br><span class="line">stress-ng: info:  [67477]     381.24s user time   ( 39.60%)</span><br><span class="line">stress-ng: info:  [67477]     575.57s system time ( 59.78%)</span><br><span class="line">stress-ng: info:  [67477]     956.81s total time  ( 99.38%)</span><br><span class="line">stress-ng: info:  [67477] load average: 11.29 4.72 1.86</span><br><span class="line"></span><br><span class="line"><span class="comment"># meta</span></span><br><span class="line">$ stress-ng --sequential 16 --class filesystem --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line">stress-ng: info:  [27612] apparmor stressor will be skipped, AppArmor is not available</span><br><span class="line">stress-ng: info:  [27612] dispatching hogs: 16 <span class="built_in">chdir</span>, 16 chmod, 16 chown, 16 copy-file, 16 dentry, 16 dir, 16 dirdeep, 16 dnotify, 16 dup, 16 eventfd, 16 fallocate, 16 fanotify, 16 fcntl, 16 fiemap, 16 filename, 16 flock, 16 fstat, 16 getdent, 16 handle, 16 inotify, 16 io, 16 iomix, 16 ioprio, 16 lease, 16 link, 16 locka, 16 lockf, 16 lockofd, 16 mknod, 16 open, 16 procfs, 16 rename, 16 symlink, 16 sync-file, 16 utime, 16 xattr</span><br><span class="line"></span><br><span class="line"><span class="comment">#syscall test, no real IO</span></span><br><span class="line">$ stress-ng --<span class="built_in">chdir</span> 8 --chmod 8 --chown 8 --fcntl 8 --filename 8 --flock 8 --fstat 8 --getdent 8 --handle 8 --io 8 -- lockf 8 --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># parallel running</span></span><br><span class="line"><span class="comment"># if you want test IO performance, got the high IO loading from these.</span></span><br><span class="line">$ stress-ng --fallocate 8 --xattr 8 --dir 8 --mknod 8 --symlink 8 --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># a lot of NFS not support xattr</span></span><br><span class="line">$ stress-ng --fallocate 8 --dir 8 --mknod 8 --symlink 8 --timeout 60 --<span class="built_in">times</span> --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># the high IO loading test could got the high IOPS in ext4 with SATA SSD</span></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sdb               0.00 100284.00    0.00 15955.50     0.00   452.52    58.08    97.34    6.05    0.00    6.05   0.06  95.05</span><br></pre></td></tr></table></figure>

<h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --cpu <span class="variable">$cores_num</span> --timeout 900</span><br></pre></td></tr></table></figure>

<h4 id="MEM"><a href="#MEM" class="headerlink" title="MEM"></a>MEM</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --vm 4 --timeout 900s</span><br><span class="line">$ stress-ng --vm-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.9;&#125;&#x27;</span> &lt; /proc/meminfo)k --vm-keep -m 1 -t 30s --metrics-brief</span><br><span class="line">$ stress-ng --mincore 5 --mincore-random --malloc 2 --malloc-bytes 10g --mremap 2 --mremap-bytes 10g --memfd 2 --memfd-bytes 10g --vm-bytes 10g -m 2  -t 600s --metrics-brief</span><br></pre></td></tr></table></figure>

<h4 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --mq 0 -t 30s --<span class="built_in">times</span>  --metrics-brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># The matrix stressor is a good way to exercise the CPU floating point operations as well as memory and processor data cache. Of all the tests, this one generally heats x86 CPUs the best.</span></span><br><span class="line">$ stress-ng --matrix 0 -t 1m --<span class="built_in">times</span> --metrics-brief</span><br></pre></td></tr></table></figure>

<h4 id="mix"><a href="#mix" class="headerlink" title="mix"></a>mix</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --cpu 2 --matrix 1 --mq 3</span><br><span class="line">$ stress-ng --all 2</span><br><span class="line"></span><br><span class="line">$ stress-ng --seq 1 -x numa,matrix,hdd</span><br><span class="line"><span class="comment">#        --sequential N</span></span><br><span class="line">sequentially run all the stressors one by one <span class="keyword">for</span> a default of 60 seconds. The number of instances of each of the individual stressors to be started is N.  If N  is  less than  zero, <span class="keyword">then</span> the number of CPUs online is used <span class="keyword">for</span> the number of instances.  If N is zero, <span class="keyword">then</span> the number of CPUs <span class="keyword">in</span> the system is used.  Use the --timeout option to specify the duration to run each stressor.</span><br></pre></td></tr></table></figure>

<h4 id="the-others-test"><a href="#the-others-test" class="headerlink" title="the others test"></a>the others test</h4><p>$ stress-ng seq 1 -x nuam, sched fifo  -t 30s times metrics-brief<br>$ stress-ng vm 16 vm-bytes 90% -t 1h metrics-brief<br>$ stress-ng cpu 8 cpu-ops 800000<br>$ stress-ng cpu 4 cpu-method fft cpu-ops 10000 metrics-brief<br>$ stress-ng cpu 0 cpu-method all -t 1h<br>$ stress-ng random 64<br>#run 64 stressors that are randomly chosen from all the available stressors.</p>
<p>$ stress-ng cpu 64 cpu-method all verify -t 10m metrics-brief<br>#run 64 instances of all the different cpu stressors and verify that the computations are correct for 10 minutes with a bogo operations summary at the end.</p>
<p>$ stress-ng sequential 8 class io -t 5m times</p>
<h1 id="run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run"><a href="#run-all-the-stressors-in-the-io-class-one-by-one-for-5-minutes-each-with-8-instances-of-each-stressor-running-concurrently-and-show-overall-time-utilisation-statistics-at-the-end-of-the-run" class="headerlink" title="run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run."></a>run  all  the stressors in the io class one by one for 5 minutes each, with 8 instances of each stressor running concurrently and show overall time utilisation statistics at the end of the run.</h1><p>$ stress-ng all 0 maximize aggressive<br>#run all the stressors (1 instance of each per CPU) simultaneously, maximize the settings (memory sizes, file allocations, etc.) and select the  most  demanding/aggressive options.</p>
<p>$        stress-ng sequential 4 class vm exclude bigheap,brk,stack<br>#run 4 instances of the VM stressors one after each other, excluding the bigheap, brk and stack stressors</p>
<p>$ stress-ng taskset 0,2-3 cpu 3<br>#run 3 instances of the CPU stressor and pin them to CPUs 0, 2 and 3.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### cpu-cache</span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">$ stress-ng --sequential 8 --class cpu-cache -t 5m</span><br><span class="line">stress-ng: info:  [13341] apparmor stressor will be skipped, AppArmor is not available</span><br><span class="line">stress-ng: info:  [13341] dispatching hogs: 8 bsearch, 8 cache, 8 heapsort, 8 hsearch, 8 icache, 8 lockbus, 8 lsearch, 8 malloc, 8 matrix, 8 membarrier, 8 memcpy, 8 mergesort, 8 qsort, 8 str, 8 stream, 8 tsearch, 8 vecmath, 8 wcs, 8 zlib</span><br><span class="line"></span><br><span class="line">$ stress-ng --cpu 4 --cache-level 2 --cache-ways 4 -t 30s --metrics-brief</span><br><span class="line">$ stress-ng --cpu 4 --cache-level 3 --cache-ways 4 -t 30s --metrics-brief</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ stress-ng --all 0 --class cpu-cache -t 5m --metrics-brief</span><br></pre></td></tr></table></figure>

<h5 id="cpu-method"><a href="#cpu-method" class="headerlink" title="cpu-method"></a>cpu-method</h5><p>$ stress-ng cpu 1 cpu-method matrixprod -t 1m metrics-brief<br>$ for m in double longdouble matrixprod nsqrt cfloat clongdouble decimal32 decimal128 explog bitops ln2 int64 int128 ackermann int128decimal128 gray euler fibonacci; do stress-ng cpu 0 cpu-method $m -t 10s metrics-brief; done</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"># float</span><br><span class="line">double           1000 iterations of a mix of double precision floating point operations</span><br><span class="line">longdouble       1000 iterations of a mix of long double precision floating point operations</span><br><span class="line">matrixprod       matrix  product  of  two  128  128 matrices of double floats. Testing on 64 bit x86 hardware shows that this is provides a good mix of memory, cache and floating point operations and is probably the best CPU method to use to make a CPU run hot.</span><br><span class="line">nsqrt            compute sqrt() of long doubles using Newton-Raphson</span><br><span class="line">cfloat           1000 iterations of a mix of floating point complex operations</span><br><span class="line">clongdouble      1000 iterations of a mix of long double floating point complex operations</span><br><span class="line">decimal32        1000 iterations of a mix of 32 bit decimal floating point operations (GCC only)</span><br><span class="line">decimal128       1000 iterations of a mix of 128 bit decimal floating point operations (GCC only)</span><br><span class="line">explog           iterate on n &#x3D; exp(log(n)  1.00002)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#int</span><br><span class="line">int64            1000 iterations of a mix of 64 bit integer operations</span><br><span class="line">int128           1000 iterations of a mix of 128 bit integer operations (GCC only)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------performance test--------------------------</span><br><span class="line">#logic</span><br><span class="line">jmp              Simple unoptimised compare &gt;, &lt;, &#x3D;&#x3D; and jmp branching</span><br><span class="line">ackermann        Ackermann function: compute A(3, 10), where:</span><br><span class="line">                 A(m, n) &#x3D; n + 1 if m &#x3D; 0;</span><br><span class="line">                 A(m - 1, 1) if m &gt; 0 and n &#x3D; 0;</span><br><span class="line">                 A(m - 1, A(m, n - 1)) if m &gt; 0 and n &gt; 0</span><br><span class="line"># bit</span><br><span class="line">bitops           various bit operations from bithack, namely: reverse bits, parity check, bit count, round to nearest power of 2</span><br><span class="line"># int</span><br><span class="line">gray             calculate binary to gray code and gray code back to binary for integers from 0 to 65535 </span><br><span class="line">fibonacci        compute Fibonacci sequence of 0, 1, 1, 2, 5, 8...</span><br><span class="line"></span><br><span class="line">#float</span><br><span class="line">euler            compute e using n &#x3D; (1 + (1  n))  n </span><br><span class="line">ln2              compute ln(2) based on series:</span><br><span class="line">#mix</span><br><span class="line">int128decimal32 1000 iterations of a mix of 128 bit integer and 128 bit decimal floating point operations (GCC only)</span><br><span class="line">#rand hash</span><br><span class="line">djb2a            128 rounds of hash DJB2a (Dan Bernstein hash using the xor variant) on 128 to 1 bytes of random strings</span><br><span class="line">dither           FloydSteinberg dithering of a 1024  768 random image from 8 bits down to 1 bit of depth.</span><br><span class="line">crc16            compute 1024 rounds of CCITT CRC16 on random data</span><br><span class="line"></span><br><span class="line">-----------------------------------END--------------------------</span><br><span class="line"></span><br><span class="line">#C</span><br><span class="line">callfunc         recursively call 8 argument C function to a depth of 1024 calls and unwind</span><br><span class="line"></span><br><span class="line">#random, hash</span><br><span class="line">jenkin        Jenkin&#39;s integer hash on 128 rounds of 128..1 bytes of random data</span><br><span class="line">hanoi         solve a 21 disc Towers of Hanoi stack using the recursive solution</span><br><span class="line">              hamming          compute Hamming H(8,4) codes on 262144 lots of 4 bit data. This turns 4 bit data into 8 bit Hamming code containing 4 parity bits. For data bits  d1..d4,</span><br><span class="line">                               parity bits are computed as:</span><br><span class="line">                                 p1 &#x3D; d2 + d3 + d4</span><br><span class="line">                                 p2 &#x3D; d1 + d3 + d4</span><br><span class="line">                                 p3 &#x3D; d1 + d2 + d4</span><br><span class="line">                                 p4 &#x3D; d1 + d2 + d3</span><br><span class="line">correlate        perform a 16384  1024 correlation of random doubles</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--memthrash-method method</span><br><span class="line">              specify a memthrash stress method. Available memthrash stress methods are described</span><br><span class="line">              as follows:</span><br><span class="line"></span><br><span class="line">              Method           Description</span><br><span class="line">              all              iterate over all the below memthrash methods</span><br><span class="line">              chunk1           memset 1 byte chunks of random data into random locations</span><br><span class="line">              chunk8           memset 8 byte chunks of random data into random locations</span><br><span class="line">              chunk64          memset 64 byte chunks of random data into random locations</span><br><span class="line">              chunk256         memset 256 byte chunks of random data into random locations</span><br><span class="line">              chunkpage        memset page size chunks of random data into random locations</span><br><span class="line">              flip             flip (invert) all bits in ramdom locations</span><br><span class="line">              flush            flush cache line in random locations</span><br><span class="line">              lock             lock randomly choosing locations (Intel x86 CPUs only)</span><br><span class="line">              matrix           treat memory as a 2  2 matrix and swap random elements</span><br><span class="line">              memset           memset the memory with random data</span><br><span class="line">              mfence           stores with write serialization (Intel x86 CPUs only)</span><br><span class="line">              prefetch         prefetch data at random memory locations</span><br><span class="line">              random           randomly  run any of the memthrash methods except for &#39;random&#39; and</span><br><span class="line">                               &#39;all&#39;</span><br><span class="line">              spinread         spin loop read the same random location 2^19 times</span><br><span class="line">              spinwrite        spin loop write the same random location 2^19 times</span><br></pre></td></tr></table></figure>

<h5 id="class"><a href="#class" class="headerlink" title="class"></a>class</h5><p>The stress-ng stressors are grouped together in different classes:</p>
<p>cpu - CPU intensive<br>cpu-cache - stress CPU instruction and/or data caches<br>device - raw device driver stressors<br>io - generic input/output<br>interrupt - high interrupt load generators<br>filesystem - file system activity<br>memory - stack, heap, memory mapping, shared memory stressors<br>network - TCP/IP, UDP and UNIX domain socket stressors<br>os - core kernel stressors<br>pipe - pipe and UNIX socket stressors<br>scheduler - force high levels of context switching<br>security - AppArmor stressor<br>vm - Virtual Memory stressor (paging and memory)</p>
<p>matrix-method method<br>       specify a matrix stress method. Available matrix stress methods are described as follows:</p>
<pre><code>   Method           Description
   all              iterate over all the below matrix stress methods
   add              add two N  N matrices

   copy             copy one N  N matrix to another
   div              divide an N  N matrix by a scalar
   hadamard         Hadamard product of two N  N matrices
   frobenius        Frobenius product of two N  N matrices
   mean             arithmetic mean of two N  N matrices
   mult             multiply an N  N matrix by a scalar
   prod             product of two N  N matrices
   sub              subtract one N  N matrix from another N  N matrix
   trans            transpose an N  N matrix</code></pre>
<h4 id="performance-info"><a href="#performance-info" class="headerlink" title="performance info"></a>performance info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ stress-ng --mq 0 -t 30s --<span class="built_in">times</span> --perf</span><br><span class="line">stress-ng: info:  [68895] dispatching hogs: 16 mq</span><br><span class="line">^Cstress-ng: info:  [68895] unsuccessful run completed <span class="keyword">in</span> 15.95s</span><br><span class="line">stress-ng: info:  [68895] mq:</span><br><span class="line">stress-ng: info:  [68895]            667,942,869,088 CPU Cycles                    41.88 B/sec</span><br><span class="line">stress-ng: info:  [68895]            343,598,563,312 Instructions                  21.54 B/sec (0.514 instr. per cycle)</span><br><span class="line">stress-ng: info:  [68895]              4,273,568,592 Cache References               0.27 B/sec</span><br><span class="line">stress-ng: info:  [68895]                108,195,424 Cache Misses                   6.78 M/sec ( 2.53%)</span><br><span class="line">stress-ng: info:  [68895]             62,069,485,136 Branch Instructions            3.89 B/sec</span><br><span class="line">stress-ng: info:  [68895]              1,391,055,360 Branch Misses                 87.21 M/sec ( 2.24%)</span><br><span class="line">stress-ng: info:  [68895]              4,911,414,496 Bus Cycles                     0.31 B/sec</span><br><span class="line">stress-ng: info:  [68895]            510,787,333,888 Total Cycles                  32.02 B/sec</span><br><span class="line">stress-ng: info:  [68895]                      3,184 Page Faults Minor            199.61 /sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Page Faults Major              0.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                  3,924,080 Context Switches               0.25 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    718,208 CPU Migrations                45.03 K/sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Alignment Faults               0.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                      3,088 Page Faults User             193.60 /sec</span><br><span class="line">stress-ng: info:  [68895]                         96 Page Faults Kernel             6.02 /sec</span><br><span class="line">stress-ng: info:  [68895]                 92,731,952 System Call Enter              5.81 M/sec</span><br><span class="line">stress-ng: info:  [68895]                 92,731,952 System Call Exit               5.81 M/sec</span><br><span class="line">stress-ng: info:  [68895]                 54,434,816 Kmalloc                        3.41 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    399,904 Kmalloc Node                  25.07 K/sec</span><br><span class="line">stress-ng: info:  [68895]                231,994,672 Kfree                         14.54 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    139,904 Kmem Cache Alloc               8.77 K/sec</span><br><span class="line">stress-ng: info:  [68895]                     88,848 Kmem Cache Alloc Node          5.57 K/sec</span><br><span class="line">stress-ng: info:  [68895]                    181,568 Kmem Cache Free               11.38 K/sec</span><br><span class="line">stress-ng: info:  [68895]                     59,856 MM Page Alloc                  3.75 K/sec</span><br><span class="line">stress-ng: info:  [68895]                    158,720 MM Page Free                   9.95 K/sec</span><br><span class="line">stress-ng: info:  [68895]                  8,842,656 RCU Utilization                0.55 M/sec</span><br><span class="line">stress-ng: info:  [68895]                    764,352 Sched Migrate Task            47.92 K/sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Sched Move NUMA                0.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                  6,617,648 Sched Wakeup                   0.41 M/sec</span><br><span class="line">stress-ng: info:  [68895]                         16 Signal Generate                1.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                         80 Signal Deliver                 5.02 /sec</span><br><span class="line">stress-ng: info:  [68895]                        672 IRQ Entry                     42.13 /sec</span><br><span class="line">stress-ng: info:  [68895]                        672 IRQ Exit                      42.13 /sec</span><br><span class="line">stress-ng: info:  [68895]                    664,704 Soft IRQ Entry                41.67 K/sec</span><br><span class="line">stress-ng: info:  [68895]                    664,704 Soft IRQ Exit                 41.67 K/sec</span><br><span class="line">stress-ng: info:  [68895]                         16 Writeback Dirty Inode          1.00 /sec</span><br><span class="line">stress-ng: info:  [68895]                          0 Writeback Dirty Page           0.00 /sec</span><br><span class="line">stress-ng: info:  [68895] <span class="keyword">for</span> a 15.95s run time:</span><br><span class="line">stress-ng: info:  [68895]     255.21s available CPU time</span><br><span class="line">stress-ng: info:  [68895]      25.73s user time   ( 10.08%)</span><br><span class="line">stress-ng: info:  [68895]     181.50s system time ( 71.12%)</span><br><span class="line">stress-ng: info:  [68895]     207.23s total time  ( 81.20%)</span><br><span class="line">stress-ng: info:  [68895] load average: 5.35 1.73 1.08</span><br></pre></td></tr></table></figure>

<h4 id="Verify-mode"><a href="#Verify-mode" class="headerlink" title="Verify mode"></a>Verify mode</h4><p>Some stressors have a verification mode. A stress test is run and the results are checked, if the results are incorrect then stress-ng will flag up a warning error message. Suppose we want to run some exhaustive memory checks on a blob of virtually mapped memory via the vm stressor, enable the verify mode and this will sanity check that the read/write results on the memory:</p>
<p>$ stress-ng vm 1 vm-bytes 2G verify -v<br>Note that not all stressors have a verify mode, and enabling it will reduce the bogo op stats as there is an extra verification step being invoked.</p>
<h4 id="Generating-major-page-faults"><a href="#Generating-major-page-faults" class="headerlink" title="Generating major page faults"></a>Generating major page faults</h4><p>You can generate major page faults (by accessing a page is not loaded in memory at the time of the fault) and see the page fault rate using:<br>$ stress-ng fault 0 perf -t 1m</p>
<p>or with newer kernels use the userfaultfd stressor to force even more major faults:<br>$ stress-ng userfaultfd 0 perf -t 1m</p>
<p>Running timers at high frequency can generate a large interrupt load. The timer stressor with an appropriately selected timer frequency can be used to force many hundreds of thousands of interrupts per second, for example, 32 instances at 1MHz:<br>$ stress-ng timer 32 timer-freq 1000000</p>
<h3 id="test-case"><a href="#test-case" class="headerlink" title="test case"></a>test case</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -------all cores CPU case1:------</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> jmp bitops fibonacci euler ln2 int128decimal32 djb2a crc16; <span class="keyword">do</span> stress-ng --cpu 0 --cpu-method <span class="variable">$m</span> -t 240s --metrics-brief; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> -------4 cores CPU case1:------</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> jmp bitops fibonacci euler ln2 int128decimal32 djb2a crc16; <span class="keyword">do</span> stress-ng --cpu 4 --cpu-method <span class="variable">$m</span> -t 240s --metrics-brief; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> -------mem test1:---------</span><br><span class="line">stress-ng --malloc 1 --malloc-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k  --vm-keep -m 1 --vm-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k --mremap 2 --mremap-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k --memfd 2 --memfd-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.1;&#125;&#x27;</span> /proc/meminfo)k -t 600s --metrics-brief</span><br><span class="line"><span class="built_in">echo</span> -------mem test2:---------</span><br><span class="line">stress-ng --mincore 0 --mincore-random -t 600s --metrics-brief</span><br><span class="line"><span class="built_in">echo</span> -------mem test3:---------</span><br><span class="line">stress-ng --vm-bytes $(awk <span class="string">&#x27;/MemFree/&#123;printf &quot;%d\n&quot;, $2 * 0.9;&#125;&#x27;</span> /proc/meminfo)k --vm-keep -m 1 -t 600s --metrics-brief</span><br></pre></td></tr></table></figure>

<h3 id="Emulate-some-error-to-test-the-block-device"><a href="#Emulate-some-error-to-test-the-block-device" class="headerlink" title="Emulate some error to test the block device"></a>Emulate some error to test the block device</h3><h4 id="dm-delay"><a href="#dm-delay" class="headerlink" title="dm-delay"></a><a target="_blank" rel="noopener" href="https://enodev.fr/posts/emulate-a-slow-block-device-with-dm-delay.html#">dm-delay</a></h4><p>Device-Mappers delay target delays reads and/or writes and maps them to different devices.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$ sudo modprobe brd rd_nr&#x3D;1 rd_size&#x3D;1048576</span><br><span class="line"></span><br><span class="line">[random]</span><br><span class="line">readwrite&#x3D;randread</span><br><span class="line">blocksize&#x3D;4k</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">filename&#x3D;&#x2F;dev&#x2F;ram0</span><br><span class="line">time_based&#x3D;1</span><br><span class="line">runtime&#x3D;10</span><br><span class="line"></span><br><span class="line">DDR 1333</span><br><span class="line">Jobs: 1 (f&#x3D;1): [r(1)][100.0%][r&#x3D;1471MiB&#x2F;s,w&#x3D;0KiB&#x2F;s][r&#x3D;377k,w&#x3D;0 IOPS][eta 00m:00s]</span><br><span class="line">rw: (groupid&#x3D;0, jobs&#x3D;1): err&#x3D; 0: pid&#x3D;13487: Thu Jun  4 22:43:25 2020</span><br><span class="line">   read: IOPS&#x3D;361k, BW&#x3D;1411MiB&#x2F;s (1480MB&#x2F;s)(13.8GiB&#x2F;10001msec)</span><br><span class="line">    clat (nsec): min&#x3D;790, max&#x3D;124854, avg&#x3D;1563.39, stdev&#x3D;935.07</span><br><span class="line">     lat (nsec): min&#x3D;984, max&#x3D;125042, avg&#x3D;1757.85, stdev&#x3D;978.84</span><br><span class="line">    clat percentiles (nsec):</span><br><span class="line">     |  1.00th&#x3D;[ 1240],  5.00th&#x3D;[ 1304], 10.00th&#x3D;[ 1336], 20.00th&#x3D;[ 1368],</span><br><span class="line">     | 30.00th&#x3D;[ 1384], 40.00th&#x3D;[ 1400], 50.00th&#x3D;[ 1432], 60.00th&#x3D;[ 1464],</span><br><span class="line">     | 70.00th&#x3D;[ 1496], 80.00th&#x3D;[ 1560], 90.00th&#x3D;[ 1752], 95.00th&#x3D;[ 2352],</span><br><span class="line">     | 99.00th&#x3D;[ 3376], 99.50th&#x3D;[ 4080], 99.90th&#x3D;[14784], 99.95th&#x3D;[24960],</span><br><span class="line">     | 99.99th&#x3D;[31360]</span><br><span class="line">   bw (  MiB&#x2F;s): min&#x3D; 1004, max&#x3D; 1476, per&#x3D;99.79%, avg&#x3D;1408.26, stdev&#x3D;144.72, samples&#x3D;19</span><br><span class="line">   iops        : min&#x3D;257224, max&#x3D;377934, avg&#x3D;360514.11, stdev&#x3D;37048.52, samples&#x3D;19</span><br><span class="line">  lat (nsec)   : 1000&#x3D;0.01%</span><br><span class="line">  lat (usec)   : 2&#x3D;91.75%, 4&#x3D;7.64%, 10&#x3D;0.49%, 20&#x3D;0.03%, 50&#x3D;0.09%</span><br><span class="line">  lat (usec)   : 100&#x3D;0.01%, 250&#x3D;0.01%</span><br><span class="line">  cpu          : usr&#x3D;27.40%, sys&#x3D;72.48%, ctx&#x3D;954, majf&#x3D;0, minf&#x3D;9</span><br><span class="line">  IO depths    : 1&#x3D;100.0%, 2&#x3D;0.0%, 4&#x3D;0.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     submit    : 0&#x3D;0.0%, 4&#x3D;100.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, 64&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     complete  : 0&#x3D;0.0%, 4&#x3D;100.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, 64&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     issued rwt: total&#x3D;3613043,0,0, short&#x3D;0,0,0, dropped&#x3D;0,0,0</span><br><span class="line">     latency   : target&#x3D;0, window&#x3D;0, percentile&#x3D;100.00%, depth&#x3D;1</span><br><span class="line"></span><br><span class="line">Run status group 0 (all jobs):</span><br><span class="line">   READ: bw&#x3D;1411MiB&#x2F;s (1480MB&#x2F;s), 1411MiB&#x2F;s-1411MiB&#x2F;s (1480MB&#x2F;s-1480MB&#x2F;s), io&#x3D;13.8GiB (14.8GB), run&#x3D;10001-10001msec</span><br><span class="line"></span><br><span class="line"># Create device delaying rw operation for 500ms</span><br><span class="line">$ echo &quot;0 $(blockdev --getsz &#x2F;dev&#x2F;ram0) delay &#x2F;dev&#x2F;ram0 0 500&quot; | dmsetup create delayed</span><br><span class="line">$ ls -l &#x2F;dev&#x2F;mapper&#x2F;delayed </span><br><span class="line">lrwxrwxrwx 1 root root 7 6   4 22:47 &#x2F;dev&#x2F;mapper&#x2F;delayed -&gt; ..&#x2F;dm-0</span><br><span class="line"></span><br><span class="line">[random]</span><br><span class="line">filename&#x3D;&#x2F;dev&#x2F;dm-0</span><br><span class="line">readwrite&#x3D;randread</span><br><span class="line">blocksize&#x3D;4k</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">time_based&#x3D;1</span><br><span class="line">runtime&#x3D;10</span><br><span class="line"></span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f&#x3D;1): [r(1)][100.0%][r&#x3D;8KiB&#x2F;s,w&#x3D;0KiB&#x2F;s][r&#x3D;2,w&#x3D;0 IOPS][eta 00m:00s]</span><br><span class="line">random: (groupid&#x3D;0, jobs&#x3D;1): err&#x3D; 0: pid&#x3D;13873: Thu Jun  4 22:56:44 2020</span><br><span class="line">   read: IOPS&#x3D;1, BW&#x3D;8007B&#x2F;s (8007B&#x2F;s)(80.0KiB&#x2F;10231msec)</span><br><span class="line">    clat (msec): min&#x3D;503, max&#x3D;516, avg&#x3D;511.50, stdev&#x3D; 2.97</span><br><span class="line">     lat (msec): min&#x3D;503, max&#x3D;516, avg&#x3D;511.50, stdev&#x3D; 2.97</span><br><span class="line">    clat percentiles (msec):</span><br><span class="line">     |  1.00th&#x3D;[  506],  5.00th&#x3D;[  506], 10.00th&#x3D;[  510], 20.00th&#x3D;[  510],</span><br><span class="line">     | 30.00th&#x3D;[  514], 40.00th&#x3D;[  514], 50.00th&#x3D;[  514], 60.00th&#x3D;[  514],</span><br><span class="line">     | 70.00th&#x3D;[  514], 80.00th&#x3D;[  514], 90.00th&#x3D;[  514], 95.00th&#x3D;[  518],</span><br><span class="line">     | 99.00th&#x3D;[  518], 99.50th&#x3D;[  518], 99.90th&#x3D;[  518], 99.95th&#x3D;[  518],</span><br><span class="line">     | 99.99th&#x3D;[  518]</span><br><span class="line">   bw (  KiB&#x2F;s): min&#x3D;    8, max&#x3D;    8, per&#x3D;100.00%, avg&#x3D; 8.00, stdev&#x3D; 0.00, samples&#x3D;19</span><br><span class="line">   iops        : min&#x3D;    2, max&#x3D;    2, avg&#x3D; 2.00, stdev&#x3D; 0.00, samples&#x3D;19</span><br><span class="line">  lat (msec)   : 750&#x3D;100.00%</span><br><span class="line">  cpu          : usr&#x3D;0.00%, sys&#x3D;0.02%, ctx&#x3D;20, majf&#x3D;0, minf&#x3D;6</span><br><span class="line">  IO depths    : 1&#x3D;100.0%, 2&#x3D;0.0%, 4&#x3D;0.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     submit    : 0&#x3D;0.0%, 4&#x3D;100.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, 64&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     complete  : 0&#x3D;0.0%, 4&#x3D;100.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, 64&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     issued rwt: total&#x3D;20,0,0, short&#x3D;0,0,0, dropped&#x3D;0,0,0</span><br><span class="line">     latency   : target&#x3D;0, window&#x3D;0, percentile&#x3D;100.00%, depth&#x3D;1</span><br><span class="line"></span><br><span class="line">Run status group 0 (all jobs):</span><br><span class="line">   READ: bw&#x3D;8007B&#x2F;s (8007B&#x2F;s), 8007B&#x2F;s-8007B&#x2F;s (8007B&#x2F;s-8007B&#x2F;s), io&#x3D;80.0KiB (81.9kB), run&#x3D;10231-10231msec</span><br><span class="line"></span><br><span class="line">Disk stats (read&#x2F;write):</span><br><span class="line">    dm-0: ios&#x3D;20&#x2F;0, merge&#x3D;0&#x2F;0, ticks&#x3D;9720&#x2F;0, in_queue&#x3D;10140, util&#x3D;99.14%, aggrios&#x3D;0&#x2F;0, aggrmerge&#x3D;0&#x2F;0, aggrticks&#x3D;0&#x2F;0, aggrin_queue&#x3D;0, aggrutil&#x3D;0.00%</span><br><span class="line">  ram0: ios&#x3D;0&#x2F;0, merge&#x3D;0&#x2F;0, ticks&#x3D;0&#x2F;0, in_queue&#x3D;0, util&#x3D;0.00%</span><br><span class="line"></span><br><span class="line"># Create a block device that delays reads for 500 ms and writes for 300 ms</span><br><span class="line">size&#x3D;$(blockdev --getsize &#x2F;dev&#x2F;ram0) # Size in 512-bytes sectors</span><br><span class="line">$ echo &quot;0 $(blockdev --getsize &#x2F;dev&#x2F;ram0) delay &#x2F;dev&#x2F;ram0 0 500 &#x2F;dev&#x2F;ram0 0 300&quot; | dmsetup create delayed</span><br><span class="line"></span><br><span class="line">$ dmsetup remove &#x2F;dev&#x2F;mapper&#x2F;delayed</span><br></pre></td></tr></table></figure>
<h4 id="dm-linear"><a href="#dm-linear" class="headerlink" title="dm-linear"></a>dm-linear</h4><p>The dm-linear target maps a linear range of blocks of the device-mapper device onto a linear range of a backend device. dm-linear is the basic building block of logical volume managers such as LVM.</p>
<h4 id="dm-flakey"><a href="#dm-flakey" class="headerlink" title="dm-flakey"></a>dm-flakey</h4><p>This target is the same as the linear target except that it exhibits unreliable behaviour periodically.  Its been found useful in simulating failing devices for testing purposes.</p>
<ul>
<li>drop_writes All write I/Os are silently ignored and dropped. Read I/Os are handled correctly.</li>
<li>error_writes All write I/Os are failed with an error signaled. Read I/Os are handled correctly.</li>
<li>corrupt_bio_byte During the down time, replace the Nth byte of the data of each read or write block I/O with a specified value.<br>The default error mode is to fail all I/O requests during the down time of the simulation cycle.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">tabled parameters:</span><br><span class="line">&lt;dev path&gt; &lt;offset&gt; &lt;up interval&gt; &lt;down interval&gt;  [&lt;num_features&gt; [&lt;feature arguments&gt;]]</span><br><span class="line">$ dmsetup create test --table &#39;0 123 flakey &#x2F;dev&#x2F;sda1 0 4 8&#39;</span><br><span class="line">$  file &#x2F;dev&#x2F;mapper&#x2F;dm_test0 </span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;dm_test0: symbolic link to ..&#x2F;dm-0</span><br><span class="line"></span><br><span class="line">[random]</span><br><span class="line">filename&#x3D;&#x2F;dev&#x2F;dm-0</span><br><span class="line">#readwrite&#x3D;randrw</span><br><span class="line">readwrite&#x3D;randread</span><br><span class="line">blocksize&#x3D;4k</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">time_based&#x3D;1</span><br><span class="line">runtime&#x3D;130</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fio-3.1</span><br><span class="line">Starting 1 process</span><br><span class="line">fio: io_u error on file &#x2F;dev&#x2F;dm-0: Input&#x2F;output error: read offset&#x3D;0, buflen&#x3D;4096</span><br><span class="line">random: No I&#x2F;O performed by sync, perhaps try --debug&#x3D;io option for details?</span><br><span class="line">fio: pid&#x3D;16261, err&#x3D;5&#x2F;file:io_u.c:1756, func&#x3D;io_u error, error&#x3D;Input&#x2F;output error</span><br><span class="line"></span><br><span class="line">random: (groupid&#x3D;0, jobs&#x3D;1): err&#x3D; 5 (file:io_u.c:1756, func&#x3D;io_u error, error&#x3D;Input&#x2F;output error): pid&#x3D;16261: Fri Jun  5 00:29:08 2020</span><br><span class="line">  cpu          : usr&#x3D;0.00%, sys&#x3D;0.00%, ctx&#x3D;0, majf&#x3D;0, minf&#x3D;17</span><br><span class="line">  IO depths    : 1&#x3D;100.0%, 2&#x3D;0.0%, 4&#x3D;0.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     submit    : 0&#x3D;0.0%, 4&#x3D;100.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, 64&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     complete  : 0&#x3D;50.0%, 4&#x3D;50.0%, 8&#x3D;0.0%, 16&#x3D;0.0%, 32&#x3D;0.0%, 64&#x3D;0.0%, &gt;&#x3D;64&#x3D;0.0%</span><br><span class="line">     issued rwt: total&#x3D;1,0,0, short&#x3D;0,0,0, dropped&#x3D;0,0,0</span><br><span class="line">     latency   : target&#x3D;0, window&#x3D;0, percentile&#x3D;100.00%, depth&#x3D;1</span><br><span class="line"></span><br><span class="line">Run status group 0 (all jobs):</span><br><span class="line"></span><br><span class="line">Disk stats (read&#x2F;write):</span><br><span class="line">    dm-0: ios&#x3D;0&#x2F;0, merge&#x3D;0&#x2F;0, ticks&#x3D;0&#x2F;0, in_queue&#x3D;0, util&#x3D;0.00%, aggrios&#x3D;0&#x2F;0, aggrmerge&#x3D;0&#x2F;0, aggrticks&#x3D;0&#x2F;0, aggrin_queue&#x3D;0, aggrutil&#x3D;0.00%</span><br><span class="line">  sda: ios&#x3D;0&#x2F;0, merge&#x3D;0&#x2F;0, ticks&#x3D;0&#x2F;0, in_queue&#x3D;0, util&#x3D;0.00%</span><br><span class="line"></span><br><span class="line">[18800.528564] buffer_io_error: 110 callbacks suppressed</span><br><span class="line">[18800.528569] Buffer I&#x2F;O error on dev dm-0, logical block 0, async page read</span><br><span class="line">[18800.528582] Buffer I&#x2F;O error on dev dm-0, logical block 1, async page read</span><br><span class="line">[18800.528587] Buffer I&#x2F;O error on dev dm-0, logical block 2, async page read</span><br><span class="line">[18800.528591] Buffer I&#x2F;O error on dev dm-0, logical block 3, async page read</span><br><span class="line">[18800.528596] Buffer I&#x2F;O error on dev dm-0, logical block 4, async page read</span><br><span class="line">[18800.528600] Buffer I&#x2F;O error on dev dm-0, logical block 5, async page read</span><br><span class="line">[18800.528604] Buffer I&#x2F;O error on dev dm-0, logical block 6, async page read</span><br><span class="line">[18800.528608] Buffer I&#x2F;O error on dev dm-0, logical block 7, async page read</span><br></pre></td></tr></table></figure>
<p>$ dmsetup suspend /dev/dm-0<br>$ dmsetup resume /dev/dm-0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">dm-linear</span><br><span class="line">dm-zoned</span><br><span class="line">(dm-dust)[https:&#x2F;&#x2F;www.kernel.org&#x2F;doc&#x2F;Documentation&#x2F;device-mapper&#x2F;dm-dust.txt]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">the fio demo</span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">[global]</span><br><span class="line">directory&#x3D;.&#x2F;</span><br><span class="line">iodepth&#x3D;8</span><br><span class="line">rwmixread&#x3D;50</span><br><span class="line">numjobs&#x3D;32</span><br><span class="line">size&#x3D;100M</span><br><span class="line">norandommap&#x3D;1</span><br><span class="line">group_reporting</span><br><span class="line">refill_buffers</span><br><span class="line">end_fsync&#x3D;1</span><br><span class="line">disable_slat&#x3D;1</span><br><span class="line">exitall</span><br><span class="line">timeout&#x3D;36000</span><br><span class="line">direct&#x3D;0</span><br><span class="line">nrfiles&#x3D;8</span><br><span class="line">bssplit&#x3D;4k&#x2F;10:32k&#x2F;20:64k&#x2F;20:128k&#x2F;20:256k&#x2F;20:1024k&#x2F;10</span><br><span class="line">[job1]</span><br><span class="line">rw&#x3D;write</span><br><span class="line">ioengine&#x3D;libaio</span><br><span class="line">[job2]</span><br><span class="line">rw&#x3D;read</span><br><span class="line">ioengine&#x3D;libaio</span><br><span class="line">[job3]</span><br><span class="line">rw&#x3D;randread</span><br><span class="line">ioengine&#x3D;libaio</span><br><span class="line">[job4]</span><br><span class="line">rw&#x3D;randwrite</span><br><span class="line">ioengine&#x3D;libaio</span><br><span class="line">[job5]</span><br><span class="line">rw&#x3D;randrw</span><br><span class="line">ioengine&#x3D;libaio</span><br><span class="line">[job6]</span><br><span class="line">rw&#x3D;write</span><br><span class="line">ioengine&#x3D;posixaio</span><br><span class="line">[job7]</span><br><span class="line">rw&#x3D;read</span><br><span class="line">ioengine&#x3D;posixaio</span><br><span class="line">[job8]</span><br><span class="line">rw&#x3D;randread</span><br><span class="line">ioengine&#x3D;posixaio</span><br><span class="line">[job9]</span><br><span class="line">rw&#x3D;randwrite</span><br><span class="line">ioengine&#x3D;posixaio</span><br><span class="line">[job10]</span><br><span class="line">rw&#x3D;randrw</span><br><span class="line">ioengine&#x3D;posixaio</span><br><span class="line">[job11]</span><br><span class="line">rw&#x3D;write</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">[job12]</span><br><span class="line">rw&#x3D;read</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">[job13]</span><br><span class="line">rw&#x3D;randread</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">[job14]</span><br><span class="line">rw&#x3D;randwrite</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">[job15]</span><br><span class="line">rw&#x3D;randrw</span><br><span class="line">ioengine&#x3D;sync</span><br><span class="line">[job16]</span><br><span class="line">rw&#x3D;write</span><br><span class="line">ioengine&#x3D;psync</span><br><span class="line">[job17]</span><br><span class="line">rw&#x3D;read</span><br><span class="line">ioengine&#x3D;psync</span><br><span class="line">[job18]</span><br><span class="line">rw&#x3D;randread</span><br><span class="line">ioengine&#x3D;psync</span><br><span class="line">[job19]</span><br><span class="line">rw&#x3D;randwrite</span><br><span class="line">ioengine&#x3D;psync</span><br><span class="line">[job20]</span><br><span class="line">rw&#x3D;randrw</span><br><span class="line">ioengine&#x3D;psync</span><br><span class="line">[job21]</span><br><span class="line">rw&#x3D;write</span><br><span class="line">ioengine&#x3D;vsync</span><br><span class="line">[job22]</span><br><span class="line">rw&#x3D;read</span><br><span class="line">ioengine&#x3D;vsync</span><br><span class="line">[job23]</span><br><span class="line">rw&#x3D;randread</span><br><span class="line">ioengine&#x3D;vsync</span><br><span class="line">[job24]</span><br><span class="line">rw&#x3D;randwrite</span><br><span class="line">ioengine&#x3D;vsync</span><br><span class="line">[job25]</span><br><span class="line">rw&#x3D;randrw</span><br><span class="line">ioengine&#x3D;vsync</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/17/benchmark-tools/" data-id="ckg0we47s005aa1o6dmhvcxi4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test/" rel="tag">test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nvme" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/17/nvme/" class="article-date">
  <time datetime="2020-03-17T03:27:38.000Z" itemprop="datePublished">2020-03-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/block/">block</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/17/nvme/">nvme test</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>NAND P/E Cycles = amount of program / erase cycles NAND can do before wearing out<ul>
<li>WAF = NAND writes / host writes</li>
</ul>
</li>
<li>TBW or PBW  amount of host writes to SSD before wearing out<ul>
<li>TBW = drive capacity * cycles / WAF</li>
</ul>
</li>
<li>DWPD (drive writes per day): amount of data you can write to device each day of the warranty (typically 5 years) without wearing out<ul>
<li>DWPD = TBW/365/5/drive capacity</li>
</ul>
</li>
</ul>
<ol>
<li>Create partition smaller than total user capacity of SSD</li>
<li>Limit max LBA of drive through vendor specific tools</li>
<li>Create a namespace smaller than total user capacity</li>
<li>Limit application use to smaller LBA range</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://events.static.linuxfound.org/sites/events/files/slides/lemoal-nvme-polling-vault-2017-final_0.pdf">nvme hybird polling</a><br>I/O models</p>
<ul>
<li><p>IRQ vs polling</p>
<ul>
<li>NVM is coming ! Is this relevant ?</li>
<li>Linux implementation</li>
</ul>
</li>
<li><p>Block Layer and NVMe driver</p>
<ul>
<li>Evaluation Results</li>
<li>Classic polling vs Hybrid polling</li>
<li>Impact of process scheduling</li>
<li>Comparison with user level drivers</li>
</ul>
</li>
<li><p>Implemented by blk_mq_poll</p>
<ul>
<li>block-mq enabled devices only</li>
<li>Device queue flagged with poll enabled<ul>
<li>Can be controlled through sysfs</li>
<li>Enabled by default for devices supporting it, e.g. NVMe</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># To enable it, you echo 1 to /sys/block/&lt;dev&gt;/queue/io_poll.</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt;  /sys/block/nvme0n1/queue/io_poll</span><br><span class="line">$ cat  /sys/block/nvme0n1/queue/io_poll</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<ul>
<li>Polling is tried for any block I/O belonging to a high-priority I/O context (IOCB_HIPRI)</li>
<li>IRQs are NOT disabled<ul>
<li>ISR is still executed as the device signals completions</li>
<li>But ISR sees a completion slot already processed</li>
</ul>
</li>
</ul>
<p>6us average latency with IRQ, 4.5us with polling</p>
<ul>
<li>25% lower latency with polling</li>
<li>166 KIOPS vs 222 KIOPS</li>
<li><code>But 100% load on the polling CPU</code></li>
<li>Only 32% CPU load with IRQ model</li>
</ul>
<p>Adaptive hybrid polling gives the same average latency of 4.5us as classic polling</p>
<ul>
<li>But with only 58% CPU load</li>
<li>32% with IRQ model</li>
<li>Fixed time polling allows controlling the CPU vs latency trade-off</li>
<li>IRQ like average latency and CPU load for high polling delay</li>
<li>Better use the IRQ model</li>
<li>Lower CPU loads with a small average latency degradation achieved with intermediate polling delay</li>
</ul>
<p><code>If I use NVME, if you have the top CPU, you could enable the polling, if not , irq is the better choice</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /sys/block/nvme0n1/queue/io_poll_delay</span><br><span class="line">-1</span><br><span class="line"><span class="comment"># -1 class polling (default)</span></span><br><span class="line"><span class="comment"># 0 means adaptive hybird polling</span></span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; /sys/block/nvme0n1/queue/io_poll_delay</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">|&lt;------------------------Application Perecived I&#x2F;O latency---------------------------------&gt;|</span><br><span class="line">IRQ      syscall  BIO_stack  Device_driver  CS             sleep            CS  BIO_stack </span><br><span class="line">                                                                            | (wake)</span><br><span class="line">                                                               CS ISR -------</span><br><span class="line">                                                               |(IRQ)</span><br><span class="line">		                    command execution-----------   </span><br><span class="line"></span><br><span class="line">Polling  syscall  BIO_stack  Device_driver    Are you done ?    BIO_stack&lt;-------Gain-------&gt;| </span><br><span class="line">                                                 |</span><br><span class="line">                                           command execution</span><br><span class="line"></span><br><span class="line">Hybrid   syscall  BIO_stack  Device_driver  cs sleep cs  done?  BIO_stack&lt;-------Gain-------&gt;| </span><br><span class="line">                                                     |(wake)|</span><br><span class="line">                                      Timer IRQ --&gt; ISR     |</span><br><span class="line">						     command execution</span><br></pre></td></tr></table></figure>
<h4 id="Software-optimization"><a href="#Software-optimization" class="headerlink" title="Software optimization"></a>Software optimization</h4><ul>
<li>System call (VFS)<ul>
<li>Optimizations introduced with kernel 4.10</li>
</ul>
</li>
<li>BIO stack<ul>
<li>blk-mq already very efficient</li>
</ul>
</li>
<li>Device driver<ul>
<li>NVMe driver submission and completion paths are very short</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://metebalci.com/blog/a-quick-tour-of-nvm-express-nvme/">Im copy the article, just read it</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">$ nvme --smart-log /dev/nvme0</span><br><span class="line">Smart Log <span class="keyword">for</span> NVME device:nvme0 namespace-id:ffffffff</span><br><span class="line">critical_warning                    : 0</span><br><span class="line">temperature                         : 35 C</span><br><span class="line">available_spare                     : 100%</span><br><span class="line">available_spare_threshold           : 0%</span><br><span class="line">percentage_used                     : 0%</span><br><span class="line">data_units_read                     : 320,346,034</span><br><span class="line">data_units_written                  : 441,545,307</span><br><span class="line">host_read_commands                  : 16,537,842,223</span><br><span class="line">host_write_commands                 : 19,148,305,649</span><br><span class="line">controller_busy_time                : 3,505</span><br><span class="line">power_cycles                        : 50</span><br><span class="line">power_on_hours                      : 16,079</span><br><span class="line">unsafe_shutdowns                    : 33</span><br><span class="line">media_errors                        : 0</span><br><span class="line">num_err_log_entries                 : 0</span><br><span class="line">Warning Temperature Time            : 0</span><br><span class="line">Critical Composite Temperature Time : 0</span><br><span class="line">Thermal Management T1 Trans Count   : 0</span><br><span class="line">Thermal Management T2 Trans Count   : 0</span><br><span class="line">Thermal Management T1 Total Time    : 0</span><br><span class="line">Thermal Management T2 Total Time    : 0</span><br><span class="line"></span><br><span class="line">nvme error-log /dev/nvme0</span><br><span class="line">Error Log Entries <span class="keyword">for</span> device:nvme0 entries:64</span><br><span class="line">.................</span><br><span class="line"> Entry[ 0]</span><br><span class="line">.................</span><br><span class="line">error_count  : 0</span><br><span class="line">sqid         : 0</span><br><span class="line">cmdid        : 0</span><br><span class="line">status_field : 0(SUCCESS: The <span class="built_in">command</span> completed successfully)</span><br><span class="line">parm_err_loc : 0</span><br><span class="line">lba          : 0</span><br><span class="line">nsid         : 0</span><br><span class="line">vs           : 0</span><br><span class="line">cs           : 0</span><br><span class="line">.................</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">Entry[63]</span><br><span class="line">.................</span><br><span class="line">error_count  : 0</span><br><span class="line">sqid         : 0</span><br><span class="line">cmdid        : 0</span><br><span class="line">status_field : 0(SUCCESS: The <span class="built_in">command</span> completed successfully)</span><br><span class="line">parm_err_loc : 0</span><br><span class="line">lba          : 0</span><br><span class="line">nsid         : 0</span><br><span class="line">vs           : 0</span><br><span class="line">cs           : 0</span><br><span class="line">.................</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ nvme get-log /dev/nvme0 --log-id=2 --log-len=512</span><br><span class="line">Device:nvme0 log-id:2 namespace-id:0xffffffff</span><br><span class="line">       0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f</span><br><span class="line">0000: 00 33 01 64 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;.3.d............&quot;</span></span><br><span class="line">0010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;................&quot;</span></span><br><span class="line">0020: b2 17 18 13 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;................&quot;</span></span><br><span class="line">0030: 5b 72 51 1a 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;[rQ.............&quot;</span></span><br><span class="line">0040: 2f 72 bb d9 03 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;/r..............&quot;</span></span><br><span class="line">0050: f1 f4 53 75 04 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;..Su............&quot;</span></span><br><span class="line">0060: b1 0d 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;................&quot;</span></span><br><span class="line">0070: 32 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;2...............&quot;</span></span><br><span class="line">0080: cf 3e 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;.&gt;..............&quot;</span></span><br><span class="line">0090: 21 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 <span class="string">&quot;!...............&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ nvme list</span><br><span class="line">Node             SN                   Model                                    Namespace Usage                      Format           FW Rev</span><br><span class="line">---------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------</span><br><span class="line">/dev/nvme0n1     PHKS00000000000000   INTEL SSDPED1K375GA                      1         375.08  GB / 375.08  GB      4 KiB +  0 B   E2010435</span><br><span class="line"></span><br><span class="line">$ nvme list-ns /dev/nvme0n1</span><br><span class="line">NVMe Status:INVALID_NS: The namespace or the format of that namespace is invalid(400b) NSID:0</span><br><span class="line"></span><br><span class="line">$ nvme fw-download /dev/nvme0n1 -f &lt;fw binary&gt;</span><br><span class="line">$ nvme fw-commit /dev/nvme0n1 -s 1 -a 1</span><br><span class="line">$ nvme reset /dev/nvme0 </span><br><span class="line"></span><br><span class="line"><span class="comment">#secure format</span></span><br><span class="line">$ nvme format /dev/nvme0 s 1</span><br><span class="line">SES = 0 results <span class="keyword">in</span> drive being formatted and trimmed</span><br><span class="line">SES = 1 <span class="keyword">for</span> Block Erase  low level block erase on media (physically erase NAND blocks, or overwrite with 0 on SCM)</span><br><span class="line">SES = 2 <span class="keyword">for</span> Crypto Erase - change media encryption key</span><br><span class="line">-l <span class="keyword">for</span> LBA format, find capabilities <span class="keyword">in</span> NVMe identify controller -t timeout <span class="keyword">for</span> devices that will take a long time</span><br><span class="line">-p <span class="keyword">for</span> protection information with variable sector size</span><br><span class="line"></span><br><span class="line"><span class="comment">## for more info </span></span><br><span class="line">Format NVM, <span class="built_in">command</span> dword 10</span><br><span class="line"></span><br><span class="line">Sanitize (not widely supported yet)</span><br><span class="line">$ nvme sanitize</span><br><span class="line">* Block Erase  low level block erase on media (physically erase NAND blocks)</span><br><span class="line">* Crypto Erase - change media encryption key</span><br><span class="line">* Overwrite  overwrite with data patterns (not good or recommended <span class="keyword">for</span> NAND based SSDs due to endurance)</span><br></pre></td></tr></table></figure>

<h3 id="create-mdraid-for-nvme-ssd"><a href="#create-mdraid-for-nvme-ssd" class="headerlink" title="create mdraid for nvme ssd"></a>create mdraid for nvme ssd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ mdadm -C /dev/md0 /dev/nvme[0-3]n1 n 4 e imsm</span><br><span class="line">$ mdadm -C /dev/md0 /dev/nvme[0-3]n1 n 4 e imsm</span><br><span class="line"></span><br><span class="line"><span class="comment">## I/O polling mode was introduced with linux 4.4, in polling mode the cpu continuously checks if the I/O command completed</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/block/nvme0n1/queue/io_poll</span><br><span class="line">bash: <span class="built_in">echo</span>: write error: Invalid argument</span><br><span class="line"></span><br><span class="line"><span class="comment">## Hybird polling mode was introduced in linux kenrel 4.10, hybrid polling mode improvded QD1 performance closer to that of polling mode performance, but with lower cpu utilizaion</span></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /sys/block/nvme0n1/queue/io_poll_delay</span><br><span class="line">0=hybrid, 1 = always poll( default )</span><br><span class="line"></span><br><span class="line">block-mq enabled devices only</span><br><span class="line">Device queue flagged with poll enabled</span><br><span class="line"></span><br><span class="line">CPU frequency    &gt;  3.0GHz</span><br><span class="line">Hyper threading     <span class="built_in">disable</span></span><br><span class="line">EIST(Enhanced intel speed step technology)    disabled</span><br><span class="line">intel Turbo mode    <span class="built_in">disable</span></span><br><span class="line">C-states            <span class="built_in">disable</span></span><br><span class="line">P-states            <span class="built_in">disable</span></span><br><span class="line">CPU Governor(os)    performance mode</span><br><span class="line">IRQ balancing(os)   disabled</span><br><span class="line">SMP Affinity        <span class="built_in">set</span> interrupts to run <span class="keyword">in</span> the proper CPU cores</span><br><span class="line">I/O polling or Hybrid mode    Enabled</span><br></pre></td></tr></table></figure>
<p>Linux flow of command execution on NVME SSDs<br>User app requestion IO -&gt; kernel processes IO request and sends to device driver -&gt; device driver processes the requests(create SQ entry, rings doorbell register) -&gt; device processes the requests(read sq entry, processes IO, create cq entry, signals MSI-x to host) -&gt; kernel call device driver to handle the completion -&gt; device driver ack, that the entry in CQ has been processed</p>
<p>IO execution in SPDK<br>User app requestion IO -&gt; SPDK userspace device driver process the requests(create SQ entry, rings doorbell register) -&gt; device processes the requestion(read sq entry, processes IO, create cq entry) -&gt; user application polls SPDK for IO completion -&gt; spdk call user application completion callback when IO is complete</p>
<p>cat /proc/version /proc/cpuinfo /proc/meminfo /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor<br>lspci -v<br>nvme list</p>
<p>#disable IRQ balance<br>set SMP affinity<br>systemctl stop irqbalance<br>folders=/proc/irq/*<br>for folder in $folders<br>do<br>  files=$folder/*<br>  for file in $files<br>  do<br>     if [[ $file == <em>nvme</em> ]]<br>     then<br>        echo $file<br>        contents=$(cat $folder/affinity_hint)<br>        echo $contents &gt; $folder/smp_affinity<br>        cat $folder/smp_affinity<br>     fi<br>  done<br>done</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line">$ nvme id-ctrl -H &#x2F;dev&#x2F;nvme0n1</span><br><span class="line">NVME Identify Controller:</span><br><span class="line">vid       : 0x8086                  # vid is PCI Vendor ID (so Samsung in this case), 0x144d as in the lspci output.</span><br><span class="line">ssvid     : 0x8086                  # ssvid is PCI Subsystem Vendor ID    </span><br><span class="line">sn        : PHK000000000000000</span><br><span class="line">mn        : INTEL SSDPED1K375GA</span><br><span class="line">fr        : E2010435</span><br><span class="line">rab       : 0</span><br><span class="line">ieee      : 5cd2e4</span><br><span class="line">cmic      : 0                       # the Controller Multi-Path I&#x2F;O and Namespace Sharing Capabilities.</span><br><span class="line">  [3:3] : 0	ANA not supported</span><br><span class="line">  [2:2] : 0	PCI</span><br><span class="line">  [1:1] : 0	Single Controller</span><br><span class="line">  [0:0] : 0	Single Port</span><br><span class="line"></span><br><span class="line">mdts      : 5                       # mdts is Maximum Data Transfer Size. </span><br><span class="line">                                    # It is reported as a power of two and in units of minimum memory page size. mdts&#x3D;5 here</span><br><span class="line">                                    # so 2 &#x3D; 32. We will see the minimum memory page size (MPSMIN) as 4K below. So MDTS is 32 * 4K &#x3D; 128K.</span><br><span class="line">cntlid    : 0</span><br><span class="line">ver       : 0</span><br><span class="line">rtd3r     : 0</span><br><span class="line">rtd3e     : 0</span><br><span class="line">oaes      : </span><br><span class="line">  [9:9] : 0	Firmware Activation Notices Not Supported</span><br><span class="line">  [8:8] : 0	Namespace Attribute Changed Event Not Supported</span><br><span class="line"></span><br><span class="line">ctratt    : 0</span><br><span class="line">  [5:5] : 0	Predictable Latency Mode Not Supported</span><br><span class="line">  [4:4] : 0	Endurance Groups Not Supported</span><br><span class="line">  [3:3] : 0	Read Recovery Levels Not Supported</span><br><span class="line">  [2:2] : 0	NVM Sets Not Supported</span><br><span class="line">  [1:1] : 0	Non-Operational Power State Permissive Not Supported</span><br><span class="line">  [0:0] : 0	128-bit Host Identifier Not Supported</span><br><span class="line"></span><br><span class="line">rrls      : 0</span><br><span class="line">oacs      : 0x7                    # Optional Admin Command Support</span><br><span class="line">  [8:8] : 0	Doorbell Buffer Config Not Supported</span><br><span class="line">  [7:7] : 0	Virtualization Management Not Supported</span><br><span class="line">  [6:6] : 0	NVMe-MI Send and Receive Not Supported</span><br><span class="line">  [5:5] : 0	Directives Not Supported</span><br><span class="line">  [4:4] : 0	Device Self-test Not Supported</span><br><span class="line">  [3:3] : 0	NS Management and Attachment Not Supported</span><br><span class="line">  [2:2] : 0x1	FW Commit and Download Supported</span><br><span class="line">  [1:1] : 0x1	Format NVM Supported</span><br><span class="line">  [0:0] : 0x1	Security Send and Receive Supported</span><br><span class="line"></span><br><span class="line">acl       : 3</span><br><span class="line">aerl      : 3</span><br><span class="line">frmw      : 0x2                    # firmware update</span><br><span class="line">  [4:4] : 0	Firmware Activate Without Reset Not Supported</span><br><span class="line">  [3:1] : 0x1	Number of Firmware Slots</span><br><span class="line">  [0:0] : 0	Firmware Slot 1 Read&#x2F;Write</span><br><span class="line"></span><br><span class="line">lpa       : 0x2</span><br><span class="line">  [3:3] : 0	Telemetry host&#x2F;controller initiated log page Not Suporrted</span><br><span class="line">  [2:2] : 0	Extended data for Get Log Page Not Supported</span><br><span class="line">  [1:1] : 0x1	Command Effects Log Page Supported</span><br><span class="line">  [0:0] : 0	SMART&#x2F;Health Log Page per NS Not Supported</span><br><span class="line"></span><br><span class="line">elpe      : 63</span><br><span class="line">npss      : 0</span><br><span class="line">avscc     : 0</span><br><span class="line">  [0:0] : 0	Admin Vendor Specific Commands uses Vendor Specific Format</span><br><span class="line"></span><br><span class="line">apsta     : 0</span><br><span class="line">  [0:0] : 0	Autonomous Power State Transitions Not Supported</span><br><span class="line"></span><br><span class="line">wctemp    : 0</span><br><span class="line">cctemp    : 0</span><br><span class="line">mtfa      : 0</span><br><span class="line">hmpre     : 0</span><br><span class="line">hmmin     : 0</span><br><span class="line">tnvmcap   : 0                      # Total NVM Capacity and it is an optional field. As it is reported as zero, it is not supported.</span><br><span class="line">unvmcap   : 0                      </span><br><span class="line">rpmbs     : 0</span><br><span class="line"> [31:24]: 0	Access Size</span><br><span class="line"> [23:16]: 0	Total Size</span><br><span class="line">  [5:3] : 0	Authentication Method</span><br><span class="line">  [2:0] : 0	Number of RPMB Units</span><br><span class="line"></span><br><span class="line">edstt     : 0</span><br><span class="line">dsto      : 0</span><br><span class="line">fwug      : 0</span><br><span class="line">kas       : 0</span><br><span class="line">hctma     : 0</span><br><span class="line">  [0:0] : 0	Host Controlled Thermal Management Not Supported</span><br><span class="line"></span><br><span class="line">mntmt     : 0</span><br><span class="line">mxtmt     : 0</span><br><span class="line">sanicap   : 0</span><br><span class="line">  [2:2] : 0	Overwrite Sanitize Operation Not Supported</span><br><span class="line">  [1:1] : 0	Block Erase Sanitize Operation Not Supported</span><br><span class="line">  [0:0] : 0	Crypto Erase Sanitize Operation Not Supported</span><br><span class="line"></span><br><span class="line">hmminds   : 0</span><br><span class="line">hmmaxd    : 0</span><br><span class="line">nsetidmax : 0</span><br><span class="line">anatt     : 0</span><br><span class="line">anacap    : 0</span><br><span class="line">  [7:7] : 0	Non-zero group ID Not Supported</span><br><span class="line">  [6:6] : 0	Group ID does not change</span><br><span class="line">  [4:4] : 0	ANA Change state Not Supported</span><br><span class="line">  [3:3] : 0	ANA Persistent Loss state Not Supported</span><br><span class="line">  [2:2] : 0	ANA Inaccessible state Not Supported</span><br><span class="line">  [1:1] : 0	ANA Non-optimized state Not Supported</span><br><span class="line">  [0:0] : 0	ANA Optimized state Not Supported</span><br><span class="line"></span><br><span class="line">anagrpmax : 0</span><br><span class="line">nanagrpid : 0</span><br><span class="line">sqes      : 0x66   # (Maximum and Required) Submission Queue Entry (SQE) Size. </span><br><span class="line">                   # It is expected to be 64 but with proprietary extensions it can be modified. The value is 0x66 here.</span><br><span class="line">  [7:4] : 0x6	Max SQ Entry Size (64)</span><br><span class="line">  [3:0] : 0x6	Min SQ Entry Size (64)</span><br><span class="line"></span><br><span class="line">cqes      : 0x44   # (Maximum and Required) Completion Queue Entry (CQE) Size. Similar to calculation of SQE size, </span><br><span class="line">                   # its value is 0x44 here, so both maximum and required completion queue entry size is 2&#x3D;16 bytes.</span><br><span class="line">  [7:4] : 0x4	Max CQ Entry Size (16)</span><br><span class="line">  [3:0] : 0x4	Min CQ Entry Size (16)</span><br><span class="line"></span><br><span class="line">maxcmd    : 0</span><br><span class="line">nn        : 1      # (Maximum) Number of Namespaces supported by the controller. Although theoretical maximum is high, here it is 1, </span><br><span class="line">                   # so only one namespace is possible.</span><br><span class="line">oncs      : 0x6    # is Optional NVM Command Support</span><br><span class="line">  [7:7] : 0	Virtualization Management Not Supported</span><br><span class="line">  [6:6] : 0	Timestamp Not Supported</span><br><span class="line">  [5:5] : 0	Reservations Not Supported</span><br><span class="line">  [4:4] : 0	Save and Select Not Supported</span><br><span class="line">  [3:3] : 0	Write Zeroes Not Supported</span><br><span class="line">  [2:2] : 0x1	Data Set Management Supported</span><br><span class="line">  [1:1] : 0x1	Write Uncorrectable Supported</span><br><span class="line">  [0:0] : 0	Compare Not Supported</span><br><span class="line"></span><br><span class="line">fuses     : 0   </span><br><span class="line">  [0:0] : 0	Fused Compare and Write Not Supported</span><br><span class="line"></span><br><span class="line">fna       : 0x4</span><br><span class="line">  [2:2] : 0x1	Crypto Erase Supported as part of Secure Erase</span><br><span class="line">  [1:1] : 0	Crypto Erase Applies to Single Namespace(s)</span><br><span class="line">  [0:0] : 0	Format Applies to Single Namespace(s)</span><br><span class="line"></span><br><span class="line">vwc       : 0</span><br><span class="line">  [0:0] : 0	Volatile Write Cache Not Present</span><br><span class="line"></span><br><span class="line">awun      : 0</span><br><span class="line">awupf     : 0</span><br><span class="line">nvscc     : 0</span><br><span class="line">  [0:0] : 0	NVM Vendor Specific Commands uses Vendor Specific Format</span><br><span class="line"></span><br><span class="line">nwpc      : 0</span><br><span class="line">  [2:2] : 0	Permanent Write Protect Not Supported</span><br><span class="line">  [1:1] : 0	Write Protect Until Power Supply Not Supported</span><br><span class="line">  [0:0] : 0	No Write Protect and Write Protect Namespace Not Supported</span><br><span class="line"></span><br><span class="line">acwu      : 0</span><br><span class="line">sgls      : 0</span><br><span class="line"> [1:0]  : 0	Scatter-Gather Lists Not Supported</span><br><span class="line"></span><br><span class="line">mnan      : 0</span><br><span class="line">subnqn    :</span><br><span class="line">ioccsz    : 0</span><br><span class="line">iorcsz    : 0</span><br><span class="line">icdoff    : 0</span><br><span class="line">ctrattr   : 0</span><br><span class="line">  [0:0] : 0	Dynamic Controller Model</span><br><span class="line"></span><br><span class="line">msdbd     : 0</span><br><span class="line">ps    0 : mp:18.00W operational enlat:0 exlat:0 rrt:0 rrl:0</span><br><span class="line">          rwt:0 rwl:0 idle_power:- active_power:-</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line"></span><br><span class="line">sending Identify List Namespaces</span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">$ nvme list-ns &#x2F;dev&#x2F;nvme0 &quot;</span><br><span class="line">[   0]:0x1</span><br><span class="line"></span><br><span class="line"># optane</span><br><span class="line">$ nvme list-ns &#x2F;dev&#x2F;nvme0</span><br><span class="line">NVMe Status:INVALID_NS: The namespace or the format of that namespace is invalid(400b) NSID:0</span><br><span class="line"></span><br><span class="line">$ nvme id-ns &#x2F;dev&#x2F;nvme0 --namespace-id&#x3D;0x1</span><br><span class="line">NVME Identify Namespace 1:</span><br><span class="line">nsze    : 0x5754b9a  # Namespace Size (NSZE). Indicates the number of logical blocks, 0x5754b9a &#x3D; 91573146</span><br><span class="line">                     # lsblk -b show nvme0n1     259:0    0  375083606016  0 disk    91573146*4096&#x3D;375083606016</span><br><span class="line">ncap    : 0x5754b9a  # The maximum number of logical blocks allocated to the namespace. </span><br><span class="line">                     # If there is a thin provisioning (if disk space is allocated on demand), </span><br><span class="line">                     # this value can be less than NSZE. Here, it is not the case so its value is same as NSZE.</span><br><span class="line">nuse    : 0x5754b9aa # nuse, Namespace Utilization (NUSE). The current number of logical blocks allocated to the namespace. </span><br><span class="line">                     # If there is a thin provisioning (if disk space is allocated on demand), this value can be less than NSZE. </span><br><span class="line">                     # Here, it is not the case so its value is same as NSZE.</span><br><span class="line">nsfeat  : 0          #  Namespace Features (NSFEAT)</span><br><span class="line">                     # Bit 3 &#x3D; 0, NGUID and EUI64 values may be reused by the controller after this namespace is deleted.</span><br><span class="line">                     # Bit 2 &#x3D; 0, the controller does not support the Deallocated or Unwritten Logical Block error.</span><br><span class="line">                     # Bit 1 &#x3D; 0, AWUN, AWUPF and ACWU fields should be used instead of NAWUN, NAWUPF, NACWU.</span><br><span class="line">                     # Bit 0 &#x3D; 0, meaning the namespace does not support Thin Provisioning.</span><br><span class="line">nlbaf   : 6          # Number of LBA Formats (NLBAF). Indicates the number of supported LBA data size and metadata size </span><br><span class="line">                     # combinations supported by the namespace. </span><br><span class="line">                     # If It is a zero based value and its value here is 0, so there is only 1 format supported.</span><br><span class="line">flbas   : 0x3        # Formatted LBA Size (FLBAS). Indicates the LBA data size and metadata size combination </span><br><span class="line">                     # Bits 3:0 indicates one of the 16 supported LBA Formats indicated in this data structure. </span><br><span class="line"></span><br><span class="line">                     #LBA Format fields:</span><br><span class="line"></span><br><span class="line">                     #ms, Metadata Size (MS). Since its value is 0, metadata is not supported.</span><br><span class="line">                     #ds, LBA Data Size (LBADS). It is reported in terms of a power of two, so LBA data size is 2 &#x3D; 512 bytes.</span><br><span class="line">                     #rp, Releative Performance (RP). Indicates the relative performance of this format to other formats. </span><br><span class="line">                     # Value of 0 indicates it is the best performance. </span><br><span class="line">                     # It does not make much sense here because we have only one LBA Format supported.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mc      : 0x1</span><br><span class="line">dpc     : 0x11</span><br><span class="line">dps     : 0          # End-to-end Data Protection Type Settings (DPS), T10 PI</span><br><span class="line">                     # Bit 3 if set to 1 indicates that the protection information, </span><br><span class="line">                     # if enabled, is transferred as the first eight bytes of metadata. </span><br><span class="line">                     # Bit 3 if cleared to 0 indicates that the protection information, </span><br><span class="line">                     # if enabled, is transferred as the last eight bytes of metadata.</span><br><span class="line">                     # 000b Protection information is not enabled</span><br><span class="line">                     # 001b Protection information is enabled, Type 1</span><br><span class="line">                     # 010b Protection information is enabled, Type 2</span><br><span class="line">                     # 011b Protection information is enabled, Type 3</span><br><span class="line">                     # 100b  111b Reserved</span><br><span class="line">nmic    : 0</span><br><span class="line">rescap  : 0</span><br><span class="line">fpi     : 0</span><br><span class="line">dlfeat  : 0</span><br><span class="line">nawun   : 0</span><br><span class="line">nawupf  : 0</span><br><span class="line">nacwu   : 0</span><br><span class="line">nabsn   : 0</span><br><span class="line">nabo    : 0</span><br><span class="line">nabspf  : 0</span><br><span class="line">noiob   : 0</span><br><span class="line">nvmcap  : 0</span><br><span class="line">nsattr	: 0</span><br><span class="line">nvmsetid: 0</span><br><span class="line">anagrpid: 0</span><br><span class="line">endgid  : 0</span><br><span class="line">nguid   : 00000000000000000000000000000000</span><br><span class="line">eui64   : 5cd2e4e419330100</span><br><span class="line">lbaf  0 : ms:0   lbads:9  rp:0x2</span><br><span class="line">lbaf  1 : ms:8   lbads:9  rp:0x2</span><br><span class="line">lbaf  2 : ms:16  lbads:9  rp:0x2</span><br><span class="line">lbaf  3 : ms:0   lbads:12 rp:0 (in use)</span><br><span class="line">lbaf  4 : ms:8   lbads:12 rp:0</span><br><span class="line">lbaf  5 : ms:64  lbads:12 rp:0</span><br><span class="line">lbaf  6 : ms:128 lbads:12 rp:0</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nvmexpress.org/wp-content/uploads/NVM_Express_Revision_1.3.pdf">nvme_express_revision</a><br>nvme admin command </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">VMe Admin Commands</span><br><span class="line">Here are the NVMe admin commands with opcodes:</span><br><span class="line">Create and Delete I/O Submission Queue (01h, 00h)</span><br><span class="line">Get Log Page (02h)</span><br><span class="line">Create and Delete I/O Completion Queue (05h, 04h)</span><br><span class="line">Identify (06h)</span><br><span class="line">Abort (08h)</span><br><span class="line">Get and Set Features (0Ah, 09h)</span><br><span class="line">Asynchronous Event Request (0Ch)</span><br><span class="line">Namespace Management (0Dh)</span><br><span class="line">Firmware Commit and Image Download (10h, 11h)</span><br><span class="line">Device Self-test (14h)</span><br><span class="line">Namespace Attachment (15h)</span><br><span class="line">Keep Alive (18h)</span><br><span class="line">Directive Send and Receive (19h, 1Ah)</span><br><span class="line">Virtualization Management (1Ch)</span><br><span class="line">NVMe-MI Send and Receive (1Dh, 1Eh)</span><br><span class="line">Doorbell Buffer Config (7Ch)</span><br><span class="line">Format NVM (80h)</span><br><span class="line">Security Send and Receive (81h, 82h)</span><br><span class="line">Sanitize (84h)</span><br><span class="line"></span><br><span class="line">$ nvme admin-passthru /dev/nvme0 --opcode=0x06 --cdw10=0x0001 --data-len=4096 -r -d -s</span><br><span class="line">opcode       : 06</span><br><span class="line">flags        : 00</span><br><span class="line">rsvd1        : 0000</span><br><span class="line">nsid         : 00000000</span><br><span class="line">cdw2         : 00000000</span><br><span class="line">cdw3         : 00000000</span><br><span class="line">data_len     : 00001000</span><br><span class="line">metadata_len : 00000000</span><br><span class="line">addr         : 563223139000</span><br><span class="line">metadata     : 0</span><br><span class="line">cdw10        : 00000001</span><br><span class="line">cdw11        : 00000000</span><br><span class="line">cdw12        : 00000000</span><br><span class="line">cdw13        : 00000000</span><br><span class="line">cdw14        : 00000000</span><br><span class="line">cdw15        : 00000000</span><br><span class="line">timeout_ms   : 00000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># NVM command</span></span><br><span class="line"><span class="comment"># NVM comands should only be sent if controller is ready (indicated by Controller Status register CSTS.RDY) and after I/O submission and completion queue have been created.</span></span><br><span class="line">Flush (00h)</span><br><span class="line">Write and Read (01h, 02h)</span><br><span class="line">Write Uncorrectable (04h)</span><br><span class="line">Compare (05h)</span><br><span class="line">Write Zeroes (08h)</span><br><span class="line">Dataset Management (09h)</span><br><span class="line">Reservation Register and Report (0Dh, 0Eh)</span><br><span class="line">Reservation Acquire and Release (11h, 15h)</span><br><span class="line"></span><br><span class="line">$ nvme show-regs -H /dev/nvme0</span><br><span class="line"><span class="built_in">cap</span>     : 2004010fff</span><br><span class="line">	Memory Page Size Maximum      (MPSMAX): 4096 bytes</span><br><span class="line">	Memory Page Size Minimum      (MPSMIN): 4096 bytes</span><br><span class="line">	Boot Partition Support           (BPS): No</span><br><span class="line">	Command Sets Supported           (CSS): NVM <span class="built_in">command</span> <span class="built_in">set</span> is supported</span><br><span class="line">	NVM Subsystem Reset Supported  (NSSRS): No</span><br><span class="line">	Doorbell Stride                (DSTRD): 4 bytes</span><br><span class="line">	Timeout                           (TO): 2000 ms</span><br><span class="line">	Arbitration Mechanism Supported  (AMS): Weighted Round Robin with Urgent Priority Class is not supported</span><br><span class="line">	Contiguous Queues Required       (CQR): Yes</span><br><span class="line">	Maximum Queue Entries Supported (MQES): 4096  <span class="comment">### Bytes</span></span><br><span class="line"></span><br><span class="line">version : 10000</span><br><span class="line">	NVMe specification 1.0</span><br><span class="line"></span><br><span class="line">cc      : 460001</span><br><span class="line">	I/O Completion Queue Entry Size (IOCQES): 16 bytes</span><br><span class="line">	I/O Submission Queue Entry Size (IOSQES): 64 bytes</span><br><span class="line">	Shutdown Notification              (SHN): No notification; no effect</span><br><span class="line">	Arbitration Mechanism Selected     (AMS): Round Robin</span><br><span class="line">	Memory Page Size                   (MPS): 4096 bytes</span><br><span class="line">	I/O Command Sets Selected          (CSS): NVM Command Set</span><br><span class="line">	Enable                              (EN): Yes</span><br><span class="line"></span><br><span class="line">csts    : 1</span><br><span class="line">	Processing Paused               (PP): No</span><br><span class="line">	NVM Subsystem Reset Occurred (NSSRO): No</span><br><span class="line">	Shutdown Status               (SHST): Normal operation (no shutdown has been requested)</span><br><span class="line">	Controller Fatal Status        (CFS): False</span><br><span class="line">	Ready                          (RDY): Yes</span><br><span class="line"></span><br><span class="line">nssr    : 0</span><br><span class="line">	NVM Subsystem Reset Control (NSSRC): 0</span><br><span class="line"></span><br><span class="line">intms   : 0</span><br><span class="line">	Interrupt Vector Mask Set (IVMS): 0</span><br><span class="line"></span><br><span class="line">intmc   : 0</span><br><span class="line">	Interrupt Vector Mask Clear (IVMC): 0</span><br><span class="line"></span><br><span class="line">aqa     : 1f001f</span><br><span class="line">	Admin Completion Queue Size (ACQS): 32</span><br><span class="line">	Admin Submission Queue Size (ASQS): 32</span><br><span class="line"></span><br><span class="line">asq     : 10255f9000</span><br><span class="line">	Admin Submission Queue Base (ASQB): 10255f9000</span><br><span class="line"></span><br><span class="line">acq     : 10255f8000</span><br><span class="line">	Admin Completion Queue Base (ACQB): 10255f8000</span><br><span class="line"></span><br><span class="line">cmbloc  : 0</span><br><span class="line">	Controller Memory Buffer feature is not supported</span><br><span class="line"></span><br><span class="line">cmbsz   : 0</span><br><span class="line">	Controller Memory Buffer feature is not supported</span><br><span class="line"></span><br><span class="line">bpinfo  : 0</span><br><span class="line">	Boot Partition feature is not supported</span><br><span class="line"></span><br><span class="line">bprsel  : 0</span><br><span class="line">	Boot Partition feature is not supported</span><br><span class="line"></span><br><span class="line">bpmbl   : 0</span><br><span class="line">	Boot Partition feature is not supported</span><br></pre></td></tr></table></figure>

<h3 id="Read-data-from-the-device"><a href="#Read-data-from-the-device" class="headerlink" title="Read data from the device"></a>Read data from the device</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dd <span class="keyword">if</span>=/dev/nvme0n1 of=lba.0.dd bs=512 count=1</span><br><span class="line">$ nvme <span class="built_in">read</span> /dev/nvme0n1 --start-block=0 --block-count=0 --data-size=512 --data=lba.0.read</span><br><span class="line">$ nvme io-passthru /dev/nvme0 --opcode=0x02 --namespace-id=0x1 --data-len=512 --<span class="built_in">read</span> --cdw10=0 --cdw11=0 --cdw12=0 -b &gt; lba.0.io</span><br><span class="line">nvme: malloc.c:2392: sysmalloc: Assertion `(old_top == initial_top (av) &amp;&amp; old_size == 0) || ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse (old_top) &amp;&amp; ((unsigned long) old_end &amp; (pagesize - 1)) == 0)<span class="string">&#x27; failed.</span></span><br><span class="line"><span class="string">Aborted (core dumped)</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/17/nvme/" data-id="ckg0we48a0060a1o6cxlqb32g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nfs/" rel="tag">nfs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-network_hardware" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/16/network_hardware/" class="article-date">
  <time datetime="2020-03-16T02:32:49.000Z" itemprop="datePublished">2020-03-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/network/">network</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/16/network_hardware/">network topology</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Deep-buffers-matter"><a href="#Deep-buffers-matter" class="headerlink" title="Deep buffers matter"></a>Deep buffers matter</h3><ul>
<li>lossless networks</li>
<li>how to they deal with incast problems ?<ul>
<li>Answer: tell everyone to stop<ul>
<li>In theory, allows small buffers</li>
<li>In practice, this leads to tree saturation</li>
<li>Causes blocking all the way to all sources<br><img src="/img/deep_buffer_matt-1.png"><table>
<thead>
<tr>
<th>Customer</th>
<th align="center">Real Buffer Utilization</th>
<th align="right">Cool</th>
</tr>
</thead>
<tbody><tr>
<td>HPC</td>
<td align="center">Storage Clustre -medium</td>
<td align="right">33MB</td>
</tr>
<tr>
<td>Animation</td>
<td align="center">Storage filer(NFS)</td>
<td align="right">6.2MB</td>
</tr>
<tr>
<td>Software vendor</td>
<td align="center">Engineering Build servers</td>
<td align="right">14.9MB</td>
</tr>
<tr>
<td>Online shopping</td>
<td align="center">Hadoop 2K servers -big data</td>
<td align="right">52.3MB</td>
</tr>
<tr>
<td>Educational</td>
<td align="center">Virtualization</td>
<td align="right">52.4MB</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Deep-Buffers-Matter"><a href="#Deep-Buffers-Matter" class="headerlink" title="Deep Buffers Matter!"></a>Deep Buffers Matter!</h4><p>cause packets dropped per teragen<br>Improving uplink contention in mixed speed networks<br>High Density in core/spine (many-to-one, in-cast, fan-in)<br><img src="/img/deep_buffer_matt-2.png"></p>
<h4 id="Buffer-utilisation-per-port"><a href="#Buffer-utilisation-per-port" class="headerlink" title="Buffer utilisation per port"></a>Buffer utilisation per port</h4><p>some switch get the lower buffer utilisation<br>it could cause a lot of tcp retransmit</p>
<p>The question is our issues.<br>How much buffer are you using ? Any visibility ?<br>What cause your retransmits ?<br><img src="/img/deep_buffer_matt-3.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/16/network_hardware/" data-id="ckg0we46l001la1o63c2ab6gz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/architecture/" rel="tag">architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/topology/" rel="tag">topology</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-gdb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/03/gdb/" class="article-date">
  <time datetime="2020-03-03T14:17:33.000Z" itemprop="datePublished">2020-03-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gdb/">gdb</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/03/gdb/">GDB tips</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="OS-settting"><a href="#OS-settting" class="headerlink" title="OS settting"></a>OS settting</h3><h4 id="Core-pattern"><a href="#Core-pattern" class="headerlink" title="Core pattern"></a>Core pattern</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/sys/kernel/core_pattern</span><br><span class="line">/usr/share/apport/apport %p %s %c %d %P %E</span><br><span class="line"><span class="comment">## kernel variable</span></span><br><span class="line">kernel.core_pattern = |/usr/share/apport/apport %p %s %c %d %P %E</span><br><span class="line"><span class="comment">#If the first character of the pattern is a &#x27;|&#x27;, the kernel will treat the rest of the pattern as a command to run.  The core dump will be written to the standard input of that program instead of to a file.</span></span><br><span class="line"></span><br><span class="line">kernel.core_pipe_limit = 0</span><br><span class="line"><span class="comment"># This sysctl is only applicable when core_pattern is configured to pipe core files to a user space helper (when the first character of core_pattern is a &#x27;|&#x27;, see above).  When collecting cores via a pipe to an application, it is occasionally useful for the collecting application to gather data about the crashing process from its /proc/pid directory.  In order to do this safely, the kernel must wait for the collecting process to exit, so as not to remove the crashing processes proc files prematurely.  This in turn creates the possibility that a misbehaving userspace collecting process can block the reaping of a crashed process simply by never exiting.  This sysctl defends against that. It defines how many concurrent crashing processes may be piped to user space applications in parallel.  If this value is exceeded, then those crashing processes above that value are noted via the kernel log and their cores are skipped.  0 is a special value, indicating that unlimited processes may be captured in parallel, but that no waiting will take place (i.e. the collecting process is not guaranteed access to `/proc/&lt;crashing pid&gt;/`).</span></span><br><span class="line"></span><br><span class="line">kernel.core_uses_pid = 0</span><br><span class="line">kernel.core_patternfs.suid_dumpable = 2</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ulimit</span> -S -c unlimited</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable genarate the core file</span></span><br><span class="line">$ <span class="built_in">ulimit</span> -c n</span><br></pre></td></tr></table></figure>

<h4 id="Core-single"><a href="#Core-single" class="headerlink" title="Core single"></a>Core single</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Standard signals</span><br><span class="line">     Linux supports the standard signals listed below.  Several signal  numbers  are  architecture-dependent,  as</span><br><span class="line">     indicated  <span class="keyword">in</span>  the  <span class="string">&quot;Value&quot;</span> column.  (Where three values are given, the first one is usually valid <span class="keyword">for</span> alpha</span><br><span class="line">     and sparc, the middle one <span class="keyword">for</span> x86, arm, and most other architectures, and the last one  <span class="keyword">for</span>  mips.   (Values</span><br><span class="line">     <span class="keyword">for</span>  parisc  are  not shown; see the Linux kernel <span class="built_in">source</span> <span class="keyword">for</span> signal numbering on that architecture.)  A dash</span><br><span class="line">     (-) denotes that a signal is absent on the corresponding architecture.</span><br><span class="line"></span><br><span class="line">     First the signals described <span class="keyword">in</span> the original POSIX.1-1990 standard.</span><br><span class="line"></span><br><span class="line">     Signal     Value     Action   Comment</span><br><span class="line">     </span><br><span class="line">     SIGQUIT       3       Core    Quit from keyboard</span><br><span class="line">     SIGILL        4       Core    Illegal Instruction</span><br><span class="line">     SIGABRT       6       Core    Abort signal from abort(3)</span><br><span class="line">     SIGFPE        8       Core    Floating-point exception</span><br><span class="line">     SIGSEGV      11       Core    Invalid memory reference</span><br><span class="line"></span><br><span class="line">     The signals SIGKILL and SIGSTOP cannot be caught, blocked, or ignored.</span><br><span class="line"></span><br><span class="line">     Next the signals not <span class="keyword">in</span> the POSIX.1-1990 standard but described <span class="keyword">in</span> SUSv2 and POSIX.1-2001.</span><br><span class="line"></span><br><span class="line">     Signal       Value     Action   Comment</span><br><span class="line">     </span><br><span class="line">     SIGBUS      10,7,10     Core    Bus error (bad memory access)</span><br><span class="line">     SIGSYS      12,31,12    Core    Bad system call (SVr4);</span><br><span class="line">                                     see also seccomp(2)</span><br><span class="line">     SIGTRAP        5        Core    Trace/breakpoint <span class="built_in">trap</span></span><br><span class="line">     SIGXCPU     24,24,30    Core    CPU time <span class="built_in">limit</span> exceeded (4.2BSD);</span><br><span class="line">                                     see setrlimit(2)</span><br><span class="line">     SIGXFSZ     25,25,31    Core    File size <span class="built_in">limit</span> exceeded (4.2BSD);</span><br><span class="line">                                     see setrlimit(2)</span><br><span class="line">     Up to and including Linux 2.2, the default behavior <span class="keyword">for</span> SIGSYS,  SIGXCPU,  SIGXFSZ,  and  (on  architectures</span><br><span class="line">     other  than  SPARC and MIPS) SIGBUS was to terminate the process (without a core dump).  (On some other UNIX</span><br><span class="line">     systems the default action <span class="keyword">for</span> SIGXCPU and SIGXFSZ is to terminate the process without a core dump.)   Linux</span><br><span class="line">     2.4 conforms to the POSIX.1-2001 requirements <span class="keyword">for</span> these signals, terminating the process with a core dump.</span><br><span class="line"></span><br><span class="line">     Next various other signals.</span><br><span class="line"></span><br><span class="line">     Signal       Value     Action   Comment</span><br><span class="line">     </span><br><span class="line">     SIGIOT         6        Core    IOT <span class="built_in">trap</span>. A synonym <span class="keyword">for</span> SIGABRT</span><br><span class="line">     SIGUNUSED    -,31,-     Core    Synonymous with SIGSYS</span><br><span class="line"></span><br><span class="line">     (Signal 29 is SIGINFO / SIGPWR on an alpha but SIGLOST on a sparc.)</span><br><span class="line"></span><br><span class="line">     SIGEMT  is  not  specified  <span class="keyword">in</span>  POSIX.1-2001, but nevertheless appears on most other UNIX systems, <span class="built_in">where</span> its</span><br><span class="line">     default action is typically to terminate the process with a core dump.</span><br><span class="line"></span><br><span class="line">     SIGPWR (<span class="built_in">which</span> is not specified <span class="keyword">in</span> POSIX.1-2001) is typically ignored by default on those other UNIX  systems</span><br><span class="line">     <span class="built_in">where</span> it appears.</span><br><span class="line"></span><br><span class="line">     SIGIO (<span class="built_in">which</span> is not specified <span class="keyword">in</span> POSIX.1-2001) is ignored by default on several other UNIX systems.</span><br><span class="line"></span><br><span class="line">     Where defined, SIGUNUSED is synonymous with SIGSYS on most architectures.  Since glibc 2.26, SIGUNUSED is no</span><br><span class="line">     longer defined on any architecture.</span><br></pre></td></tr></table></figure>

<h4 id="Enable-ptrace-permissions"><a href="#Enable-ptrace-permissions" class="headerlink" title="Enable ptrace permissions"></a>Enable ptrace permissions</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/sysctl.d/10-ptrace.conf</span><br><span class="line">kernel.yama.ptrace_scope = 0</span><br><span class="line"></span><br><span class="line">0 - classic ptrace permissions: a process can PTRACE_ATTACH to any other</span><br><span class="line">    process running under the same uid, as long as it is dumpable (i.e.</span><br><span class="line">    did not transition uids, start privileged, or have called</span><br><span class="line">    prctl(PR_SET_DUMPABLE...) already). Similarly, PTRACE_TRACEME is</span><br><span class="line">    unchanged.</span><br><span class="line"></span><br><span class="line">1 - restricted ptrace: a process must have a predefined relationship</span><br><span class="line">    with the inferior it wants to call PTRACE_ATTACH on. By default,</span><br><span class="line">    this relationship is that of only its descendants when the above</span><br><span class="line">    classic criteria is also met. To change the relationship, an</span><br><span class="line">    inferior can call prctl(PR_SET_PTRACER, debugger, ...) to <span class="built_in">declare</span></span><br><span class="line">    an allowed debugger PID to call PTRACE_ATTACH on the inferior.</span><br><span class="line">    Using PTRACE_TRACEME is unchanged.</span><br><span class="line"></span><br><span class="line">2 - admin-only attach: only processes with CAP_SYS_PTRACE may use ptrace</span><br><span class="line">    with PTRACE_ATTACH, or through children calling PTRACE_TRACEME.</span><br><span class="line"></span><br><span class="line">3 - no attach: no processes may use ptrace with PTRACE_ATTACH nor via</span><br><span class="line">    PTRACE_TRACEME. Once <span class="built_in">set</span>, this sysctl value cannot be changed.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Genarate-the-debug-info"><a href="#Genarate-the-debug-info" class="headerlink" title="Genarate the debug info"></a>Genarate the debug info</h3><ul>
<li>-g produces debugging information in theOS native format</li>
<li>-ggdb produces debugging information specifically intennded for gdb</li>
<li>-ggdb3 produces extra debugging information, for example: including macro definitions</li>
<li>wall means enable warnning</li>
<li>-O0  turn off all optimization</li>
<li>-O1 ,-O2, -O3  optimization<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure CFLAGS=<span class="string">&quot;-Wall -O2 -ggdb3&quot;</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">### Genarate the core file</span></span><br><span class="line">usage:  gcore [-a] [-o filename] pid</span><br><span class="line">```bash</span><br><span class="line">$ gcore -o /tmp/core -p <span class="variable">$pid</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>for the kernel</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> c &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure>

<h3 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install ubuntu-dbgsym-keyring</span><br></pre></td></tr></table></figure>

<h3 id="Open-the-core-file"><a href="#Open-the-core-file" class="headerlink" title="Open the core file"></a>Open the core file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ gdb ./a.out ./bubble_sort_core</span><br><span class="line"></span><br><span class="line">GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-linux-gnu&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;show configuration&quot;</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">&quot;help&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;apropos word&quot;</span> to search <span class="keyword">for</span> commands related to <span class="string">&quot;word&quot;</span>...</span><br><span class="line">Reading symbols from ./a.out...done.</span><br><span class="line">[New LWP 20410]</span><br><span class="line">Core was generated by `./a.out<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">Program terminated with signal SIGABRT, Aborted.</span></span><br><span class="line"><span class="string">#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51</span></span><br><span class="line"><span class="string">51	../sysdeps/unix/sysv/linux/raise.c: No such file or directory.</span></span><br></pre></td></tr></table></figure>

<h3 id="attach-the-process"><a href="#attach-the-process" class="headerlink" title="attach the process"></a>attach the process</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gdb attach <span class="variable">$PID</span></span><br><span class="line">$ gdb ./the_programA_binray <span class="variable">$pid_of_the_programA</span></span><br></pre></td></tr></table></figure>

<h3 id="gdb-basic-cmd"><a href="#gdb-basic-cmd" class="headerlink" title="gdb basic cmd"></a>gdb basic cmd</h3><p>break<br>break +offset<br>break -offset<br>break linenum<br>break filename:linenum<br>break func_name<br>break filename:func_name<br>break *address<br>break  if <condition></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## not work</span><br><span class="line">break foo if i&gt;0</span><br><span class="line">commands</span><br><span class="line">printf &quot;i is %d\n&quot;, i</span><br><span class="line">continue</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b func_name <span class="keyword">if</span> var_name == 5</span><br></pre></td></tr></table></figure>

<p>info break (i b)<br>i b n</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b main</span><br><span class="line">Breakpoint 1 at 0x564b218ff830: file ./bubble_sort_bug.c, line 29.</span><br><span class="line">(gdb) b <span class="built_in">exit</span></span><br><span class="line">Breakpoint 2 at 0x7f258be23120: file exit.c, line 139.</span><br><span class="line">(gdb) i b</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep y   0x0000564b218ff830 <span class="keyword">in</span> main at ./bubble_sort_bug.c:29</span><br><span class="line">2       breakpoint     keep y   0x00007f258be23120 <span class="keyword">in</span> __GI_exit at exit.c:139</span><br><span class="line">(gdb) i b 2</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">2       breakpoint     keep y   0x00007f258be23120 <span class="keyword">in</span> __GI_exit at exit.c:139</span><br><span class="line">(gdb) b main <span class="keyword">if</span> i==1</span><br><span class="line">Breakpoint 4 at 0x555555554830: file ./bubble_sort_bug.c, line 29.</span><br></pre></td></tr></table></figure>

<p>watch var   It is stopped by the gdb after the write has occurred<br>rwatch var  It is stopped by the gdb after the read has occurred<br>awatch var  It is stopped by the gdb after the read and write have occurred</p>
<p>step  (in function0<br>next  (not go to function)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info b</span><br><span class="line">No breakpoints or watchpoints.</span><br><span class="line">(gdb) watch a <span class="keyword">if</span> a==5 </span><br><span class="line">Hardware watchpoint 3: a</span><br><span class="line">(gdb) info b</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">3       hw watchpoint  keep y                      a</span><br><span class="line">	stop only <span class="keyword">if</span> a==5</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Thread 2 <span class="string">&quot;a.out&quot;</span> hit Hardware watchpoint 3: a</span><br><span class="line"></span><br><span class="line">Old value = 4</span><br><span class="line">New value = 5</span><br><span class="line">thread1_func (p_arg=0x555555554844) at thread1.c:10</span><br><span class="line">10	                sleep(10);</span><br><span class="line">(gdb)</span><br><span class="line"></span><br><span class="line">(gdb) info watchpoints</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">3       hw watchpoint  keep y                      a</span><br><span class="line">	stop only <span class="keyword">if</span> a==5</span><br><span class="line">	breakpoint already hit 1 time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(gdb) watch 0x600850</span><br><span class="line">Cannot watch constant value 0x600850.</span><br><span class="line">(gdb) watch *(int *) 0x600850</span><br><span class="line">Watchpoint 1: *(int *) 6293584 </span><br></pre></td></tr></table></figure>

<p>catch <event><br>tcatch <event>  (temp catch)<br>event: throw,catch,exec,fork,load,unload,exception,exception unhandled,assert,syscall [name | number ],</p>
<p>(gdb) catch syscall open<br>Catchpoint 7 (syscall open [2])<br>(gdb) catch syscall 5<br>Catchpoint 8 (syscall fstat [5])<br>(gdb) help catch syscall<br>Catch system calls by their names, groups and/or numbers.<br>Arguments say which system calls to catch.  If no arguments are given,<br>every system call will be caught.  Arguments, if given, should be one<br>or more system call names (if your system supports that), system call<br>groups or system call numbers.</p>
<p>for more syscall<br>/usr/include/x86_64-linux-gnu/asm/unistd_64.h</p>
<p>clear #clear all<br>clear function<br>clear linenum</p>
<p>delete beakpoints [range,eg: 1-5]</p>
<p>enable/disable breakpoints [range]<br>enable breakpoints once range<br>enable breakpoints delete range</p>
<p>set logging file the_log_filename<br>set logging on/off<br>set env PATH=/tmp/bin<br>set listsize 25</p>
<h1 id="set-print-variable-length"><a href="#set-print-variable-length" class="headerlink" title="set print variable length"></a>set print variable length</h1><p>set print elements 250<br>set print elements 0 #no limit</p>
<p>set step-mode on<br>This is useful in cases where you may be interested in inspecting the machine instructions of a function which has no symbolic info and do not want GDB to automatically skip over this function.</p>
<p>save br .gdb_20200601<br>-x .gdb_20200601</p>
<p>finish<br>Continue running until just after function in the selected stack frame returns. Print the returned value (if any). This command can be abbreviated as fin.</p>
<p>return</p>
<p>print expr<br>Evaluate the expression expr and display the resulting value. The expression may include calls to functions in the program being debugged.</p>
<p>call expr<br>Evaluate the expression expr without displaying void returned values.<br>You can use this variant of the print command if you want to execute a function from your program that does not return anything (a.k.a. a void function), but without cluttering the output with void returned values that GDB will otherwise print. If the result is not void, it is printed and saved in the value history.<br>It is possible for the function you call via the print or call command to generate a signal (e.g., if theres a bug in the function, or if you passed it incorrect arguments). What happens in that case is controlled by the set unwindonsignal command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">(gdb) bt</span><br><span class="line"><span class="comment">#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51</span></span><br><span class="line"><span class="comment">#1  0x00007f258be20801 in __GI_abort () at abort.c:79</span></span><br><span class="line"><span class="comment">#2  0x00007f258be69897 in __libc_message (action=action@entry=do_abort, </span></span><br><span class="line">    fmt=fmt@entry=0x7f258bf96988 <span class="string">&quot;*** %s ***: %s terminated\n&quot;</span>) at ../sysdeps/posix/libc_fatal.c:181</span><br><span class="line"><span class="comment">#3  0x00007f258bf14cd1 in __GI___fortify_fail_abort (need_backtrace=need_backtrace@entry=false, </span></span><br><span class="line">    msg=msg@entry=0x7f258bf96966 <span class="string">&quot;stack smashing detected&quot;</span>) at fortify_fail.c:33</span><br><span class="line"><span class="comment">#4  0x00007f258bf14c92 in __stack_chk_fail () at stack_chk_fail.c:29</span></span><br><span class="line"><span class="comment">#5  0x0000564b218ff8e9 in main () at ./bubble_sort_bug.c:43</span></span><br><span class="line"></span><br><span class="line">(gdb) f 2</span><br><span class="line"><span class="comment">#2  0x00007f258be69897 in __libc_message (action=action@entry=do_abort, </span></span><br><span class="line">    fmt=fmt@entry=0x7f258bf96988 <span class="string">&quot;*** %s ***: %s terminated\n&quot;</span>) at ../sysdeps/posix/libc_fatal.c:181</span><br><span class="line">181	../sysdeps/posix/libc_fatal.c: No such file or directory.</span><br><span class="line">(gdb) up</span><br><span class="line"><span class="comment">#3  0x00007f258bf14cd1 in __GI___fortify_fail_abort (need_backtrace=need_backtrace@entry=false, </span></span><br><span class="line">    msg=msg@entry=0x7f258bf96966 <span class="string">&quot;stack smashing detected&quot;</span>) at fortify_fail.c:33</span><br><span class="line">33	fortify_fail.c: No such file or directory.</span><br><span class="line">(gdb) down</span><br><span class="line"><span class="comment">#2  0x00007f258be69897 in __libc_message (action=action@entry=do_abort, </span></span><br><span class="line">    fmt=fmt@entry=0x7f258bf96988 <span class="string">&quot;*** %s ***: %s terminated\n&quot;</span>) at ../sysdeps/posix/libc_fatal.c:181</span><br><span class="line">181	../sysdeps/posix/libc_fatal.c: No such file or directory.</span><br><span class="line"></span><br><span class="line">(gdb) f 5</span><br><span class="line"><span class="comment">#5  0x0000564b218ff8e9 in main () at ./bubble_sort_bug.c:43</span></span><br><span class="line">43	&#125;</span><br><span class="line">(gdb) info f</span><br><span class="line">Stack level 5, frame at 0x7ffd58ea9f80:</span><br><span class="line"> rip = 0x564b218ff8e9 <span class="keyword">in</span> main (./bubble_sort_bug.c:43); saved rip = 0x7f258be01b97</span><br><span class="line"> <span class="built_in">caller</span> of frame at 0x7ffd58ea9e40</span><br><span class="line"> <span class="built_in">source</span> language c.</span><br><span class="line"> Arglist at 0x7ffd58ea9f70, args: </span><br><span class="line"> Locals at 0x7ffd58ea9f70, Previous frame<span class="string">&#x27;s sp is 0x7ffd58ea9f80</span></span><br><span class="line"><span class="string"> Saved registers:</span></span><br><span class="line"><span class="string">  rbx at 0x7ffd58ea9f68, rbp at 0x7ffd58ea9f70, rip at 0x7ffd58ea9f78</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) info args</span></span><br><span class="line"><span class="string">No arguments.</span></span><br><span class="line"><span class="string">(gdb) info locals</span></span><br><span class="line"><span class="string">array = &#123;20424913, 207764369, 232957269, 286304630, 340051919, 418929367, 428095442, 560929304, 622631137, </span></span><br><span class="line"><span class="string">  681405812, 702646332, 717507172, 771731937, 844764348, 871741416, 893622553, 939367001, 953569863, 983680782, </span></span><br><span class="line"><span class="string">  1133421906, 1150235085, 1170267861, 1267699692, 1278859841, 1351132359, 1478380837, 1618765791, 1747714870, </span></span><br><span class="line"><span class="string">  2015283722, 2027462427, 2046956728, 2080576919&#125;</span></span><br><span class="line"><span class="string">i = 36</span></span><br></pre></td></tr></table></figure>

<p>info</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info <span class="built_in">functions</span> thread1_func </span><br><span class="line">All <span class="built_in">functions</span> matching regular expression <span class="string">&quot;thread1_func&quot;</span>:</span><br><span class="line"></span><br><span class="line">File thread1.c:</span><br><span class="line">void *thread1_func(void *);</span><br></pre></td></tr></table></figure>

<p>print</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">(gdb) list</span><br><span class="line">1	<span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">2	<span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line">3</span><br><span class="line">4	void printArray(int arr[], int n)</span><br><span class="line">5	&#123;</span><br><span class="line">6	   <span class="keyword">for</span> (int i=0; i&lt;n; i++) &#123;</span><br><span class="line">7	     arr[i]=arr[i]+i;</span><br><span class="line">8	     <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[i]);</span><br><span class="line">9	   &#125;</span><br><span class="line">10	&#125;</span><br><span class="line">11</span><br><span class="line">12	int main()</span><br><span class="line">13	&#123;</span><br><span class="line">14	    int n = 10;</span><br><span class="line">15	    int arr[n];</span><br><span class="line">16</span><br><span class="line">17	    // Fill whole array with 100.</span><br><span class="line">18	    memset(arr, 10, n*sizeof(arr[0]));</span><br><span class="line">19	    <span class="built_in">printf</span>(<span class="string">&quot;Array after memset()\n&quot;</span>);</span><br><span class="line">20	    printArray(arr, n);</span><br><span class="line">21</span><br><span class="line">22	    <span class="built_in">return</span> 0;</span><br><span class="line">23	&#125;</span><br><span class="line"></span><br><span class="line">(gdb) info b</span><br><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep y   0x00000000004005d5 <span class="keyword">in</span> printArray at test2.c:7</span><br><span class="line">	breakpoint already hit 10 <span class="built_in">times</span></span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span><br><span class="line">7	     arr[i]=arr[i]+i;</span><br><span class="line">(gdb) <span class="built_in">print</span> arr</span><br><span class="line"><span class="variable">$13</span> = (int *) 0x7fffffffe0d0</span><br><span class="line">(gdb) <span class="built_in">print</span> *arr</span><br><span class="line"><span class="variable">$14</span> = 168430090</span><br><span class="line">(gdb) <span class="built_in">print</span> *arr@</span><br><span class="line">A syntax error <span class="keyword">in</span> expression, near `<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">(gdb) bt full</span></span><br><span class="line"><span class="string">#0  printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">        i = 3</span></span><br><span class="line"><span class="string">#1  0x00000000004006ec in main () at test2.c:20</span></span><br><span class="line"><span class="string">        n = 10</span></span><br><span class="line"><span class="string">        arr = &#123;168430090, 168430091, 168430092, 168430090, 168430090, 168430090, 168430090, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string">(gdb) p i</span></span><br><span class="line"><span class="string">$15 = 4</span></span><br><span class="line"><span class="string">(gdb) p arr[i]</span></span><br><span class="line"><span class="string">$16 = 168430090</span></span><br><span class="line"><span class="string">(gdb) p arr[20]</span></span><br><span class="line"><span class="string">$17 = -7664</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) c</span></span><br><span class="line"><span class="string">Continuing.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">7	     arr[i]=arr[i]+i;</span></span><br><span class="line"><span class="string">(gdb) p i</span></span><br><span class="line"><span class="string">$20 = 5</span></span><br><span class="line"><span class="string">(gdb) set arr[4]=125</span></span><br><span class="line"><span class="string">(gdb) bt full</span></span><br><span class="line"><span class="string">#0  printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">        i = 5</span></span><br><span class="line"><span class="string">#1  0x00000000004006ec in main () at test2.c:20</span></span><br><span class="line"><span class="string">        n = 10</span></span><br><span class="line"><span class="string">        arr = &#123;168430090, 168430091, 168430092, 168430093, 125, 168430090, 168430090, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) c</span></span><br><span class="line"><span class="string">Continuing.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">7	     arr[i]=arr[i]+i;</span></span><br><span class="line"><span class="string">(gdb) bt full</span></span><br><span class="line"><span class="string">#0  printArray (arr=0x7fffffffe0d0, n=10) at test2.c:7</span></span><br><span class="line"><span class="string">        i = 6</span></span><br><span class="line"><span class="string">#1  0x00000000004006ec in main () at test2.c:20</span></span><br><span class="line"><span class="string">        n = 10</span></span><br><span class="line"><span class="string">        arr = &#123;168430090, 168430091, 168430092, 168430093, 168430094, 168430095, 168430090, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string">(gdb) p i</span></span><br><span class="line"><span class="string">No symbol &quot;i&quot; in current context.</span></span><br><span class="line"><span class="string">(gdb) p $i</span></span><br><span class="line"><span class="string">$24 = 5</span></span><br><span class="line"><span class="string">(gdb) set arr[$i]=10</span></span><br><span class="line"><span class="string">(gdb) set arr[$i++]=11</span></span><br><span class="line"><span class="string">(gdb) p arr[5]</span></span><br><span class="line"><span class="string">$26 = 10</span></span><br><span class="line"><span class="string">(gdb) p arr[6]</span></span><br><span class="line"><span class="string">$27 = 11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) p/t arr[6]</span></span><br><span class="line"><span class="string">$28 = 1011</span></span><br><span class="line"><span class="string">(gdb) p/x arr[6]</span></span><br><span class="line"><span class="string">$29 = 0xb</span></span><br><span class="line"><span class="string">(gdb) p/f arr[6]</span></span><br><span class="line"><span class="string">$30 = 1.54142831e-44</span></span><br><span class="line"><span class="string">(gdb) p/c arr[6]</span></span><br><span class="line"><span class="string">$31 = 11 &#x27;</span>\v<span class="string">&#x27;</span></span><br><span class="line"><span class="string">(gdb) p/d arr[6]</span></span><br><span class="line"><span class="string">$32 = 11</span></span><br><span class="line"><span class="string">(gdb) p/o arr[6]</span></span><br><span class="line"><span class="string">$33 = 013</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">examine (x command)</span></span><br><span class="line"><span class="string">(gdb) p arr</span></span><br><span class="line"><span class="string">$37 = &#123;168430090, 168430091, 168430092, 168430093, 168430094, 10, 11, 168430090, 168430090, 168430090&#125;</span></span><br><span class="line"><span class="string">      __________ same with print format</span></span><br><span class="line"><span class="string">      |</span></span><br><span class="line"><span class="string">x/[n][f][u]</span></span><br><span class="line"><span class="string">   |     |</span></span><br><span class="line"><span class="string"> number  -------------- b. Bytes. h. Halfwords (two bytes). w. Words (four bytes) This is the initial default.  g. Giant words (eight bytes)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) x/10d arr</span></span><br><span class="line"><span class="string">0x7fffffffe0d0:	168430090	168430091	168430092	168430093</span></span><br><span class="line"><span class="string">0x7fffffffe0e0:	168430094	10	11	168430090</span></span><br><span class="line"><span class="string">0x7fffffffe0f0:	168430090	168430090</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) info reg</span></span><br><span class="line"><span class="string">rax            0x400aaae297396d09	4614688658370948361</span></span><br><span class="line"><span class="string">rbx            0x7fffffffe100	140737488347392</span></span><br><span class="line"><span class="string">rcx            0x7fffdfafe9b0	140736946235824</span></span><br><span class="line"><span class="string">rdx            0xa	10</span></span><br><span class="line"><span class="string">rsi            0xa	10</span></span><br><span class="line"><span class="string">rdi            0x7fffffffe0d0	140737488347344</span></span><br><span class="line"><span class="string">rbp            0x7fffffffe0c0	0x7fffffffe0c0</span></span><br><span class="line"><span class="string">rsp            0x7fffffffe090	0x7fffffffe090</span></span><br><span class="line"><span class="string">r8             0xffffffffffffffff	-1</span></span><br><span class="line"><span class="string">r9             0x0	0</span></span><br><span class="line"><span class="string">r10            0x22	34</span></span><br><span class="line"><span class="string">r11            0x246	582</span></span><br><span class="line"><span class="string">r12            0x4004d0	4195536</span></span><br><span class="line"><span class="string">r13            0x7fffffffe210	140737488347664</span></span><br><span class="line"><span class="string">r14            0x0	0</span></span><br><span class="line"><span class="string">r15            0x0	0</span></span><br><span class="line"><span class="string">rip            0x4005da	0x4005da &lt;printArray+29&gt;</span></span><br><span class="line"><span class="string">eflags         0x206	[ PF IF ]</span></span><br><span class="line"><span class="string">cs             0x33	51</span></span><br><span class="line"><span class="string">ss             0x2b	43</span></span><br><span class="line"><span class="string">ds             0x0	0</span></span><br><span class="line"><span class="string">es             0x0	0</span></span><br><span class="line"><span class="string">fs             0x0	0</span></span><br><span class="line"><span class="string">gs             0x0	0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) list</span></span><br><span class="line"><span class="string">1	#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">2	int main()</span></span><br><span class="line"><span class="string">3	&#123;</span></span><br><span class="line"><span class="string">4	        float x = 456.876;</span></span><br><span class="line"><span class="string">5	        printf (&quot;\nx = %f\n&quot;, x);</span></span><br><span class="line"><span class="string">6	        return 0;</span></span><br><span class="line"><span class="string">7	&#125;</span></span><br><span class="line"><span class="string">(gdb) b 4</span></span><br><span class="line"><span class="string">Breakpoint 1 at 0x400535: file float.c, line 4.</span></span><br><span class="line"><span class="string">(gdb) b 5</span></span><br><span class="line"><span class="string">Breakpoint 2 at 0x40053e: file float.c, line 5.</span></span><br><span class="line"><span class="string">(gdb) b 6</span></span><br><span class="line"><span class="string">Breakpoint 3 at 0x400555: file float.c, line 6.</span></span><br><span class="line"><span class="string">(gdb) c</span></span><br><span class="line"><span class="string">The program is not being run.</span></span><br><span class="line"><span class="string">(gdb) start</span></span><br><span class="line"><span class="string">Temporary breakpoint 4 at 0x400535: file float.c, line 4.</span></span><br><span class="line"><span class="string">Starting program: /root/./a.out</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, main () at float.c:4</span></span><br><span class="line"><span class="string">4	        float x = 456.876;</span></span><br><span class="line"><span class="string">(gdb) n</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 2, main () at float.c:5</span></span><br><span class="line"><span class="string">5	        printf (&quot;\nx = %f\n&quot;, x);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) p x</span></span><br><span class="line"><span class="string">$5 = 456.876007</span></span><br><span class="line"><span class="string">(gdb) x/fw &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe12c:	456.876007</span></span><br><span class="line"><span class="string">(gdb) x/tw &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe12c:	01000011111001000111000000100001</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### modify the float to double</span></span><br><span class="line"><span class="string">(gdb) list</span></span><br><span class="line"><span class="string">1	#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">2	int main()</span></span><br><span class="line"><span class="string">3	&#123;</span></span><br><span class="line"><span class="string">4	        //float x = 456.876;</span></span><br><span class="line"><span class="string">5	        double x = 456.876;</span></span><br><span class="line"><span class="string">6	        printf (&quot;\nx = %lf\n&quot;, x);</span></span><br><span class="line"><span class="string">7	        return 0;</span></span><br><span class="line"><span class="string">8	&#125;</span></span><br><span class="line"><span class="string">(gdb) x/1fg &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe128:	456.87599999999998</span></span><br><span class="line"><span class="string">(gdb) x/1tg &amp;x</span></span><br><span class="line"><span class="string">0x7fffffffe128:	0100000001111100100011100000010000011000100100110111010010111100</span></span><br><span class="line"><span class="string">(gdb) p x</span></span><br><span class="line"><span class="string">$6 = 456.87599999999998</span></span><br></pre></td></tr></table></figure>



<h3 id="print-argv"><a href="#print-argv" class="headerlink" title="print argv"></a><a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/set-program-args.html">print argv</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -g3 walk1.c -o walk</span><br><span class="line">$ gdb ./walk <span class="comment"># or you could $ gdb -args ./walk /tmp 10</span></span><br><span class="line">Reading symbols from /root/walk...done.</span><br><span class="line"></span><br><span class="line">(gdb) b main</span><br><span class="line">Breakpoint 1 at 0x400bb8: file walk1.c, line 73.</span><br><span class="line">(gdb) r /tmp 10 <span class="comment">#  or you could (gdb) set args /tmp 10</span></span><br><span class="line">Starting program: /root/./walk /tmp 10</span><br><span class="line"></span><br><span class="line">Breakpoint 1, main (argc=3, argv=0x7fffffffe138) at walk1.c:73</span><br><span class="line">73	    <span class="keyword">if</span>(argc != 3)</span><br><span class="line">(gdb) p argc</span><br><span class="line"><span class="variable">$1</span> = 3</span><br><span class="line">(gdb) p argv</span><br><span class="line"><span class="variable">$2</span> = (char **) 0x7fffffffe138</span><br><span class="line">(gdb) p argv[0]</span><br><span class="line"><span class="variable">$3</span> = 0x7fffffffe414 <span class="string">&quot;/root/./walk&quot;</span></span><br><span class="line">(gdb) p argv[1]</span><br><span class="line"><span class="variable">$4</span> = 0x7fffffffe421 <span class="string">&quot;/tmp&quot;</span></span><br><span class="line">(gdb) p argv[2]</span><br><span class="line"><span class="variable">$5</span> = 0x7fffffffe426 <span class="string">&quot;10&quot;</span></span><br><span class="line">(gdb)</span><br><span class="line"></span><br><span class="line"><span class="comment"># attach args</span></span><br><span class="line">$ gdb --args /bin/bash -c <span class="string">&#x27;ls -l&#x27;</span></span><br><span class="line">$ <span class="built_in">set</span> listsize 40</span><br><span class="line">$ p *args@4 </span><br><span class="line"></span><br><span class="line"><span class="comment"># if the software was install by source, you could add --directory for import debug symbol</span></span><br><span class="line"><span class="comment"># re-complie bash</span></span><br><span class="line"></span><br><span class="line">$ gdb --args /usr/<span class="built_in">local</span>/bin/bash -c <span class="string">&#x27;echo [1g]&#x27;</span> --directory ~/tools/bash-4.4</span><br><span class="line">(gdb) la src</span><br><span class="line"></span><br><span class="line"><span class="comment">## if you want disable optimze</span></span><br><span class="line">$ CFLAGS=<span class="string">&quot;-g -O0&quot;</span> CXXFLAGS=<span class="string">&quot;-g -O0&quot;</span> LDFLAGS=<span class="string">&quot;-g&quot;</span>  ./configure --enable-debugger</span><br><span class="line">$ CFLAGS=<span class="string">&quot;-g -O0&quot;</span> CXXFLAGS=<span class="string">&quot;-g -O0&quot;</span> LDFLAGS=<span class="string">&quot;-g&quot;</span>  ./make -j 2</span><br><span class="line"></span><br><span class="line"><span class="comment">## set debug directory</span></span><br><span class="line">(gdb) <span class="built_in">set</span> debug-file-directory &lt;directory&gt;</span><br><span class="line">(gdb) show debug-file-directory</span><br><span class="line">(gdb) <span class="built_in">set</span> debug-file-directory /usr/lib/debug</span><br><span class="line">add-symbol-file filename address</span><br><span class="line">add-symbol-file filename address [ -readnow ] [ -mapped ]</span><br><span class="line">add-symbol-file filename -ssection address ...</span><br></pre></td></tr></table></figure>

<h3 id="golang"><a href="#golang" class="headerlink" title="golang"></a>golang</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -gcflags <span class="string">&quot;-N -l&quot;</span> gdbsandbox.go</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gdb -p <span class="variable">$pid</span></span><br><span class="line">(gdb) disas readline</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/03/gdb/" data-id="ckg0we484005pa1o6cz165otl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/debug/" rel="tag">debug</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ansible/">ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/awk/">awk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bash/">bash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/benchmark/">benchmark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bios/">bios</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/block/">block</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/container/">container</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/debug/">debug</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/device-mapper/">device_mapper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/filesystem/">filesystem</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gdb/">gdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ha/">ha</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hardware/">hardware</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ipmi/">ipmi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mdraid/">mdraid</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/proc/">proc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/raid/">raid</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scsi/">scsi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storage/">storage</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/virtualization/">virtualization</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/" rel="tag">architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/" rel="tag">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bcc/" rel="tag">bcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/benchmark/" rel="tag">benchmark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bios/" rel="tag">bios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/block/" rel="tag">block</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bpf/" rel="tag">bpf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/calls/" rel="tag">calls</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cpu/" rel="tag">cpu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/" rel="tag">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dell/" rel="tag">dell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dm/" rel="tag">dm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/driver/" rel="tag">driver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ext4/" rel="tag">ext4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fio/" rel="tag">fio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fsck/" rel="tag">fsck</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftrace/" rel="tag">ftrace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gpt/" rel="tag">gpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ha/" rel="tag">ha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hardware/" rel="tag">hardware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ipmi/" rel="tag">ipmi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/irq/" rel="tag">irq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/isdct/" rel="tag">isdct</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kvm/" rel="tag">kvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lfs/" rel="tag">lfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lxc/" rel="tag">lxc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/megaraid/" rel="tag">megaraid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mem/" rel="tag">mem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memory/" rel="tag">memory</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/multipath/" rel="tag">multipath</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nfs/" rel="tag">nfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nic/" rel="tag">nic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pci/" rel="tag">pci</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perf/" rel="tag">perf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/posix/" rel="tag">posix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/" rel="tag">postgresql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/privoxy/" rel="tag">privoxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/process/" rel="tag">process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/" rel="tag">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/racadm/" rel="tag">racadm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raid/" rel="tag">raid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ratio/" rel="tag">ratio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sas/" rel="tag">sas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sata/" rel="tag">sata</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/schdule/" rel="tag">schdule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scsi/" rel="tag">scsi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/smcli/" rel="tag">smcli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sparse/" rel="tag">sparse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssd/" rel="tag">ssd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/system/" rel="tag">system</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/topology/" rel="tag">topology</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/trace/" rel="tag">trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virt/" rel="tag">virt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualization/" rel="tag">virtualization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xfs/" rel="tag">xfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zfs/" rel="tag">zfs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/architecture/" style="font-size: 10px;">architecture</a> <a href="/tags/awk/" style="font-size: 10px;">awk</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/bcc/" style="font-size: 12px;">bcc</a> <a href="/tags/benchmark/" style="font-size: 14px;">benchmark</a> <a href="/tags/bios/" style="font-size: 10px;">bios</a> <a href="/tags/block/" style="font-size: 16px;">block</a> <a href="/tags/bpf/" style="font-size: 12px;">bpf</a> <a href="/tags/calls/" style="font-size: 10px;">calls</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/cpu/" style="font-size: 12px;">cpu</a> <a href="/tags/debug/" style="font-size: 12px;">debug</a> <a href="/tags/dell/" style="font-size: 10px;">dell</a> <a href="/tags/dm/" style="font-size: 10px;">dm</a> <a href="/tags/driver/" style="font-size: 10px;">driver</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/ext4/" style="font-size: 10px;">ext4</a> <a href="/tags/fio/" style="font-size: 10px;">fio</a> <a href="/tags/fsck/" style="font-size: 10px;">fsck</a> <a href="/tags/ftrace/" style="font-size: 10px;">ftrace</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/gpt/" style="font-size: 10px;">gpt</a> <a href="/tags/ha/" style="font-size: 12px;">ha</a> <a href="/tags/hardware/" style="font-size: 10px;">hardware</a> <a href="/tags/ipmi/" style="font-size: 10px;">ipmi</a> <a href="/tags/irq/" style="font-size: 10px;">irq</a> <a href="/tags/isdct/" style="font-size: 10px;">isdct</a> <a href="/tags/kvm/" style="font-size: 10px;">kvm</a> <a href="/tags/lfs/" style="font-size: 12px;">lfs</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/lxc/" style="font-size: 10px;">lxc</a> <a href="/tags/megaraid/" style="font-size: 10px;">megaraid</a> <a href="/tags/mem/" style="font-size: 10px;">mem</a> <a href="/tags/memory/" style="font-size: 10px;">memory</a> <a href="/tags/multipath/" style="font-size: 10px;">multipath</a> <a href="/tags/network/" style="font-size: 12px;">network</a> <a href="/tags/nfs/" style="font-size: 12px;">nfs</a> <a href="/tags/nic/" style="font-size: 10px;">nic</a> <a href="/tags/pci/" style="font-size: 10px;">pci</a> <a href="/tags/perf/" style="font-size: 10px;">perf</a> <a href="/tags/posix/" style="font-size: 10px;">posix</a> <a href="/tags/postgresql/" style="font-size: 10px;">postgresql</a> <a href="/tags/privoxy/" style="font-size: 10px;">privoxy</a> <a href="/tags/process/" style="font-size: 10px;">process</a> <a href="/tags/proxy/" style="font-size: 12px;">proxy</a> <a href="/tags/racadm/" style="font-size: 10px;">racadm</a> <a href="/tags/raid/" style="font-size: 12px;">raid</a> <a href="/tags/ratio/" style="font-size: 10px;">ratio</a> <a href="/tags/sas/" style="font-size: 12px;">sas</a> <a href="/tags/sata/" style="font-size: 12px;">sata</a> <a href="/tags/schdule/" style="font-size: 10px;">schdule</a> <a href="/tags/scsi/" style="font-size: 14px;">scsi</a> <a href="/tags/smcli/" style="font-size: 10px;">smcli</a> <a href="/tags/sparse/" style="font-size: 10px;">sparse</a> <a href="/tags/ssd/" style="font-size: 10px;">ssd</a> <a href="/tags/system/" style="font-size: 10px;">system</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/test/" style="font-size: 18px;">test</a> <a href="/tags/topology/" style="font-size: 10px;">topology</a> <a href="/tags/trace/" style="font-size: 10px;">trace</a> <a href="/tags/ubuntu/" style="font-size: 12px;">ubuntu</a> <a href="/tags/virt/" style="font-size: 10px;">virt</a> <a href="/tags/virtualization/" style="font-size: 10px;">virtualization</a> <a href="/tags/xfs/" style="font-size: 10px;">xfs</a> <a href="/tags/zfs/" style="font-size: 20px;">zfs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/07/24/bpftrace/">bpftrace</a>
          </li>
        
          <li>
            <a href="/2020/07/22/network-benchmark-result/">Network bencharmk results</a>
          </li>
        
          <li>
            <a href="/2020/06/01/mdadm/">backup the mdraid info</a>
          </li>
        
          <li>
            <a href="/2020/03/24/syscall/">syscall</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Ginger<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>