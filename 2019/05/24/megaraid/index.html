<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Replace megaraid by strocli | 己不由心，身又岂能由己</title><meta name="keywords" content="raid,megaraid"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="Got megaraid log123456789101112perccli64 &#x2F;call show all logfile&#x3D;megaraid.cfgperccli64 &#x2F;call show events file&#x3D;events.logperccli64 &#x2F;call show termlog type&#x3D;config logfile&#x3D;termlog.configperccli64 &#x2F;call sh">
<meta property="og:type" content="article">
<meta property="og:title" content="Replace megaraid by strocli">
<meta property="og:url" content="http://yoursite.com/2019/05/24/megaraid/index.html">
<meta property="og:site_name" content="己不由心，身又岂能由己">
<meta property="og:description" content="Got megaraid log123456789101112perccli64 &#x2F;call show all logfile&#x3D;megaraid.cfgperccli64 &#x2F;call show events file&#x3D;events.logperccli64 &#x2F;call show termlog type&#x3D;config logfile&#x3D;termlog.configperccli64 &#x2F;call sh">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg">
<meta property="article:published_time" content="2019-05-24T01:26:24.000Z">
<meta property="article:modified_time" content="2020-10-09T12:24:23.370Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="raid">
<meta property="article:tag" content="megaraid">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2019/05/24/megaraid/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-10-09 20:24:23'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/244247-guts.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Got-megaraid-log"><span class="toc-number">1.</span> <span class="toc-text">Got megaraid log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-time"><span class="toc-number">2.</span> <span class="toc-text">Set time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-cache-policy"><span class="toc-number">3.</span> <span class="toc-text">Set cache policy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-raid10"><span class="toc-number">4.</span> <span class="toc-text">Create raid10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Megaraid-FastPATH-for-SAS-SATA-SSD"><span class="toc-number">5.</span> <span class="toc-text">Megaraid FastPATH for SAS&#x2F;SATA SSD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#case-1"><span class="toc-number">5.1.</span> <span class="toc-text">case 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Setting-BBU"><span class="toc-number">5.2.</span> <span class="toc-text">Setting BBU</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cachevault"><span class="toc-number">5.3.</span> <span class="toc-text">Cachevault</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-all-megaraid-log-not-filter"><span class="toc-number">5.4.</span> <span class="toc-text">Get all megaraid log, not filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Show-raid-logic-info"><span class="toc-number">5.5.</span> <span class="toc-text">Show raid logic info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Import-license"><span class="toc-number">5.6.</span> <span class="toc-text">Import license</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Backup-config"><span class="toc-number">5.7.</span> <span class="toc-text">Backup config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Interrupt-BGI"><span class="toc-number">5.8.</span> <span class="toc-text">Interrupt BGI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rebuild-Migrate-init"><span class="toc-number">5.9.</span> <span class="toc-text">Rebuild&#x2F;Migrate&#x2F;init</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Make-device-good"><span class="toc-number">5.10.</span> <span class="toc-text">Make device good</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Make-JBOD"><span class="toc-number">5.11.</span> <span class="toc-text">Make JBOD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Foreign-devices"><span class="toc-number">5.12.</span> <span class="toc-text">Foreign devices</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#About-Consistency-and-patrol-read"><span class="toc-number">6.</span> <span class="toc-text">About Consistency and patrol read</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Patrol-read"><span class="toc-number">6.1.</span> <span class="toc-text">Patrol read</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Consistency-Check"><span class="toc-number">6.2.</span> <span class="toc-text">Consistency Check</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Montor-cache-ECC-count"><span class="toc-number">7.</span> <span class="toc-text">Montor cache ECC count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#About-device-write-cache-in-megaraid"><span class="toc-number">8.</span> <span class="toc-text">About device write cache in megaraid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Backup-and-restore-config-file"><span class="toc-number">9.</span> <span class="toc-text">Backup and restore config file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flush-RAID-write-cache"><span class="toc-number">10.</span> <span class="toc-text">Flush RAID write cache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#show-PHY"><span class="toc-number">11.</span> <span class="toc-text">show PHY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Foreign-configurations"><span class="toc-number">12.</span> <span class="toc-text">Foreign configurations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dimmer-switch"><span class="toc-number">13.</span> <span class="toc-text">Dimmer switch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Device"><span class="toc-number">14.</span> <span class="toc-text">Device</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug"><span class="toc-number">15.</span> <span class="toc-text">debug</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#log"><span class="toc-number">15.1.</span> <span class="toc-text">log</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Encolsure"><span class="toc-number">15.2.</span> <span class="toc-text">Encolsure</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phy-err"><span class="toc-number">15.3.</span> <span class="toc-text">phy err</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#diag-adapter"><span class="toc-number">15.4.</span> <span class="toc-text">diag adapter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-SEP-for-Dell-PERC"><span class="toc-number">15.5.</span> <span class="toc-text">Enable SEP for Dell PERC</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enable-JBOD"><span class="toc-number">16.</span> <span class="toc-text">Enable JBOD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SAS-loading-balance"><span class="toc-number">17.</span> <span class="toc-text">SAS loading balance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Driver-performance"><span class="toc-number">18.</span> <span class="toc-text">Driver performance</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-smart-info-from-LSI-megaraid"><span class="toc-number">18.1.</span> <span class="toc-text">Get smart info from LSI megaraid</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#performance-monitor"><span class="toc-number">19.</span> <span class="toc-text">performance monitor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#T10-PI-for-megaraid"><span class="toc-number">20.</span> <span class="toc-text">T10 PI for megaraid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#About-T10-rebuild-assist-for-megaraid"><span class="toc-number">21.</span> <span class="toc-text">About T10 rebuild assist for megaraid</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-T10-data-protection-in-LSI-9380-8e"><span class="toc-number">21.1.</span> <span class="toc-text">Enable T10-data-protection in LSI 9380-8e</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-raid-and-enable-T10-pi-data-protection"><span class="toc-number">21.2.</span> <span class="toc-text">Create raid and enable T10-pi data protection</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redhat-support"><span class="toc-number">21.3.</span> <span class="toc-text">Redhat support</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">己不由心，身又岂能由己</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Replace megaraid by strocli</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-05-24T01:26:24.000Z" title="Created 2019-05-24 09:26:24">2019-05-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-10-09T12:24:23.370Z" title="Updated 2020-10-09 20:24:23">2020-10-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Storage/">Storage</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="Got-megaraid-log"><a href="#Got-megaraid-log" class="headerlink" title="Got megaraid log"></a>Got megaraid log</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">perccli64 /call show all logfile=megaraid.cfg<br>perccli64 /call show events file=events.log<br>perccli64 /call show termlog <span class="hljs-built_in">type</span>=config logfile=termlog.config<br>perccli64 /call show termlog <span class="hljs-built_in">type</span>=contents logfile=termlog.contents<br>perccli64 /call show eventloginfo<br>perccli64 /call show dequeuelog file=dequeue.log<br>perccli64 /call show alilog logfile=ali.log<br><br><span class="hljs-comment"># clear the log</span><br><span class="hljs-comment">#perccli64 /c x set debug reset all</span><br><span class="hljs-comment">#perccli64 /call delete events</span><br><span class="hljs-comment">#perccli64 /call delete termlog</span><br></code></pre></td></tr></table></figure>

<h3 id="Set-time"><a href="#Set-time" class="headerlink" title="Set time"></a>Set time</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /call show time<br>$ storcli64 /call <span class="hljs-built_in">set</span> time=yyyymmdd hh:mm:ss|systemtime<br>$ timedatectl set-timezone Asia/XXXXXX<br>$ storcli64 /call <span class="hljs-built_in">set</span> time=systemtime<br></code></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="Set-cache-policy"><a href="#Set-cache-policy" class="headerlink" title="Set cache policy"></a>Set cache policy</h3><p>Disable write back cache</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ storcli64 /c0/v0 <span class="hljs-builtin-name">set</span> <span class="hljs-attribute">wrcache</span>=wb/wt/awb <span class="hljs-attribute">rdcache</span>=ra <span class="hljs-attribute">iopolicy</span>=cached <span class="hljs-attribute">pdcache</span>=on<br></code></pre></td></tr></table></figure>

<h3 id="Create-raid10"><a href="#Create-raid10" class="headerlink" title="Create raid10"></a>Create raid10</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /c0 add vd <span class="hljs-built_in">type</span>=raid10 drives=252:0-7 pdperarray=2 WT strip=64<br>$ storcli64 /c0 add vd <span class="hljs-built_in">type</span>=raid5 drives=252:0,2,4,6 WT strip=64<br>$ storcli64 /c0/vXX del force<br><br>$ storcli64 /c0/e54/s43,44 add hotsparedrive <span class="hljs-comment">#global hs</span><br>$ storcli64 /c0/e54/s43 add hotsparedrive dgs=0,1 <span class="hljs-comment">#as Dedicated Hot spare for disk groups 0,1</span><br>$ storcli64 /c0/e54/s43 delete hotsparedrive <span class="hljs-comment">#deletes a hot spare drive</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/en/doc/EDOC1000111853?section=j005">reference</a><br><img src="/img/lsi-3108-example-20191010.png"><br>Read Policy</p>
<ul>
<li>No Read Ahead: disables the Read Ahead function.</li>
<li>Read Ahead: enables the Read Ahead function. The controller pre-reads sequential data or the data predicted to be used and saves it in the cache.</li>
</ul>
<p>Write Policy</p>
<ul>
<li>Write Back: After the controller cache receives all data, the controller sends the host a message indicating that data transmission is complete.</li>
<li>Write Through: After the drive subsystem receives all data, the controller sends the host a message indicating that data transmission is complete.</li>
<li>Always Write Back: Virtual drive remains in Write Back mode if the capacitor fails or no capacitor exists.</li>
</ul>
<p>I/O Policy</p>
<ul>
<li>Direct: Data is read directly and is not cached. This is the recommended mode for common configuration.</li>
<li>Cached: All data is read from cache. This is the recommended mode for CacheCade.</li>
</ul>
<p>Access Policy</p>
<ul>
<li>Read/Write: Read and write operations are allowed.</li>
<li>Read Only: The virtual drive is read-only.</li>
<li>Blocked: The virtual drive is locked from access.</li>
</ul>
<p>Drive Cache</p>
<ul>
<li>Unchanged: uses the current cache policy.</li>
<li>Enable: writes data to the cache before writing data to the hard drive. This option improves data write performance. However, data may be lost if there is no protection mechanism against power failures.</li>
<li>Disable: writes data to a hard drive without caching the data. Data is not lost if power failures occur.</li>
</ul>
<p>Emulation Type<br>Set the sector size reported to the OS.<br>50</p>
<ul>
<li><p>If the member drive is 512B/512B:</p>
<ul>
<li>Default: The logical drive sector is 512B/512B.</li>
<li>None: The logical drive sector is 512B/512B.</li>
<li>Force: The logical drive sector is 512B/4KB.</li>
</ul>
</li>
<li><p>If the member drive is 512B/4KB:</p>
<ul>
<li>Default: The logical drive sector is 512B/4KB.</li>
<li>None: The logical drive sector is 512B/512B.</li>
<li>Force: The logical drive sector is 512B/4KB.</li>
</ul>
</li>
</ul>
<h3 id="Megaraid-FastPATH-for-SAS-SATA-SSD"><a href="#Megaraid-FastPATH-for-SAS-SATA-SSD" class="headerlink" title="Megaraid FastPATH for SAS/SATA SSD"></a>Megaraid FastPATH for SAS/SATA SSD</h3><h4 id="case-1"><a href="#case-1" class="headerlink" title="case 1"></a><a target="_blank" rel="noopener" href="https://lenovopress.com/lp0592.pdf">case 1</a></h4><p>Suggest RAID5<br>To benefit from FastPath, an array must be defined using these specific parameters:</p>
<ul>
<li>Write Through</li>
<li>Direct IO</li>
<li>No Read Ahead</li>
<li>64KB stripe size (for most workloads)</li>
<li>RAID 5(fastpath support all raid level)</li>
<li>Disk Cache Policy: This controls the write cache policy for the drives in the arrays (as opposed to the write cache policy of the RAID adapter). Enabling disk write caching can put data at risk.<ul>
<li>full initialization</li>
</ul>
</li>
</ul>
<p>With FastPath enabled, and when certain conditions are met, the MegaRAID software stack running on the RAID controller can bypass portions of the software stack, resulting in a highly efficient, streamlined code path that the RAID controller can execute very quickly. This means that the RAID controller can handle more trips though its code in a given amount of time, which equates to higher possible IOPS.</p>
<p>FastPath is not designed to speed up slow storage. It will not have an effect on storage performance unless the RAID controller is the bottleneck. If the controller itself is limiting storage performance, then enabling FastPath will allow the controller to run faster, raising performance. FastPath is not meant for use with HDD storage nor is it meant for sequential workloads.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /c0 show aso<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Premium Feature Key :<br>===================<br><br>--------------------------------------------------------------<br>Adv S/W Opt                 Time Remaining  Mode<br>--------------------------------------------------------------<br>MegaRAID FastPath           Unlimited       Secured<br>MegaRAID CacheCade Pro 2.0  Unlimited       Secured<br>MegaRAID RAID6              Unlimited       Factory Installed<br>MegaRAID RAID5              Unlimited       Factory Installed<br>--------------------------------------------------------------<br><br><br>Re-host Information :<br>===================<br>Needs Re-hosting = NO<br>``<br><br><span class="hljs-comment">#### [Case 2: Aerospike Certification Tool](https://www.aerospike.com/docs/operations/plan/ssd/lsi_megacli.html)</span><br>RAID Level	0<br>Write Policy	Write Through<br>Read Policy	No Read Ahead<br>IO Policy	Direct IO<br>Other	        No write to cache <span class="hljs-keyword">if</span> bad BBU<br><br>Dell R720xd<br>PERC H710p RAID controller<br>8 x 200 GB Intel s3700 SSDs<br><br>Latency measures during torture tests (96,000 reads/sec and 48,000 concurrent writes/second).<br>RAID setting	% &gt;1 ms	% &gt;2 ms	% &gt;4 ms	% &gt;8 ms	% &gt;16 ms<br>Default	        22.20	13.96	4.29	0.22	0.00<br>FastPath™	4.31	0.85	0.17	0.00	0.00<br><br>The latencies <span class="hljs-keyword">for</span> the FastPath™ are much better. In general better latency results mean much higher threshold <span class="hljs-keyword">for</span> throughput.<br><br><span class="hljs-comment">### Storcli replace Megacli</span><br><span class="hljs-comment">#### BBU info</span><br>```bash<br>$ /opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -getBbuProperties -aALL<br><br><br>BBU Properties <span class="hljs-keyword">for</span> Adapter: 0<br><br>  Auto Learn Period: 30 Days<br>  Next Learn time: Mon Jun  3 12:02:38 2019<br><br>  Learn Delay Interval:0 Hours<br>  Auto-Learn Mode: Enabled<br>  BBU Mode = 4<br><br>$ /opt/MegaRAID/storcli/storcli64 /call/bbu show properties<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>BBU_Properties :<br>==============<br><br>--------------------------------------------------------------<br>Property             Value<br>--------------------------------------------------------------<br>Auto Learn Period    30d (2592000 seconds)<br>Next Learn time      2019/06/03  12:02:38 (612878558 seconds)<br>Learn Delay Interval 0 hour(s)<br>Auto-Learn Mode      Enabled<br>BBU Mode             4<br>--------------------------------------------------------------<br><br>$ /opt/MegaRAID/storcli/storcli64 /call/bbu show status<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>BBU_Info :<br>========<br><br>------------------------------------------------------------------<br>Property      Value<br>------------------------------------------------------------------<br>BatteryType   iBBU08<br>Voltage       4056 mV<br>Current       0 mA<br>Temperature   31 C<br>Battery State Optimal<br>Design Mode   1: 12+ Hrs retention with a transparent learn cycle<br>                 and best service life.<br>------------------------------------------------------------------<br><br><br>BBU_Firmware_Status :<br>===================<br><br>-------------------------------------------------<br>Property                                   Value<br>-------------------------------------------------<br>Charging Status                            None<br>Voltage                                    OK<br>Temperature                                OK<br>Learn Cycle Requested                      No<br>Learn Cycle Active                         No<br>Learn Cycle Status                         OK<br>Learn Cycle Timeout                        No<br>I2C Errors Detected                        No<br>Battery Pack Missing                       No<br>Battery Replacement required               No<br>Remaining Capacity Low                     No<br>Periodic Learn Required                    No<br>Transparent Learn                          No<br>No space to cache offload                  No<br>Pack is about to fail &amp; should be replaced No<br>Cache Offload premium feature required     No<br>Module microcode update required           No<br>-------------------------------------------------<br><br>GasGaugeStatus :<br>==============<br><br>--------------------------------------<br>Property                   Value<br>--------------------------------------<br>Fully Discharged           No<br>Fully Charged              No<br>Discharging                No<br>Initialized                Yes<br>Remaining Time Alarm       No<br>Terminate Discharge Alarm  No<br>Over Temperature           No<br>Charging Terminated        No<br>Over Charged               No<br>Relative State of Charge   97%<br>Charger System State       1<br>Charger System Ctrl        0<br>Charging current           0 mA<br>Absolute state of charge   78%<br>Max Error                  0%<br>Battery backup charge time 48 hours +<br>--------------------------------------<br><br>$ /opt/MegaRAID/storcli/storcli64 /call/bbu show status | grep -i <span class="hljs-built_in">type</span><br>BatteryType   iBBU08<br><br><span class="hljs-comment">#important value</span><br>Remaining Capacity Low                  : No<br><br><span class="hljs-comment">#design capacity: 1500, max</span><br>Relative State of Charge ＝ 1055 ／ 1198 ～ 89%<br>Absolute State of charge ＝ 1055 ／ 1500 ～ 70%<br></code></pre></td></tr></table></figure>

<h4 id="Setting-BBU"><a href="#Setting-BBU" class="headerlink" title="Setting BBU"></a>Setting BBU</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli /cx/bbu <span class="hljs-built_in">set</span> learnDelayInterval=168 <span class="hljs-comment">#hours</span><br><br>$ /opt/MegaRAID/storcli/storcli64 /call/bbu show modes<br>Controller = 0<br>Status = Success<br>Description = Get BBU Modes Succeeded.<br><br>Available BBU Modes :<br>===================<br>Mode-1 = 12+ Hrs retention with a transparent learn cycle and best service life.<br>Mode-3 = 24+ Hrs retention with a transparent learn cycle and balanced service life.<br>Mode-4 = 48+ Hrs retention with a non-transparent learn cycle and balanced service life<br><br>$ storcli /cx/bbu <span class="hljs-built_in">set</span> bbuMode=&lt;value&gt;<br>0 48 hours of retentiona at 60 °C, 1-year Service Life.<br>a. Indicates how long the battery can hold data <span class="hljs-keyword">in</span> the controller<span class="hljs-string">&#x27;s memory in case of accidental system shutdown.</span><br><span class="hljs-string">1 12 hours of retention at 45 °C, 5-year Service Life, transparent learn.b</span><br><span class="hljs-string">b. The controller&#x27;</span>s performance is not affected during the battery<span class="hljs-string">&#x27;s learn cycle.</span><br><span class="hljs-string">2 12 hours of retention at 55 °C, 3-year Service Life, transparent learn.</span><br><span class="hljs-string">3 24 hours of retention at 45 °C, 3-year Service Life, transparent learn.</span><br><span class="hljs-string">4 48 hours of retention at 45 °C, 3-year Service Life.</span><br><span class="hljs-string">5 48 hours of retention at 55 °C, 1-year Service Life.</span><br><span class="hljs-string">6 Same as the description for BBU mode 5. The BBU mode 6 enables you to receive events when the battery capacity reaches suboptimal and critical thresholds.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">$ storcli /cx bbu set autolearnmode=&lt;value&gt;</span><br><span class="hljs-string">where x= 0 – Enabled, 1 – Disabled, 2 – Warn though event.</span><br><span class="hljs-string"></span><br><span class="hljs-string">## Manual learn battery</span><br><span class="hljs-string">$ storcli /c0/bbu start learn</span><br></code></pre></td></tr></table></figure>

<h4 id="Cachevault"><a href="#Cachevault" class="headerlink" title="Cachevault"></a><a target="_blank" rel="noopener" href="https://www.thomas-krenn.com/en/wiki/CacheVault_Flash_Cache">Cachevault</a></h4><p>Here is not install cachevalut, all FLASH devices don’t need it, because fastpath need writethrough mode</p>
<p>No battery is used with CacheVault technology. The cache content is protected by the following systems:</p>
<ul>
<li>A double-layer capacitor is connected to the RAID controller.</li>
<li>This will be fully loaded automatically during server startup.</li>
<li>In case of power failure the RAID controller uses the power of the capacitor to write the Flash-Memory to maintain all contents of the cache non-volatile (almost like a USB stick).</li>
<li>The next time the server is started the RAID controller writes the data from the Flash-Memory to the RAID Array.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /c0/cv show<br>Controller = 0<br>Status = Failure<br>Description = None<br><br>Detailed Status :<br>===============<br><br>----------------------------------------------------<br>Ctrl Status Property ErrMsg                   ErrCd<br>----------------------------------------------------<br>   0 Failed -        Cachevault doesn<span class="hljs-string">&#x27;t exist   255</span><br><span class="hljs-string">----------------------------------------------------</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ storcli64 /c0/cv show all</span><br><span class="hljs-string">$ storcli64 /c0/cv show learn</span><br><span class="hljs-string">$ storcli64 /c0/cv show status</span><br><span class="hljs-string">$ storcli64 /c0/cv start learn</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<h4 id="Get-all-megaraid-log-not-filter"><a href="#Get-all-megaraid-log-not-filter" class="headerlink" title="Get all megaraid log, not filter"></a>Get all megaraid log, not filter</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#shows the history of log files generated</span><br>$ storcli64  /call show eventloginfo file=logfile<br>$ MegaCli64 -AdpEventLog -GetEvents -f logfile -aALL<br><br><span class="hljs-comment">#prints the system log</span><br>$ storcli64 /c0 show events file=megaraid_events.log<br><br><span class="hljs-comment"># shows the firmware logs</span><br>$ storcli64 /c0 show termlog <br>$ storcli64 /c0 show termlog <span class="hljs-built_in">type</span>=config<br>$ storcli64 /c0 show termlog <span class="hljs-built_in">type</span>=contents<br><br></code></pre></td></tr></table></figure>

<h4 id="Show-raid-logic-info"><a href="#Show-raid-logic-info" class="headerlink" title="Show raid logic info"></a>Show raid logic info</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /cx/dall show [all]<br>$ MegaCli64 -cfgdsply -aALL<br></code></pre></td></tr></table></figure>

<h4 id="Import-license"><a href="#Import-license" class="headerlink" title="Import license"></a>Import license</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli /c0 <span class="hljs-built_in">set</span> aso key=xxxxxxxxx<br></code></pre></td></tr></table></figure>

<h4 id="Backup-config"><a href="#Backup-config" class="headerlink" title="Backup config"></a>Backup config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ MegaCli -CfgSave -f filename -aN   <br>$ MegaCli -CfgRestore -f filename -aN  <br><br>$ storcli64 /c0 <span class="hljs-built_in">set</span> config file=raid_adapter0.config<br>$ storcli64 /c0 get config file=raid_adapter0.config<br></code></pre></td></tr></table></figure>

<h4 id="Interrupt-BGI"><a href="#Interrupt-BGI" class="headerlink" title="Interrupt BGI"></a>Interrupt BGI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ MegaCli64 -LDBI -Abort -LALL -aALL<br>$ storcli64 /call/vall <span class="hljs-built_in">set</span> autobgi=On|Off<br>$ storcli64 /call/vall show autobgi<br>$ storcli64 /call/vall stop bgi<br>$ storcli64 /call/vall pause bgi<br>$ storcli64 /call/vall resume bgi<br>$ storcli64 /call/vall show bgi<br>$ storcli64 /call <span class="hljs-built_in">set</span> bgirate=90<br></code></pre></td></tr></table></figure>

<h4 id="Rebuild-Migrate-init"><a href="#Rebuild-Migrate-init" class="headerlink" title="Rebuild/Migrate/init"></a>Rebuild/Migrate/init</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ MegaCli64  -AdpSetProp RebuildRate 50 -a0<br>$ storcli64 /call <span class="hljs-built_in">set</span> rebuildrate=50<br><br>$ MegaCli64  -AdpSetProp ReconRate 50 -a0<br>$ /opt/MegaRAID/MegaCli/MegaCli64 -LDRecon ShowProg L1  -a0<br>$ storcli64 /call <span class="hljs-built_in">set</span> migraterate=50<br>$ storcli /c0/v1 show migrate<br>$ storcli /c0/v1 start migrate <span class="hljs-built_in">type</span>=raidx<br><br><span class="hljs-comment">#  automatic background initialization</span><br>$ /opt/MegaRAID/MegaCli/MegaCli64 -LDBI -ShowProg -LALL -aALL<br>$ storcli /call/vall <span class="hljs-built_in">set</span> autobgi=on<br>$ storcli /call/vall show autobgi<br>$ storcli /call/vall stop bgi<br>$ storcli /call/vall pause bgi<br>$ storcli /call/vall resume bgi<br>$ storcli /call/vall show bgi<br><br><span class="hljs-comment"># virtual drive initialization</span><br>$ /opt/MegaRAID/MegaCli/MegaCli64 -LDInit ShowProg Lall a0<br>$ storcli /c0/vall start init<br>$ storcli /c0/vall stop init<br>$ storcli /c0/vall show init<br><br><br></code></pre></td></tr></table></figure>

<h4 id="Make-device-good"><a href="#Make-device-good" class="headerlink" title="Make device good"></a>Make device good</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ MegaCli64 -PDMakeGood -PhysDrv[20:12] -a0<br>$ storcli64 /c0/e20/s12 <span class="hljs-built_in">set</span> good force<br></code></pre></td></tr></table></figure>

<h4 id="Make-JBOD"><a href="#Make-JBOD" class="headerlink" title="Make JBOD"></a>Make JBOD</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ MegaCli64 -PDMakeJBOD -PhysDrv[E0:S0,E1:S1,...] -aN|-a0,1,2|-aALL<br>$ storcli64 /c0/e20/s12 <span class="hljs-built_in">set</span> jbod (default on)<br>$ storcli64 /c0 <span class="hljs-built_in">set</span> jbod = on/off<br><br>$ MegaCli -AdpSetProp -EnableJBOD -val -aN|-a0,1,2|-aALL<br>      val - 0=Disable JBOD mode.<br>            1=Enable JBOD mode.<br><br>$ storcli64 /c0 <span class="hljs-built_in">set</span> jbod=on<br><br></code></pre></td></tr></table></figure>

<h4 id="Foreign-devices"><a href="#Foreign-devices" class="headerlink" title="Foreign devices"></a>Foreign devices</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ MegaCli64  -CfgForeign -Clear -aALL<br>$ storcli64 /c0/fall del|delete<br><br>$ storcli64 /c0/fall show<br>$ storcli64 /c0/fall import<br></code></pre></td></tr></table></figure>

<h3 id="About-Consistency-and-patrol-read"><a href="#About-Consistency-and-patrol-read" class="headerlink" title="About Consistency and patrol read"></a><a target="_blank" rel="noopener" href="https://www.digiliant.com/docs/MegaRAID-SAS-Software-User-Guide-12Gbs.pdf">About Consistency and patrol read</a></h3><h4 id="Patrol-read"><a href="#Patrol-read" class="headerlink" title="Patrol read"></a>Patrol read</h4><p>Patrol read involves the review of your system for possible drive errors that could lead to drive failure and then action to correct errors. The goal is to protect data integrity by detecting drive failure before the failure can damage data. The corrective actions depend on the drive group configuration and the type of errors.<br>Patrol read starts only when the controller is idle for a defined period of time and no other background tasks are active, though it can continue to run during heavy I/O processes.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /c0 show patrolRead<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Controller Properties :<br>=====================<br><br>---------------------------------------------<br>Ctrl_Prop               Value<br>---------------------------------------------<br>PR Mode                 Auto<br>PR Execution Delay      168 hours<br>PR iterations completed 0<br>PR Next Start time      08/24/2019, 03:00:00<br>PR on SSD               Disabled<br>PR on EPD               Disabled<br>PR Current State        Stopped<br>---------------------------------------------<br><span class="hljs-comment"># mode=auto/manual</span><br>$ storcli64 /call <span class="hljs-built_in">set</span> patrolread=on mode=auto includessds=on maxconcurrentpd=255 delay=360 <span class="hljs-comment">#255 phy devs ,360 housr(15days)</span><br>$ storcli64 /call <span class="hljs-built_in">set</span> patrolread=on mode=auto starttime=2019/08/24 03<br>$ storcli64 /call <span class="hljs-built_in">set</span> patrolread=off<br><br><span class="hljs-comment">##show/stop/start/resume/pause</span><br>$ storcli64 /call start patrolRead <br>$ storcli64 /call show patrolRead<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Controller Properties :<br>=====================<br><br>----------------------------------<br>Ctrl_Prop               Value<br>----------------------------------<br>PR Mode                 Auto<br>PR Execution Delay      360 hours<br>PR iterations completed 352<br>PR on SSD               Enabled<br>PR Current State        Stopped<br>----------------------------------<br><br>$ storcli64 /call show prrate<br>$ storcli64 /call <span class="hljs-built_in">set</span> prrate=40<br></code></pre></td></tr></table></figure>

<h4 id="Consistency-Check"><a href="#Consistency-Check" class="headerlink" title="Consistency Check"></a>Consistency Check</h4><p>checking consistency means calculating the data on one drive and comparing the results to the contents of the parity drive<br>It is recommended that you perform a consistency check at least once a month.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /c0 show cc<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Controller Properties :<br>=====================<br><br>-----------------------------------------------<br>Ctrl_Prop                 Value<br>-----------------------------------------------<br>CC Operation Mode         Concurrent<br>CC Execution Delay        168<br>CC Next Starttime         08/24/2019, 02:00:00<br>CC Current State          Stopped<br>CC Number of iterations   311<br>CC Number of VD completed 2<br>CC Excluded VDs           None<br>-----------------------------------------------<br><br>$ storcli64 /call show ccrate<br>$ storcli64 /call <span class="hljs-built_in">set</span> ccrate=50<br><br><br><span class="hljs-comment">#schedule</span><br>$ storcli64 /call/vall <span class="hljs-built_in">set</span> cc=seq <br>$ storcli64 /call <span class="hljs-built_in">set</span> cc=seq starttime=2019/08/31 02 delay=1440  <span class="hljs-comment">## check interval 1440 hours ,60 days</span><br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Controller Properties :<br>=====================<br><br>---------------------------------<br>Ctrl_Prop    Value<br>---------------------------------<br>CC Mode      SEQ<br>CC Starttime 2019/08/31 02:00:00<br>CC delay     1440<br>---------------------------------<br><br><span class="hljs-comment">### if I &#x27;m not set start time</span><br>$ storcli64 /call <span class="hljs-built_in">set</span> cc=seq delay=1440<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Controller Properties :<br>=====================<br><br>----------------<br>Ctrl_Prop Value<br>----------------<br>CC Mode   SEQ<br>CC delay  1440<br>----------------<br><br><br>$ storcli64 /c0 show cc<br>CC Operation Mode         Sequential<br>CC Execution Delay        1440<br>CC Next Starttime         08/24/2019, 03:00:00 <span class="hljs-comment">## first start after about 12 hours</span><br>CC Current State          Stopped<br>CC Number of iterations   120<br>CC Number of VD completed 1<br>CC Excluded VDs           None<br><br><br><span class="hljs-comment">### show again</span><br>$ storcli64 /c0 show cc<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Controller Properties :<br>=====================<br><br>-----------------------------------------------<br>Ctrl_Prop                 Value<br>-----------------------------------------------<br>CC Operation Mode         Sequential<br>CC Execution Delay        1440<br>CC Next Starttime         08/31/2019, 02:00:00<br>CC Current State          Stopped<br>CC Number of iterations   311<br>CC Number of VD completed 2<br>CC Excluded VDs           None<br>-----------------------------------------------<br><br><span class="hljs-comment">#manual start and show status</span><br><span class="hljs-comment">#show/stop/start/resume/pause</span><br>$ storcli64 /call/vall start cc [force]<br>$ storcli64 /call/vall show cc<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>VD Operation Status :<br>===================<br><br>-----------------------------------<br>VD Operation Progress% Status<br>-----------------------------------<br> 0 CC                0 In progress<br> 1 CC                1 In progress<br>-----------------------------------<br><br><br>$ storcli64 /call/vall stop cc<br></code></pre></td></tr></table></figure>

<h3 id="Montor-cache-ECC-count"><a href="#Montor-cache-ECC-count" class="headerlink" title="Montor cache ECC count"></a>Montor cache ECC count</h3><p>eccbucketleakrate 0 to 65535 Sets the leak rate of the single-bit bucket in minutes (one entry removed per leak-rate).<br>eccbucketsize 0 to 255 Sets the size of ECC single-bit-error bucket (logs event when full).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /c0 show all | grep Bucket<br>ECC Bucket Count = 0<br>ECC Bucket Size = 255<br>ECC Bucket Leak Rate (hrs) = 4<br></code></pre></td></tr></table></figure>

<h3 id="About-device-write-cache-in-megaraid"><a href="#About-device-write-cache-in-megaraid" class="headerlink" title="About device write cache in megaraid"></a><a target="_blank" rel="noopener" href="https://utcc.utoronto.ca/~cks/space/blog/tech/ModernDiskWriteCaches">About device write cache in megaraid</a></h3><p>drives can also support a write option called ‘Force Unit Access’ (FUA) that bypasses the write cache in order to force what you’re writing to be forced to disk. In general FUA is bundled with another feature called ‘Disable Page Out’ (DPO), which tells the drive that putting the data into cache is not useful.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ Virtual Drives = 2<br><br>VD LIST :<br>=======<br><br>-------------------------------------------------------------<br>DG/VD TYPE  State Access Consist Cache Cac sCC     Size Name<br>-------------------------------------------------------------<br>0/0   RAID1 Optl  RW     Yes     NRWTD -   OFF 223.0 GB R1OS<br>1/1   RAID5 Optl  RW     Yes     RWTD  -   OFF 1.307 TB<br>-------------------------------------------------------------<br><br>Cac=CacheCade|Rec=Recovery|OfLn=OffLine|Pdgd=Partially Degraded|dgrd=Degraded<br>Optl=Optimal|RO=Read Only|RW=Read Write|HD=Hidden|B=Blocked|Consist=Consistent|<br>R=Read Ahead Always|NR=No Read Ahead|WB=WriteBack|<br>AWB=Always WriteBack|WT=WriteThrough|C=Cached IO|D=Direct IO|sCC=Scheduled<br>Check Consistency<br><br>Physical Drives = 6<br><br>PD LIST :<br>=======<br><br>----------------------------------------------------------------------<br>EID:Slt DID State DG       Size Intf Med SED PI SeSz Model         Sp<br>----------------------------------------------------------------------<br>32:0      0 Onln   0   223.0 GB SATA SSD N   N  512B THNSF8240CCSE U<br>32:1      1 Onln   0   223.0 GB SATA SSD N   N  512B THNSF8240CCSE U<br>32:2      2 Onln   1 446.625 GB SATA SSD N   N  512B MTFDDAK480TDC U<br>32:3      3 Onln   1 446.625 GB SATA SSD N   N  512B MTFDDAK480TDC U<br>32:4      4 Onln   1 446.625 GB SATA SSD N   N  512B MTFDDAK480TDC U<br>32:5      5 Onln   1 446.625 GB SATA SSD N   N  512B MTFDDAK480TDC U<br>----------------------------------------------------------------------<br><br>$ dmesg -T | grep DPO<br>[Tue Nov  5 23:21:47 2019] sd 0:2:1:0: [sdb] Write cache: disabled, <span class="hljs-built_in">read</span> cache: enabled, supports DPO and FUA<br>[Tue Nov  5 23:21:47 2019] sd 0:2:0:0: [sda] Write cache: disabled, <span class="hljs-built_in">read</span> cache: disabled, supports DPO and FUA<br><br>$ perccli64 /c0/vall <span class="hljs-built_in">set</span> wrcache=WT rdcache=nora iopolicy=direct<br>Controller = 0<br>Status = Success<br>Description = None<br><br>Detailed Status :<br>===============<br><br>----------------------------------------<br>VD Property Value  Status  ErrCd ErrMsg<br>----------------------------------------<br> 0 wrCache  WT     Success     0 -<br> 0 rdCache  NoRA   Success     0 -<br> 0 IoPolicy Direct Success     0 -<br> 1 wrCache  WT     Success     0 -<br> 1 rdCache  NoRA   Success     0 -<br> 1 IoPolicy Direct Success     0 -<br>----------------------------------------<br><br>$ reboot<br><br>$ dmesg -T | grep DPO<br>[Thu Nov  7 02:37:51 2019] sd 0:2:0:0: [sda] Write cache: disabled, <span class="hljs-built_in">read</span> cache: disabled, supports DPO and FUA<br>[Thu Nov  7 02:37:51 2019] sd 0:2:1:0: [sdb] Write cache: disabled, <span class="hljs-built_in">read</span> cache: disabled, supports DPO and FUA<br><br>Supported VD Operations :<br>=======================<br>Read Policy = Yes<br>Write Policy = Yes<br>IO Policy = Yes<br>Access Policy = Yes<br>Disk Cache Policy = Yes<br><br>$ perccli64 /c0/v0 <span class="hljs-built_in">set</span> wrcache=WB<br>VD Property Value Status  ErrCd ErrMsg<br>---------------------------------------<br> 0 wrCache  WB    Success     0 -<br>---------------------------------------<br><br>$ reboot<br><br>$  dmesg -T | grep DPO<br>[Thu Nov  7 02:53:00 2019] sd 0:2:0:0: [sda] Write cache: disabled, <span class="hljs-built_in">read</span> cache: disabled, doesn<span class="hljs-string">&#x27;t support DPO or FUA</span><br><span class="hljs-string">[Thu Nov  7 02:53:00 2019] sd 0:2:1:0: [sdb] Write cache: disabled, read cache: disabled, supports DPO and FUA</span><br></code></pre></td></tr></table></figure>
<p>You could change megaraid cache policy, let the device support DPO and FUA</p>
<h3 id="Backup-and-restore-config-file"><a href="#Backup-and-restore-config-file" class="headerlink" title="Backup and restore config file"></a>Backup and restore config file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#backup controller config to file;</span><br>./storcli64 /c0 get config file=megaraid.cfg<br>./storcli64 /c0 <span class="hljs-built_in">set</span> config file=megaraid.cfg<br><span class="hljs-comment">#Clear a Configuration; dangerous</span><br><span class="hljs-comment">###./storcli64 /c0 delete config[force]</span><br></code></pre></td></tr></table></figure>

<h3 id="Flush-RAID-write-cache"><a href="#Flush-RAID-write-cache" class="headerlink" title="Flush RAID write cache"></a>Flush RAID write cache</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">#Cache Flush on Selected Controller</span><br>$ MegaCli64 –AdpCacheFlush -aN|-a0,1,2|-aALL<br>$ storcli64 /c0 <span class="hljs-keyword">set</span> flushwriteverify=<span class="hljs-keyword">on</span><br>$ storcli64 /c0 <span class="hljs-keyword">show</span> flushwriteverify <br>$ storcli64 /c0 flushcache<br><br>$ perccli64 /c0 flushcache<br>Controller = <span class="hljs-number">0</span><br><span class="hljs-keyword">Status</span> = <span class="hljs-keyword">Success</span><br>Description = Adapter <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> disk caches flushed successfully.<br><br><span class="hljs-comment"># delete the preserved cache for a particular virtual driver on the controller in missing state</span><br>$ perccli64 /c0/v1 <span class="hljs-keyword">delete</span> preservedCache <br>$ storcli64 /c0/v1 <span class="hljs-keyword">delete</span> preservedCache <span class="hljs-keyword">force</span><br><br>$ storcli64 /c0 <span class="hljs-keyword">show</span> preservedCache<br>Controller = <span class="hljs-number">0</span><br><span class="hljs-keyword">Status</span> = <span class="hljs-keyword">Success</span><br>Description = <span class="hljs-keyword">No</span> <span class="hljs-keyword">Virtual</span> Drive has Preserved <span class="hljs-keyword">Cache</span> Data.<br></code></pre></td></tr></table></figure>

<h3 id="show-PHY"><a href="#show-PHY" class="headerlink" title="show PHY"></a>show PHY</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli /cx/px|pall <span class="hljs-built_in">set</span> linkspeed=0(auto)|1.5|3|6|12<br>$ perccli64 /c0/pall show<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>PhyInfo :<br>=======<br><br>-----------------------------------------------------------------------------<br>PhyNo SAS_Addr           Phy_Identifier Link_Speed Device_Type   Description<br>-----------------------------------------------------------------------------<br>    0 0x500056B3BECB2FFF             17 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>    1 0x500056B3BECB2FFF             20 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>    2 0x500056B3BECB2FFF             18 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>    3 0x500056B3BECB2FFF             23 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>    4 0x500056B3BECB2FFF             19 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>    5 0x500056B3BECB2FFF             21 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>    6 0x500056B3BECB2FFF             16 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>    7 0x500056B3BECB2FFF             22 No <span class="hljs-built_in">limit</span>   Edge Expander -<br>-----------------------------------------------------------------------------<br><br>$ perccli64 /call/eall show<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Properties :<br>==========<br><br>--------------------------------------------------------------------<br>EID State Slots PD PS Fans TSs Alms SIM Port<span class="hljs-comment"># ProdID VendorSpecific</span><br>--------------------------------------------------------------------<br> 32 OK        8  6  0    0   0    0   0 00 x1 BP14G+  !   ?<br>--------------------------------------------------------------------<br><br>EID-Enclosure Device ID |PD-Physical drive count |PS-Power Supply count|<br>TSs-Temperature sensor count |Alms-Alarm count |SIM-SIM Count<br><br>$ perccli64 /call/eall show status<br>Controller = 0<br>Status = Success<br>Description = None<br><br><span class="hljs-comment"># upgrade the enclosure</span><br>$ storcli64 /c0/e32 download src=enclosure_fw.bin<br></code></pre></td></tr></table></figure>

<h3 id="Foreign-configurations"><a href="#Foreign-configurations" class="headerlink" title="Foreign configurations"></a>Foreign configurations</h3><p>NOTE Provide the security key when importing a locked foreign configuration created in a different machine that is encrypted with a security key.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /c0/fall show<br>Controller = 0<br>Status = Success<br>Description = Couldn<span class="hljs-string">&#x27;t find any foreign Configuration</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ storcli64 /c0/fall import</span><br><span class="hljs-string">$ storcli64 /cx/fx|fall show [all][ securitykey=sssssssssss ]</span><br><span class="hljs-string"></span><br><span class="hljs-string">#This command deletes the foreign configuration of a controller.</span><br><span class="hljs-string">$ ### storcli64 /c0/fall delete</span><br></code></pre></td></tr></table></figure>

<h3 id="Dimmer-switch"><a href="#Dimmer-switch" class="headerlink" title="Dimmer switch"></a>Dimmer switch</h3><p>The Dimmer Switch is the power-saving policy for the virtual drive</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /c0 show ds<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>Controller Properties :<br>=====================<br><br>-------------------------------<br>Ctrl_Prop         Value<br>-------------------------------<br>SpnDwnUncDrv      Disabled<br>SpnDwnHS          Disabled<br>SpnDwnTm          30 minute(s)<br>SpnDwnCfgDrv      Disabled<br>DefaultLdPSPolicy None<br>DsblLdPsInterval  0 hours<br>DsblLdPsTime      0 minutes<br>SpnUpEncDly       8 second(s)<br>spinUpEncDrvCnt   6<br>-------------------------------<br><br>$ storcli /cx/vx <span class="hljs-built_in">set</span> ds=default | auto | none | max | maxnocache<br>auto: Logical device power savings are managed by the firmware.<br>none: No power saving policy.<br>max: Logical device uses maximum power savings.<br>maxnocache: Logical device does not cache write to maximise power savings.<br><br>$ storcli64  /c0 <span class="hljs-built_in">set</span> ds=on <span class="hljs-built_in">type</span>=1|2<br>1: Unconfigured<br>2: Hot spare<br>3: Virtual drive<br>4: All<br><br>$ storcli /cx <span class="hljs-built_in">set</span> ds=on [properties]<br>disableldps: Interval <span class="hljs-keyword">in</span> hours or time <span class="hljs-keyword">in</span> hh:mm format<br>spinupdrivecount: Valid enclosure number (0 to 255)<br>SpinUpEncDelay: Valid time <span class="hljs-keyword">in</span> seconds<br></code></pre></td></tr></table></figure>

<h3 id="Device"><a href="#Device" class="headerlink" title="Device"></a>Device</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /cx[/ex]/sx spindown<br>$ storcli64 /cx[/ex]/sx spinup<br><br>$ storcli64 /cx[/ex]/sx secureerase [force]<br>$ storcli64 /cx[/ex]/sx start erase [simple|normal|thorough] [erasepatternA=&lt;value1&gt;] [erasepatternB=&lt;value2&gt;]<br>$ storcli64 /cx[/ex]/sx stop erase<br></code></pre></td></tr></table></figure>

<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><h4 id="log"><a href="#log" class="headerlink" title="log"></a>log</h4><p>— 0 – NA<br>— 1– SET<br>— 2 – CLEAR<br>— 3 – CLEAR ALL<br>— 4 – DEBUG DUMP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /call show all logfile=megaraid.cfg<br>$ storcli64 /c x <span class="hljs-built_in">set</span> debug reset all <br>$ storcli64 /call x <span class="hljs-built_in">set</span> debug <span class="hljs-built_in">type</span> = &lt;value&gt; option = &lt;value&gt; level = [&lt;value <span class="hljs-keyword">in</span> hex&gt;]<br><span class="hljs-comment">#type – takes the value from 0 – 128, mapping each number to a particular debug variable in the firmware.</span><br>$ <span class="hljs-comment">#storcli64 /call delete events</span><br>$ <span class="hljs-comment">#storcli64 /call delete termlog</span><br><br>$ storcli64 /call show events file=events.log<br>$ storcli64 /call show termlog <span class="hljs-built_in">type</span>=config logfile=termlog.config<br>$ storcli64 /call show termlog <span class="hljs-built_in">type</span>=contents logfile=termlog.contents<br>$ storcli64 /call show eventloginfo logfile=event.info<br>$ storcli64 /call show dequeuelog file=dequeue.log<br>$ storcli64 /call show alilog logfile=ali.log<br></code></pre></td></tr></table></figure>
<h4 id="Encolsure"><a href="#Encolsure" class="headerlink" title="Encolsure"></a>Encolsure</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /call/eall download src=encolsure.bin<br>$ perccli64 /call/eall show all<br>$ perccli64 /call/eall show status <br></code></pre></td></tr></table></figure>

<h4 id="phy-err"><a href="#phy-err" class="headerlink" title="phy err"></a>phy err</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">storcli /cx/px|pall show<br>storcli /cx/px|pall show all<br>storcli /cx/ex show phyerrorcounters<br>storcli /cx[/ex]/sx show phyerrorcounters<br>storcli /cx[/ex]/sx reset phyerrorcounters<br>storcli /cx/px|pall <span class="hljs-built_in">set</span> linkspeed=0(auto)|1.5|3|6|12<br></code></pre></td></tr></table></figure>

<h4 id="diag-adapter"><a href="#diag-adapter" class="headerlink" title="diag adapter"></a>diag adapter</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /c0 start diag duration=10 logfile=diag.log<br></code></pre></td></tr></table></figure>

<h4 id="Enable-SEP-for-Dell-PERC"><a href="#Enable-SEP-for-Dell-PERC" class="headerlink" title="Enable SEP for Dell PERC"></a>Enable SEP for Dell PERC</h4><p>Configures enclosure detection on a non-SES/expander backplane.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /call <span class="hljs-built_in">set</span> backplane mode=0 expose=on<br>0: Use autodetect logic of backplanes, such as SGPIO and I2C SEP using GPIO pins.<br>1: Disable autodetect SGPIO.<br>2: Disable I2C SEP autodetect.<br>3: Disable both the autodetects.<br><br>backplane expose: Enables or disables device drivers to expose enclosure devices; <span class="hljs-keyword">for</span> example, expanders, SEPs.<br><br>$ perccli64 /call <span class="hljs-built_in">set</span> sesmonitoring=on<br></code></pre></td></tr></table></figure>


<h3 id="Enable-JBOD"><a href="#Enable-JBOD" class="headerlink" title="Enable JBOD"></a>Enable JBOD</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /call <span class="hljs-built_in">set</span> jbod=on<br></code></pre></td></tr></table></figure>

<h3 id="SAS-loading-balance"><a href="#SAS-loading-balance" class="headerlink" title="SAS loading balance"></a>SAS loading balance</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /cx <span class="hljs-built_in">set</span> loadbalancemode=on<br></code></pre></td></tr></table></figure>

<h3 id="Driver-performance"><a href="#Driver-performance" class="headerlink" title="Driver performance"></a>Driver performance</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ storcli64 /call <span class="hljs-built_in">set</span> DPM=on<br><span class="hljs-comment">#Enables or disables drive performance monitoring</span><br><br>$ storcli64 /call <span class="hljs-built_in">set</span> ncq=on<br>$ storcli64 /call <span class="hljs-built_in">set</span> perfmode=1 <span class="hljs-comment">#default was 0</span><br>0: Tuned to provide best IOPS, currently applicable to non-FastPath<br>1: Tuned to provide least latency, currently applicable to non-FastPath<br></code></pre></td></tr></table></figure>

<h4 id="Get-smart-info-from-LSI-megaraid"><a href="#Get-smart-info-from-LSI-megaraid" class="headerlink" title="Get smart info from LSI megaraid"></a>Get smart info from LSI megaraid</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smartctl -s on -a -d megaraid,1 /dev/sda -T permissive<br>$ smartctl -s on -a -d megaraid,0 /dev/sda -T permissive<br>smartctl 6.5 2016-05-07 r4318 [x86_64-linux-3.10.0-957.1.3.el7.x86_64] (<span class="hljs-built_in">local</span> build)<br>Copyright (C) 2002-16, Bruce Allen, Christian Franke, www.smartmontools.org<br><br>=== START OF INFORMATION SECTION ===<br>Vendor:               HGST<br>Product:              HUSMM1616ASS204<br>Revision:             L380<br>Compliance:           SPC-4<br>User Capacity:        1,600,321,314,816 bytes [1.60 TB]<br>Logical block size:   512 bytes<br>LU is resource provisioned, LBPRZ=1<br>Rotation Rate:        Solid State Device<br>Form Factor:          2.5 inches<br>Logical Unit id:      0x0000000000000000<br>Serial number:        0000000<br>Device <span class="hljs-built_in">type</span>:          disk<br>Transport protocol:   SAS (SPL-3)<br>Local Time is:        Thu Dec 27 15:44:50 2018 CST<br>SMART support is:     Available - device has SMART capability.<br>SMART support is:     Enabled<br>Temperature Warning:  Disabled or Not Supported<br><br>=== START OF ENABLE/DISABLE COMMANDS SECTION ===<br>Informational Exceptions (SMART) enabled<br>Temperature warning enabled<br><br>=== START OF READ SMART DATA SECTION ===<br>SMART Health Status: OK<br><br>Percentage used endurance indicator: 0%<br>Current Drive Temperature:     32 C<br>Drive Trip Temperature:        60 C<br><br>Manufactured <span class="hljs-keyword">in</span> week 53 of year 2016<br>Specified cycle count over device lifetime:  0<br>Accumulated start-stop cycles:  0<br>Specified load-unload count over device lifetime:  0<br>Accumulated load-unload cycles:  0<br>Vendor (Seagate) cache information<br>  Blocks sent to initiator = 6325615015755776<br><br>Error counter <span class="hljs-built_in">log</span>:<br>           Errors Corrected by           Total   Correction     Gigabytes    Total<br>               ECC          rereads/    errors   algorithm      processed    uncorrected<br>           fast | delayed   rewrites  corrected  invocations   [10^9 bytes]  errors<br><span class="hljs-built_in">read</span>:          0        0         0         0          0       6874.841           0<br>write:         0        0         0         0          0      10898.936           0<br>verify:        0        0         0         0          0         32.879           0<br><br>Non-medium error count:        0<br></code></pre></td></tr></table></figure>

<h3 id="performance-monitor"><a href="#performance-monitor" class="headerlink" title="performance monitor"></a>performance monitor</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /c0 show dpm<br>$ perccli64 /c0 <span class="hljs-built_in">set</span> dpm=on<br><br>$ perccli64 /c0 delete dpmstat <span class="hljs-built_in">type</span> = Hist | LCT | RA |EXT [logfile=filename]<br>$ perccli64 /c0 show dpmstat <span class="hljs-built_in">type</span> = Hist | LCT | RA |EXT [logfile=filename]<br>$ storcli64 /c0 start dpm<br>$ storcli64 /c0 stop dpm<br><br>MR 7.14 storcli64 version<br>$ storcli64 /c1/e25/sall show dpmstat <span class="hljs-built_in">type</span> = HIST logfile=9460-16i_dpmstat_HIST.txt<br>$ storcli64 /c1/e25/sall show dpmstat <span class="hljs-built_in">type</span> = LCT logfile=9460-16i_dpmstat_LCT.txt<br>$ storcli64 /c1/e25/sall show dpmstat <span class="hljs-built_in">type</span> = RA logfile=9460-16i_dpmstat_RA.txt<br>$ storcli64 /c1/e25/sall show dpmstat <span class="hljs-built_in">type</span> = EXT logfile=9460-16i_dpmstat_EXT.txt<br><br>MR 9361-8i use MR 6.14, storcli 1.2.xx<br>$ storcli64 -DpmStat -Dsply lct -physdrv [10:0] -a0<br><br>Drive Performance Monitor Configuration <span class="hljs-keyword">for</span> 0<br>Performance Monitor: ON<br>Max commands <span class="hljs-keyword">for</span> averaging: 100<br>Max latency commands to save: 10<br><br>Enclosure Device ID: 32<br>Slot Number: 0<br>Device Id: 0<br>                    Resp<br>Date    |   Time  | Time(ms) | CDB/ATA Task File(hex)<br>-----------------------------------------------------------------------------<br><br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br>0        0         0.0000    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br><br>$ storcli64 -DpmStat -Dsply ra -physdrv [10:0] -a0<br><br>Drive Performance Monitor Configuration <span class="hljs-keyword">for</span> 0<br>Performance Monitor: ON<br>Max commands <span class="hljs-keyword">for</span> averaging: 100<br>Max latency commands to save: 10<br><br>Requested data: Running Average Drive Statistics<br><br>Enclosure   Slot                           Queue      Xfer       Resp<br>Device ID | Number | Device Id |  IOPs  |  Depth  |   Rate    |  Time<br>          |        |           |        |         |   (MB/s)  |  (ms)<br><br>32          3        3          0        0         0.0000       0.0000<br><br>$ storcli64 -DpmStat -Dsply hist -physdrv [10:0] -a0<br>Drive Performance Monitor Configuration <span class="hljs-keyword">for</span> 0<br>Performance Monitor: ON<br>Max commands <span class="hljs-keyword">for</span> averaging: 100<br>Max latency commands to save: 10<br><br>Enclosure Device ID: 32<br>Slot Number: 3<br>Device Id: 3<br><br>------------------------------------------<br>Bin       Respose Time (ms)   IO Count<br>------------------------------------------<br>1         1                   0<br>2         2                   0<br>3         3                   0<br>4         4                   0<br>5         5                   0<br>6         6                   0<br>7         7                   0<br>8         8                   0<br>9         9                   0<br>10        10                  0<br>11        20                  0<br>12        30                  0<br>13        40                  0<br>14        50                  0<br>15        60                  0<br>16        70                  0<br>17        80                  0<br>18        90                  0<br>19        100                 0<br>20        200                 0<br>21        300                 0<br>22        400                 0<br>23        500                 0<br>24        600                 0<br>25        700                 0<br>26        800                 0<br>27        900                 0<br>28        1000                0<br>29        2000                0<br>30        3000                0<br>31        4000                0<br>32        5000                0<br>33        6000                0<br>34        7000                0<br>35        8000                0<br>36        9000                0<br>37        10000               0<br>38        10000+              0<br>------------------------------------------<br><br><br>$ storcli64 -DpmStat -Dsply ext -physdrv [10:0] -a0<br>Drive Performance Monitor Configuration <span class="hljs-keyword">for</span> 0<br>Performance Monitor: ON<br>Max commands <span class="hljs-keyword">for</span> averaging: 100<br>Max latency commands to save: 10<br><br>Enclosure Device ID: 32<br>Slot Number: 3<br>Device Id: 3<br>  Sectors                                      Commands<br>-------------------------------------------------------------------------------<br>Read        Write       Write-FUA      Read        Write       Write-FUA  Flush<br>-------------------------------------------------------------------------------<br>0           0           0              0           0           0           0<br></code></pre></td></tr></table></figure>

<h3 id="T10-PI-for-megaraid"><a href="#T10-PI-for-megaraid" class="headerlink" title="T10 PI for megaraid"></a>T10 PI for megaraid</h3><p><img src="/img/MegaRAID-setting-1.png"><br><a target="_blank" rel="noopener" href="https://www.broadcom.com/support/knowledgebase/1211161502244/the-data-protection-feature---megaraid">Megaraid T10 PI</a><br>The Data Protection feature is an additional method of preventing data corruption by delivering end-to-end data integrity through the full I/O path from the application to the disk drive. This feature is officially called T-10 Protection Information (T-10 PI) and requires special hard drives with 520-byte sectors. The feature is essentially Parity which is done internally on the drives that support T-10 PI.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ perccli64 /cx <span class="hljs-built_in">set</span> pi state = off <br></code></pre></td></tr></table></figure>

<h3 id="About-T10-rebuild-assist-for-megaraid"><a href="#About-T10-rebuild-assist-for-megaraid" class="headerlink" title="About T10 rebuild assist for megaraid"></a><a target="_blank" rel="noopener" href="https://www.dell.com/support/article/us/en/04/qna44044/perc9-under-certain-conditions-there-is-a-possible-data-integrity-issue-with-the-rapid-rebuild?lang=en">About T10 rebuild assist for megaraid</a></h3><p><code>Unstable</code></p>
<p>Dell PERC 9 controllers (H330, H730, H730P, and H830) introduced a feature called Rapid Rebuild that speeds up the time to rebuild failed drives in certain conditions. This feature is based on T10 Rebuild Assist. Dell has determined that there is a possibility for data integrity issues when this feature is used under certain conditions.</p>
<p><code>When the PERC is rebuilding the data for the &quot;bad&quot; sectors, it incorrectly writes data from cache to the failed drive instead of the hot spare. This results in data and associated parity not being written to the hot spare. In write through mode, parity errors will occur. In write back mode, errors will occur in both data and associated parity.</code></p>
<p>From the PERC Controller log if you see the below highlighted text you have encountered the issue.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">C0:EVT<span class="hljs-comment">#395950-08/17/16 13:54:59: 114=State change on PD 0b(e0x20/s11) from OFFLINE(XX) to REBUILDASSIST(12)</span><br></code></pre></td></tr></table></figure>
<p>If you have not encountered this issue then to protect against this scenario please update your PERC H730, H730p, H830 controller firmware to 25.5.0.0018 and PERC H330 controller firmware to 25.5.0.0019 or later firmware which disables the Rapid Rebuild feature.</p>
<h4 id="Enable-T10-data-protection-in-LSI-9380-8e"><a href="#Enable-T10-data-protection-in-LSI-9380-8e" class="headerlink" title="Enable T10-data-protection in LSI 9380-8e"></a>Enable T10-data-protection in LSI 9380-8e</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># make sure the sas device support the feature</span><br>$ sg_vpd -p ei -l -v /dev/sdc<br>    inquiry cdb: 12 01 86 00 <span class="hljs-built_in">fc</span> 00<br>    inquiry: pass-through requested 252 bytes but got 64 bytes<br>    inquiry cdb: 12 00 00 00 24 00<br>extended INQUIRY data VPD page:<br>   [PQual=0  Peripheral device <span class="hljs-built_in">type</span>: disk]<br>  ACTIVATE_MICROCODE=1 [before final WRITE BUFFER]<br><br>  SPT=1 [protection types 1 and 2 supported]<br>...<br>$ sg_format -v --long --format --size=512 --fmtpinfo=3 --pfu=0 /dev/sdX<br><span class="hljs-comment"># or you could set to 4K</span><br>$ sg_format -v --long --format --size=4096 --fmtpinfo=3 --pfu=0 /dev/sdX<br><br><span class="hljs-comment"># first format, show an error</span><br>    inquiry cdb: 12 00 00 00 24 00<br>    HGST      HUS724030ALS640   A280   peripheral_type: disk [0x0]<br>      PROTECT=1<br>      &lt;&lt; supports protection information&gt;&gt;<br>    mode sense (10) cdb: 5a 10 01 00 00 00 00 00 <span class="hljs-built_in">fc</span> 00<br>mode sense (10):  Fixed format, current;  Sense key: Unit Attention<br> Additional sense: Mode parameters changed<br>MODE SENSE (10) <span class="hljs-built_in">command</span>, unit attention<br><br><span class="hljs-comment"># try second format, it &#x27;s worked</span><br>    inquiry cdb: 12 00 00 00 24 00<br>    HGST      HUS724030ALS640   A280   peripheral_type: disk [0x0]<br>      PROTECT=1<br>      &lt;&lt; supports protection information&gt;&gt;<br>    mode sense (10) cdb: 5a 10 01 00 00 00 00 00 <span class="hljs-built_in">fc</span> 00<br>    mode sense (10): pass-through requested 252 bytes but got 36 bytes<br>Mode Sense (block descriptor) data, prior to changes:<br>  &lt;&lt;&lt; longlba flag <span class="hljs-built_in">set</span> (64 bit lba) &gt;&gt;&gt;<br>  Number of blocks=5860533168 [0x15d50a3b0]<br>  Block size=512 [0x200]<br><br>A FORMAT will commence <span class="hljs-keyword">in</span> 10 seconds<br>    ALL data on /dev/sds will be DESTROYED<br>        Press control-C to abort<br>A FORMAT will commence <span class="hljs-keyword">in</span> 5 seconds<br>    ALL data on /dev/sds will be DESTROYED<br>        Press control-C to abort<br>    format cdb: 04 d8 00 00 00 00<br><br><span class="hljs-comment">## After format and switch the device to the LSI-9380-8e</span><br><br>Basics :<br>======<br>Controller = 0<br>Model = AVAGO MegaRAID SAS 9380-8e<br>Serial Number = SV43821663<br>Current Controller Date/Time = 04/30/2020, 03:38:35<br>Current System Date/time = 04/30/2020, 11:38:36<br>SAS Address = 500605b00992b480<br>PCI Address = 00:65:00:00<br>Mfg Date = 09/19/14<br>Rework Date = 00/00/00<br>Revision No = 01C<br><br>Version :<br>=======<br>Firmware Package Build = 24.21.0-0119<br>Firmware Version = 4.680.00-8505<br>CPLD Version = 26611-00A<br>Bios Version = 6.36.00.3_4.19.08.00_0x06180203<br>HII Version = 03.25.05.12<br>Ctrl-R Version = 5.19-0603<br>Preboot CLI Version = 01.07-05:<span class="hljs-comment">#%0000</span><br>NVDATA Version = 3.1705.00-0020<br>Boot Block Version = 3.07.00.00-0003<br>Driver Name = megaraid_sas<br>Driver Version = 07.707.50.00-rh1<br></code></pre></td></tr></table></figure>

<h4 id="Create-raid-and-enable-T10-pi-data-protection"><a href="#Create-raid-and-enable-T10-pi-data-protection" class="headerlink" title="Create raid and enable T10-pi data protection"></a>Create raid and enable T10-pi data protection</h4><p>you can see PI = Y , it ‘s worked.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Add &quot;pi&quot; key word</span><br>$ storcli64 /c0 add vd <span class="hljs-built_in">type</span>=raid5 drives=94:13,15,17 WB pi strip=64<br>$ storcli64 /c0/v1 show all<br><br>CLI Version = 007.1211.0000.0000 Nov 07, 2019<br>Operating system = Linux 3.10.0-1062.18.1.el7.x86_64<br>Controller = 0<br>Status = Success<br>Description = None<br><br><br>/c0/v1 :<br>======<br><br>-------------------------------------------------------------<br>DG/VD TYPE  State Access Consist Cache Cac sCC     Size Name<br>-------------------------------------------------------------<br>1/1   RAID5 Optl  RW     No      RWBD  -   ON  5.457 TB<br>-------------------------------------------------------------<br><br>EID=Enclosure Device ID| VD=Virtual Drive| DG=Drive Group|Rec=Recovery<br>Cac=CacheCade|OfLn=OffLine|Pdgd=Partially Degraded|Dgrd=Degraded<br>Optl=Optimal|RO=Read Only|RW=Read Write|HD=Hidden|TRANS=TransportReady|B=Blocked|<br>Consist=Consistent|R=Read Ahead Always|NR=No Read Ahead|WB=WriteBack|<br>AWB=Always WriteBack|WT=WriteThrough|C=Cached IO|D=Direct IO|sCC=Scheduled<br>Check Consistency<br><br><br>PDs <span class="hljs-keyword">for</span> VD 1 :<br>============<br><br>----------------------------------------------------------------------------<br>EID:Slt DID State DG     Size Intf Med SED PI SeSz Model            Sp Type<br>----------------------------------------------------------------------------<br>94:13   104 Onln   1 2.728 TB SAS  HDD N   Y  512B HUS724030ALS640  U  -<br>94:15   107 Onln   1 2.728 TB SAS  HDD N   Y  512B HUS724030ALS640  U  -<br>94:17   102 Onln   1 2.728 TB SAS  HDD N   Y  512B HUS724030ALS640  U  -<br>----------------------------------------------------------------------------<br><br>EID=Enclosure Device ID|Slt=Slot No.|DID=Device ID|DG=DriveGroup<br>DHS=Dedicated Hot Spare|UGood=Unconfigured Good|GHS=Global Hotspare<br>UBad=Unconfigured Bad|Onln=Online|Offln=Offline|Intf=Interface<br>Med=Media Type|SED=Self Encryptive Drive|PI=Protection Info<br>SeSz=Sector Size|Sp=Spun|U=Up|D=Down|T=Transition|F=Foreign<br>UGUnsp=UGood Unsupported|UGShld=UnConfigured shielded|HSPShld=Hotspare shielded<br>CFShld=Configured shielded|Cpybck=CopyBack|CBShld=Copyback Shielded<br>UBUnsp=UBad Unsupported|Rbld=Rebuild<br><br></code></pre></td></tr></table></figure>

<p>GUI set<br>[/img/adapter_support_pi.png]<br>[/img/create_r1.png]<br>[/img/create_vd_pi.png]<br>[/img/4K-pi.png]<br>[/img/512B-pi.png]<br>[/img/vd_support_pi.png]</p>
<h4 id="Redhat-support"><a href="#Redhat-support" class="headerlink" title="Redhat support"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/ch-install-config">Redhat support</a></h4><p>Block Devices with DIF/DIX Enabled<br>DIF/DIX is a hardware checksum feature provided by certain SCSI host bus adapters and block devices. When DIF/DIX is enabled, error occurs if the block device is used as a general-purpose block device. Buffered I/O or mmap(2)-based I/O will not work reliably, as there are no interlocks in the buffered write path to prevent buffered data from being overwritten after the DIF/DIX checksum has been calculated.<br>This causes the I/O to later fail with a checksum error. This problem is common to all block device (or file system-based) buffered I/O or mmap(2) I/O, so it is not possible to work around these errors caused by overwrites.<br>As such, block devices with DIF/DIX enabled should only be used with applications that use O_DIRECT. Such applications should use the raw block device. Alternatively, it is also safe to use the XFS file system on a DIF/DIX enabled block device, as long as only O_DIRECT I/O is issued through the file system. XFS is the only file system that does not fall back to buffered I/O when doing certain allocation operations.<br>The responsibility for ensuring that the I/O data does not change after the DIF/DIX checksum has been computed always lies with the application, so only applications designed for use with O_DIRECT I/O and DIF/DIX hardware should use DIF/DIX.</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/05/24/megaraid/">http://yoursite.com/2019/05/24/megaraid/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/raid/">raid</a><a class="post-meta__tags" href="/tags/megaraid/">megaraid</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/07/18/ubuntu/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">ubuntu</div></div></a></div><div class="next-post pull-right"><a href="/2019/04/28/consistency-test/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Test hardware and filesystem data consistency</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/06/01/mdadm/" title="backup the mdraid info"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-01</div><div class="title">backup the mdraid info</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '0b9d5b98d0a972b33cf7',
      clientSecret: '769efc11b32f6c0d03bcbf3ee800dfc4e2690459',
      repo: 'homerl.github.io',
      owner: 'homerl',
      admin: ['homerl'],
      id: '29661eaa93f728f5bb510f745fd4eb51',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>