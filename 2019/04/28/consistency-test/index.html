<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Test hardware and filesystem data consistency | 己不由心，身又岂能由己</title><meta name="keywords" content="postgresql,test,fio"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="Because there are some Enterprise hardware firmware issue cause some function not work&#x2F;data loss.make sure the supercapacitor is work in Enterprise SSDIn Some case, if the device partition is not alig">
<meta property="og:type" content="article">
<meta property="og:title" content="Test hardware and filesystem data consistency">
<meta property="og:url" content="http://yoursite.com/2019/04/28/consistency-test/index.html">
<meta property="og:site_name" content="己不由心，身又岂能由己">
<meta property="og:description" content="Because there are some Enterprise hardware firmware issue cause some function not work&#x2F;data loss.make sure the supercapacitor is work in Enterprise SSDIn Some case, if the device partition is not alig">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg">
<meta property="article:published_time" content="2019-04-28T09:43:07.000Z">
<meta property="article:modified_time" content="2020-10-09T12:17:12.774Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="postgresql">
<meta property="article:tag" content="test">
<meta property="article:tag" content="fio">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2019/04/28/consistency-test/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-10-09 20:17:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/244247-guts.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-filesystem-settting"><span class="toc-number">1.</span> <span class="toc-text">About filesystem settting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PostgreSQL-Installation"><span class="toc-number">2.</span> <span class="toc-text">PostgreSQL Installation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Disable-PostgreSQL-WAL-Write-Ahead-Log"><span class="toc-number">2.1.</span> <span class="toc-text">Disable PostgreSQL WAL(Write-Ahead Log)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pgbench"><span class="toc-number">2.2.</span> <span class="toc-text">pgbench</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enable-WAL-test-to-test-file-system"><span class="toc-number">3.</span> <span class="toc-text">Enable WAL test to test file system</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FIO-verify"><span class="toc-number">4.</span> <span class="toc-text">FIO verify</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">己不由心，身又岂能由己</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Test hardware and filesystem data consistency</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-04-28T09:43:07.000Z" title="Created 2019-04-28 17:43:07">2019-04-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-10-09T12:17:12.774Z" title="Updated 2020-10-09 20:17:12">2020-10-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Benchmark/">Benchmark</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>Because there are some Enterprise hardware firmware issue cause some function not work/data loss.<br><a target="_blank" rel="noopener" href="https://engineering.nordeus.com/power-failure-testing-with-ssds/">make sure the supercapacitor is work in Enterprise SSD</a><br>In Some case, if the device partition is not aligned, the logic 512 Byte across the two physical block(512B), it will cause atomic transaction failed (enable the dev write buffer,the buffer no battery or supercapacitor)</p>
<h3 id="About-filesystem-settting"><a href="#About-filesystem-settting" class="headerlink" title="About filesystem settting"></a>About filesystem settting</h3><p>Disable barrier and set data is writeback </p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">ext4/xfs </span>-o <span class="hljs-keyword">barrier=0,data=writeback</span><br><span class="hljs-keyword">zfs </span><span class="hljs-keyword">disable </span><span class="hljs-keyword">sync </span>write<br></code></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="PostgreSQL-Installation"><a href="#PostgreSQL-Installation" class="headerlink" title="PostgreSQL Installation"></a><a target="_blank" rel="noopener" href="https://tecadmin.net/install-postgresql-11-on-centos/">PostgreSQL Installation</a></h3><p>Here is my first time to use postgresql, good luck</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ mkfs.ext4 /dev/sdXX1<br>$ rpm -Uvh https://yum.postgresql.org/11/redhat/rhel-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm<br>$ yum install postgresql11-server<br>$ mount /dev/sdXX1 /var/lib/pgsql -o barrier=0,data=writeback<br>$ chown -R postgres.postgres /var/lib/pgsql<br>$ /usr/pgsql-11/bin/postgresql-11-setup initdb<br><span class="hljs-comment"># data is in /var/lib/pgsql/11/data</span><br>$ systemctl <span class="hljs-built_in">enable</span> postgresql-11<br>$ systemctl start postgresql-11<br></code></pre></td></tr></table></figure>

<h4 id="Disable-PostgreSQL-WAL-Write-Ahead-Log"><a href="#Disable-PostgreSQL-WAL-Write-Ahead-Log" class="headerlink" title="Disable PostgreSQL WAL(Write-Ahead Log)"></a>Disable PostgreSQL WAL(Write-Ahead Log)</h4><p><a target="_blank" rel="noopener" href="https://blog.nukomeet.com/faster-inserts-how-to-increase-postgresql-write-performance-24d76bd56f75">The WAL guarantees that the table data is persisted in the event of an unclean shutdown. In other words, unlogged tables are automatically cleared if the server crashes.</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">CREATE UNLOGGED TABLE user_clicks (<br>  id uuid PRIMARY KEY,<br>  time timestamptz,<br>  user_id int<br>);<br><br><br>CREATE UNLOGGED TABLE name (<br>…<br>);<br><br>ALTER TABLE user_clicks SET LOGGED <br>ALTER TABLE user_clicks SET UNLOGGED <br><br><span class="hljs-comment"># List all unlogged tables within the current database.</span><br>SELECT relname FROM pg_class WHERE relpersistence = <span class="hljs-string">&#x27;u&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="pgbench"><a href="#pgbench" class="headerlink" title="pgbench"></a>pgbench</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo -u postgres psql -U postgres -c <span class="hljs-string">&quot;CREATE DATABASE pgbench1;&quot;</span><br>$ mkdir /var/lib/pgsql/11/index<br>$ chown postgres.postgres /var/lib/pgsql/11/index<br>$ sudo -u postgres psql -U postgres -c <span class="hljs-string">&quot;CREATE TABLESPACE index LOCATION &#x27;/var/lib/pgsql/11/index&#x27;;&quot;</span><br><span class="hljs-comment"># init table in pgbench1</span><br>$ sudo -u postgres /usr/pgsql-11/bin/pgbench -U postgres -i pgbench1<br><br><span class="hljs-comment"># go to postgresql terminal</span><br>$ sudo -u postgres psql <br><br>postgres <span class="hljs-comment"># postgres=# \l</span><br><span class="hljs-comment"># list databases;</span><br>                             List of databases<br>   Name    |  Owner   | Encoding  | Collate | Ctype |   Access privileges<br>-----------+----------+-----------+---------+-------+-----------------------<br> pgbench1  | postgres | SQL_ASCII | C       | C     |<br><br>postgres=<span class="hljs-comment"># \c pgbench1</span><br>You are now connected to database <span class="hljs-string">&quot;pgbench1&quot;</span> as user <span class="hljs-string">&quot;postgres&quot;</span>.<br><br>pgbench1=<span class="hljs-comment"># \dt;</span><br>              List of relations<br> Schema |       Name       | Type  |  Owner<br>--------+------------------+-------+----------<br> public | pgbench_accounts | table | postgres<br> public | pgbench_branches | table | postgres<br> public | pgbench_history  | table | postgres<br> public | pgbench_tellers  | table | postgres<br>(4 rows)<br><br><span class="hljs-comment">## it &#x27;s the pgbench create table</span><br>$ sudo -u postgres /usr/pgsql-11/bin/pgbench -U postgres -i pgbench1 --index-tablespace=index<br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;CREATE INDEX ON pgbench_accounts(abalance,aid) TABLESPACE index;&quot;</span><br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;CREATE INDEX ON pgbench_history(mtime) TABLESPACE index;&quot;</span><br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;CREATE INDEX ON pgbench_history(aid,delta) TABLESPACE index;&quot;</span><br>CREATE INDEX<br><br><span class="hljs-comment">## Disable test table WAL log</span><br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_accounts SET UNLOGGED&quot;</span><br>ALTER TABLE<br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_branches SET UNLOGGED&quot;</span><br>ALTER TABLE<br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_history SET UNLOGGED&quot;</span><br>ALTER TABLE<br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_tellers SET UNLOGGED&quot;</span><br>ALTER TABLE<br><br><span class="hljs-comment">## bengin to test</span><br>$ sudo -u postgres /usr/pgsql-11/bin/pgbench -c 64 -j 64 -T 1200 -P 8 -M extended --random-seed=rand pgbench1<br>...<br>progress: 1160.0 s, 50.0 tps, lat 1184.948 ms stddev 1421.433<br>progress: 1168.0 s, 50.1 tps, lat 1205.856 ms stddev 1672.771<br>progress: 1176.0 s, 49.0 tps, lat 1359.426 ms stddev 1864.131<br>progress: 1184.0 s, 47.5 tps, lat 1365.739 ms stddev 1912.132<br>progress: 1192.0 s, 49.5 tps, lat 1341.149 ms stddev 1631.751<br>progress: 1200.0 s, 48.9 tps, lat 1308.528 ms stddev 1643.086<br>transaction <span class="hljs-built_in">type</span>: &lt;<span class="hljs-built_in">builtin</span>: TPC-B (sort of)&gt;<br>scaling factor: 1<br>query mode: extended<br>number of clients: 64<br>number of threads: 64<br>duration: 1200 s<br>number of transactions actually processed: 2750119<br>latency average = 27.940 ms<br>latency stddev = 181.635 ms<br>tps = 2289.444326 (including connections establishing)<br>tps = 2289.485134 (excluding connections establishing)<br></code></pre></td></tr></table></figure>
<p>In the test process, hot plugin the SSD mount at /var/lib/pgsql.<br>Don’t use “echo 1 &gt; /sys/block/sdXX/device/delete, the operate will sync write cache to the device</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo -u postgres /usr/pgsql-11/bin/pg_dumpall &gt; /dev/null<br></code></pre></td></tr></table></figure>
<p>Check the command has any error.</p>
<h3 id="Enable-WAL-test-to-test-file-system"><a href="#Enable-WAL-test-to-test-file-system" class="headerlink" title="Enable WAL test to test file system"></a><a target="_blank" rel="noopener" href="http://mysql.taobao.org/monthly/2016/10/07/">Enable WAL test to test file system</a></h3><p>If you are enable WAL log, force stop the database, and the database will go to recovery</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_accounts SET LOGGED&quot;</span><br>ALTER TABLE<br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_branches SET LOGGED&quot;</span><br>ALTER TABLE<br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_history SET LOGGED&quot;</span><br>ALTER TABLE<br>$ sudo -u postgres psql -U postgres -d pgbench1 -c <span class="hljs-string">&quot;ALTER TABLE pgbench_tellers SET LOGGED&quot;</span><br>ALTER TABLE<br><br><span class="hljs-comment">### After enable WAL in my zfs test env, no zil</span><br>progress: 792.0 s, 3699.0 tps, lat 17.227 ms stddev 20.965<br>progress: 800.0 s, 3592.0 tps, lat 17.867 ms stddev 23.278<br>progress: 808.0 s, 3502.7 tps, lat 18.292 ms stddev 25.962<br>progress: 816.0 s, 3560.8 tps, lat 17.972 ms stddev 24.924<br>progress: 824.0 s, 3628.1 tps, lat 17.656 ms stddev 23.070<br>progress: 832.0 s, 3617.6 tps, lat 17.655 ms stddev 22.472<br>progress: 840.0 s, 2590.1 tps, lat 21.832 ms stddev 30.337<br>progress: 848.0 s, 46.5 tps, lat 1283.200 ms stddev 1202.214<br>progress: 856.0 s, 5.7 tps, lat 1130.780 ms stddev 1334.794<br>progress: 864.0 s, 21.3 tps, lat 5008.063 ms stddev 6756.387<br>progress: 872.0 s, 48.1 tps, lat 1666.621 ms stddev 2890.584<br>progress: 880.0 s, 49.1 tps, lat 1269.726 ms stddev 1383.484<br>progress: 888.0 s, 50.4 tps, lat 1277.642 ms stddev 1514.558<br><br><br>$ sudo -u postgres /usr/pgsql-11/bin/pgbench -c 64 -j 64 -T 1200 -P 8 -M extended <span class="hljs-attribute">--random-seed</span>=rand pgbench1<br>setting random seed <span class="hljs-keyword">to</span> 4859633172491879446<br>starting vacuum<span class="hljs-built_in">..</span>.end.<br>progress: 8.0 s, 46.1 tps, lat 1104.991 ms stddev 997.076<br>progress: 16.0 s, 48.0 tps, lat 1344.463 ms stddev 1467.943<br>progress: 24.0 s, 49.9 tps, lat 1285.797 ms stddev 1509.956<br>progress: 32.0 s, 47.4 tps, lat 1277.344 ms stddev 1487.591<br>progress: 40.0 s, 48.8 tps, lat 1406.851 ms stddev 1789.872<br>progress: 48.0 s, 38.1 tps, lat 1477.057 ms stddev 1411.267<br>progress: 56.0 s, 39.0 tps, lat 1695.951 ms stddev 2172.428<br>progress: 64.0 s, 51.5 tps, lat 1270.484 ms stddev 2008.514<br>progress: 72.0 s, 48.1 tps, lat 1260.300 ms stddev 1831.611<br>progress: 80.0 s, 42.6 tps, lat 1605.049 ms stddev 2572.170<br><span class="hljs-built_in">..</span>.<br><br><span class="hljs-comment"># disable it immediate</span><br>$ sudo -u postgres /usr/pgsql-11/bin/pg_ctl stop  -D /var/lib/pgsql/11/data -m immediate<br><br>waiting <span class="hljs-keyword">for</span><span class="hljs-built_in"> server </span><span class="hljs-keyword">to</span> shut down<span class="hljs-built_in">..</span><span class="hljs-built_in">..</span> done<br>server stopped<br><br>progress: 768.0 s, 41.1 tps, lat 1562.948 ms stddev 1996.733<br>progress: 776.0 s, 48.3 tps, lat 1258.457 ms stddev 1728.933<br>WARNING:  terminating<span class="hljs-built_in"> connection </span>because of crash of another<span class="hljs-built_in"> server </span>process<br>DETAIL:  The postmaster has commanded this<span class="hljs-built_in"> server </span>process <span class="hljs-keyword">to</span> roll back the current transaction <span class="hljs-keyword">and</span> exit, because another<span class="hljs-built_in"> server </span>process exited abnormally <span class="hljs-keyword">and</span> possibly corrupted shared memory.<br>HINT:  <span class="hljs-keyword">In</span> a moment you should be able <span class="hljs-keyword">to</span> reconnect <span class="hljs-keyword">to</span> the database <span class="hljs-keyword">and</span> repeat your command.<br>WARNING:  terminating<span class="hljs-built_in"> connection </span>because of crash of another<span class="hljs-built_in"> server </span>process<br>DETAIL:  The postmaster has commanded this<span class="hljs-built_in"> server </span>process <span class="hljs-keyword">to</span> roll back the current transaction <span class="hljs-keyword">and</span> exit, because another<span class="hljs-built_in"> server </span>process exited abnormally <span class="hljs-keyword">and</span> possibly corrupted shared memory.<br><br><span class="hljs-comment">### postgresql log</span><br>$ tail -f /var/lib/pgsql/11/data/log/postgresql-Mon.log<br><br>2019-04-29 07:43:53.582 UTC [11284] WARNING:  terminating<span class="hljs-built_in"> connection </span>because of crash of another<span class="hljs-built_in"> server </span>process<br>2019-04-29 07:43:53.582 UTC [11284] DETAIL:  The postmaster has commanded this<span class="hljs-built_in"> server </span>process <span class="hljs-keyword">to</span> roll back the current transaction <span class="hljs-keyword">and</span> exit, because another<span class="hljs-built_in"> server </span>process exited abnormally <span class="hljs-keyword">and</span> possibly corrupted shared memory.<br>2019-04-29 07:43:53.582 UTC [11284] HINT:  <span class="hljs-keyword">In</span> a moment you should be able <span class="hljs-keyword">to</span> reconnect <span class="hljs-keyword">to</span> the database <span class="hljs-keyword">and</span> repeat your command.<br>2019-04-29 07:43:53.582 UTC [11284] CONTEXT:  <span class="hljs-keyword">while</span> rechecking updated tuple (3,17) <span class="hljs-keyword">in</span> relation <span class="hljs-string">&quot;pgbench_tellers&quot;</span><br>2019-04-29 07:43:53.584 UTC [11304] WARNING:  terminating<span class="hljs-built_in"> connection </span>because of crash of another<span class="hljs-built_in"> server </span>process<br>2019-04-29 07:43:53.584 UTC [11304] DETAIL:  The postmaster has commanded this<span class="hljs-built_in"> server </span>process <span class="hljs-keyword">to</span> roll back the current transaction <span class="hljs-keyword">and</span> exit, because another<span class="hljs-built_in"> server </span>process exited abnormally <span class="hljs-keyword">and</span> possibly corrupted shared memory.<br>2019-04-29 07:43:53.584 UTC [11304] HINT:  <span class="hljs-keyword">In</span> a moment you should be able <span class="hljs-keyword">to</span> reconnect <span class="hljs-keyword">to</span> the database <span class="hljs-keyword">and</span> repeat your command.<br>2019-04-29 07:43:53.584 UTC [11304] CONTEXT:  <span class="hljs-keyword">while</span> updating tuple (17,116) <span class="hljs-keyword">in</span> relation <span class="hljs-string">&quot;pgbench_tellers&quot;</span><br>2019-04-29 07:43:53.653 UTC [11282] WARNING:  terminating<span class="hljs-built_in"> connection </span>because of crash of another<span class="hljs-built_in"> server </span>process<br>2019-04-29 07:43:53.653 UTC [11282] DETAIL:  The postmaster has commanded this<span class="hljs-built_in"> server </span>process <span class="hljs-keyword">to</span> roll back the current transaction <span class="hljs-keyword">and</span> exit, because another<span class="hljs-built_in"> server </span>process exited abnormally <span class="hljs-keyword">and</span> possibly corrupted shared memory.<br>2019-04-29 07:43:53.653 UTC [11282] HINT:  <span class="hljs-keyword">In</span> a moment you should be able <span class="hljs-keyword">to</span> reconnect <span class="hljs-keyword">to</span> the database <span class="hljs-keyword">and</span> repeat your command.<br>2019-04-29 07:43:53.667 UTC [450] LOG:  database<span class="hljs-built_in"> system </span>is shut down<br><br>$ cd /var/lib/pgsql/11/data/pg_wal<br><span class="hljs-comment">#let &#x27;s test 14834480</span><br>$ sudo -u postgres /usr/pgsql-11/bin/pg_waldump -b 00000001000000010000008D | grep Transaction | tail | head -n 1<br>pg_waldump: FATAL:  <span class="hljs-builtin-name">error</span> <span class="hljs-keyword">in</span> WAL record at 1/8DEFE4B0: invalid record length at 1/8DEFE4D8: wanted 24, got 0<br>rmgr: Transaction len (rec/tot):     34/    34, tx:   14834480, lsn: 1/8DEFCAF8, prev 1/8DEFCAB8, desc: COMMIT 2019-04-29 07:43:53.168178 UTC<br><br>$ <span class="hljs-attribute">pgbench1</span>=# select xmin,* <span class="hljs-keyword">from</span> pgbench_history where xmin <span class="hljs-keyword">in</span> (14834480);<br>   xmin   | tid | bid |  aid  | delta |           mtime            | filler<br>----------+-----+-----+-------+-------+----------------------------+--------<br> 14834480 |  10 |   1 | 57633 |  1859 | 2019-04-29 08:41:26.458402 |<br>(1 row)<br><br>$ dd <span class="hljs-attribute">if</span>=/dev/zero <span class="hljs-attribute">of</span>=./00000001000000010000008D <span class="hljs-attribute">bs</span>=1 <span class="hljs-attribute">count</span>=10000 <span class="hljs-attribute">skip</span>=100<br><br>$ tail -f /var/lib/pgsql/11/data/log/postgresql-Mon.log <br>2019-04-29 07:57:03.979 UTC [11634] LOG:  database<span class="hljs-built_in"> system </span>was interrupted; last known up at 2019-04-29 07:41:55 UTC<br>2019-04-29 07:57:04.050 UTC [11634] LOG:  invalid primary checkpoint record<br>2019-04-29 07:57:04.051 UTC [11634] PANIC:  could <span class="hljs-keyword">not</span> locate a valid checkpoint record<br>2019-04-29 07:57:04.171 UTC [11632] LOG:  startup process (PID 11634) was terminated by signal 6: Aborted<br>2019-04-29 07:57:04.171 UTC [11632] LOG:  aborting startup due <span class="hljs-keyword">to</span> startup process failure<br>2019-04-29 07:57:04.173 UTC [11632] LOG:  database<span class="hljs-built_in"> system </span>is shut down<br><br>$ sudo -u postgres /usr/pgsql-11/bin/pg_resetwal -f /var/lib/pgsql/11/data<br>Write-ahead log reset<br><br>$ sudo -u postgres /usr/pgsql-11/bin/pg_ctl start  -D /var/lib/pgsql/11/data<br>waiting <span class="hljs-keyword">for</span><span class="hljs-built_in"> server </span><span class="hljs-keyword">to</span> start<span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>2019-04-29 08:17:18.990 UTC [11662] LOG:  listening on<span class="hljs-built_in"> IPv6 address </span><span class="hljs-string">&quot;::1&quot;</span>,<span class="hljs-built_in"> port </span>5432<br>2019-04-29 08:17:18.990 UTC [11662] LOG:  listening on IPv4<span class="hljs-built_in"> address </span><span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-built_in"> port </span>5432<br>2019-04-29 08:17:19.000 UTC [11662] LOG:  listening on Unix socket <span class="hljs-string">&quot;/var/run/postgresql/.s.PGSQL.5432&quot;</span><br>2019-04-29 08:17:19.026 UTC [11662] LOG:  listening on Unix socket <span class="hljs-string">&quot;/tmp/.s.PGSQL.5432&quot;</span><br>2019-04-29 08:17:19.050 UTC [11662] LOG:  redirecting log output <span class="hljs-keyword">to</span><span class="hljs-built_in"> logging </span>collector process<br>2019-04-29 08:17:19.050 UTC [11662] HINT:  Future log output will appear <span class="hljs-keyword">in</span> directory <span class="hljs-string">&quot;log&quot;</span>.<br> done<br>server started<br><br>$ tail -f /var/lib/pgsql/11/data/log/postgresql-Mon.log<br>2019-04-29 08:17:19.064 UTC [11664] LOG:  database<span class="hljs-built_in"> system </span>was shut down at 2019-04-29 08:17:11 UTC<br>2019-04-29 08:17:19.104 UTC [11662] LOG:  database<span class="hljs-built_in"> system </span>is ready <span class="hljs-keyword">to</span> accept connections<br>2019-04-29 08:17:31.640 UTC [11671] WARNING: <span class="hljs-built_in"> page </span>is <span class="hljs-keyword">not</span> marked all-visible but visibility map bit is <span class="hljs-builtin-name">set</span> <span class="hljs-keyword">in</span> relation <span class="hljs-string">&quot;pgbench_tellers&quot;</span><span class="hljs-built_in"> page </span>0<br>2019-04-29 08:17:31.640 UTC [11671] WARNING: <span class="hljs-built_in"> page </span>is <span class="hljs-keyword">not</span> marked all-visible but visibility map bit is <span class="hljs-builtin-name">set</span> <span class="hljs-keyword">in</span> relation <span class="hljs-string">&quot;pgbench_tellers&quot;</span><span class="hljs-built_in"> page </span>3<br><br><span class="hljs-comment"># you can&#x27;t found it</span><br>$ <span class="hljs-attribute">pgbench1</span>=# select xmin,* <span class="hljs-keyword">from</span> pgbench_history where xmin <span class="hljs-keyword">in</span> (14834480);<br> xmin | tid | bid | aid | delta | mtime | filler<br>------+-----+-----+-----+-------+-------+--------<br>(0 rows)<br><br>$ sudo -u postgres /usr/pgsql-11/bin/pgbench -c 64 -j 64 -T 1200 -P 8 -M extended <span class="hljs-attribute">--random-seed</span>=rand pgbench1<br>setting random seed <span class="hljs-keyword">to</span> 4384533976954680126<br>starting vacuum<span class="hljs-built_in">..</span>.end.<br>empty range given <span class="hljs-keyword">to</span> random<br>client 1 aborted <span class="hljs-keyword">in</span> command 0 (set) of<span class="hljs-built_in"> script </span>0; evaluation of meta-command failed<br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><br>empty range given <span class="hljs-keyword">to</span> random<br>client 40 aborted <span class="hljs-keyword">in</span> command 0 (set) of<span class="hljs-built_in"> script </span>0; evaluation of meta-command failed<br>transaction type: &lt;builtin: TPC-B (sort of)&gt;<br>scaling factor: 0<br>query mode: extended<br>number of clients: 64<br>number of threads: 64<br>duration: 1200 s<br>number of transactions actually processed: 0<br><br><span class="hljs-comment">## re-init</span><br><br>$ sudo -u postgres /usr/pgsql-11/bin/pgbench -i pgbench1<br>dropping old tables<span class="hljs-built_in">..</span>.<br>creating tables<span class="hljs-built_in">..</span>.<br>generating data<span class="hljs-built_in">..</span>.<br>100000 of 100000 tuples (100%) done (elapsed 0.12 s, remaining 0.00 s)<br>vacuuming<span class="hljs-built_in">..</span>.<br>creating primary keys<span class="hljs-built_in">..</span>.<br>done.<br><br></code></pre></td></tr></table></figure>
<p>Oh shit,it looks like meta data loss cause tables incomplelte….</p>
<p><a target="_blank" rel="noopener" href="https://github.com/winlibs/postgresql/blob/master/src/backend/commands/vacuumlazy.c">source code</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">		 * As of PostgreSQL 9.2, the visibility map bit should never be set if</span><br><span class="hljs-comment">		 * the page-level bit is clear.  However, it&#x27;s possible that the bit</span><br><span class="hljs-comment">		 * got cleared after we checked it and before we took the buffer</span><br><span class="hljs-comment">		 * content lock, so we must recheck before jumping to the conclusion</span><br><span class="hljs-comment">		 * that something bad has happened.</span><br><span class="hljs-comment">		 */</span><br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (all_visible_according_to_vm &amp;&amp; !PageIsAllVisible(page)<br>				 &amp;&amp; VM_ALL_VISIBLE(onerel, blkno, &amp;vmbuffer))<br>		&#123;<br>			elog(WARNING, <span class="hljs-string">&quot;page is not marked all-visible but visibility map bit is set in relation \&quot;%s\&quot; page %u&quot;</span>,<br>				 relname, blkno);<br>			visibilitymap_clear(onerel, blkno, vmbuffer,<br>								VISIBILITYMAP_VALID_BITS);<br>		&#125;<br></code></pre></td></tr></table></figure>


<h3 id="FIO-verify"><a href="#FIO-verify" class="headerlink" title="FIO verify"></a><a target="_blank" rel="noopener" href="https://github.com/axboe/fio/issues/713">FIO verify</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ fio --ioengine=libaio --name=<span class="hljs-built_in">test</span> --direct=1 --directory=<span class="hljs-variable">$filepath</span> --bs=512 --iodepth=1 --readwrite=randwrite --size=1G --numjobs=1 --verify=crc64 --do_verify=1 --verify_state_save=1 --group_reporting --verify_backlog=8192<br>$ fio --ioengine=libaio --name=<span class="hljs-built_in">test</span> --direct=1 --directory=<span class="hljs-variable">$filepath</span> --bs=512 --iodepth=1 --readwrite=randread  --size=1G --numjobs=1 --verify=crc64 --group_reporting --verify_only --verify_dump=1 --verify_state_load=1 --do_verify=1 --verify_backlog=8192<br><br>$ fio --ioengine=libaio --name=<span class="hljs-built_in">test</span> --direct=1 --directory=<span class="hljs-variable">$filepath</span> --bs=4K --iodepth=1 --readwrite=randwrite --size=4G --numjobs=1 --verify=crc64 --do_verify=1 --verify_state_save=1 --group_reporting --verify_backlog=8192<br>$ fio --ioengine=libaio --name=<span class="hljs-built_in">test</span> --direct=1 --directory=<span class="hljs-variable">$filepath</span> --bs=4K --iodepth=1 --readwrite=randread  --size=4G --numjobs=1 --verify=crc64 --group_reporting --verify_only --verify_dump=1 --verify_state_load=1 --do_verify=1 --verify_backlog=8192<br></code></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/04/28/consistency-test/">http://yoursite.com/2019/04/28/consistency-test/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/postgresql/">postgresql</a><a class="post-meta__tags" href="/tags/test/">test</a><a class="post-meta__tags" href="/tags/fio/">fio</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/05/24/megaraid/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Replace megaraid by strocli</div></div></a></div><div class="next-post pull-right"><a href="/2019/04/02/lxc_with_zfs/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">linux container with zfs</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/07/22/network-benchmark-result/" title="Network bencharmk results"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-22</div><div class="title">Network bencharmk results</div></div></a></div><div><a href="/2018/07/12/storage_benchmark/" title="storage benchmark"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-12</div><div class="title">storage benchmark</div></div></a></div><div><a href="/2020/03/17/benchmark-tools/" title="bencharmk tools"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-17</div><div class="title">bencharmk tools</div></div></a></div><div><a href="/2016/03/22/ha/" title="High availability test"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2016-03-22</div><div class="title">High availability test</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '0b9d5b98d0a972b33cf7',
      clientSecret: '769efc11b32f6c0d03bcbf3ee800dfc4e2690459',
      repo: 'homerl.github.io',
      owner: 'homerl',
      admin: ['homerl'],
      id: 'e214f81de645f5b9380f918614b7e1e4',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>