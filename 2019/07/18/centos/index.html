<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>centos | 己不由心，身又岂能由己</title><meta name="keywords" content="centos"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="centossystemd rc.local123456789101112131415161718192021$ sudo vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;rc-local.service[Unit]Description&#x3D;&#x2F;etc&#x2F;rc.local CompatibilityConditionPathExists&#x3D;&#x2F;etc&#x2F;rc.local[Service]Type&#x3D;forking">
<meta property="og:type" content="article">
<meta property="og:title" content="centos">
<meta property="og:url" content="http://yoursite.com/2019/07/18/centos/index.html">
<meta property="og:site_name" content="己不由心，身又岂能由己">
<meta property="og:description" content="centossystemd rc.local123456789101112131415161718192021$ sudo vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;rc-local.service[Unit]Description&#x3D;&#x2F;etc&#x2F;rc.local CompatibilityConditionPathExists&#x3D;&#x2F;etc&#x2F;rc.local[Service]Type&#x3D;forking">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg">
<meta property="article:published_time" content="2019-07-18T07:37:02.000Z">
<meta property="article:modified_time" content="2020-10-09T12:20:45.171Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="centos">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2019/07/18/centos/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-10-09 20:20:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/244247-guts.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#centos"><span class="toc-number">1.</span> <span class="toc-text">centos</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd-rc-local"><span class="toc-number">1.1.</span> <span class="toc-text">systemd rc.local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#date"><span class="toc-number">1.2.</span> <span class="toc-text">date</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dd"><span class="toc-number">1.3.</span> <span class="toc-text">dd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#selinux"><span class="toc-number">1.4.</span> <span class="toc-text">selinux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Software-Collections-SCL-Repository"><span class="toc-number">1.5.</span> <span class="toc-text">Software Collections ( SCL ) Repository</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#centos-8"><span class="toc-number"></span> <span class="toc-text">centos 8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nofile"><span class="toc-number">1.</span> <span class="toc-text">Nofile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pidstat"><span class="toc-number">2.</span> <span class="toc-text">pidstat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nfsstat"><span class="toc-number">3.</span> <span class="toc-text">nfsstat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user-space-pipe-size"><span class="toc-number">4.</span> <span class="toc-text">user space pipe size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rand-file"><span class="toc-number">5.</span> <span class="toc-text">rand file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#samba"><span class="toc-number">6.</span> <span class="toc-text">samba</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Account"><span class="toc-number">6.1.</span> <span class="toc-text">Account</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#config"><span class="toc-number">6.2.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Show-status"><span class="toc-number">6.3.</span> <span class="toc-text">Show status</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update-kernel-moduels-in-lib-moduels-uname-r"><span class="toc-number">7.</span> <span class="toc-text">update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#syscalls"><span class="toc-number">8.</span> <span class="toc-text">syscalls</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter-syslog"><span class="toc-number">9.</span> <span class="toc-text">filter syslog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs"><span class="toc-number">10.</span> <span class="toc-text">xfs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Check-fragmentation"><span class="toc-number">10.1.</span> <span class="toc-text">Check fragmentation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tmp-permission"><span class="toc-number">11.</span> <span class="toc-text">tmp permission</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#taskset"><span class="toc-number">12.</span> <span class="toc-text">taskset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh"><span class="toc-number">13.</span> <span class="toc-text">ssh</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-key-not-work"><span class="toc-number">13.1.</span> <span class="toc-text">ssh key not work</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-config-allow-users"><span class="toc-number">13.2.</span> <span class="toc-text">ssh config allow users</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strace"><span class="toc-number">14.</span> <span class="toc-text">strace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Calculated-CPU-usage"><span class="toc-number">15.</span> <span class="toc-text">Calculated CPU usage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tuna"><span class="toc-number">16.</span> <span class="toc-text">tuna</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS-client"><span class="toc-number">17.</span> <span class="toc-text">NFS client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monitor"><span class="toc-number">18.</span> <span class="toc-text">Monitor</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">18.1.</span> <span class="toc-text">ps</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selinux-1"><span class="toc-number">19.</span> <span class="toc-text">selinux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handle-overflow-in-jiffies"><span class="toc-number">20.</span> <span class="toc-text">handle overflow in jiffies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prevent-the-data-be-deleted"><span class="toc-number">21.</span> <span class="toc-text">Prevent the data be deleted</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#errno"><span class="toc-number">22.</span> <span class="toc-text">errno</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tc"><span class="toc-number">23.</span> <span class="toc-text">tc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VNC"><span class="toc-number">24.</span> <span class="toc-text">VNC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vncserer-was-runing-but-there-is-no-desktop-in-centos-7"><span class="toc-number">25.</span> <span class="toc-text">Vncserer was runing, but there is no desktop in centos 7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#screen"><span class="toc-number">26.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VLC"><span class="toc-number">27.</span> <span class="toc-text">VLC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Not-show-media-title"><span class="toc-number">27.1.</span> <span class="toc-text">Not show media title</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Not-resize-interface"><span class="toc-number">27.2.</span> <span class="toc-text">Not resize interface</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grub"><span class="toc-number">28.</span> <span class="toc-text">grub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-debug-parameters"><span class="toc-number">29.</span> <span class="toc-text">set debug parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS"><span class="toc-number">30.</span> <span class="toc-text">NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nolock"><span class="toc-number">30.1.</span> <span class="toc-text">nolock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file-lock"><span class="toc-number">30.2.</span> <span class="toc-text">file lock</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-could-I-found-which-file-cause-pipe-hang"><span class="toc-number">31.</span> <span class="toc-text">How could I found which file cause pipe hang</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-pipe-change-to-socket"><span class="toc-number">31.1.</span> <span class="toc-text">If pipe change to socket</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcpdump"><span class="toc-number">32.</span> <span class="toc-text">tcpdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#calculate-upload-download-speed-by-ping"><span class="toc-number">33.</span> <span class="toc-text">calculate upload&#x2F;download speed by ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MTU-problem-check"><span class="toc-number">34.</span> <span class="toc-text">MTU problem check</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yum"><span class="toc-number">35.</span> <span class="toc-text">yum</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Exclude-packages"><span class="toc-number">35.1.</span> <span class="toc-text">Exclude packages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch-version"><span class="toc-number">35.2.</span> <span class="toc-text">Switch version</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Download-to-local"><span class="toc-number">35.3.</span> <span class="toc-text">Download to local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Resolve-dependency-resolution-errors"><span class="toc-number">35.4.</span> <span class="toc-text">Resolve dependency resolution errors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Uninstall-rpm-packages-from-rpmdb"><span class="toc-number">35.5.</span> <span class="toc-text">Uninstall rpm packages from rpmdb</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upgrade-kernel"><span class="toc-number">36.</span> <span class="toc-text">upgrade kernel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BBR"><span class="toc-number">36.1.</span> <span class="toc-text">BBR</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reinstall-grub2-from-boot-livecd"><span class="toc-number">37.</span> <span class="toc-text">reinstall grub2 from boot livecd</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LVM-partition"><span class="toc-number">37.1.</span> <span class="toc-text">LVM partition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-in-ubuntu"><span class="toc-number">37.2.</span> <span class="toc-text">Test in ubuntu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-in-CentOS-7-set-boot-menu"><span class="toc-number">37.3.</span> <span class="toc-text">Test in CentOS 7, set boot menu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Re-install-EFI"><span class="toc-number">37.4.</span> <span class="toc-text">Re-install EFI</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rdesktop-to-win10"><span class="toc-number">38.</span> <span class="toc-text">rdesktop to win10</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-remote-desktop"><span class="toc-number">38.1.</span> <span class="toc-text">Enable remote desktop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Modify-registry-from-win10"><span class="toc-number">38.2.</span> <span class="toc-text">Modify registry from win10</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#record-and-replay-linux-terminal"><span class="toc-number">39.</span> <span class="toc-text">record and replay linux terminal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#traceroute-error"><span class="toc-number">40.</span> <span class="toc-text">traceroute error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><span class="toc-number">41.</span> <span class="toc-text">Getting Error su: cannot set user id: Resource temporarily unavailable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lshw"><span class="toc-number">42.</span> <span class="toc-text">lshw</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS8"><span class="toc-number">43.</span> <span class="toc-text">CentOS8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bonding"><span class="toc-number">43.1.</span> <span class="toc-text">bonding</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fio-test-multiple-nodes"><span class="toc-number">44.</span> <span class="toc-text">fio test multiple nodes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Permission"><span class="toc-number">45.</span> <span class="toc-text">Permission</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#screen-1"><span class="toc-number">46.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-systemd-service"><span class="toc-number">47.</span> <span class="toc-text">Add systemd service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#route-config"><span class="toc-number">48.</span> <span class="toc-text">route config</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#static-route"><span class="toc-number">48.1.</span> <span class="toc-text">static route</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-NIC-driver-err"><span class="toc-number">49.</span> <span class="toc-text">Check NIC driver err</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#collectl"><span class="toc-number">50.</span> <span class="toc-text">collectl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#process-mointor"><span class="toc-number">51.</span> <span class="toc-text">process mointor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time"><span class="toc-number">52.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#youtube-download"><span class="toc-number">53.</span> <span class="toc-text">youtube download</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uptime-and-vmstat-running"><span class="toc-number">54.</span> <span class="toc-text">uptime and vmstat running</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kernel-do-IRQ-X-Y-No-irq-handler-for-vector-irq-1"><span class="toc-number">55.</span> <span class="toc-text">kernel: do_IRQ: X.Y No irq handler for vector (irq -1)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multipath-issue"><span class="toc-number">56.</span> <span class="toc-text">multipath issue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sshfs"><span class="toc-number">57.</span> <span class="toc-text">sshfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scan-file-size"><span class="toc-number">58.</span> <span class="toc-text">scan file size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#System-err-for-monitor"><span class="toc-number">59.</span> <span class="toc-text">System err for monitor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cgroup-limit-resource"><span class="toc-number">60.</span> <span class="toc-text">cgroup limit resource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#About-WB-SYNC-NONE-and-WB-SYNC-ALL"><span class="toc-number">61.</span> <span class="toc-text">About WB_SYNC_NONE and WB_SYNC_ALL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tools"><span class="toc-number">62.</span> <span class="toc-text">Tools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ldd"><span class="toc-number">62.1.</span> <span class="toc-text">ldd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Read-ELF-Executable-and-Linking-Format"><span class="toc-number">62.2.</span> <span class="toc-text">Read ELF(Executable and Linking Format)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#objdump"><span class="toc-number">62.3.</span> <span class="toc-text">objdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nm"><span class="toc-number">62.4.</span> <span class="toc-text">nm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-number">62.5.</span> <span class="toc-text">size</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#process-schduler"><span class="toc-number">63.</span> <span class="toc-text">process schduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vim-jump-cursor"><span class="toc-number">64.</span> <span class="toc-text">vim jump cursor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gpart-recovery-partition-table"><span class="toc-number">65.</span> <span class="toc-text">gpart recovery partition table</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">己不由心，身又岂能由己</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">centos</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-07-18T07:37:02.000Z" title="Created 2019-07-18 15:37:02">2019-07-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-10-09T12:20:45.171Z" title="Updated 2020-10-09 20:20:45">2020-10-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/OS/">OS</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h3><h4 id="systemd-rc-local"><a href="#systemd-rc-local" class="headerlink" title="systemd rc.local"></a>systemd rc.local</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo vi /etc/systemd/system/rc-local.service<br><br>[Unit]<br>Description=/etc/rc.local Compatibility<br>ConditionPathExists=/etc/rc.local<br><br>[Service]<br>Type=forking<br>ExecStart=/etc/rc.local start<br>TimeoutSec=0<br>StandardOutput=tty<br>RemainAfterExit=yes<br>SysVStartPriority=99<br><br>[Install]<br>WantedBy=multi-user.target<br><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;exit 0&quot;</span> &gt; /etc/rc.local<br><br>$ sudo chmod +x /etc/rc.local<br>$ sudo systemctl <span class="hljs-built_in">enable</span> rc-local<br></code></pre></td></tr></table></figure>

<h4 id="date"><a href="#date" class="headerlink" title="date"></a>date</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ date -d <span class="hljs-string">&quot;@1595260885&quot;</span> +<span class="hljs-string">&quot;%m/%d/%Y %H:%M:%S&quot;</span><br>07/21/2020 00:01:25<br><br>$ date -d <span class="hljs-string">&quot;07/21/2020 00:01:25&quot;</span> +%s<br>159526088<br><br>$ date -d @12345 -u +%H:%M:%S<br>03:25:45<br><br>$ date -d <span class="hljs-string">&quot;09/04/2020 03:25:45&quot;</span> +%s<br>1599186345<br>$ date -d <span class="hljs-string">&quot;09/04/2020 00:00:00&quot;</span> +%s<br>1599174000<br>$ <span class="hljs-built_in">echo</span> $((<span class="hljs-number">1599186345</span>-<span class="hljs-number">1599174000</span>))<br>12345<br></code></pre></td></tr></table></figure>

<h4 id="dd"><a href="#dd" class="headerlink" title="dd"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8554568/add-a-big-buffer-to-a-pipe-between-two-commands">dd</a></h4><p>dd modify pipe buffer block size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ commandA | dd status=none iflag=fullblock bs=1M | commandB<br>$ process1 | mbuffer -m 1024M | process2<br></code></pre></td></tr></table></figure>

<h4 id="selinux"><a href="#selinux" class="headerlink" title="selinux"></a>selinux</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ setenforce 0<br>$ getenforce<br>Permissive<br></code></pre></td></tr></table></figure>
<h4 id="Software-Collections-SCL-Repository"><a href="#Software-Collections-SCL-Repository" class="headerlink" title="Software Collections ( SCL ) Repository"></a>Software Collections ( SCL ) Repository</h4><p>$ yum install centos-release-scl-rh<br>$ yum install devtoolset-9-toolchain</p>
<h1 id="centos-8"><a href="#centos-8" class="headerlink" title="centos 8"></a>centos 8</h1><p>$ dnf install gcc-toolset-9</p>
<p>$ gfortran –version | head -2<br>GNU Fortran (GCC) 4.8.5 20150623 (Red Hat 4.8.5-36)<br>Copyright (C) 2015 Free Software Foundation, Inc.</p>
<p>$ scl enable devtoolset-9 bash</p>
<p>$  gfortran –version | head -2<br>GNU Fortran (GCC) 8.2.1 20180905 (Red Hat 8.2.1-3)<br>Copyright (C) 2018 Free Software Foundation, Inc.</p>
<a id="more"></a>

<h3 id="Nofile"><a href="#Nofile" class="headerlink" title="Nofile"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/447583/ulimit-vs-file-max">Nofile</a></h3><p>/proc/sys/fs/file-max<br>ulimit -n</p>
<p>file-max is the maximum File Descriptors (FD) enforced on a kernel level, which cannot be surpassed by all processes without increasing.<br>The ulimit is enforced on a process level, which can be less than the file-max.</p>
<p>/proc/sys/fs/file-nr<br>This will return three values denote the number of allocated file handles the number of allocated but unused file handles, and the maximum number of file handles. </p>
<h3 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ pidstat -C <span class="hljs-string">&#x27;linpack|stream&#x27;</span> -d 2 -rsuw<br></code></pre></td></tr></table></figure>

<h3 id="nfsstat"><a href="#nfsstat" class="headerlink" title="nfsstat"></a>nfsstat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nfsiostat -d /mount 2<br></code></pre></td></tr></table></figure>

<h3 id="user-space-pipe-size"><a href="#user-space-pipe-size" class="headerlink" title="user space pipe size"></a>user space pipe size</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># F_SETPIPE_SZ F_GETPIPE_SZ</span><br><span class="hljs-comment"># echo 104857600 &gt; /proc/sys/fs/pipe-max-size</span><br><span class="hljs-comment"># fs.pipe-max-size=104857600</span><br><span class="hljs-comment"># ulimit pipe size            (512 bytes, -p) 8 = 4096 bytes, it &#x27;s pipe buffer size in the ulimit, not pipe size</span><br><span class="hljs-comment">## POSIX.1-2001 says that write(2)s of less than PIPE_BUF  bytes  must  be atomic:  the  output  data  is  written  to  the  pipe  as a contiguous sequence.  Writes of more than PIPE_BUF bytes may  be  non-atomic:  the kernel  may  interleave the data with data written by other processes.</span><br><br><span class="hljs-comment"># here 2 tools for pipe</span><br><span class="hljs-comment"># pv - Pipe Viewer - is a terminal-based tool for monitoring the progress of data through a pipeline.</span><br><span class="hljs-comment"># process1 | pv -pterbTCB 1G | process2</span><br><br>$ pv -cN sources linux-image-unsigned-4.15.0-65-generic-dbgsym_4.15.0-65.74_amd64.ddeb | dd of=/tmp/tmp bs=512 | pv -cN cat<br><br>$ mkfifo -m 777 /tmp/lfs.log<br>$ lctl debug_daemon start /tmp/lfs.log<br><br><span class="hljs-comment">## lfs 40MB log</span><br>$ lctl debug_daemon start /tmp/lfs.40.bin 40<br><br></code></pre></td></tr></table></figure>

<h3 id="rand-file"><a href="#rand-file" class="headerlink" title="rand file"></a>rand file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl rand -out 1G.file 1073741824<br></code></pre></td></tr></table></figure>

<h3 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h3><h4 id="Account"><a href="#Account" class="headerlink" title="Account"></a>Account</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd -r -s /bin/<span class="hljs-literal">false</span>  <span class="hljs-variable">$USER</span><br>PASSINPUT=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$USER</span>|cut -c1-3`123 <br>(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$PASSINPUT</span> ; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PASSINPUT</span>)  | smbpasswd -s -a <span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure>
<h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[global]<br>	workgroup = MYGROUP<br>	server string = Samba Server Version %v<br>	<span class="hljs-built_in">log</span> file = /var/<span class="hljs-built_in">log</span>/samba/<span class="hljs-built_in">log</span>.%m<br>	max <span class="hljs-built_in">log</span> size = 50<br>	security = user<br>	passdb backend = tdbsam<br>load printers = no<br>printing = bsd<br>printcap name = /dev/null<br><span class="hljs-built_in">disable</span> spoolss = yes<br><br>[SMB_DATA]<br>path = /samba/data<br>valid users =  test1,test2,test3,test4<br>create mask = 0744<br>force create mode = 0744<br>security mask = 0744<br>force security mode = 0744<br>directory mask = 0755<br>force directory mode = 0755<br>directory security mask = 0755<br>force directory security mode = 0755<br>writable = yes<br>fileid:mapping = smb_data<br>use mmap = no<br>nt acl support = yes<br>ea support = yes<br></code></pre></td></tr></table></figure>

<h4 id="Show-status"><a href="#Show-status" class="headerlink" title="Show status"></a>Show status</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient -L localhost <span class="hljs-comment">#show share point</span><br>$ pdbedit -L <span class="hljs-comment"># show users</span><br>$ mount.cifs //<span class="hljs-variable">$domain_addr</span>/SMB_DATA -o username=test1,password=<span class="hljs-variable">$your_pass</span> /mnt<br><br>$ ls -l /var/lib/samba/private/<br>total 936<br>-rw------- 1 root root 528384 Aug 22 10:36 passdb.tdb<br>-rw------- 1 root root 430080 Dec 29  2013 secrets.tdb<br><span class="hljs-comment"># backup data</span><br>$ pdbedit -e smbpasswd:/root/samba-users.backup<br><br><span class="hljs-comment"># import </span><br>$ pdbedit -i smbpasswd:/root/samba-users.backup<br><br><span class="hljs-comment"># Please backup all users from /etc/passwd too</span><br></code></pre></td></tr></table></figure>

<h3 id="update-kernel-moduels-in-lib-moduels-uname-r"><a href="#update-kernel-moduels-in-lib-moduels-uname-r" class="headerlink" title="update kernel moduels in /lib/moduels/$(uname -r)"></a>update kernel moduels in /lib/moduels/$(uname -r)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># re-generate modules.alias modules.dep</span><br>$ depmod -a<br></code></pre></td></tr></table></figure>

<h3 id="syscalls"><a href="#syscalls" class="headerlink" title="syscalls"></a>syscalls</h3><p>Get these names from <a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/include/linux/syscalls.h">syscalls.h</a></p>
<h3 id="filter-syslog"><a href="#filter-syslog" class="headerlink" title="filter syslog"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/1564823">filter syslog</a></h3><p>Created slice user-0.slice.<br>Starting Session 150 of user root.<br>Started Session 150 of user root.<br>Created slice user-0.slice.<br>Starting Session 151 of user root.<br>Started Session 151 of user root.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;if $programname == &quot;l_getidentity.*&quot; then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-lustre-id-session.conf<br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;if $programname == &quot;systemd&quot; and ($msg contains &quot;Starting Session&quot; or $msg contains &quot;Started Session&quot; or $msg contains &quot;Created slice&quot; or $msg contains &quot;Starting user-&quot; or $msg contains &quot;Starting User Slice of&quot; or $msg contains &quot;Removed session&quot; or $msg contains &quot;Removed slice User Slice of&quot; or $msg contains &quot;Stopping User Slice of&quot;) then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-systemd-session-slice.conf<br><br>$ systemctl restart rsyslog<br></code></pre></td></tr></table></figure>

<h3 id="xfs"><a href="#xfs" class="headerlink" title="xfs"></a>xfs</h3><h4 id="Check-fragmentation"><a href="#Check-fragmentation" class="headerlink" title="Check fragmentation"></a>Check fragmentation</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">xfs_db -r -c frag /dev/md127<br>actual 310296, ideal 306296, fragmentation factor 1.29%<br>Note, this number is largely meaningless.<br>Files on this filesystem average 1.01 extents per file<br></code></pre></td></tr></table></figure>

<h3 id="tmp-permission"><a href="#tmp-permission" class="headerlink" title="tmp permission"></a>tmp permission</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chmod 1777 /tmp<br></code></pre></td></tr></table></figure>

<h3 id="taskset"><a href="#taskset" class="headerlink" title="taskset"></a>taskset</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ taskset -p a 205344<br>pid 205344<span class="hljs-string">&#x27;s current affinity mask: ffffffffff</span><br><span class="hljs-string">pid 205344&#x27;</span>s new affinity mask: a<br><br>$ taskset -c -p 205344<br>pid 205344<span class="hljs-string">&#x27;s current affinity list: 1,3</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ echo &quot;obase=2; ibase=16; A&quot; | bc</span><br><span class="hljs-string">1010 # core 1,3</span><br></code></pre></td></tr></table></figure>

<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><h4 id="ssh-key-not-work"><a href="#ssh-key-not-work" class="headerlink" title="ssh key not work"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6377009/adding-public-key-to-ssh-authorized-keys-does-not-log-me-in-automatically">ssh key not work</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ chmod 700 ~/.ssh<br>$ chmod 600 ~/.ssh/authorized_keys<br>$ chmod go-w ~<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># bind $vnc_server_ip:5910 to localhost:7910</span><br>$ ssh -L 7910:localhost:5910 username@<span class="hljs-variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no<br><br><span class="hljs-comment"># to 0.0.0.0:7910</span><br>$ ssh -L 7910:0.0.0.0:5910 username@<span class="hljs-variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no<br><span class="hljs-comment"># same with 0.0.0.0</span><br>$ ssh -g -L 7910:localhost:5910 username@<span class="hljs-variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no<br><span class="hljs-comment"># limit the client ip</span><br>$ ssh -g -L 7910:<span class="hljs-variable">$&#123;ssh_client_ip&#125;</span>:5910 username@<span class="hljs-variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no<br><br><span class="hljs-comment"># bind $vnc_server_ip:5910 to $vnc_server_ip:7910 by $ssh_client</span><br><span class="hljs-comment"># modify -L to -R</span><br>$ ssh -R 7910:localhost:5910 username@<span class="hljs-variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no<br><br><span class="hljs-comment"># share all ip addr</span><br><span class="hljs-comment"># modify /etc/ssh/sshd_config &#x27;GatewayPorts clientspecified&#x27;</span><br>$ ssh -R 7910:0.0.0.0:5910 username@<span class="hljs-variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no<br><br><span class="hljs-comment"># vnc_server_ip2 and ip1 in the same LAN, bind vnc_server_ip2 5910 to ssh client 7910 and forward by vnc_server_ip1</span><br>$ ssh -L 7910:<span class="hljs-variable">$&#123;vnc_server_ip2&#125;</span>:5910 user@<span class="hljs-variable">$&#123;vnc_server_ip1&#125;</span><br>vnc_server_ip1 $ vncview localhost:7910<br><span class="hljs-comment"># Enable all ip access</span><br>$ ssh -L 7910:0.0.0.0:5910 user@<span class="hljs-variable">$&#123;vnc_server_ip1&#125;</span><br><br><span class="hljs-comment"># vnc_server_ip1 access ssh_client_ip2 vnc service</span><br>$ ssh -R 7910:ssh_client_ip2:5910 user@vnc_server_ip1<br>vnc_server_ip1 $ vncviewer localhost::7910 <br><span class="hljs-comment"># Enable all ip access</span><br>$ ssh -R 7910:0.0.0.0:5910 user@vnc_server_ip1<br><br><span class="hljs-comment">#### [pass through another machine to forward sock5](https://superuser.com/questions/332850/ssh-as-socks-proxy-through-multiple-hosts)</span><br>A-&gt;B-&gt;C  <br>C could connecnt internet, A and B could not, A pass through B to forward sock5 port to <span class="hljs-variable">$A_local_sock_port</span><br>```bash<br><span class="hljs-comment"># make these port have not block by firewalld</span><br><br><span class="hljs-comment">### In A, you could set sock5 localhost:$A_local_sock_port to connect internnet</span><br>client $ ssh -C -f -N -D <span class="hljs-variable">$local_sock_port</span> -oProxyCommand=<span class="hljs-string">&quot;ssh -C -W %h:%p username@<span class="hljs-variable">$B_ipaddr</span>&quot;</span> username@<span class="hljs-variable">$C_ipaddr</span><br><br><span class="hljs-comment"># or </span><br>client $ ssh -L <span class="hljs-variable">$local_sock_port</span>:localhost:<span class="hljs-variable">$PORT2</span> <span class="hljs-variable">$B_IPADDR</span><br>A $ ssh -f -N -D <span class="hljs-variable">$PORT2</span> <span class="hljs-variable">$C_IPADDR</span><br><span class="hljs-comment">#merge dual command to single command</span><br>client $ ssh -f -L <span class="hljs-variable">$local_sock_port</span>:localhost:<span class="hljs-variable">$PORT2</span> liyan@192.168.210.3 <span class="hljs-string">&quot;ssh -f -N -D <span class="hljs-variable">$PORT2</span> liyan@<span class="hljs-variable">$C_IPADDR</span>&quot;</span><br><br><span class="hljs-comment"># forward remote port to local</span><br>client $ ssh -fNT -R 1025:127.0.0.1:1025 -J user@<span class="hljs-variable">$B_IP</span> user@<span class="hljs-variable">$C_IP</span><br>AllowTcpForwarding yes<br>GatewayPorts yes<br></code></pre></td></tr></table></figure>

<h4 id="ssh-config-allow-users"><a href="#ssh-config-allow-users" class="headerlink" title="ssh config allow users"></a>ssh config allow users</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">AllowUsers *@192.168.1.0/24 *@*.example.com *@1.2.3.4<br>AllowGroups ssh<br></code></pre></td></tr></table></figure>

<h3 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h3><p>-ttt If given thrice, the time printed will include the microseconds and the leading portion will be printed as the number of seconds since the epoch</p>
<p>-s strsize  Specify the maximum string size to print (the default is 32).  Note that filenames are not considered strings and are always printed in full.</p>
<p>-f Trace child processes as they are created by currently traced processes  as  a  result  of  the  fork(2),  vfork(2)  and clone(2)  system  calls. Note that -p PID -f will attach all threads of process PID if it is multi-threaded, not only thread with thread_id = PID</p>
<p>-T Show the time spent in system calls.  This records the time difference between the beginning and the end of each  system call</p>
<p>-c Count time, calls, and errors for each system call and report a summary on program exit, suppressing the regular output. This attempts to show system time (CPU time spent running in the kernel) independent of wall clock time.  If -c is used with -f, only aggregate totals for all traced processes are kept.<br>-C Like -c but also print regular output while processes are running.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ strace -k cmd  <span class="hljs-comment">#show backtrace for each syscall</span><br>$ strace -t cmd  <span class="hljs-comment">#prefix each syscall with walllock time</span><br>$ strace -D cmd  strace process runs as detached grandchild of cmd<br>$ strace -p 1234 -f <span class="hljs-comment">#addatch to all threads in process-group 1234</span><br><br>strace -Tfe trace=open,<span class="hljs-built_in">read</span>,write  ./program<br>$ strace -f -FF -tt -T -s 1024 -p <span class="hljs-variable">$pid</span><br>$ strace -ttt -T -s 1024 -e trace=%memory -C -o ~/memory.log -f -p <span class="hljs-variable">$pid</span><br>$ strace -ttt -T -s 1024 -e trace=%desc -C -o ~/desc.log -f -p <span class="hljs-variable">$pid</span><br></code></pre></td></tr></table></figure>

<h3 id="Calculated-CPU-usage"><a href="#Calculated-CPU-usage" class="headerlink" title="Calculated CPU usage"></a><a target="_blank" rel="noopener" href="https://github.com/Leo-G/DevopsWiki/wiki/How-Linux-CPU-Usage-Time-and-Percentage-is-calculated">Calculated CPU usage</a></h3><p>cpu usage=(idle2-idle1)/(cpu2-cpu1)*100 # script example<br>cpu usage=[(user_2 +sys_2+nice_2) - (user_1 + sys_1+nice_1)]/(total_2 - total_1)*100</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash"> cat /proc/<span class="hljs-built_in">stat</span><br>     user nice system idle iowait  irq  softirq steal guest guest_nice<br>cpu  4705 356  584    3699   23    23     0       0     0          0<br><br><span class="hljs-meta">#!/bin/bash</span><br> <span class="hljs-comment"># by Paul Colby (http://colby.id.au), no rights reserved ;)</span><br><br> PREV_TOTAL=0<br> PREV_IDLE=0<br><br> <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span><br>   <span class="hljs-comment"># Get the total CPU statistics, discarding the &#x27;cpu &#x27; prefix.</span><br>   CPU=(`sed -n <span class="hljs-string">&#x27;s/^cpu\s//p&#x27;</span> /proc/<span class="hljs-built_in">stat</span>`)<br>   IDLE=<span class="hljs-variable">$&#123;CPU[3]&#125;</span> <span class="hljs-comment"># Just the idle CPU time.</span><br><br>   <span class="hljs-comment"># Calculate the total CPU time.</span><br>   TOTAL=0<br>   <span class="hljs-keyword">for</span> VALUE <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CPU[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br>     ((TOTAL=<span class="hljs-variable">$TOTAL</span>+<span class="hljs-variable">$VALUE</span>))<br>   <span class="hljs-keyword">done</span><br><br>   <span class="hljs-comment"># Calculate the CPU usage since we last checked.</span><br>   ((DIFF_IDLE=<span class="hljs-variable">$IDLE</span>-<span class="hljs-variable">$PREV_IDLE</span>))<br>   ((DIFF_TOTAL=<span class="hljs-variable">$TOTAL</span>-<span class="hljs-variable">$PREV_TOTAL</span>))<br>    <br>   <span class="hljs-comment">## </span><br>   DIFF_USAGE=$(awk -v diff_idle=<span class="hljs-variable">$DIFF_IDLE</span> -v diff_total=<span class="hljs-variable">$DIFF_TOTAL</span> <span class="hljs-string">&#x27;BEGIN&#123;printf &quot;%.2f&quot;, (diff_total-diff_idle)/diff_total*100&#125;&#x27;</span>)<br>   <span class="hljs-built_in">echo</span> -en <span class="hljs-string">&quot;\rCPU: <span class="hljs-variable">$DIFF_USAGE</span>%  \b\b&quot;</span><br><br>   <span class="hljs-comment"># Remember the total and idle CPU times for the next check.</span><br>   PREV_TOTAL=<span class="hljs-string">&quot;<span class="hljs-variable">$TOTAL</span>&quot;</span><br>   PREV_IDLE=<span class="hljs-string">&quot;<span class="hljs-variable">$IDLE</span>&quot;</span><br><br>   <span class="hljs-comment"># Wait before checking again.</span><br>   usleep 100000<br> <span class="hljs-keyword">done</span><br><br><br><span class="hljs-comment">## the lib messages</span><br>$ <span class="hljs-built_in">read</span>(3, <span class="hljs-string">&quot;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\20\273\0\0\0\0\0\0&quot;</span>..., 832) = 832<br><br>$ od -bc /lib/x86_64-linux-gnu/libc.so.6 | head -n4<br>0000000 177 105 114 106 002 001 001 003 000 000 000 000 000 000 000 000<br>        177   E   L   F 002 001 001 003  \0  \0  \0  \0  \0  \0  \0  \0<br>0000020 003 000 076 000 001 000 000 000 260 034 002 000 000 000 000 000<br>        003  \0   &gt;  \0 001  \0  \0  \0 260 034 002  \0  \0  \0  \0  \0<br></code></pre></td></tr></table></figure>

<h3 id="tuna"><a href="#tuna" class="headerlink" title="tuna"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/2144921">tuna</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># check kernel threads</span><br>$ tuna -U -P<br>                      thread       ctxt_switches<br>    pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd<br>  2      OTHER     0    0xfff 386420266      1048922        kthreadd<br>  4      OTHER     0        0         7            0    kworker/0:0H<br>  6      OTHER     0        0   4030025         3019     ksoftirqd/0<br>  7       FIFO    99        0    155252            0     migration/0<br><br><span class="hljs-comment"># Got the voluntary and nonvoluntary ctxt switch</span><br><span class="hljs-comment"># pid is the io test app</span><br>grep ctxt_switches /proc/<span class="hljs-variable">$&#123;pid&#125;</span>/status<br>voluntary_ctxt_switches:        2940930 (I/O bound)<br>nonvoluntary_ctxt_switches:     9042<br><br><span class="hljs-comment"># 147095 is the cpu test app</span><br>grep ctxt_switches /proc/147095/status<br>voluntary_ctxt_switches:	478<br>nonvoluntary_ctxt_switches:	1565 (CPU bound)<br><br><span class="hljs-comment"># Disabling automatic IRQ balancing</span><br>$ systemctl stop irqbalance.service<br>$ systemctl <span class="hljs-built_in">disable</span> irqbalance.service<br><br><span class="hljs-comment">#  the kernel will automatically try to balance the load based on its understanding of the hardware&#x27;s NUMA layout</span><br>$  <span class="hljs-built_in">echo</span> kernel.numa_balancing=0 &gt;&gt; /etc/sysctl.conf ; sysctl -p<br><br><span class="hljs-comment"># Isolating CPUs from the process scheduler</span><br>This step involves setting isolcpus on the kernel<span class="hljs-string">&#x27;s cmdline. This removes cores from the process scheduler that you would like to dedicate to your application, so other userland processes do not migrate to them. Please see this solutions document for more information: https://access.redhat.com/solutions/480473</span><br><span class="hljs-string">NOTE: kernel threads are not able to be disabled and will always be visible on all cores. In ps -eLf output, these show up in brackets, like [ksoftirqd/0]</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ grubby --update-kernel=ALL --add-args=&#x27;</span>isolcpus=1-3,5-31<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">## Show numa node for dev </span><br><span class="hljs-string">$ numactl -a -N netdev:em1 grep allowed /proc/self/status</span><br><span class="hljs-string">Cpus_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000055,55555555</span><br><span class="hljs-string">Cpus_allowed_list:	0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38</span><br><span class="hljs-string">Mems_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000003</span><br><span class="hljs-string">Mems_allowed_list:	0-1</span><br><span class="hljs-string"></span><br><span class="hljs-string">## bind to 0,2,4 cores</span><br><span class="hljs-string">$ numactl -a -N netdev:em1 -C 0,2,4 grep allowed /proc/self/status</span><br><span class="hljs-string">Cpus_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000015</span><br><span class="hljs-string">Cpus_allowed_list:	0,2,4</span><br><span class="hljs-string">Mems_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000003</span><br><span class="hljs-string">Mems_allowed_list:	0-1</span><br><span class="hljs-string"></span><br><span class="hljs-string">## Here has a question, if you recheck the CPU, The CPUs_allowed_list will go to &quot;0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38&quot; again</span><br><span class="hljs-string"></span><br><span class="hljs-string">## write the it to systemd service config file</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">...other lines...</span><br><span class="hljs-string">ExecStart=/bin/numactl -aN netdev:em1 -C 6 /path/to/ptpd</span><br><span class="hljs-string">...other lines...</span><br><span class="hljs-string"></span><br><span class="hljs-string">## about numactl</span><br><span class="hljs-string">Instead of a number a node can also be:</span><br><span class="hljs-string">  netdev:DEV the node connected to network device DEV</span><br><span class="hljs-string">  file:PATH  the node the block device of path is connected to</span><br><span class="hljs-string">  ip:HOST    the node of the network device host routes through</span><br><span class="hljs-string">  block:PATH the node of block device path</span><br><span class="hljs-string">  pci:[seg:]bus:dev[:func] The node of a PCI device</span><br><span class="hljs-string"></span><br><span class="hljs-string"># Dell H330 IR</span><br><span class="hljs-string">$ lspci -ttv | grep &quot;MegaRAID SAS-3 3008&quot; -B 1</span><br><span class="hljs-string"> \-[0000:00]-+-00.0  Intel Corporation Xeon E7 v4/Xeon E5 v4/Xeon E3 v4/Xeon D DMI2</span><br><span class="hljs-string">             +-01.0-[02]----00.0  LSI Logic / Symbios Logic MegaRAID SAS-3 3008 [Fury]</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ ls -l /sys/class/block</span><br><span class="hljs-string">sda -&gt; ../../devices/pci0000:00/0000:00:01.0/0000:02:00.0/host0/target0:0:0/0:0:0:0/block/sda</span><br><span class="hljs-string"></span><br><span class="hljs-string">CPU ID</span><br><span class="hljs-string">Zero-based CPU ID	0	1	2	3	4	5	6	7	8	9	10	11	12</span><br><span class="hljs-string">Decimal Value	1	2	4	8	16	32	64	128	256	512	1024	2048	4096</span><br><span class="hljs-string">Hexadecimal Value	1	2	4	8	10	20	40	80	100	200	400	800	1000</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">printf &#x27;</span>%x %x\n<span class="hljs-string">&#x27; 1024 4096</span><br><span class="hljs-string">400 1000</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ awk -F &#x27;</span>[ :]+<span class="hljs-string">&#x27; &#x27;</span><span class="hljs-variable">$0</span>!~/CPU/ &amp;&amp; <span class="hljs-variable">$0</span>~/em1/&#123;<span class="hljs-built_in">print</span> <span class="hljs-variable">$2</span>&#125;<span class="hljs-string">&#x27; /proc/interrupts</span><br><span class="hljs-string">88</span><br><span class="hljs-string">90</span><br><span class="hljs-string">91</span><br><span class="hljs-string">92</span><br><span class="hljs-string">93</span><br><span class="hljs-string">94</span><br><span class="hljs-string">95</span><br><span class="hljs-string">96</span><br><span class="hljs-string">97</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ echo 400 &gt; /proc/irq/88/smp_affinitya</span><br><span class="hljs-string">...</span><br><span class="hljs-string">$ echo 1000 &gt; /proc/irq/97/smp_affinity</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ seq 88 97 | xargs -I% grep -H . /proc/irq/%/smp_affinity</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<h3 id="NFS-client"><a href="#NFS-client" class="headerlink" title="NFS client"></a>NFS client</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;options sunrpc tcp_slot_table_entries=128&quot;</span> &gt;&gt; /etc/modprobe.d/sunrpc.conf<br><span class="hljs-comment"># the value default only 2</span><br></code></pre></td></tr></table></figure>

<h3 id="Monitor"><a href="#Monitor" class="headerlink" title="Monitor"></a>Monitor</h3><h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head<br>$ ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head<br></code></pre></td></tr></table></figure>

<h3 id="selinux-1"><a href="#selinux-1" class="headerlink" title="selinux"></a>selinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">setroubleshoot<br></code></pre></td></tr></table></figure>

<h3 id="handle-overflow-in-jiffies"><a href="#handle-overflow-in-jiffies" class="headerlink" title="handle overflow in jiffies"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8206762/how-does-linux-handle-overflow-in-jiffies">handle overflow in jiffies</a></h3><p>1ms = millisecond<br>1us = microsecond !=ms, microsecond = us<br>1ns = billisecond = nanosecond<br>1ps = picosecond</p>
<p>/usr/src/kernels/$(uname -r)/include/linux/jiffies.h</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">These inlines deal with timer wrapping correctly. You are <br>strongly encouraged to use them<br>1. Because people otherwise forget<br>2. Because <span class="hljs-keyword">if</span> the timer wrap changes <span class="hljs-keyword">in</span> future you won<span class="hljs-string">&#x27;t have to</span><br><span class="hljs-string">   alter your driver code.</span><br><span class="hljs-string"></span><br><span class="hljs-string">time_after(a,b) returns true if the time a is after time b.</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>
<p>time_before(jiffies, timeout)<br>#define time_before(jiffies, timeout) ((long)(jiffies) - (long)(timeout) &lt; 0)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> (time_before(jiffies, timeout)<br>&#123;<br>    /* we did not time out, good ... */<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    /* we timed out, error ...*<br>&#125; <br><span class="hljs-comment"># or</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,time_before(jiffies,timeout));   <br></code></pre></td></tr></table></figure>


<p>/usr/src/kernels/3.10.0-862.11.6.el7.x86_64/include/generated/autoconf.h</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#define CONFIG_HZ 1000</span><br></code></pre></td></tr></table></figure>

<p>/usr/src/kernels/$(uname -r)/include/asm-generic/param.h<br>1GHz=1000,000,000 Hz<br>1 second/1000000000<br>awk ‘BEGIN{printf “%.9f\n”,1/1000000000}’<br>0.000000001 (1ns/Hz system precision)</p>
<p>Linux kenrel CONFIG_HZ = 1000</p>
<p>Tick = 1sec / CONFIG_HZ= 1ms<br>average 1ms with once interrput, 1000 time interrupt in single second</p>
<p>The timer tick is a timer interrupt that is usually generated HZ times per second<br>jiffies means the unit of time</p>
<p>the kernel use some macros prevent an overflow, eg: time_before</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#incldue <span class="hljs-meta-string">&lt;linux/jiffies.h&gt;</span></span><br> <br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> i,j,k<br>j = jiffies;<br>i = j + HZ;<br>k = j + HZ*<span class="hljs-number">1000</span>;<br>``<br><br>```c<br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __ASM_GENERIC_PARAM_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __ASM_GENERIC_PARAM_H</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;uapi/asm-generic/param.h&gt;</span></span><br><br><span class="hljs-meta"># <span class="hljs-meta-keyword">undef</span> HZ</span><br><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> HZ		CONFIG_HZ	<span class="hljs-comment">/* Internal kernel timer frequency */</span></span><br><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> USER_HZ	100		<span class="hljs-comment">/* some user interfaces are */</span></span><br><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> CLOCKS_PER_SEC	(USER_HZ)       <span class="hljs-comment">/* in &quot;ticks&quot; like times() */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* __ASM_GENERIC_PARAM_H */</span></span><br></code></pre></td></tr></table></figure>

<h3 id="Prevent-the-data-be-deleted"><a href="#Prevent-the-data-be-deleted" class="headerlink" title="Prevent the data be deleted"></a>Prevent the data be deleted</h3><p>If you files system support attr</p>
<ul>
<li>: Adds the attribute to the existing attribute of the files.<br>– : Removes the attribute to the existing attribute of the files.<br>= : Keep the existing attributes that the files have.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ chattr +i -R demo<br>$ rm -rf demo/<br>rm: cannot remove ‘demo/0’: Permission denied<br>rm: cannot remove ‘demo/1’: Permission denied<br>rm: cannot remove ‘demo/2’: Permission denied<br>rm: cannot remove ‘demo/3’: Permission denied<br>rm: cannot remove ‘demo/4’: Permission denied<br>rm: cannot remove ‘demo/5’: Permission denied<br>rm: cannot remove ‘demo/6’: Permission denied<br>rm: cannot remove ‘demo/7’: Permission denied<br>rm: cannot remove ‘demo/8’: Permission denied<br>rm: cannot remove ‘demo/9’: Permission denied<br><br>$ lsattr demo/<br>----i----------- demo/0<br>----i----------- demo/1<br>----i----------- demo/2<br>----i----------- demo/3<br>----i----------- demo/4<br>----i----------- demo/5<br>----i----------- demo/6<br>----i----------- demo/7<br>----i----------- demo/8<br>----i----------- demo/9<br>$ chattr -i -R demo/<br>$ rm -f demo/*<br><br><span class="hljs-comment">### could be append</span><br>$ chattr -R +a demo/<br>$ <span class="hljs-built_in">cd</span> demo/<br>$ ls<br>0  1  2  3  4  5  6  7  8  9<br>$ cat 0<br>0<br>$ <span class="hljs-built_in">echo</span> 0 &gt; 0<br>-bash: 0: Operation not permitted<br>$ <span class="hljs-built_in">echo</span> 0 &gt;&gt; 0<br>$ cat 0<br>0<br>0<br>$ lsattr 0<br>-----a---------- 0<br>$ rm -f 0<br>rm: cannot remove ‘0’: Operation not permitted<br><br>$ chattr -R -a demo<br>$ rm -f demo/*<br></code></pre></td></tr></table></figure>

<h3 id="errno"><a href="#errno" class="headerlink" title="errno"></a>errno</h3><p><a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/include/uapi/asm-generic/errno.h">https://github.com/torvalds/linux/blob/master/include/uapi/asm-generic/errno.h</a><br>$ man 3 erron</p>
<h3 id="tc"><a href="#tc" class="headerlink" title="tc"></a><a target="_blank" rel="noopener" href="https://colobu.com/2017/04/21/tc-introduction/">tc</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## fixed delay</span><br>$ tc qdisc add dev eth0 root netem delay 100ms<br><br><span class="hljs-comment">## fixed delay range 100ms ± 10ms</span><br>$ tc qdisc change dev eth0 root netem delay 100ms 10ms<br><br><span class="hljs-comment">## This causes the added delay to be 100ms ± 10ms with the next random element depending 25% on the last one. This isn&#x27;t true statistical correlation, but an approximation.</span><br>$ tc qdisc change dev eth0 root netem delay 100ms 10ms 25%<br><br><span class="hljs-comment">## 0.1% package loss</span><br>$ tc qdisc change dev eth0 root netem loss 0.1%<br><br>$ tc qdisc change dev eth0 root netem loss 0.3% 25%<br><br><span class="hljs-comment">## 1% duplicate package</span><br>$ tc qdisc change dev eth0 root netem duplicate 1%<br><br><span class="hljs-comment">## 0.1% randomly modify single bit</span><br>$ tc qdisc change dev eth0 root netem corrupt 0.1%<br><br><span class="hljs-comment">## out of order, 5,10,15,20,25... package send right now, the others delay 10ms, it &#x27;s fixed, not random</span><br>$ tc qdisc change dev eth0 root netem gap 5 delay 10ms<br><br><span class="hljs-comment">## out of order randomly, 25% will be transmit, the others will be delay 10ms, next and previos has the 50% relevance ??</span><br>$ tc qdisc change dev eth0 root netem delay 10ms reorder 25% 50%<br><br><span class="hljs-comment">## delay time range at 100ms ± 75ms, it could cause the package out of order</span><br>$ tc qdisc change dev eth0 root netem delay 100ms 75ms<br><br><span class="hljs-comment">## flow control </span><br>$ tc qdisc add dev eth0 root handle 1:0 netem delay 100ms<br>$ tc qdisc add dev eth0 parent 1:1 handle 10: tbf rate 256kbit buffer 1600 <span class="hljs-built_in">limit</span> 3000<br>$ tc -s qdisc ls dev eth0<br></code></pre></td></tr></table></figure>

<h3 id="VNC"><a href="#VNC" class="headerlink" title="VNC"></a>VNC</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum groupinstall -y <span class="hljs-string">&quot;GNOME Desktop&quot;</span><br><br><span class="hljs-comment">#if there is no another data in this file</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;exec gnome-session&quot;</span> &gt; ~/.xinitrc<br><br>systemctl is-enabled vncserver@.service<br>systemctl <span class="hljs-built_in">enable</span> vncserver@.service<br><br>systemctl get-default<br>systemctl set-default multi-user.target<br><br>cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:4.service<br>vi /etc/systemd/system/vncserver@:4.service <span class="hljs-comment">## replace root user to normal user</span><br>ExecStart=/usr/sbin/runuser -l root -c <span class="hljs-string">&quot;/usr/bin/vncserver %i&quot;</span><br>PIDFile=/root/.vnc/%H%i.pid<br><br>WantedBy=multi-user.target<br><br>ln -s <span class="hljs-string">&#x27;/etc/systemd/system/vncserver@:4.service&#x27;</span> <span class="hljs-string">&#x27;/etc/systemd/system/multi-user.target.wants/vncserver@:4.service&#x27;</span><br>systemctl <span class="hljs-built_in">enable</span> vncserver@:4.service<br>systemctl start vncserver@:4.service<br></code></pre></td></tr></table></figure>

<h3 id="Vncserer-was-runing-but-there-is-no-desktop-in-centos-7"><a href="#Vncserer-was-runing-but-there-is-no-desktop-in-centos-7" class="headerlink" title="Vncserer was runing, but there is no desktop in centos 7"></a>Vncserer was runing, but there is no desktop in centos 7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ yum groupinstall Xfce<br>$ yum install xorg-x11-twm xterm xorg-x11-xinit <br>$ chmod  755 ~/.vnc/xstartup<br>$ cat ~/.vnc/xstartup<br><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-built_in">unset</span> SESSION_MANAGER<br><span class="hljs-built_in">unset</span> DBUS_SESSION_BUS_ADDRESS<br><span class="hljs-built_in">exec</span> startxfce4<br></code></pre></td></tr></table></figure>

<h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p>copy mode<br>ctrl + A + esc, press space, scroll up and select the text you want<br>ctrl + A + c, create a new session, and use vim open a file, press i go to insert mode, and press ctrl + a + ], it will copy all text to vim.</p>
<h3 id="VLC"><a href="#VLC" class="headerlink" title="VLC"></a>VLC</h3><h4 id="Not-show-media-title"><a href="#Not-show-media-title" class="headerlink" title="Not show media title"></a>Not show media title</h4><p><a target="_blank" rel="noopener" href="https://forum.videolan.org/viewtopic.php?t=50202">Same question</a><br>Tools–&gt;Preferences–&gt;Subtitles / OSD–&gt; Show media title on media start (disable it)<br>Tools–&gt;Preferences–&gt;Subtitles / OSD–&gt; Enable on screen display (disable it)</p>
<h4 id="Not-resize-interface"><a href="#Not-resize-interface" class="headerlink" title="Not resize interface"></a>Not resize interface</h4><p><img src="/img/vlc-set1.png"></p>
<h3 id="grub"><a href="#grub" class="headerlink" title="grub"></a>grub</h3><p>CentOS 7 add kernel parameter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">grubby --remove-args=<span class="hljs-string">&quot;argX argY&quot;</span> --args=<span class="hljs-string">&quot;argA argB&quot;</span> --update-kernel /boot/kernel<br>grubby --update-kernel=ALL --args=<span class="hljs-string">&#x27;scsi_mod.use_blk_mq=y dm_mod.use_blk_mq=y&#x27;</span><br><br><span class="hljs-comment">## set boot order</span><br>grubby --default-kernel<br>grubby --default-index<br>grubby --set-default /boot/vmlinuz-4.2.0-1.fc23.x86_64<br>grubby --info=ALL<br>grubby --info /boot/vmlinuz-4.2.0-1.fc23.x86_64<br></code></pre></td></tr></table></figure>

<p>set default boot</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">grubby --info=ALL<br>index=0<br>kernel=/boot/vmlinuz-3.10.0-514.6.1.el7.x86_64<br>args=<span class="hljs-string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span><br>root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33<br>initrd=/boot/initramfs-3.10.0-514.6.1.el7.x86_64.img<br>title=CentOS Linux (3.10.0-514.6.1.el7.x86_64) 7 (Core)<br>index=1<br>kernel=/boot/vmlinuz-3.10.0-327.el7.x86_64<br>args=<span class="hljs-string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span><br>root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33<br>initrd=/boot/initramfs-3.10.0-327.el7.x86_64.img<br>title=CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)<br>index=2<br>kernel=/boot/vmlinuz-0-rescue-f614a3c482eb4b21add5ae750b3871bb<br>args=<span class="hljs-string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span><br>root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33<br>initrd=/boot/initramfs-0-rescue-f614a3c482eb4b21add5ae750b3871bb.img<br>title=CentOS Linux (0-rescue-f614a3c482eb4b21add5ae750b3871bb) 7 (Core)<br>index=3<br>non linux entry<br><br>grubby --set-default /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64<br>grubby --info /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64<br></code></pre></td></tr></table></figure>

<h3 id="set-debug-parameters"><a href="#set-debug-parameters" class="headerlink" title="set debug parameters"></a>set debug parameters</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grubby --update-kernel=ALL --args=<span class="hljs-string">&#x27;rd.debug rdudevdebug systemd.log_level=debug systemd.log_target=console console=ttyS1,115200n8&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h3><h4 id="nolock"><a href="#nolock" class="headerlink" title="nolock"></a><a target="_blank" rel="noopener" href="https://linux.die.net/man/5/nfs">nolock</a></h4><p>NLM locking is used for this mount point. When using the nolock option, applications can lock files, but such locks provide exclusion only against other applications running on the same client. Remote applications are not affected by these locks.</p>
<h4 id="file-lock"><a href="#file-lock" class="headerlink" title="file lock"></a><a target="_blank" rel="noopener" href="https://docstore.mik.ua/orelly/networking_2ndEd/nfs/ch11_02.htm">file lock</a></h4><p>The NFS (Versions 2 and 3) protocol does not support file locking, but the NFS environment supports an ancillary protocol called NLM, which originally stood for “Network Lock Manager.” When an NFS filesystem on an NFS client gets a request to lock a file, instead of an NFS remote procedure call, it generates an NLM remote procedure call.</p>
<p>The NLM protocol consists of remote procedure calls that pattern fcntl arguments and results. Because blocking locks are supported (a process blocks waiting for a lock that conflicts with another holder), the NLM protocol has the notion of callbacks, from the file server to the NLM client to notify that a lock is available. In this way, the NLM client sometimes acts as an RPC server in order to receive delayed results from lock calls.</p>
<h3 id="How-could-I-found-which-file-cause-pipe-hang"><a href="#How-could-I-found-which-file-cause-pipe-hang" class="headerlink" title="How could I found which file cause pipe hang"></a>How could I found which file cause pipe hang</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ cat /dev/zero | tee /tank/the_file<br>$ ps aux | grep 63488<br>root      63488  5.2  0.0 107972   676 pts/9    S+   04:32   0:19 cat /dev/zero<br><br>$ strace -p 63488<br><span class="hljs-built_in">read</span>(3, <span class="hljs-string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536) = 65536<br>write(1, <span class="hljs-string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536) = 65536<br><span class="hljs-built_in">read</span>(3, <span class="hljs-string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536) = 65536<br>write(1, <span class="hljs-string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536<br>strace: Process 63488 detached<br><br>$ ls -l /proc/63488/fd<br>total 0<br>lrwx------ 1 root root 64 Mar 21 04:33 0 -&gt; /dev/pts/9<br>l-wx------ 1 root root 64 Mar 21 04:33 1 -&gt; pipe:[36710085]<br>lrwx------ 1 root root 64 Mar 21 04:32 2 -&gt; /dev/pts/9<br>lr-x------ 1 root root 64 Mar 21 04:33 3 -&gt; /dev/zero<br>$ lsof | grep 36710085<br>cat        63488           root    1w     FIFO                0,9         0t0   36710085 pipe<br>tee        63489           root    0r     FIFO                0,9         0t0   36710085 pipe<br>$ ls -l /proc/63489/fd<br>total 0<br>lr-x------ 1 root root 64 Mar 21 04:33 0 -&gt; pipe:[36710085]<br>lrwx------ 1 root root 64 Mar 21 04:33 1 -&gt; /dev/pts/9<br>lrwx------ 1 root root 64 Mar 21 04:32 2 -&gt; /dev/pts/9<br>l-wx------ 1 root root 64 Mar 21 04:33 3 -&gt; /tank/the_file<br></code></pre></td></tr></table></figure>
<h4 id="If-pipe-change-to-socket"><a href="#If-pipe-change-to-socket" class="headerlink" title="If pipe change to socket"></a>If pipe change to socket</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ll /proc/333709/fd<br>total 0<br>lrwx------ 1 root root 64 Mar 20 03:24 0 -&gt; /dev/null<br>lrwx------ 1 root root 64 Mar 20 03:24 1 -&gt; /dev/null<br>lrwx------ 1 root root 64 Mar 20 03:24 10 -&gt; socket:[326105]<br>lrwx------ 1 root root 64 Mar 20 03:24 11 -&gt; socket:[326106]<br>lrwx------ 1 root root 64 Mar 20 03:24 2 -&gt; /dev/null<br>lrwx------ 1 root root 64 Mar 20 03:24 3 -&gt; socket:[304292]<br>lrwx------ 1 root root 64 Mar 20 03:24 4 -&gt; socket:[304294]<br>lrwx------ 1 root root 64 Mar 20 03:24 5 -&gt; socket:[304295]<br>lrwx------ 1 root root 64 Mar 20 03:24 6 -&gt; socket:[304296]<br>lrwx------ 1 root root 64 Mar 20 03:24 7 -&gt; socket:[304297]<br>lr-x------ 1 root root 64 Mar 20 03:24 8 -&gt; /run/rpcbind.lock<br>lrwx------ 1 root root 64 Mar 20 03:24 9 -&gt; socket:[334786]<br><br><span class="hljs-comment">#304294 is inode</span><br><br>$ cat /proc/net/tcp | grep -Ei <span class="hljs-string">&#x27;local_address|304294&#x27;</span><br>sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode<br>8: 00000000:006F 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 304294 1 ffff9ac0e2f8be00 100 0 0 10 0<br></code></pre></td></tr></table></figure>

<h3 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tcpdump -n -i eth0 -A -x dst port 443 and greater 100<br>$ tcpdump -i eth0 -nt -s 500 port 53 and udp<br></code></pre></td></tr></table></figure>

<h3 id="calculate-upload-download-speed-by-ping"><a href="#calculate-upload-download-speed-by-ping" class="headerlink" title="calculate upload/download speed by ping"></a><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/4575537/calculate-upload-download-speed-by-ping">calculate upload/download speed by ping</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ping -f -c 10000 -s 1472 10.100.100.100<br></code></pre></td></tr></table></figure>
<p>At the end of the result i get: round-trip min/avg/max/stddev = 0.174/0.219/2.078/0.020 ms<br>so in average it takes 0.219 ms to send 1500 bytes and receive 1500 bytes, that’s 24 kb. 24 kb / 0.219 ms = 110 Mb/s<br>If you want to use that to a server on the internet, you need to lower the packet size to something like 1464 (for MTU 1492), drop the -f option and lower the count so it won’t take too long to finish.</p>
<p>1500 TX Bytes + 1500 RX Bytes= 3000 Bytes = 3000 * 8 = 24000 bits<br>24000 / 0.219 = 109.589 Mb/s</p>
<p>It ‘s not represent full throughput. just test single link in your ethernet adapter. not parallel.</p>
<h3 id="MTU-problem-check"><a href="#MTU-problem-check" class="headerlink" title="MTU problem check"></a>MTU problem check</h3><p>Level 3 network, between 2 nodes pass through gateway<br>Tcpdump show some packets loss, nmap show 10.xx.xx.clent port is “open”.<br>There are some packages return, some will not. Does it MTU problem ? ping could check it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ traceroute 10.xx.xx.client<br>traceroute to 10.xx.xx.client (10.xx.xx.client), 30 hops max, 60 byte packets<br> 1  10.10.xx.gateway (10.10.xx.gateway)  2.239 ms  1.901 ms  2.080 ms<br> 2  10.xx.xx.client (10.xx.xx.client)  0.606 ms  0.584 ms  0.592 ms<br>$ traceroute 10.xx.xx.client<br>traceroute to 10.xx.xx.client (10.xx.xx.client), 30 hops max, 60 byte packets<br> 1  10.10.xx.gateway (10.10.xx.gateway)  1.881 ms  2.085 ms  2.245 ms<br> 2  10.xx.xx.client (10.xx.xx.client)  0.563 ms * *<br><br>$ ping -f -c 20000 -M <span class="hljs-keyword">do</span> -s 8972 10.xx.xx.client<br>PING 10.xx.xx.client (10.xx.xx.client) 8972(9000) bytes of data.<br>...................................................................^C<br>--- 10.xx.xx.client ping statistics ---<br>67 packets transmitted, 0 received, 100% packet loss, time 1076ms<br></code></pre></td></tr></table></figure>
<p>You can got the issue from tcpdump, all larger than 1500 packets are loss.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">client <span class="hljs-comment"># tcpdump -v host 10.53.19.52 and greater 1500</span><br>tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 65535 bytes<br>11:23:58.134708 IP (tos 0x0, ttl 63, id 27071, offset 0, flags [DF], proto TCP (6), length 8532)<br>    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], cksum 0x496d (incorrect -&gt; 0x5fe6), seq 2359537411:2359545891, ack 3804990367, win 53, options [nop,nop,TS val 1203816317 ecr 81802289], length 8480<br>11:23:58.136045 IP (tos 0x0, ttl 63, id 27077, offset 0, flags [DF], proto TCP (6), length 7292)<br>    10.53.19.52.988 &gt; test-57-21.exp2: Flags [.], cksum 0x4495 (incorrect -&gt; 0xe386), seq 8480:15720, ack 1, win 53, options [nop,nop,TS val 1203816318 ecr 81802294], length 7240<br>11:23:58.148023 IP (tos 0x0, ttl 63, id 27083, offset 0, flags [DF], proto TCP (6), length 8588)<br>    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], cksum 0x49a5 (incorrect -&gt; 0x4006), seq 17016:25552, ack 1, win 53, options [nop,nop,TS val 1203816330 ecr 81802295], length 8536<br></code></pre></td></tr></table></figure>
<p>If client MTU is 1500, tcpdump(client) will not receive any large packages. they are loss in switch.</p>
<h3 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h3><h4 id="Exclude-packages"><a href="#Exclude-packages" class="headerlink" title="Exclude packages"></a>Exclude packages</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ yum update --exclude=kernel*<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[main]<br>cachedir=/var/cache/yum/<span class="hljs-variable">$basearch</span>/<span class="hljs-variable">$releasever</span><br>keepcache=0<br>debuglevel=2<br>logfile=/var/<span class="hljs-built_in">log</span>/yum.log<br>exclude=kernel* redhat-release* *.i?86<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10185">reference</a></p>
<h4 id="Switch-version"><a href="#Switch-version" class="headerlink" title="Switch version"></a>Switch version</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ yum --showduplicates list kernel<br>Installed Packages<br>Installed Packages<br>kernel.x86_64       2.6.32-573.el6       @anaconda-CentOS-201508042137.x86_64/6.7<br>kernel.x86_64       2.6.32-573.8.1.el6   @update                                 <br>Available Packages<br>kernel.x86_64       2.6.32-573.el6       base                                    <br>kernel.x86_64       2.6.32-573.1.1.el6   update                                  <br>kernel.x86_64       2.6.32-573.3.1.el6   update                                  <br>kernel.x86_64       2.6.32-573.7.1.el6   update                                  <br>kernel.x86_64       2.6.32-573.8.1.el6   update                                  <br>kernel.x86_64       2.6.32-573.12.1.el6  update                                  <br>kernel.x86_64       2.6.32-573.18.1.el6  update  <br>``` <br><br><span class="hljs-comment">#### Yum.conf</span><br>```apacheconf<br>keepcache = 1<br></code></pre></td></tr></table></figure>

<h4 id="Download-to-local"><a href="#Download-to-local" class="headerlink" title="Download to local"></a>Download to local</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">$</span> <span class="hljs-string">yum</span> <span class="hljs-string">-y</span> <span class="hljs-string">install</span> <span class="hljs-string">yum-plugin-downloadonly</span><br><span class="hljs-string">$</span> <span class="hljs-string">yum</span> <span class="hljs-string">install</span> <span class="hljs-string">--downloadonly</span> <span class="hljs-string">--downloaddir=&lt;directory&gt;</span> <span class="hljs-string">&lt;package&gt;</span><br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10154">reference</a></p>
<h4 id="Resolve-dependency-resolution-errors"><a href="#Resolve-dependency-resolution-errors" class="headerlink" title="Resolve dependency resolution errors"></a>Resolve dependency resolution errors</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># yum update</span><br>** Found 5 pre-existing rpmdb problem(s), <span class="hljs-string">&#x27;yum check&#x27;</span> output follows:<br>MegaCli-8.04.10-1.noarch is a duplicate with MegaCli-8.04.07-1.noarch<br>kernel-2.6.32-279.5.1.el6_lustre.gb16fe80.x86_64 has missing requires of kernel-firmware &gt;= (<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2.6.32&#x27;</span>, <span class="hljs-string">&#x27;279.5.1.el6_lustre.gb16fe80&#x27;</span>)<br>kernel-firmware-2.6.32-279.5.1.el6.noarch is a duplicate with kernel-firmware-2.6.32-279.el6.noarch<br>kernel-headers-2.6.32-279.5.1.el6.x86_64 is a duplicate with kernel-headers-2.6.32-279.el6.x86_64<br>libcom_err-1.42.3.wc3-7.el6.x86_64 is a duplicate with libcom_err-1.41.12-12.el6.i686<br>......<br>You could try using --skip-broken to work around the problem<br>You could try running: rpm -Va --nofiles --nodigest<br></code></pre></td></tr></table></figure>

<h4 id="Uninstall-rpm-packages-from-rpmdb"><a href="#Uninstall-rpm-packages-from-rpmdb" class="headerlink" title="Uninstall rpm packages from rpmdb"></a>Uninstall rpm packages from rpmdb</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rpm -e --justdb --nodeps <span class="hljs-string">&quot;bad rpm packages&quot;</span><br>$ rpm -ivh --force <span class="hljs-string">&quot;replace normal rpm packages&quot;</span><br><br><span class="hljs-comment"># rebuild rpmdb</span><br>$ <span class="hljs-built_in">cd</span> /var/lib/rpm<br>$ rm  -f __db*<br>$ rpm --rebuilddb <br><br>$ yum clean all<br>$ yum -y update<br></code></pre></td></tr></table></figure>

<h3 id="upgrade-kernel"><a href="#upgrade-kernel" class="headerlink" title="upgrade kernel"></a>upgrade kernel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget https://sourceware.org/elfutils/ftp/0.170/elfutils-0.170.tar.bz2<br>$ tar xjvf elfutils-0.170.tar.bz2<br>$ <span class="hljs-built_in">cd</span> ./elfutils-0.170<br>$ ./configire; make -j 8; make install<br>$ <span class="hljs-built_in">export</span> C_INCLUDE_PATH=/sources/kernel/elfutils-0.170/libelf:/sources/lib/el7/mpich-3.2.1/include/:<span class="hljs-variable">$C_INCLUDE_PATH</span><br>$ cp -v /boot/config-3.10.0-693.21.1.el7.x86_64 .config<br>make menuconfig<br>make rpm-pkg<br><span class="hljs-comment">### enable what your want</span><br></code></pre></td></tr></table></figure>

<h4 id="BBR"><a href="#BBR" class="headerlink" title="BBR"></a>BBR</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;net.core.default_qdisc=fq&#x27;</span> | sudo tee -a /etc/sysctl.conf<br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;net.ipv4.tcp_congestion_control=bbr&#x27;</span> | sudo tee -a /etc/sysctl.conf<br>sudo sysctl -p<br><br>$ sysctl net.ipv4.tcp_available_congestion_control<br>net.ipv4.tcp_available_congestion_control = cubic bbr reno<br><br>$ sysctl -n net.ipv4.tcp_congestion_control<br>bbr<br></code></pre></td></tr></table></figure>

<h3 id="reinstall-grub2-from-boot-livecd"><a href="#reinstall-grub2-from-boot-livecd" class="headerlink" title="reinstall grub2 from boot livecd"></a>reinstall grub2 from boot livecd</h3><p>/dev/sdd2 is my linux root partition, OS is pinguyos(ubuntu)</p>
<h4 id="LVM-partition"><a href="#LVM-partition" class="headerlink" title="LVM partition"></a>LVM partition</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ vgscan<br>$ lvscan<br>$ lvchange -a y /dev/centos_vg/lv_root<br></code></pre></td></tr></table></figure>

<h4 id="Test-in-ubuntu"><a href="#Test-in-ubuntu" class="headerlink" title="Test in ubuntu"></a>Test in ubuntu</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/sdd2 /opt<br>mount --<span class="hljs-built_in">bind</span> /dev/ /opt/dev<br>mount --<span class="hljs-built_in">bind</span> /sys/ /opt/sys<br>mount --<span class="hljs-built_in">bind</span> /proc /opt/proc<br>chroot /opt<br>grub-install /dev/sdd<br>grub-install --root-directory=/mnt/sysimages/boot/efi /dev/sdd<br>grub-mkconfig -o /boot/grub/grub.cfg<br></code></pre></td></tr></table></figure>

<h4 id="Test-in-CentOS-7-set-boot-menu"><a href="#Test-in-CentOS-7-set-boot-menu" class="headerlink" title="Test in CentOS 7, set boot menu"></a>Test in CentOS 7, set boot menu</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat   /boot/grub2/grub.cfg | grep Windows<br>menuentry <span class="hljs-string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span><br>grub2-set-default  <span class="hljs-string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span><br>grub2-editenv list<br>saved_entry=Windows 7 (loader) (on /dev/sda1)<br>or <br>grub2-set-default <span class="hljs-string">&quot;windows&quot;</span><br><br>grub2-mkconfig -o /boot/grub2/grub.conf<br></code></pre></td></tr></table></figure>

<h4 id="Re-install-EFI"><a href="#Re-install-EFI" class="headerlink" title="Re-install EFI"></a>Re-install EFI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ mkdir -p /opt/boot /opt/root<br>$ mount /dev/sda1 /opt/root<br>$ mount /dev/sda2 /opt/root/boot/efi<br><br>$ mount --<span class="hljs-built_in">bind</span> /dev/ /opt/dev<br>$ mount --<span class="hljs-built_in">bind</span> /sys/ /opt/sys<br>$ mount --<span class="hljs-built_in">bind</span> /proc /opt/proc<br><br>$ chroot /opt<br><br>$ grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg<br>$ yum install grub2-efi<br>$ efibootmgr -c --disk /dev/sda --part 2 -l <span class="hljs-string">&#x27;\EFI\centos\shimx64.efi&#x27;</span> -L <span class="hljs-string">&quot;CentOS Linux&quot;</span>    <br>// --part 2 point EFI partition number,-l \\EFI\\FEDORA\\GRUBX64.EFI point the GRUB EFI boot loader<br></code></pre></td></tr></table></figure>

<h3 id="rdesktop-to-win10"><a href="#rdesktop-to-win10" class="headerlink" title="rdesktop to win10"></a>rdesktop to win10</h3><h4 id="Enable-remote-desktop"><a href="#Enable-remote-desktop" class="headerlink" title="Enable remote desktop"></a>Enable remote desktop</h4><p><img src="/img/e_desktop.png"><br><img src="/img/e_firewall.png"></p>
<h4 id="Modify-registry-from-win10"><a href="#Modify-registry-from-win10" class="headerlink" title="Modify registry from win10"></a>Modify registry from win10</h4><p>\HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\SecurityLayer<br>from DWORD Hex ‘2’ to a value of ‘1’</p>
<p><a target="_blank" rel="noopener" href="http://ubuntuforums.org/showthread.php?t=2287213">reference</a></p>
<h3 id="record-and-replay-linux-terminal"><a href="#record-and-replay-linux-terminal" class="headerlink" title="record and replay linux terminal"></a>record and replay linux terminal</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ script --timing=time.txt script.log<br><span class="hljs-comment"># record what you do</span><br>$ <span class="hljs-built_in">exit</span><br>$ scriptreplay --timing=time.txt script.log<br><span class="hljs-comment"># replay</span><br></code></pre></td></tr></table></figure>

<h3 id="traceroute-error"><a href="#traceroute-error" class="headerlink" title="traceroute error"></a><a target="_blank" rel="noopener" href="https://www.ibm.com/support/knowledgecenter/TI0003M/p8hcg/p8hcg_traceroute.htm">traceroute error</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">!H<br>Host unreachable<br>!N<br>Network unreachable<br>!P<br>Protocol unreachable<br>!S<br>Source route failed<br>!F<br>Fragmentation needed<br></code></pre></td></tr></table></figure>

<h3 id="Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><a href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable" class="headerlink" title="Getting Error su: cannot set user id: Resource temporarily unavailable"></a>Getting Error su: cannot set user id: Resource temporarily unavailable</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ ulimit -u <br><span class="hljs-number">1024</span><br><br>$ ulimit -u <span class="hljs-number">10240</span><br><br>$ <span class="hljs-regexp">/etc/</span>security/limits.conf<br>testuser         -      nproc          <span class="hljs-number">10240</span><br><br>$ cat <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/kernel/</span>threads-max<br><span class="hljs-number">1026188</span><br></code></pre></td></tr></table></figure>

<h3 id="lshw"><a href="#lshw" class="headerlink" title="lshw"></a>lshw</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ lshw -c network -businfo<br>Bus info          Device      Class          Description<br>========================================================<br>pci@0000:04:00.0  em1         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe<br>pci@0000:04:00.1  em2         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe<br>pci@0000:65:00.0  p2p1        network        Ethernet 10G 2P X520 Adapter<br>pci@0000:65:00.1  p2p2        network        Ethernet 10G 2P X520 Adapter<br>                  bond0       network        Ethernet interface<br></code></pre></td></tr></table></figure>

<h3 id="CentOS8"><a href="#CentOS8" class="headerlink" title="CentOS8"></a>CentOS8</h3><h4 id="bonding"><a href="#bonding" class="headerlink" title="bonding"></a>bonding</h4><p>Because my ansible was generate the config file in network-scripts, but restart NetworkManger centos 8 not work.<br>I got the compatible mode.</p>
<p>Load the config same with centos 7, after loading, it will work in centos 8<br>Please don’t add “NM_CONTROLLED=no”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-bond0<br>$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f0<br>$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f1<br>$ nmcli connection reload<br></code></pre></td></tr></table></figure>

<h3 id="fio-test-multiple-nodes"><a href="#fio-test-multiple-nodes" class="headerlink" title="fio test multiple nodes"></a>fio test multiple nodes</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ fio --server<br><span class="hljs-comment">## start fio process in each test server</span><br><br>$ cat fio-test<br>Server-A-ip<br>Server-B-ip<br>Server-C-ip<br>...<br><br>$ fio --client=fio_hosts.list /mnt/fio.cfg<br><br>All clients: (groupid=0, <span class="hljs-built_in">jobs</span>=8): err= 0: pid=0: Fri Mar  6 17:08:04 2020<br>   <span class="hljs-built_in">read</span>: IOPS=1147, BW=1148Mi (1203M)(1011GiB/902172msec)<br>    slat (nsec): min=58, max=368519, avg=450.92, stdev=799.19<br>    clat (usec): min=1355, max=4778.4k, avg=58198.62, stdev=114448.04<br>     lat (usec): min=1356, max=4778.4k, avg=58199.07, stdev=114448.07<br>   bw (  KiB/s): min= 2043, max=2654208, per=12.74%, avg=149910.02, stdev=178032.72, samples=14109<br>   iops        : min=    1, max= 2592, avg=146.33, stdev=173.87, samples=14109<br>  write: IOPS=1146, BW=1146Mi (1202M)(1010GiB/902172msec)<br>    slat (nsec): min=162, max=916488, avg=799.05, stdev=783.74<br>    clat (usec): min=1345, max=3839.9k, avg=52775.15, stdev=105530.38<br>     lat (usec): min=1346, max=3839.9k, avg=52775.95, stdev=105530.41<br></code></pre></td></tr></table></figure>

<h3 id="Permission"><a href="#Permission" class="headerlink" title="Permission"></a>Permission</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">SUID (Set owner User ID up on execution)<br>chmod 4555/u+s /<span class="hljs-built_in">test</span><br><br>ls -l /usr/bin/passwd  /etc/shadow<br>----------  1 root root  1005 Feb 14 14:15 /etc/shadow<br>-rwsr-xr-x. 1 root root 27856 Aug  9  2019 /usr/bin/passwd<br><br>SUID is defined as giving temporary permissions to a user to run a program/file with the permissions of the file owner rather that the user who runs it<br><br>SGID<br>chmod 2555/g+s /dir <br>similar with SUID, it <span class="hljs-string">&#x27;s the group bit</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sticky Bit</span><br><span class="hljs-string">chmod 1777/chmod +t /tmp</span><br><span class="hljs-string"></span><br><span class="hljs-string">- T refers to when the execute permissions are off.</span><br><span class="hljs-string">- t refers to when the execute permissions are on.</span><br><span class="hljs-string"></span><br><span class="hljs-string">The sticky bit is primarily used on shared directories. </span><br><span class="hljs-string">[For example if user bob creates a file named /tmp/bob, other user tom can not delete this file even when the /tmp directory has permission of 777. If sticky bit is not set then tom can delete /tmp/bob, as the /tmp/bob file inherits the parent directory permissions.](https://www.thegeekdiary.com/what-is-suid-sgid-and-sticky-bit/)</span><br><span class="hljs-string"></span><br><span class="hljs-string">### set time</span><br><span class="hljs-string">#### back access time</span><br><span class="hljs-string">```bash</span><br><span class="hljs-string">$ atime=$(stat -c%X $filename)</span><br><span class="hljs-string">$ touch -a --date=@$&#123;atime&#125; $newpath</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ mtime=$(stat -c%Z $filename)</span><br><span class="hljs-string">$ touch -m --date=@$&#123;mtime&#125; $newpath</span><br></code></pre></td></tr></table></figure>

<h3 id="screen-1"><a href="#screen-1" class="headerlink" title="screen"></a>screen</h3><p>background run command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;screen -dmS collectl su -s /bin/bash nobody -c &quot;</span>\<span class="hljs-string">&#x27;&quot;collectl --export graphite,$ip,d=2 -i60 -s CMDN --netfilt &quot;\&quot;&quot;eth|en|p[0-9]|em&quot;\&quot;&quot; --dskfilt &quot;\&quot;&quot;nvme|sd&quot;\&quot;\&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="Add-systemd-service"><a href="#Add-systemd-service" class="headerlink" title="Add systemd service"></a>Add systemd service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/systemd/system/apm.service<br>[Unit]<br>Description=Local system resume actions<br>After=suspend.target hybrid-sleep.target hibernate.target<br><br>[Service]<br>Type=simple<br>ExecStart=/usr/bin/hdparm -B 254 /dev/sda<br><br>[Install]<br>WantedBy=sleep.target<br></code></pre></td></tr></table></figure>

<h3 id="route-config"><a href="#route-config" class="headerlink" title="route config"></a>route config</h3><h4 id="static-route"><a href="#static-route" class="headerlink" title="static route"></a>static route</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">subnet mask could be<br>01011000  255.255.255.88<br><br>just recommend against using noncontiguous subnet masks.<br><br>cat /etc/sysconfig/network-scripts/route-em1<br>ADDRESS0=10.64.0.0<br>NETMASK0=255.240.0.0<br>GATEWAY0=192.168<br>ADDRESS1=10.200.0.0<br>NETMASK1=255.252.0.0<br>GATEWAY1=10.64.64.247<br>ADDRESS2=10.236.0.0<br>NETMASK2=255.255.0.0<br>GATEWAY2=10.64.64.247<br></code></pre></td></tr></table></figure>

<h3 id="Check-NIC-driver-err"><a href="#Check-NIC-driver-err" class="headerlink" title="Check NIC driver err"></a>Check NIC driver err</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ethtool -S enp129s0f0 | grep -Ei <span class="hljs-string">&#x27;fail|crc|dis|drop|miss|err|over|timeout|jabb&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="collectl"><a href="#collectl" class="headerlink" title="collectl"></a>collectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ collectl --top iokb<br>$ collectl --vmstat<br>$ collectl -sZ<br>$ collectl -c10 -f /opt<br>$ collectl -m -p /var/<span class="hljs-built_in">log</span>/collectl/2daygeek-20170105-150152.raw.gz -oT<br>$ collectl -m -p /var/<span class="hljs-built_in">log</span>/collectl/2daygeek-20170105-150152.raw.gz -oT --from 15:02:00 --thru 15:02:05<br>$ collectl --showoptions<br>$ collectl --showsubsys<br>$ collectl --showsubopts<br>$ collectl --showtopopts<br></code></pre></td></tr></table></figure>

<h3 id="process-mointor"><a href="#process-mointor" class="headerlink" title="process mointor"></a>process mointor</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">$ pstree -sg <span class="hljs-number">25153</span> # <span class="hljs-keyword">get</span> process tree<br>systemd(<span class="hljs-number">1</span>)───sshd(<span class="hljs-number">3266</span>)───sshd(<span class="hljs-number">32704</span>)───hydra_pmi_proxy(<span class="hljs-number">32706</span>)───test.sh(<span class="hljs-number">32725</span>)<br><br>$ pstree -sga <span class="hljs-number">32725</span><br>systemd,<span class="hljs-number">1</span> --switched-root --system --deserialize <span class="hljs-number">22</span><br>  └─sshd,<span class="hljs-number">3266</span> -D<br>      └─sshd,<span class="hljs-number">32704</span><br>          └─hydra_pmi_proxy,<span class="hljs-number">32706</span> --control-port centos7-test:<span class="hljs-number">38001</span> --rmk user --launcher ssh --demux poll --pgid <span class="hljs-number">0</span> --retries <span class="hljs-number">10</span>--u<br>              └─test.sh,<span class="hljs-number">32725</span> /root/test.sh /mnt<br><br>$ pidstat -drsuw<br>    * CPU utilization<br>    * IO<br>    * page faults <span class="hljs-keyword">and</span> memory utilization<br>    * stack utilization<br>    * task switching<br>$ collectl -i:<span class="hljs-number">1</span> -sZ --procopts wt --procfilt p$pid -oT<br>$ collectl -i:<span class="hljs-number">1</span> -sZ --procopts wt --procfilt u$uid -oT<br><br>$ iotop -b -n1 -o -P<br><br>$ atop -d -c -PPRD <span class="hljs-number">1</span> <span class="hljs-number">1</span>  | sort -nr -k <span class="hljs-number">13</span> -k <span class="hljs-number">15</span>  | head<br>                                                                           reads    read sec     writes write sec(<span class="hljs-number">512</span>B)<br>PRD kvm-manager-a23<span class="hljs-number">-1</span> <span class="hljs-number">1585239068</span> <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">27</span> <span class="hljs-number">00</span>:<span class="hljs-number">11</span>:<span class="hljs-number">08</span> <span class="hljs-number">4256</span> <span class="hljs-number">4006</span> (bash) S n y <span class="hljs-number">1758081744</span> <span class="hljs-number">1758081744</span> <span class="hljs-number">64</span>      <span class="hljs-number">64</span>              <span class="hljs-number">48</span> <span class="hljs-number">4006</span> n y<br>last line <span class="hljs-string">&#x27;y&#x27;</span> means <span class="hljs-keyword">not</span> thread<br><br>$ atop -d -c -PPRD <span class="hljs-number">1</span> <span class="hljs-number">1</span>  | awk <span class="hljs-string">&#x27;NF&gt;10 &#123;if($(NF-6)+$(NF-4)&gt;120000) &#123;if($NF==&quot;y&quot;) print $0&#125;&#125;&#x27;</span> <br># show the proc/thread read <span class="hljs-keyword">or</span> write &gt; <span class="hljs-number">60</span>MB<br></code></pre></td></tr></table></figure>

<h3 id="time"><a href="#time" class="headerlink" title="time"></a>time</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /usr/bin/time -f <span class="hljs-string">&quot;%E real,%U user,%S sys&quot;</span> sleep 2<br>0:02.00 real,0.00 user,0.00 sys<br><br>$ /usr/bin/time -f <span class="hljs-string">&quot;%e real&quot;</span> sleep 70<br>70.00 real<br></code></pre></td></tr></table></figure>

<h3 id="youtube-download"><a href="#youtube-download" class="headerlink" title="youtube download"></a>youtube download</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ proxychains4 youtube-dl -F https://www.youtube.com/watch?v=_xxxxxx<br>[info] Available formats <span class="hljs-keyword">for</span> _12OJxATpsA:<br>format code  extension  resolution note<br>249          webm       audio only tiny   62k , opus @ 50k (48000Hz), 51.86MiB<br>250          webm       audio only tiny   81k , opus @ 70k (48000Hz), 68.24MiB<br>140          m4a        audio only tiny  136k , m4a_dash container, mp4a.40.2@128k (44100Hz), 139.88MiB<br>251          webm       audio only tiny  158k , opus @160k (48000Hz), 136.13MiB<br>278          webm       256x144    144p  103k , webm container, vp9, 30fps, video only, 100.43MiB<br>160          mp4        256x144    144p  115k , avc1.4d400c, 30fps, video only, 83.46MiB<br>242          webm       426x240    240p  250k , vp9, 30fps, video only, 202.66MiB<br>133          mp4        426x240    240p  257k , avc1.4d4015, 30fps, video only, 168.64MiB<br>243          webm       640x360    360p  611k , vp9, 30fps, video only, 377.13MiB<br>134          mp4        640x360    360p  665k , avc1.4d401e, 30fps, video only, 442.58MiB<br>244          webm       854x480    480p 1052k , vp9, 30fps, video only, 677.08MiB<br>135          mp4        854x480    480p 1343k , avc1.4d401f, 30fps, video only, 868.67MiB<br>247          webm       1280x720   720p 2410k , vp9, 30fps, video only, 1.35GiB<br>136          mp4        1280x720   720p 2678k , avc1.4d401f, 30fps, video only, 1.66GiB<br>248          webm       1920x1080  1080p 4356k , vp9, 30fps, video only, 2.42GiB<br>137          mp4        1920x1080  1080p 4525k , avc1.640028, 30fps, video only, 3.06GiB<br>271          webm       2560x1440  1440p 9330k , vp9, 30fps, video only, 7.15GiB<br>18           mp4        640x360    360p  622k , avc1.42001E, mp4a.40.2@ 96k (44100Hz), 685.04MiB<br>22           mp4        1280x720   720p 1673k , avc1.64001F, mp4a.40.2@192k (44100Hz) (best)<br><br>$ proxychains4 youtube-dl -f 137+bestaudio --merge-output-format mkv https://www.youtube.com/watch?v=_xxxxxx<br></code></pre></td></tr></table></figure>

<h3 id="uptime-and-vmstat-running"><a href="#uptime-and-vmstat-running" class="headerlink" title="uptime and vmstat running"></a>uptime and vmstat running</h3><ul>
<li><p>(uptime) number of processes that are either in a runnable or uninterruptable state.</p>
<ul>
<li>runnable state is either using the CPU or waiting to use the  CPU. <ul>
<li>A process in uninterruptable state is waiting for some I/O access.</li>
</ul>
</li>
</ul>
</li>
<li><p>(vmstat) Procs r: The number of runnable processes (running or waiting for run time, no contains uninterruptable state)</p>
</li>
</ul>
<h3 id="kernel-do-IRQ-X-Y-No-irq-handler-for-vector-irq-1"><a href="#kernel-do-IRQ-X-Y-No-irq-handler-for-vector-irq-1" class="headerlink" title="kernel: do_IRQ: X.Y No irq handler for vector (irq -1)"></a>kernel: do_IRQ: X.Y No irq handler for vector (irq -1)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * do_IRQ handles all normal device IRQ&#x27;s (the special</span><br><span class="hljs-comment"> * SMP cross-CPU interrupts have their own specific</span><br><span class="hljs-comment"> * handlers).</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function">__visible <span class="hljs-keyword">void</span> __irq_entry <span class="hljs-title">do_IRQ</span><span class="hljs-params">(struct pt_regs *regs)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pt_regs</span> *<span class="hljs-title">old_regs</span> = <span class="hljs-title">set_irq_regs</span>(<span class="hljs-title">regs</span>);</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">irq_desc</span> * <span class="hljs-title">desc</span>;</span><br>	<span class="hljs-comment">/* high bit used in ret_from_ code  */</span><br>	<span class="hljs-keyword">unsigned</span> <span class="hljs-built_in">vector</span> = ~regs-&gt;orig_ax;<br><br>	entering_irq();<br><br>	<span class="hljs-comment">/* entering_irq() tells RCU that we&#x27;re not quiescent.  Check it. */</span><br>	RCU_LOCKDEP_WARN(!rcu_is_watching(), <span class="hljs-string">&quot;IRQ failed to wake up RCU&quot;</span>);<br><br>	desc = __this_cpu_read(vector_irq[<span class="hljs-built_in">vector</span>]);<br>	<span class="hljs-keyword">if</span> (likely(!IS_ERR_OR_NULL(desc))) &#123;<br>		<span class="hljs-keyword">if</span> (IS_ENABLED(CONFIG_X86_32))<br>			handle_irq(desc, regs);<br>		<span class="hljs-keyword">else</span><br>			generic_handle_irq_desc(desc);<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		ack_APIC_irq();<br><br>		<span class="hljs-keyword">if</span> (desc == VECTOR_UNUSED) &#123;<br>			pr_emerg_ratelimited(<span class="hljs-string">&quot;%s: %d.%d No irq handler for vector\n&quot;</span>,<br>					     __func__, smp_processor_id(),<br>					     <span class="hljs-built_in">vector</span>);<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			__this_cpu_write(vector_irq[<span class="hljs-built_in">vector</span>], VECTOR_UNUSED);<br>		&#125;<br>	&#125;<br><br>	exiting_irq();<br><br>	set_irq_regs(old_regs);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>system log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">[Tue Apr 28 09:09:19 2020] do_IRQ: 6.95 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 09:23:21 2020] do_IRQ: 2.163 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 09:38:13 2020] do_IRQ: 2.151 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 09:48:55 2020] do_IRQ: 0.155 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 09:49:25 2020] do_IRQ: 2.205 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 09:51:51 2020] do_IRQ: 4.123 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 09:53:05 2020] do_IRQ: 2.208 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 10:29:52 2020] do_IRQ: 6.180 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 10:41:23 2020] do_IRQ: 2.133 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 11:30:06 2020] do_IRQ: 6.191 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 11:39:22 2020] do_IRQ: 4.234 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 11:42:23 2020] do_IRQ: 0.137 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 11:46:53 2020] do_IRQ: 2.38 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 11:57:25 2020] do_IRQ: 6.98 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 12:35:11 2020] do_IRQ: 4.121 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 12:39:12 2020] do_IRQ: 2.163 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 13:05:26 2020] do_IRQ: 0.223 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 14:00:30 2020] do_IRQ: 6.91 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 14:08:06 2020] do_IRQ: 0.159 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br>[Tue Apr 28 14:26:09 2020] do_IRQ: 6.110 No irq handler <span class="hljs-keyword">for</span> vector (irq -1)<br><br>$ grep -wEi <span class="hljs-string">&#x27;95|98|38|91|121|163&#x27;</span> /proc/interrupts<br>  38:   98081083          0  142920345          0  123688922          0  172399026          0   PCI-MSI-edge      0000:00:11.4<br>  91:         34          0         11          0         23          0         18          0   PCI-MSI-edge      em4-fp-7<br><br>00:11.4 SATA controller: Intel Corporation C610/X99 series chipset sSATA Controller [AHCI mode] (rev 05)<br></code></pre></td></tr></table></figure>
<ul>
<li><p>Hardware issue # ipmi elist is ok</p>
</li>
<li><p>The hardware driver register num overflow</p>
</li>
<li><p>The hardware driver/firmware bug cause responds hobbledown</p>
</li>
<li><p>The bad APIC(programmable interrupt controller) got the wrong IRQ number</p>
<ul>
<li>disable APIC,  noapic pci=nomsi,noaer,acpi=off</li>
</ul>
</li>
</ul>
<h3 id="multipath-issue"><a href="#multipath-issue" class="headerlink" title="multipath issue"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/2437991">multipath issue</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="hljs-built_in">limit</span>.<br>Jun 14 09:33:38 testhost kernel: device-mapper: multipath: Failing path 70:64.<br>Jun 14 09:33:38 testhost kernel: device-mapper: multipath: Failing path 71:80.<br>Jun 14 09:33:38 testhost multipathd: 70:64: mark as failed<br>Jun 14 09:33:38 testhost multipathd: nsd_crs_04: remaining active paths: 1<br>Jun 14 09:33:38 testhost multipathd: 71:80: mark as failed<br><br>$ cat /etc/udev/rules.d/99-custom.rules <span class="hljs-comment"># lfs must set to 16383</span><br>ACTION!=<span class="hljs-string">&quot;add|change&quot;</span>, GOTO=<span class="hljs-string">&quot;rule_end&quot;</span> ENV&#123;ID_VENDOR&#125;==<span class="hljs-string">&quot;NETAPP*&quot;</span>,  RUN+=<span class="hljs-string">&quot;/bin/sh -c &#x27;echo 16383 &gt; /sys%p/queue/max_sectors_kb&#x27;&quot;</span> LABEL=<span class="hljs-string">&quot;rule_end&quot;</span><br><br>or you could add <span class="hljs-string">&quot; max_sectors_kb          16383 &quot;</span> to multipath.conf<br><br><span class="hljs-comment">### add to initramfs</span><br>$ cp  -av  /boot/initramfs-$(uname -r).img  /boot/initramfs-$(uname -r).img.bak<br>dracut -f -v -i /etc/udev/rules.d/99-custom.rules /etc/udev/rules.d/99-custom.rules<br>or<br>dracut -f -v -i /etc/udev/rules.d/99-custom.rules /etc/multipath.conf<br></code></pre></td></tr></table></figure>

<h3 id="sshfs"><a href="#sshfs" class="headerlink" title="sshfs"></a>sshfs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sshfs testuser@<span class="hljs-variable">$&#123;server_ip&#125;</span>:/sshfs /Users/<span class="hljs-built_in">test</span>/Downloads -o noatime<br></code></pre></td></tr></table></figure>

<h3 id="scan-file-size"><a href="#scan-file-size" class="headerlink" title="scan file size"></a>scan file size</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ find /tank -<span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%p\t%Y\t%b\t%s\t%U\t%G\t%A@\n&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="System-err-for-monitor"><a href="#System-err-for-monitor" class="headerlink" title="System err for monitor"></a>System err for monitor</h3><p>scsi:<br>has been suspended<br>attempting host reset<br>mpt.*sas_cm.*Command Timeout<br>Medium.*Error<br>Unrecovered</p>
<p>kernel:<br>Got BUG: soft lockup<br>NMI watchdog.*BUG</p>
<p>mem:<br>page allocation failure<br>Err.*bit ECC</p>
<p>irq:<br>No irq handler for vector</p>
<p>nvme:<br>nvme nvme.*I/O.*timeout, aborting<br>reset controller<br>Device not ready; aborting reset<br>probe failure status</p>
<p>kernel:<br>INFO: task xxx:xxx blocked for more than 120 seconds.<br>kernel process or thread hang, could not be wake up at 120s<br>    hungtask<br>        hung_task_panic        0<br>        hung_task_check_count  32768<br>        hung_task_timeout_secs 120s<br>        hung_task_warnings     10x times</p>
<p>softlockup<br>NMI watchdog: BUG: soft lockup - CPU#0 stuck for 23s! [cat:153]<br>softlockup deadlock, check the kernel schdule is ok, if trigger the softlockup, the kernel could not be schduled.<br>When hrtimer wake up the kernel thread and update watchdog_touch_ts, if time now - watchdog_touch_ts &gt; timeout value, it will show this error, that mean schdule timeout.<br>/proc/sys/kernel/nmi_watchdog      hard lockup<br>/proc/sys/kernel/soft_watchdog     soft lockup<br>/proc/sys/kernel/watchdog          watchdog<br>/proc/sys/kernel/watchdog_cpumask  watchdog cpumaks，<br>/proc/sys/kernel/watchdog_thresh   watchdog timeoout</p>
<p>softlockup : the kernel loop in kernel mode without giving other tasks a chance to run, a kernel task won’t be unlock the CPU.<br>             A soft lockup is when a running task is executing kernel code and wont yield the CPU to allow other tasks to run.<br>             The default soft lockup threshold is 60 seconds for RHEL5/6 and 20 seconds on RHEL7.<br>hardlockup : the kernel loop in kernel mode without letting other interrupts have change to run, the interrupts aren’t being processes.<br>             A hard lockup is when a CPU has interrupts disabled for a long time, which might block important communication between processes or hardware.<br>             The default hard lockup threshold is 30 second on RHEL5/6 and 10 seconds on RHEL7.</p>
<p>In redhat <a target="_blank" rel="noopener" href="https://access.redhat.com/articles/1353303">doc</a><br>Each CPU has registered it’s own high resolution timer and both hard and soft lockup detection are closely connected with it.<br>This timer is fired approximately every [watchdog_thresh * 2 / 5]-seconds and does mainly three things:</p>
<ol>
<li><p>Wakes up a CPU specific watchdog task with the highest possible priority, in order to get scheduled as soon as possible. This task’s main job is to update a PER_CPU timestamp called watchdog_touch_ts.</p>
</li>
<li><p>Checks if watchdog_touch_ts + watchdog_thresh is smaller than current actual time. If yes, or in other words, if the watchdog task didn’t run for longer than watchdog_thresh, then a soft lockup is reported.</p>
</li>
<li><p>Increments a CPU specific interrupt counter called hrtimer_interrupts, denoting that an interrupt happened on the CPU.</p>
</li>
</ol>
<p>Detecting a hard lockup is a bit trickier, since the CPU is stuck and has disabled interrupts. In order to detect it, each CPU has registered a watchdog perf event, which ensures that the CPU hardware issues an NMI (non-maskable interrupt) every [hard lockup threshold]-seconds. Generally approximately 2-3 high resolution timer interrupts are supposed to happen in-between 2 of these NMIs.<br>The handler function of this NMI will check the hrtimer_interrupts counter and copy-save it’s current value. If it sees the same value as it has saved before, it reports a hard lockup, because it means that no interrupt happened during [hard lockup threshold]-seconds.</p>
<p>Usually a CPU lockup is caused by a task stuck in a loop. Sometimes it’s due to a code loop where the termination condition has not yet been met. For example it may be an unbounded list (ie while !list_empty()). In cases like this the code should limit the maximum iterations of the loop before voluntarily yielding the CPU (ie cond_resched()).</p>
<p>Often CPU lockups are caused by tasks trying to acquire a spinlock that for some reason cannot be acquired in a reasonable time. This could be due to current owner of the lock not relinquishing the lock or it may be a case of starvation where excessive activity on the lock delays some tasks long enough to exceed the watchdog threshold (ie RHEL5 spinlocks on numa).</p>
<p>Other cases involve a loop where the termination condition is never going to be met. For example the code expects a state change that isn’t going to happen.</p>
<p>It’s also possible to get false reports from the watchdog on virtual machines where the host system stalls the guest for longer than the watchdog threshold period. The watchdog will think the guest has been running during that time but the CPUs have not been able to make progress.</p>
<p>##default is enabled<br>$ sysctl kernel.softlockup_panic kernel.hardlockup_panic<br>kernel.softlockup_panic = 0<br>kernel.hardlockup_panic = 0</p>
<p>##disable, there is no soft lockup watchdog here<br>echo 1 &gt; /proc/sys/kernel/softlockup_panic</p>
<p><a target="_blank" rel="noopener" href="https://blog.seibert-media.com/2018/01/04/log-book-linux-cpu-lockups/#:~:text=A%20'hard%20lockup'%20is%20defined,the%20good%20old%20DOS%20days.">Provoke lockups with your own kernel module</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">hog.c</span><br><span class="hljs-comment">#include &lt;linux/init.h&gt;</span><br><span class="hljs-comment">#include &lt;linux/module.h&gt;</span><br><span class="hljs-comment">#include &lt;linux/kernel.h&gt;</span><br><span class="hljs-comment">#include &lt;linux/kthread.h&gt;</span><br> <br><span class="hljs-string">MODULE_LICENSE(&quot;GPL&quot;);</span><br> <br><span class="hljs-string">static</span> <span class="hljs-string">int</span><br><span class="hljs-string">hog_thread(void</span> <span class="hljs-string">*data)</span><br>&#123;<br>    <span class="hljs-string">printk(KERN_INFO</span> <span class="hljs-string">&quot;Hogging a CPU now\n&quot;</span><span class="hljs-string">);</span><br>    <span class="hljs-string">while</span> <span class="hljs-string">(1);</span><br> <br>    <span class="hljs-string">/*</span> <span class="hljs-string">unreached</span> <span class="hljs-string">*/</span><br>    <span class="hljs-string">return</span> <span class="hljs-number">0</span><span class="hljs-string">;</span><br>&#125;<br> <br><span class="hljs-string">static</span> <span class="hljs-string">int</span> <span class="hljs-string">__init</span><br><span class="hljs-string">hog_init(void)</span><br>&#123;<br>    <span class="hljs-string">kthread_run(hog_thread</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;hog&quot;</span><span class="hljs-string">);</span><br>    <span class="hljs-string">return</span> <span class="hljs-number">0</span><span class="hljs-string">;</span><br>&#125;<br> <br><span class="hljs-string">module_init(hog_init);</span><br><br><span class="hljs-comment">#makefile</span><br><span class="hljs-string">obj-m</span> <span class="hljs-string">+=</span> <span class="hljs-string">hog.o</span><br> <br><span class="hljs-attr">all:</span><br>    <span class="hljs-string">make</span> <span class="hljs-string">-C</span> <span class="hljs-string">/lib/modules/$(shell</span> <span class="hljs-string">uname</span> <span class="hljs-string">-r)/build/</span> <span class="hljs-string">M=$(PWD)</span> <span class="hljs-string">modules</span><br><span class="hljs-attr">clean:</span><br>    <span class="hljs-string">make</span> <span class="hljs-string">-C</span> <span class="hljs-string">/lib/modules/$(shell</span> <span class="hljs-string">uname</span> <span class="hljs-string">-r)/build/</span> <span class="hljs-string">M=$(PWD)</span> <span class="hljs-string">clean</span><br><br><span class="hljs-comment"># in centos </span><br><span class="hljs-string">$</span> <span class="hljs-string">cat</span> <span class="hljs-string">Makefile</span><br><span class="hljs-string">obj-m</span> <span class="hljs-string">+=</span> <span class="hljs-string">hog.o</span><br><br><span class="hljs-attr">all:</span> <span class="hljs-string">make</span> <span class="hljs-string">-C</span> <span class="hljs-string">/lib/modules/$(uname</span> <span class="hljs-string">-r)/build/</span> <span class="hljs-string">M=$(pwd)</span> <span class="hljs-string">modules</span><br><span class="hljs-attr">clean:</span> <span class="hljs-string">make</span> <span class="hljs-string">-C</span> <span class="hljs-string">/lib/modules/$(uname</span> <span class="hljs-string">-r)/build/</span> <span class="hljs-string">M=$(pwd)</span> <span class="hljs-string">clean</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">make</span> <span class="hljs-string">-C</span> <span class="hljs-string">/lib/modules/$(uname</span> <span class="hljs-string">-r)/build/</span> <span class="hljs-string">M=$(pwd)</span> <span class="hljs-string">modules</span><br><span class="hljs-attr">make:</span> <span class="hljs-string">Entering</span> <span class="hljs-string">directory</span> <span class="hljs-string">`/usr/src/kernels/3.10.0-1062.1.1.el7.x86_64&#x27;</span><br>  <span class="hljs-string">CC</span> [<span class="hljs-string">M</span>]  <span class="hljs-string">/root/hog/hog.o</span><br>  <span class="hljs-string">Building</span> <span class="hljs-string">modules,</span> <span class="hljs-string">stage</span> <span class="hljs-number">2</span><span class="hljs-string">.</span><br>  <span class="hljs-string">MODPOST</span> <span class="hljs-number">1</span> <span class="hljs-string">modules</span><br>  <span class="hljs-string">CC</span>      <span class="hljs-string">/root/hog/hog.mod.o</span><br>  <span class="hljs-string">LD</span> [<span class="hljs-string">M</span>]  <span class="hljs-string">/root/hog/hog.ko</span><br><span class="hljs-attr">make:</span> <span class="hljs-string">Leaving</span> <span class="hljs-string">directory</span> <span class="hljs-string">`/usr/src/kernels/3.10.0-1062.1.1.el7.x86_64&#x27;</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">ls</span> <br><span class="hljs-string">hog.c</span>  <span class="hljs-string">hog.ko</span>  <span class="hljs-string">hog.mod.c</span>  <span class="hljs-string">hog.mod.o</span>  <span class="hljs-string">hog.o</span>  <span class="hljs-string">Makefile</span>  <span class="hljs-string">modules.order</span>  <span class="hljs-string">Module.symvers</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">insmod</span> <span class="hljs-string">hog.ko</span><br><span class="hljs-string">$</span> <span class="hljs-string">lsmod</span> <span class="hljs-string">|</span> <span class="hljs-string">grep</span> <span class="hljs-string">hog</span><br><span class="hljs-string">hog</span>                    <span class="hljs-number">12386</span>  <span class="hljs-number">0</span><br><br> <span class="hljs-attr">kernel:NMI watchdog: BUG:</span> <span class="hljs-string">soft</span> <span class="hljs-string">lockup</span> <span class="hljs-bullet">-</span> <span class="hljs-string">CPU#0</span> <span class="hljs-string">stuck</span> <span class="hljs-string">for</span> <span class="hljs-string">23s!</span> [<span class="hljs-string">hog:2308</span>]<br><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">NMI watchdog: BUG:</span> <span class="hljs-string">soft</span> <span class="hljs-string">lockup</span> <span class="hljs-bullet">-</span> <span class="hljs-string">CPU#0</span> <span class="hljs-string">stuck</span> <span class="hljs-string">for</span> <span class="hljs-string">23s!</span> [<span class="hljs-string">hog:2308</span>]<br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">Modules linked in:</span> <span class="hljs-string">hog(OE)</span> <span class="hljs-string">dell_rbu</span> <span class="hljs-string">dcdbas</span> <span class="hljs-string">sunrpc</span> <span class="hljs-string">nfit</span> <span class="hljs-string">libnvdimm</span> <span class="hljs-string">zfs(POE)</span> <span class="hljs-string">zunicode(POE)</span> <span class="hljs-string">zavl(POE)</span> <span class="hljs-string">icp(POE)</span> <span class="hljs-string">ppdev</span> <span class="hljs-string">iosf_mbi</span> <span class="hljs-string">crc32_pclmul</span> <span class="hljs-string">ghash_clmulni_intel</span> <span class="hljs-string">joydev</span> <span class="hljs-string">zcommon(POE)</span> <span class="hljs-string">znvpair(POE)</span> <span class="hljs-string">spl(OE)</span> <span class="hljs-string">sg</span> <span class="hljs-string">aesni_intel</span> <span class="hljs-string">virtio_balloon</span> <span class="hljs-string">virtio_rng</span> <span class="hljs-string">lrw</span> <span class="hljs-string">gf128mul</span> <span class="hljs-string">glue_helper</span> <span class="hljs-string">ablk_helper</span> <span class="hljs-string">cryptd</span> <span class="hljs-string">pcspkr</span> <span class="hljs-string">i2c_piix4</span> <span class="hljs-string">parport_pc</span> <span class="hljs-string">parport</span> <span class="hljs-string">binfmt_misc</span> <span class="hljs-string">ip_tables</span> <span class="hljs-string">xfs</span> <span class="hljs-string">libcrc32c</span> <span class="hljs-string">sr_mod</span> <span class="hljs-string">sd_mod</span> <span class="hljs-string">cdrom</span> <span class="hljs-string">crc_t10dif</span> <span class="hljs-string">crct10dif_generic</span> <span class="hljs-string">ata_generic</span> <span class="hljs-string">pata_acpi</span> <span class="hljs-string">virtio_console</span> <span class="hljs-string">virtio_net</span> <span class="hljs-string">virtio_blk</span> <span class="hljs-string">virtio_scsi</span> <span class="hljs-string">qxl</span> <span class="hljs-string">drm_kms_helper</span> <span class="hljs-string">syscopyarea</span> <span class="hljs-string">sysfillrect</span> <span class="hljs-string">sysimgblt</span> <span class="hljs-string">fb_sys_fops</span> <span class="hljs-string">ttm</span> <span class="hljs-string">drm</span> <span class="hljs-string">crct10dif_pclmul</span> <span class="hljs-string">crct10dif_common</span> <span class="hljs-string">crc32c_intel</span> <span class="hljs-string">ata_piix</span> <span class="hljs-string">ahci</span> <span class="hljs-string">libahci</span> <span class="hljs-string">libata</span> <span class="hljs-string">serio_raw</span> <span class="hljs-string">virtio_pci</span> <span class="hljs-string">virtio_ring</span> <span class="hljs-string">virtio</span> <span class="hljs-string">floppy</span> <span class="hljs-string">drm_panel_orientation_quirks</span> <span class="hljs-string">dm_mirror</span> <span class="hljs-string">dm_region_hash</span> <span class="hljs-string">dm_log</span> <span class="hljs-string">dm_mod</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">CPU: 0 PID: 2308 Comm: hog Kdump: loaded Tainted:</span> <span class="hljs-string">P</span>           <span class="hljs-string">OE</span>  <span class="hljs-string">------------</span>   <span class="hljs-number">3.10</span><span class="hljs-number">.0</span><span class="hljs-number">-1062.1</span><span class="hljs-number">.1</span><span class="hljs-string">.el7.x86_64</span> <span class="hljs-comment">#1</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">Hardware name:</span> <span class="hljs-string">Red</span> <span class="hljs-string">Hat</span> <span class="hljs-string">KVM,</span> <span class="hljs-string">BIOS</span> <span class="hljs-number">1.11</span><span class="hljs-number">.1</span><span class="hljs-number">-4.</span><span class="hljs-string">module_el8.0.0+189+f9babebb</span> <span class="hljs-number">04</span><span class="hljs-string">/01/2014</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">task: ffff9c0335878000 ti: ffff9c03356a4000 task.ti:</span> <span class="hljs-string">ffff9c03356a4000</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">RIP:</span> <span class="hljs-number">0010</span><span class="hljs-string">:[&lt;ffffffffc0721017&gt;]</span>  [<span class="hljs-string">&lt;ffffffffc0721017&gt;</span>] <span class="hljs-string">hog_thread+0x17/0x1000</span> [<span class="hljs-string">hog</span>]<br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">RSP: 0018:ffff9c03356a7ec0  EFLAGS:</span> <span class="hljs-number">00000246</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">RAX: 0000000000000011 RBX: ffff9c03356a7e50 RCX:</span> <span class="hljs-number">0000000000000000</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">RDX: 0000000000000000 RSI: ffff9c033dc13898 RDI:</span> <span class="hljs-string">ffff9c033dc13898</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">RBP: ffff9c03356a7ec0 R08: 0000000000000000 R09:</span> <span class="hljs-number">0000000000000040</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">R10: 000000000000029a R11: 0000000000aaaaaa R12:</span> <span class="hljs-number">0000000000000000</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">R13: ffffffffc0721000 R14: 0000000000000000 R15:</span> <span class="hljs-string">ffff9c03352ebc90</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">FS:</span>  <span class="hljs-number">0000000000000000</span><span class="hljs-string">(0000)</span> <span class="hljs-string">GS:ffff9c033dc00000(0000)</span> <span class="hljs-string">knlGS:0000000000000000</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">CS:  0010 DS: 0000 ES: 0000 CR0:</span> <span class="hljs-number">0000000080050033</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">CR2: 0000561560589e20 CR3: 0000000006010000 CR4:</span> <span class="hljs-string">00000000003606f0</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">DR0: 0000000000000000 DR1: 0000000000000000 DR2:</span> <span class="hljs-number">0000000000000000</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7:</span> <span class="hljs-number">0000000000000400</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">Call Trace:</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>]  [<span class="hljs-string">&lt;ffffffffa08c50d1&gt;</span>] <span class="hljs-string">kthread+0xd1/0xe0</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>]  [<span class="hljs-string">&lt;ffffffffa08c5000&gt;</span>] <span class="hljs-string">?</span> <span class="hljs-string">insert_kthread_work+0x40/0x40</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>]  [<span class="hljs-string">&lt;ffffffffa0f8cd37&gt;</span>] <span class="hljs-string">ret_from_fork_nospec_begin+0x21/0x21</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>]  [<span class="hljs-string">&lt;ffffffffa08c5000&gt;</span>] <span class="hljs-string">?</span> <span class="hljs-string">insert_kthread_work+0x40/0x40</span><br>[<span class="hljs-string">Mon</span> <span class="hljs-string">Jun</span>  <span class="hljs-number">8</span> <span class="hljs-number">03</span><span class="hljs-string">:32:28</span> <span class="hljs-number">2020</span>] <span class="hljs-attr">Code:</span> <span class="hljs-string">&lt;eb&gt;</span> <span class="hljs-string">fe</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br></code></pre></td></tr></table></figure>


<p>Enable nmi_watchdog=1 in kernel</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs dts">cat hard.c<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/init.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/kthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/spinlock.h&gt;</span></span><br> <br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL&quot;</span>);<br> <br>static int<br>hog_thread(void *data)<br>&#123;<br>    static DEFINE_SPINLOCK(lock);<br>    unsigned long flags;<br> <br>    printk(KERN_INFO <span class="hljs-string">&quot;Hogging a CPU now\n&quot;</span>);<br>    spin_lock_irqsave(<span class="hljs-variable">&amp;lock</span>, flags);<br>    while (<span class="hljs-number">1</span>);<br> <br>    <span class="hljs-comment">/* unreached */</span><br>    return <span class="hljs-number">0</span>;<br>&#125;<br> <br>static int __init<br>hog_init(void)<br>&#123;<br>    kthread_run(hog_thread, NULL, <span class="hljs-string">&quot;hog&quot;</span>);<br>    return <span class="hljs-number">0</span>;<br>&#125;<br> <br>module_init(hog_init);<br><br>obj-m += hard.o<br><br><span class="hljs-symbol">all:</span> make -C <span class="hljs-meta-keyword">/lib/</span>modules/$(uname -r)<span class="hljs-meta-keyword">/build/</span> M=$(pwd) modules<br><span class="hljs-symbol">clean:</span> make -C <span class="hljs-meta-keyword">/lib/</span>modules/$(uname -r)<span class="hljs-meta-keyword">/build/</span> M=$(pwd) clean<br><br>$  make -C <span class="hljs-meta-keyword">/lib/</span>modules/$(uname -r)<span class="hljs-meta-keyword">/build/</span> M=$(pwd) modules<br><span class="hljs-symbol">make:</span> Entering directory `<span class="hljs-meta-keyword">/usr/</span>src<span class="hljs-meta-keyword">/kernels/</span><span class="hljs-number">3.10</span><span class="hljs-number">.0</span><span class="hljs-number">-1062.1</span><span class="hljs-number">.1</span>.el7.x86_64&#x27;<br>  CC [M]  <span class="hljs-meta-keyword">/root/</span>hardhog/hard.o<br>  Building modules, stage <span class="hljs-number">2.</span><br>  MODPOST <span class="hljs-number">1</span> modules<br>  CC      <span class="hljs-meta-keyword">/root/</span>hardhog/hard.mod.o<br>  LD [M]  <span class="hljs-meta-keyword">/root/</span>hardhog/hard.ko<br><br>$ insmod hard.ko<br><br><span class="hljs-meta"># after insmod, the KVM ssh not respond too.</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://kernelnewbies.org/FAQ/FastpathAndSlowpath">In general</a>, “fast path” is the commonly run code that should finish very quickly. For example, when it comes to spinlocks the fast path is that nobody is holding the spinlock and the CPU that wants it can just take it.<br>Conversely, the slow path for spinlocks is that the lock is already taken by somebody else and the CPU will have to wait for the lock to be freed.<br>The first case is the common one that should be optimized.<br>The second one is not as important and does not need to be optimized much at all.</p>
<h3 id="cgroup-limit-resource"><a href="#cgroup-limit-resource" class="headerlink" title="cgroup limit resource"></a>cgroup limit resource</h3><p>limit memory size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ cgcreate -g memory:DBLimitedGroup<br>$ <span class="hljs-built_in">echo</span> 16G &gt; /sys/fs/cgroup/memory/DBLimitedGroup/memory.limit_in_bytes<br>$ sync; <span class="hljs-built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches<br>$ cgclassify -g memory:DBLimitedGroup $(pid)<br></code></pre></td></tr></table></figure>

<h3 id="About-WB-SYNC-NONE-and-WB-SYNC-ALL"><a href="#About-WB-SYNC-NONE-and-WB-SYNC-ALL" class="headerlink" title="About WB_SYNC_NONE and WB_SYNC_ALL"></a>About WB_SYNC_NONE and WB_SYNC_ALL</h3><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v3.10.108/source/fs/fs-writeback.c#L140">https://elixir.bootlin.com/linux/v3.10.108/source/fs/fs-writeback.c#L140</a><br>/**</p>
<ul>
<li>bdi_start_writeback - start writeback</li>
<li>@bdi: the backing device to write from</li>
<li>@nr_pages: the number of pages to write</li>
<li>@reason: reason why some writeback work was initiated</li>
<li></li>
<li>Description:</li>
<li>This does WB_SYNC_NONE opportunistic writeback. The IO is only</li>
<li>started when this function returns, we make no guarantees on</li>
<li>completion. Caller need not hold sb s_umount semaphore.</li>
<li></li>
<li>/</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v3.10.108/source/include/linux/writeback.h#L34">https://elixir.bootlin.com/linux/v3.10.108/source/include/linux/writeback.h#L34</a></p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">writeback_sync_modes</span> &#123;</span><br>	WB_SYNC_NONE,	<span class="hljs-regexp">/* Don&#x27;t wait on anything */</span><br>	WB_SYNC_ALL,	<span class="hljs-regexp">/* Wait on every mapping */</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><h4 id="ldd"><a href="#ldd" class="headerlink" title="ldd"></a>ldd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ldd /bin/ls<br>	linux-vdso.so.1 =&gt;  (0x00007fff59353000)<br>	libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fa12b999000)<br>	libcap.so.2 =&gt; /lib64/libcap.so.2 (0x00007fa12b794000)<br>	libacl.so.1 =&gt; /lib64/libacl.so.1 (0x00007fa12b58b000)<br>	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fa12b1bd000)<br>	libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007fa12af5b000)<br>	libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fa12ad57000)<br>	/lib64/ld-linux-x86-64.so.2 (0x00007fa12bbc0000)<br>	libattr.so.1 =&gt; /lib64/libattr.so.1 (0x00007fa12ab52000)<br>	libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fa12a936000)<br></code></pre></td></tr></table></figure>

<h4 id="Read-ELF-Executable-and-Linking-Format"><a href="#Read-ELF-Executable-and-Linking-Format" class="headerlink" title="Read ELF(Executable and Linking Format)"></a>Read ELF(Executable and Linking Format)</h4><p>Relocatable file (eg: xx.o)<br>Executable file<br>Dynamic Linking Library (eg: xx.so)<br>Static Linking Library  (eg: xx.a)</p>
<p>ELF Header<br>ELF Program Header Table/Program Headers<br>ELF Section Header Table/Section Headers<br>ELF Sections<br>multiple sections merge to a segment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ readelf -h /bin/ls<br>ELF Header:<br>  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00<br>  Class:                             ELF64<br>  Data:                              2<span class="hljs-string">&#x27;s complement, little endian</span><br><span class="hljs-string">  Version:                           1 (current)</span><br><span class="hljs-string">  OS/ABI:                            UNIX - System V</span><br><span class="hljs-string">  ABI Version:                       0</span><br><span class="hljs-string">  Type:                              EXEC (Executable file)</span><br><span class="hljs-string">  Machine:                           Advanced Micro Devices X86-64</span><br><span class="hljs-string">  Version:                           0x1</span><br><span class="hljs-string">  Entry point address:               0x404324</span><br><span class="hljs-string">  Start of program headers:          64 (bytes into file)</span><br><span class="hljs-string">  Start of section headers:          115688 (bytes into file)</span><br><span class="hljs-string">  Flags:                             0x0</span><br><span class="hljs-string">  Size of this header:               64 (bytes)</span><br><span class="hljs-string">  Size of program headers:           56 (bytes)</span><br><span class="hljs-string">  Number of program headers:         9</span><br><span class="hljs-string">  Size of section headers:           64 (bytes)</span><br><span class="hljs-string">  Number of section headers:         30</span><br><span class="hljs-string">  Section header string table index: 29</span><br><span class="hljs-string"></span><br><span class="hljs-string">$  readelf -S /bin/ls | grep debug</span><br><span class="hljs-string">  [27] .gnu_debuglink    PROGBITS         0000000000000000  0001b600</span><br><span class="hljs-string">  [28] .gnu_debugdata    PROGBITS         0000000000000000  0001b610 </span><br><span class="hljs-string"></span><br><span class="hljs-string">$ readelf -all /bin/ls</span><br><span class="hljs-string">......</span><br></code></pre></td></tr></table></figure>

<h4 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ objdump -i <br><span class="hljs-comment"># Display a list showing all architectures and object formats available for specification with -b or -m.</span><br>...<br>$ gcc -O2 -ggdb3 -c -o sort.o sort.c<br>$ objdump -d sort.o<br><span class="hljs-comment">#Display the assembler mnemonics for the machine instructions from objfile</span><br><br>sort.o:     file format elf64-x86-64<br><br><br>Disassembly of section .text:<br><br>0000000000000000 &lt;sort&gt;:<br>   0:	31 c0                	xor    %eax,%eax<br>   2:	b9 01 00 00 00       	mov    <span class="hljs-variable">$0x1</span>,%ecx<br>   7:	83 f8 1e             	cmp    <span class="hljs-variable">$0x1e</span>,%eax<br>   a:	7e 0b                	jle    17 &lt;sort+0x17&gt;<br>   c:	84 c9                	<span class="hljs-built_in">test</span>   %cl,%cl<br>   e:	75 36                	jne    46 &lt;sort+0x46&gt;<br>  10:	b9 01 00 00 00       	mov    <span class="hljs-variable">$0x1</span>,%ecx<br>...<br><br>$ objdump -t sort.o<br><span class="hljs-comment"># Print the symbol table entries of the file</span><br><br>sort.o:     file format elf64-x86-64<br><br>SYMBOL TABLE:<br>0000000000000000 l    df *ABS*	0000000000000000 sort.c<br>0000000000000000 l    d  .text	0000000000000000 .text<br>0000000000000000 l    d  .data	0000000000000000 .data<br>0000000000000000 l    d  .bss	0000000000000000 .bss<br>0000000000000000 l    d  .rodata.str1.1	0000000000000000 .rodata.str1.1<br>0000000000000000 l    d  .text.startup	0000000000000000 .text.startup<br>0000000000000000 l    d  .debug_info	0000000000000000 .debug_info<br>0000000000000000 l    d  .debug_abbrev	0000000000000000 .debug_abbrev<br>0000000000000000 l    d  .debug_loc	0000000000000000 .debug_loc<br>...<br></code></pre></td></tr></table></figure>

<h4 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h4><p>list symbols from object files</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">$ nm ./walk<br>                 U <span class="hljs-symbol">atoi@</span>@GLIBC_2<span class="hljs-number">.2</span><span class="hljs-number">.5</span><br><span class="hljs-number">00000000006020</span>a4 B __bss_start<br>                 U <span class="hljs-symbol">closedir@</span>@GLIBC_2<span class="hljs-number">.2</span><span class="hljs-number">.5</span><br><span class="hljs-number">00000000006020</span>a8 b completed<span class="hljs-number">.6355</span><br><span class="hljs-number">00000000006020</span>a0 D __data_start<br><span class="hljs-number">00000000006020</span>a0 W data_start<br><span class="hljs-number">0000000000400880</span> t deregister_tm_clones<br><span class="hljs-number">00000000004008f</span>0 t __do_global_dtors_aux<br><span class="hljs-number">0000000000601e18</span> t __do_global_dtors_aux_fini_array_entry<br><span class="hljs-number">0000000000400</span>d18 R __dso_handle<br><br>$ nm -e ./walk<br>                 U <span class="hljs-symbol">atoi@</span>@GLIBC_2<span class="hljs-number">.2</span><span class="hljs-number">.5</span><br><span class="hljs-number">00000000006020</span>a4 B __bss_start<br>                 U <span class="hljs-symbol">closedir@</span>@GLIBC_2<span class="hljs-number">.2</span><span class="hljs-number">.5</span><br><span class="hljs-number">00000000006020</span>a8 b completed<span class="hljs-number">.6355</span><br><span class="hljs-number">00000000006020</span>a0 D __data_start<br><span class="hljs-number">00000000006020</span>a0 W data_start<br><span class="hljs-number">0000000000400880</span> t deregister_tm_clones<br><span class="hljs-number">00000000004008f</span>0 t __do_global_dtors_aux<br><span class="hljs-number">0000000000601e18</span> t __do_global_dtors_aux_fini_array_entry<br><span class="hljs-number">0000000000400</span>d18 R __dso_handle<br></code></pre></td></tr></table></figure>

<p>kernel symbol table</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs tcl">$  grep CONFIG_KALLSYMS /boot/config<span class="hljs-number">-3.10</span><span class="hljs-number">.0</span><span class="hljs-number">-1062.18</span><span class="hljs-number">.1</span>.el7.x86_64<br>CONFIG_KALLSYMS=y<br>CONFIG_KALLSYMS_ALL=y<br><br>$ grep <span class="hljs-string">&quot; tcp_v4_do_rcv&quot;</span>  /<span class="hljs-keyword">proc</span>/kallsyms<br>ffffffff936c0c70<span class="hljs-title"> T</span> tcp_v4_do_rcv<br>##<span class="hljs-title"> Why</span> addr<span class="hljs-title"> is</span> change ?<br><br>$<span class="hljs-title"> grep</span> CONFIG_RANDOMIZE_BASE /boot/config-3.10.0-1062.18.1.el7.x86_64<br>CONFIG_RANDOMIZE_BASE=y<br><br>##<span class="hljs-title"> ALL</span> info,<span class="hljs-title"> the</span> compiler<span class="hljs-title"> optimize</span> cause<span class="hljs-title"> some</span> symbols<span class="hljs-title"> missing</span> in<span class="hljs-title"> kallsyms</span><br><span class="hljs-title">$</span> grep &quot;<span class="hljs-title"> tcp_v4_do_rcv&quot;</span>  /boot/System.map-3.10.0-1062.18.1.el7.x86_64<br>ffffffff816c0c70<span class="hljs-title"> T</span> tcp_v4_do_rcv<br></code></pre></td></tr></table></figure>



<p>uppercase: global(external) symbol<br>lowercase: local symbol<br>T The symbol is in the text(code) section<br>D The symbol is in the initialized data section<br>R The sysbol is in a read only data section<br>t static<br>d static<br>R const<br>r static const</p>
<h4 id="size"><a href="#size" class="headerlink" title="size"></a>size</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">size add_lock<br>   text	   data	    bss	    dec	    hex	filename<br>   5008	    660	      4	   5672	   1628	add_lock<br></code></pre></td></tr></table></figure>

<p>代码段： 只读，可共享; 代码段（code segment/text segment ）通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读, 某些架构也允许代码段为可写，即允许修改程序。在代码段中，也有可能包含一些只读的常数变量，例如字符串常量等。<br>数据段： 储存已被初始化了的静态数据。数据段（data segment ）通常是指用来存放程序中已初始化的全局变量的一块内存区域。数据段属于静态内存分配。<br>BSS 段：未初始化的数据段. BSS 段（bss segment ）通常是指用来存放程序中未初始化的全局变量的一块内存区域。BSS 是英文Block Started by Symbol 的简称。BSS 段属于静态内存分配。<br>堆（heap ）：low to high, 堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用malloc 等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用free 等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）<br>栈(stack) ： high to low, 栈又称堆栈，是用户存放程序临时创建的局部变量，也就是说我们函数括弧“{} ”中定义的变量（但不包括static 声明的变量，static 意味着在数据段中存放变量）。除此以外，在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的先进先出特点，所以栈特别方便用来保存/ 恢复调用现场。从这个意义上讲，我们可以把堆栈看成一个寄存、交换临时数据的内存区。<br>另外, 在高地址还储存了命令行参数及环境变量.</p>
<p>The heap is, generally speaking, one specific memory region created by the C runtime, and managed by malloc (which in turn uses the brk and sbrk system calls to grow and shrink).<br>mmap is a way of creating new memory regions, independently of malloc (and so independently of the heap). munmap is simply its inverse, it releases these regions.<br>Some picture show mmap high addr to low addr, same direction with stack</p>
<h3 id="process-schduler"><a href="#process-schduler" class="headerlink" title="process schduler"></a>process schduler</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ chrt -p <span class="hljs-variable">$pid</span><br>$ chrt -m<br>$ chrt [-b/-f/-o/-r/-i/-d] -p <span class="hljs-variable">$priority</span> <span class="hljs-variable">$pid</span><br>-b SCHED_BATCH<br>-f SCHED_FIFO<br>-o SCHED_OTHER<br>-r SCHED_RR<br>-i SCHED_IDLE<br>-d SCHED_DEADLINE<br></code></pre></td></tr></table></figure>

<h3 id="vim-jump-cursor"><a href="#vim-jump-cursor" class="headerlink" title="vim jump cursor"></a>vim jump cursor</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">:cal cursor(30, 5)<br></code></pre></td></tr></table></figure>

<h3 id="gpart-recovery-partition-table"><a href="#gpart-recovery-partition-table" class="headerlink" title="gpart recovery partition table"></a>gpart recovery partition table</h3><p>boot by freebsd livecd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gpart disk list<br>$ gpart recover /dev/sda<br></code></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/07/18/centos/">http://yoursite.com/2019/07/18/centos/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/centos/">centos</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/10/10/golang/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">golang</div></div></a></div><div class="next-post pull-right"><a href="/2019/07/18/ubuntu/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">ubuntu</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '0b9d5b98d0a972b33cf7',
      clientSecret: '769efc11b32f6c0d03bcbf3ee800dfc4e2690459',
      repo: 'homerl.github.io',
      owner: 'homerl',
      admin: ['homerl'],
      id: '35e7a85fd9d838d3cbc4dd6b66c05120',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>