<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>centos | b946c5a0bf547c89</title><meta name="description" content="centossystemd rc.local123456789101112131415161718192021$ sudo vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;rc-local.service[Unit]Description&#x3D;&#x2F;etc&#x2F;rc.local CompatibilityConditionPathExists&#x3D;&#x2F;etc&#x2F;rc.local[Service]Type&#x3D;forking"><meta name="keywords" content="centos"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2019/07/18/centos/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="centos"><meta property="og:url" content="http://yoursite.com/2019/07/18/centos/"><meta property="og:site_name" content="b946c5a0bf547c89"><meta property="og:description" content="centossystemd rc.local123456789101112131415161718192021$ sudo vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;rc-local.service[Unit]Description&#x3D;&#x2F;etc&#x2F;rc.local CompatibilityConditionPathExists&#x3D;&#x2F;etc&#x2F;rc.local[Service]Type&#x3D;forking"><meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><meta property="article:published_time" content="2019-07-18T07:37:02.000Z"><meta property="article:modified_time" content="2020-09-27T16:17:09.828Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime: '',
  date_suffix: {"one_hour":"Just","hours":"hours ago","day":"days ago"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-09-28 00:17:09'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">59</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">66</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#centos"><span class="toc-number">1.</span> <span class="toc-text">centos</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd-rc-local"><span class="toc-number">1.1.</span> <span class="toc-text">systemd rc.local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#date"><span class="toc-number">1.2.</span> <span class="toc-text">date</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dd"><span class="toc-number">1.3.</span> <span class="toc-text">dd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#selinux"><span class="toc-number">1.4.</span> <span class="toc-text">selinux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Software-Collections-SCL-Repository"><span class="toc-number">1.5.</span> <span class="toc-text">Software Collections ( SCL ) Repository</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#centos-8"><span class="toc-number"></span> <span class="toc-text">centos 8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nofile"><span class="toc-number">1.</span> <span class="toc-text">Nofile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pidstat"><span class="toc-number">2.</span> <span class="toc-text">pidstat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nfsstat"><span class="toc-number">3.</span> <span class="toc-text">nfsstat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user-space-pipe-size"><span class="toc-number">4.</span> <span class="toc-text">user space pipe size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rand-file"><span class="toc-number">5.</span> <span class="toc-text">rand file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#samba"><span class="toc-number">6.</span> <span class="toc-text">samba</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Account"><span class="toc-number">6.1.</span> <span class="toc-text">Account</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#config"><span class="toc-number">6.2.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Show-status"><span class="toc-number">6.3.</span> <span class="toc-text">Show status</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update-kernel-moduels-in-lib-moduels-uname-r"><span class="toc-number">7.</span> <span class="toc-text">update kernel moduels in &#x2F;lib&#x2F;moduels&#x2F;$(uname -r)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#syscalls"><span class="toc-number">8.</span> <span class="toc-text">syscalls</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter-syslog"><span class="toc-number">9.</span> <span class="toc-text">filter syslog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs"><span class="toc-number">10.</span> <span class="toc-text">xfs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Check-fragmentation"><span class="toc-number">10.1.</span> <span class="toc-text">Check fragmentation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tmp-permission"><span class="toc-number">11.</span> <span class="toc-text">tmp permission</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#taskset"><span class="toc-number">12.</span> <span class="toc-text">taskset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh"><span class="toc-number">13.</span> <span class="toc-text">ssh</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-key-not-work"><span class="toc-number">13.1.</span> <span class="toc-text">ssh key not work</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-config-allow-users"><span class="toc-number">13.2.</span> <span class="toc-text">ssh config allow users</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strace"><span class="toc-number">14.</span> <span class="toc-text">strace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Calculated-CPU-usage"><span class="toc-number">15.</span> <span class="toc-text">Calculated CPU usage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tuna"><span class="toc-number">16.</span> <span class="toc-text">tuna</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS-client"><span class="toc-number">17.</span> <span class="toc-text">NFS client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monitor"><span class="toc-number">18.</span> <span class="toc-text">Monitor</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">18.1.</span> <span class="toc-text">ps</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selinux-1"><span class="toc-number">19.</span> <span class="toc-text">selinux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handle-overflow-in-jiffies"><span class="toc-number">20.</span> <span class="toc-text">handle overflow in jiffies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prevent-the-data-be-deleted"><span class="toc-number">21.</span> <span class="toc-text">Prevent the data be deleted</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#errno"><span class="toc-number">22.</span> <span class="toc-text">errno</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tc"><span class="toc-number">23.</span> <span class="toc-text">tc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VNC"><span class="toc-number">24.</span> <span class="toc-text">VNC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vncserer-was-runing-but-there-is-no-desktop-in-centos-7"><span class="toc-number">25.</span> <span class="toc-text">Vncserer was runing, but there is no desktop in centos 7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#screen"><span class="toc-number">26.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VLC"><span class="toc-number">27.</span> <span class="toc-text">VLC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Not-show-media-title"><span class="toc-number">27.1.</span> <span class="toc-text">Not show media title</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Not-resize-interface"><span class="toc-number">27.2.</span> <span class="toc-text">Not resize interface</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grub"><span class="toc-number">28.</span> <span class="toc-text">grub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-debug-parameters"><span class="toc-number">29.</span> <span class="toc-text">set debug parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS"><span class="toc-number">30.</span> <span class="toc-text">NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nolock"><span class="toc-number">30.1.</span> <span class="toc-text">nolock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file-lock"><span class="toc-number">30.2.</span> <span class="toc-text">file lock</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-could-I-found-which-file-cause-pipe-hang"><span class="toc-number">31.</span> <span class="toc-text">How could I found which file cause pipe hang</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-pipe-change-to-socket"><span class="toc-number">31.1.</span> <span class="toc-text">If pipe change to socket</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcpdump"><span class="toc-number">32.</span> <span class="toc-text">tcpdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#calculate-upload-download-speed-by-ping"><span class="toc-number">33.</span> <span class="toc-text">calculate upload&#x2F;download speed by ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MTU-problem-check"><span class="toc-number">34.</span> <span class="toc-text">MTU problem check</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yum"><span class="toc-number">35.</span> <span class="toc-text">yum</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Exclude-packages"><span class="toc-number">35.1.</span> <span class="toc-text">Exclude packages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch-version"><span class="toc-number">35.2.</span> <span class="toc-text">Switch version</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Download-to-local"><span class="toc-number">35.3.</span> <span class="toc-text">Download to local</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Resolve-dependency-resolution-errors"><span class="toc-number">35.4.</span> <span class="toc-text">Resolve dependency resolution errors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Uninstall-rpm-packages-from-rpmdb"><span class="toc-number">35.5.</span> <span class="toc-text">Uninstall rpm packages from rpmdb</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upgrade-kernel"><span class="toc-number">36.</span> <span class="toc-text">upgrade kernel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BBR"><span class="toc-number">36.1.</span> <span class="toc-text">BBR</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reinstall-grub2-from-boot-livecd"><span class="toc-number">37.</span> <span class="toc-text">reinstall grub2 from boot livecd</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LVM-partition"><span class="toc-number">37.1.</span> <span class="toc-text">LVM partition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-in-ubuntu"><span class="toc-number">37.2.</span> <span class="toc-text">Test in ubuntu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-in-CentOS-7-set-boot-menu"><span class="toc-number">37.3.</span> <span class="toc-text">Test in CentOS 7, set boot menu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Re-install-EFI"><span class="toc-number">37.4.</span> <span class="toc-text">Re-install EFI</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rdesktop-to-win10"><span class="toc-number">38.</span> <span class="toc-text">rdesktop to win10</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-remote-desktop"><span class="toc-number">38.1.</span> <span class="toc-text">Enable remote desktop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Modify-registry-from-win10"><span class="toc-number">38.2.</span> <span class="toc-text">Modify registry from win10</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#record-and-replay-linux-terminal"><span class="toc-number">39.</span> <span class="toc-text">record and replay linux terminal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#traceroute-error"><span class="toc-number">40.</span> <span class="toc-text">traceroute error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><span class="toc-number">41.</span> <span class="toc-text">Getting Error su: cannot set user id: Resource temporarily unavailable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lshw"><span class="toc-number">42.</span> <span class="toc-text">lshw</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS8"><span class="toc-number">43.</span> <span class="toc-text">CentOS8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bonding"><span class="toc-number">43.1.</span> <span class="toc-text">bonding</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fio-test-multiple-nodes"><span class="toc-number">44.</span> <span class="toc-text">fio test multiple nodes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Permission"><span class="toc-number">45.</span> <span class="toc-text">Permission</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#screen-1"><span class="toc-number">46.</span> <span class="toc-text">screen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-systemd-service"><span class="toc-number">47.</span> <span class="toc-text">Add systemd service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#route-config"><span class="toc-number">48.</span> <span class="toc-text">route config</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#static-route"><span class="toc-number">48.1.</span> <span class="toc-text">static route</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-NIC-driver-err"><span class="toc-number">49.</span> <span class="toc-text">Check NIC driver err</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#collectl"><span class="toc-number">50.</span> <span class="toc-text">collectl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#process-mointor"><span class="toc-number">51.</span> <span class="toc-text">process mointor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time"><span class="toc-number">52.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#youtube-download"><span class="toc-number">53.</span> <span class="toc-text">youtube download</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uptime-and-vmstat-running"><span class="toc-number">54.</span> <span class="toc-text">uptime and vmstat running</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kernel-do-IRQ-X-Y-No-irq-handler-for-vector-irq-1"><span class="toc-number">55.</span> <span class="toc-text">kernel: do_IRQ: X.Y No irq handler for vector (irq -1)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multipath-issue"><span class="toc-number">56.</span> <span class="toc-text">multipath issue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sshfs"><span class="toc-number">57.</span> <span class="toc-text">sshfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scan-file-size"><span class="toc-number">58.</span> <span class="toc-text">scan file size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#System-err-for-monitor"><span class="toc-number">59.</span> <span class="toc-text">System err for monitor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cgroup-limit-resource"><span class="toc-number">60.</span> <span class="toc-text">cgroup limit resource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#About-WB-SYNC-NONE-and-WB-SYNC-ALL"><span class="toc-number">61.</span> <span class="toc-text">About WB_SYNC_NONE and WB_SYNC_ALL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tools"><span class="toc-number">62.</span> <span class="toc-text">Tools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ldd"><span class="toc-number">62.1.</span> <span class="toc-text">ldd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Read-ELF-Executable-and-Linking-Format"><span class="toc-number">62.2.</span> <span class="toc-text">Read ELF(Executable and Linking Format)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#objdump"><span class="toc-number">62.3.</span> <span class="toc-text">objdump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nm"><span class="toc-number">62.4.</span> <span class="toc-text">nm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-number">62.5.</span> <span class="toc-text">size</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#process-schduler"><span class="toc-number">63.</span> <span class="toc-text">process schduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vim-jump-cursor"><span class="toc-number">64.</span> <span class="toc-text">vim jump cursor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gpart-recovery-partition-table"><span class="toc-number">65.</span> <span class="toc-text">gpart recovery partition table</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">b946c5a0bf547c89</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">centos</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-07-18T07:37:02.000Z" title="Created 2019-07-18 15:37:02">2019-07-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-09-27T16:17:09.828Z" title="Updated 2020-09-28 00:17:09">2020-09-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/others/">others</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h3><h4 id="systemd-rc-local"><a href="#systemd-rc-local" class="headerlink" title="systemd rc.local"></a>systemd rc.local</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/systemd/system/rc-local.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=/etc/rc.local Compatibility</span><br><span class="line">ConditionPathExists=/etc/rc.local</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line">TimeoutSec=0</span><br><span class="line">StandardOutput=tty</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">SysVStartPriority=99</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;exit 0&quot;</span> &gt; /etc/rc.local</span><br><span class="line"></span><br><span class="line">$ sudo chmod +x /etc/rc.local</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> rc-local</span><br></pre></td></tr></table></figure>

<h4 id="date"><a href="#date" class="headerlink" title="date"></a>date</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ date -d <span class="string">&quot;@1595260885&quot;</span> +<span class="string">&quot;%m/%d/%Y %H:%M:%S&quot;</span></span><br><span class="line">07/21/2020 00:01:25</span><br><span class="line"></span><br><span class="line">$ date -d <span class="string">&quot;07/21/2020 00:01:25&quot;</span> +%s</span><br><span class="line">159526088</span><br><span class="line"></span><br><span class="line">$ date -d @12345 -u +%H:%M:%S</span><br><span class="line">03:25:45</span><br><span class="line"></span><br><span class="line">$ date -d <span class="string">&quot;09/04/2020 03:25:45&quot;</span> +%s</span><br><span class="line">1599186345</span><br><span class="line">$ date -d <span class="string">&quot;09/04/2020 00:00:00&quot;</span> +%s</span><br><span class="line">1599174000</span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">1599186345</span>-<span class="number">1599174000</span>))</span><br><span class="line">12345</span><br></pre></td></tr></table></figure>

<h4 id="dd"><a href="#dd" class="headerlink" title="dd"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8554568/add-a-big-buffer-to-a-pipe-between-two-commands">dd</a></h4><p>dd modify pipe buffer block size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ commandA | dd status=none iflag=fullblock bs=1M | commandB</span><br><span class="line">$ process1 | mbuffer -m 1024M | process2</span><br></pre></td></tr></table></figure>

<h4 id="selinux"><a href="#selinux" class="headerlink" title="selinux"></a>selinux</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ setenforce 0</span><br><span class="line">$ getenforce</span><br><span class="line">Permissive</span><br></pre></td></tr></table></figure>
<h4 id="Software-Collections-SCL-Repository"><a href="#Software-Collections-SCL-Repository" class="headerlink" title="Software Collections ( SCL ) Repository"></a>Software Collections ( SCL ) Repository</h4><p>$ yum install centos-release-scl-rh<br>$ yum install devtoolset-9-toolchain</p>
<h1 id="centos-8"><a href="#centos-8" class="headerlink" title="centos 8"></a>centos 8</h1><p>$ dnf install gcc-toolset-9</p>
<p>$ gfortran –version | head -2<br>GNU Fortran (GCC) 4.8.5 20150623 (Red Hat 4.8.5-36)<br>Copyright (C) 2015 Free Software Foundation, Inc.</p>
<p>$ scl enable devtoolset-9 bash</p>
<p>$  gfortran –version | head -2<br>GNU Fortran (GCC) 8.2.1 20180905 (Red Hat 8.2.1-3)<br>Copyright (C) 2018 Free Software Foundation, Inc.</p>
<a id="more"></a>

<h3 id="Nofile"><a href="#Nofile" class="headerlink" title="Nofile"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/447583/ulimit-vs-file-max">Nofile</a></h3><p>/proc/sys/fs/file-max<br>ulimit -n</p>
<p>file-max is the maximum File Descriptors (FD) enforced on a kernel level, which cannot be surpassed by all processes without increasing.<br>The ulimit is enforced on a process level, which can be less than the file-max.</p>
<p>/proc/sys/fs/file-nr<br>This will return three values denote the number of allocated file handles the number of allocated but unused file handles, and the maximum number of file handles. </p>
<h3 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -C <span class="string">&#x27;linpack|stream&#x27;</span> -d 2 -rsuw</span><br></pre></td></tr></table></figure>

<h3 id="nfsstat"><a href="#nfsstat" class="headerlink" title="nfsstat"></a>nfsstat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nfsiostat -d /mount 2</span><br></pre></td></tr></table></figure>

<h3 id="user-space-pipe-size"><a href="#user-space-pipe-size" class="headerlink" title="user space pipe size"></a>user space pipe size</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F_SETPIPE_SZ F_GETPIPE_SZ</span></span><br><span class="line"><span class="comment"># echo 104857600 &gt; /proc/sys/fs/pipe-max-size</span></span><br><span class="line"><span class="comment"># fs.pipe-max-size=104857600</span></span><br><span class="line"><span class="comment"># ulimit pipe size            (512 bytes, -p) 8 = 4096 bytes, it &#x27;s pipe buffer size in the ulimit, not pipe size</span></span><br><span class="line"><span class="comment">## POSIX.1-2001 says that write(2)s of less than PIPE_BUF  bytes  must  be atomic:  the  output  data  is  written  to  the  pipe  as a contiguous sequence.  Writes of more than PIPE_BUF bytes may  be  non-atomic:  the kernel  may  interleave the data with data written by other processes.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># here 2 tools for pipe</span></span><br><span class="line"><span class="comment"># pv - Pipe Viewer - is a terminal-based tool for monitoring the progress of data through a pipeline.</span></span><br><span class="line"><span class="comment"># process1 | pv -pterbTCB 1G | process2</span></span><br><span class="line"></span><br><span class="line">$ pv -cN sources linux-image-unsigned-4.15.0-65-generic-dbgsym_4.15.0-65.74_amd64.ddeb | dd of=/tmp/tmp bs=512 | pv -cN cat</span><br><span class="line"></span><br><span class="line">$ mkfifo -m 777 /tmp/lfs.log</span><br><span class="line">$ lctl debug_daemon start /tmp/lfs.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## lfs 40MB log</span></span><br><span class="line">$ lctl debug_daemon start /tmp/lfs.40.bin 40</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="rand-file"><a href="#rand-file" class="headerlink" title="rand file"></a>rand file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -out 1G.file 1073741824</span><br></pre></td></tr></table></figure>

<h3 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h3><h4 id="Account"><a href="#Account" class="headerlink" title="Account"></a>Account</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -r -s /bin/<span class="literal">false</span>  <span class="variable">$USER</span></span><br><span class="line">PASSINPUT=`<span class="built_in">echo</span> <span class="variable">$USER</span>|cut -c1-3`123 </span><br><span class="line">(<span class="built_in">echo</span> <span class="variable">$PASSINPUT</span> ; <span class="built_in">echo</span> <span class="variable">$PASSINPUT</span>)  | smbpasswd -s -a <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>
<h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">	workgroup = MYGROUP</span><br><span class="line">	server string = Samba Server Version %v</span><br><span class="line">	<span class="built_in">log</span> file = /var/<span class="built_in">log</span>/samba/<span class="built_in">log</span>.%m</span><br><span class="line">	max <span class="built_in">log</span> size = 50</span><br><span class="line">	security = user</span><br><span class="line">	passdb backend = tdbsam</span><br><span class="line">load printers = no</span><br><span class="line">printing = bsd</span><br><span class="line">printcap name = /dev/null</span><br><span class="line"><span class="built_in">disable</span> spoolss = yes</span><br><span class="line"></span><br><span class="line">[SMB_DATA]</span><br><span class="line">path = /samba/data</span><br><span class="line">valid users =  test1,test2,test3,test4</span><br><span class="line">create mask = 0744</span><br><span class="line">force create mode = 0744</span><br><span class="line">security mask = 0744</span><br><span class="line">force security mode = 0744</span><br><span class="line">directory mask = 0755</span><br><span class="line">force directory mode = 0755</span><br><span class="line">directory security mask = 0755</span><br><span class="line">force directory security mode = 0755</span><br><span class="line">writable = yes</span><br><span class="line">fileid:mapping = smb_data</span><br><span class="line">use mmap = no</span><br><span class="line">nt acl support = yes</span><br><span class="line">ea support = yes</span><br></pre></td></tr></table></figure>

<h4 id="Show-status"><a href="#Show-status" class="headerlink" title="Show status"></a>Show status</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ smbclient -L localhost <span class="comment">#show share point</span></span><br><span class="line">$ pdbedit -L <span class="comment"># show users</span></span><br><span class="line">$ mount.cifs //<span class="variable">$domain_addr</span>/SMB_DATA -o username=test1,password=<span class="variable">$your_pass</span> /mnt</span><br><span class="line"></span><br><span class="line">$ ls -l /var/lib/samba/private/</span><br><span class="line">total 936</span><br><span class="line">-rw------- 1 root root 528384 Aug 22 10:36 passdb.tdb</span><br><span class="line">-rw------- 1 root root 430080 Dec 29  2013 secrets.tdb</span><br><span class="line"><span class="comment"># backup data</span></span><br><span class="line">$ pdbedit -e smbpasswd:/root/samba-users.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># import </span></span><br><span class="line">$ pdbedit -i smbpasswd:/root/samba-users.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># Please backup all users from /etc/passwd too</span></span><br></pre></td></tr></table></figure>

<h3 id="update-kernel-moduels-in-lib-moduels-uname-r"><a href="#update-kernel-moduels-in-lib-moduels-uname-r" class="headerlink" title="update kernel moduels in /lib/moduels/$(uname -r)"></a>update kernel moduels in /lib/moduels/$(uname -r)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># re-generate modules.alias modules.dep</span></span><br><span class="line">$ depmod -a</span><br></pre></td></tr></table></figure>

<h3 id="syscalls"><a href="#syscalls" class="headerlink" title="syscalls"></a>syscalls</h3><p>Get these names from <a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/include/linux/syscalls.h">syscalls.h</a></p>
<h3 id="filter-syslog"><a href="#filter-syslog" class="headerlink" title="filter syslog"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/1564823">filter syslog</a></h3><p>Created slice user-0.slice.<br>Starting Session 150 of user root.<br>Started Session 150 of user root.<br>Created slice user-0.slice.<br>Starting Session 151 of user root.<br>Started Session 151 of user root.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;if $programname == &quot;l_getidentity.*&quot; then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-lustre-id-session.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;if $programname == &quot;systemd&quot; and ($msg contains &quot;Starting Session&quot; or $msg contains &quot;Started Session&quot; or $msg contains &quot;Created slice&quot; or $msg contains &quot;Starting user-&quot; or $msg contains &quot;Starting User Slice of&quot; or $msg contains &quot;Removed session&quot; or $msg contains &quot;Removed slice User Slice of&quot; or $msg contains &quot;Stopping User Slice of&quot;) then stop&#x27;</span> &gt;/etc/rsyslog.d/ignore-systemd-session-slice.conf</span><br><span class="line"></span><br><span class="line">$ systemctl restart rsyslog</span><br></pre></td></tr></table></figure>

<h3 id="xfs"><a href="#xfs" class="headerlink" title="xfs"></a>xfs</h3><h4 id="Check-fragmentation"><a href="#Check-fragmentation" class="headerlink" title="Check fragmentation"></a>Check fragmentation</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xfs_db -r -c frag /dev/md127</span><br><span class="line">actual 310296, ideal 306296, fragmentation factor 1.29%</span><br><span class="line">Note, this number is largely meaningless.</span><br><span class="line">Files on this filesystem average 1.01 extents per file</span><br></pre></td></tr></table></figure>

<h3 id="tmp-permission"><a href="#tmp-permission" class="headerlink" title="tmp permission"></a>tmp permission</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 1777 /tmp</span><br></pre></td></tr></table></figure>

<h3 id="taskset"><a href="#taskset" class="headerlink" title="taskset"></a>taskset</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ taskset -p a 205344</span><br><span class="line">pid 205344<span class="string">&#x27;s current affinity mask: ffffffffff</span></span><br><span class="line"><span class="string">pid 205344&#x27;</span>s new affinity mask: a</span><br><span class="line"></span><br><span class="line">$ taskset -c -p 205344</span><br><span class="line">pid 205344<span class="string">&#x27;s current affinity list: 1,3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ echo &quot;obase=2; ibase=16; A&quot; | bc</span></span><br><span class="line"><span class="string">1010 # core 1,3</span></span><br></pre></td></tr></table></figure>

<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><h4 id="ssh-key-not-work"><a href="#ssh-key-not-work" class="headerlink" title="ssh key not work"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6377009/adding-public-key-to-ssh-authorized-keys-does-not-log-me-in-automatically">ssh key not work</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 700 ~/.ssh</span><br><span class="line">$ chmod 600 ~/.ssh/authorized_keys</span><br><span class="line">$ chmod go-w ~</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bind $vnc_server_ip:5910 to localhost:7910</span></span><br><span class="line">$ ssh -L 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># to 0.0.0.0:7910</span></span><br><span class="line">$ ssh -L 7910:0.0.0.0:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"><span class="comment"># same with 0.0.0.0</span></span><br><span class="line">$ ssh -g -L 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"><span class="comment"># limit the client ip</span></span><br><span class="line">$ ssh -g -L 7910:<span class="variable">$&#123;ssh_client_ip&#125;</span>:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># bind $vnc_server_ip:5910 to $vnc_server_ip:7910 by $ssh_client</span></span><br><span class="line"><span class="comment"># modify -L to -R</span></span><br><span class="line">$ ssh -R 7910:localhost:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># share all ip addr</span></span><br><span class="line"><span class="comment"># modify /etc/ssh/sshd_config &#x27;GatewayPorts clientspecified&#x27;</span></span><br><span class="line">$ ssh -R 7910:0.0.0.0:5910 username@<span class="variable">$&#123;vnc_server_ip&#125;</span> -o GSSAPIAuthentication=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># vnc_server_ip2 and ip1 in the same LAN, bind vnc_server_ip2 5910 to ssh client 7910 and forward by vnc_server_ip1</span></span><br><span class="line">$ ssh -L 7910:<span class="variable">$&#123;vnc_server_ip2&#125;</span>:5910 user@<span class="variable">$&#123;vnc_server_ip1&#125;</span></span><br><span class="line">vnc_server_ip1 $ vncview localhost:7910</span><br><span class="line"><span class="comment"># Enable all ip access</span></span><br><span class="line">$ ssh -L 7910:0.0.0.0:5910 user@<span class="variable">$&#123;vnc_server_ip1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vnc_server_ip1 access ssh_client_ip2 vnc service</span></span><br><span class="line">$ ssh -R 7910:ssh_client_ip2:5910 user@vnc_server_ip1</span><br><span class="line">vnc_server_ip1 $ vncviewer localhost::7910 </span><br><span class="line"><span class="comment"># Enable all ip access</span></span><br><span class="line">$ ssh -R 7910:0.0.0.0:5910 user@vnc_server_ip1</span><br><span class="line"></span><br><span class="line"><span class="comment">#### [pass through another machine to forward sock5](https://superuser.com/questions/332850/ssh-as-socks-proxy-through-multiple-hosts)</span></span><br><span class="line">A-&gt;B-&gt;C  </span><br><span class="line">C could connecnt internet, A and B could not, A pass through B to forward sock5 port to <span class="variable">$A_local_sock_port</span></span><br><span class="line">```bash</span><br><span class="line"><span class="comment"># make these port have not block by firewalld</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### In A, you could set sock5 localhost:$A_local_sock_port to connect internnet</span></span><br><span class="line">client $ ssh -C -f -N -D <span class="variable">$local_sock_port</span> -oProxyCommand=<span class="string">&quot;ssh -C -W %h:%p username@<span class="variable">$B_ipaddr</span>&quot;</span> username@<span class="variable">$C_ipaddr</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or </span></span><br><span class="line">client $ ssh -L <span class="variable">$local_sock_port</span>:localhost:<span class="variable">$PORT2</span> <span class="variable">$B_IPADDR</span></span><br><span class="line">A $ ssh -f -N -D <span class="variable">$PORT2</span> <span class="variable">$C_IPADDR</span></span><br><span class="line"><span class="comment">#merge dual command to single command</span></span><br><span class="line">client $ ssh -f -L <span class="variable">$local_sock_port</span>:localhost:<span class="variable">$PORT2</span> liyan@192.168.210.3 <span class="string">&quot;ssh -f -N -D <span class="variable">$PORT2</span> liyan@<span class="variable">$C_IPADDR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># forward remote port to local</span></span><br><span class="line">client $ ssh -fNT -R 1025:127.0.0.1:1025 -J user@<span class="variable">$B_IP</span> user@<span class="variable">$C_IP</span></span><br><span class="line">AllowTcpForwarding yes</span><br><span class="line">GatewayPorts yes</span><br></pre></td></tr></table></figure>

<h4 id="ssh-config-allow-users"><a href="#ssh-config-allow-users" class="headerlink" title="ssh config allow users"></a>ssh config allow users</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllowUsers *@192.168.1.0/24 *@*.example.com *@1.2.3.4</span><br><span class="line">AllowGroups ssh</span><br></pre></td></tr></table></figure>

<h3 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h3><p>-ttt If given thrice, the time printed will include the microseconds and the leading portion will be printed as the number of seconds since the epoch</p>
<p>-s strsize  Specify the maximum string size to print (the default is 32).  Note that filenames are not considered strings and are always printed in full.</p>
<p>-f Trace child processes as they are created by currently traced processes  as  a  result  of  the  fork(2),  vfork(2)  and clone(2)  system  calls. Note that -p PID -f will attach all threads of process PID if it is multi-threaded, not only thread with thread_id = PID</p>
<p>-T Show the time spent in system calls.  This records the time difference between the beginning and the end of each  system call</p>
<p>-c Count time, calls, and errors for each system call and report a summary on program exit, suppressing the regular output. This attempts to show system time (CPU time spent running in the kernel) independent of wall clock time.  If -c is used with -f, only aggregate totals for all traced processes are kept.<br>-C Like -c but also print regular output while processes are running.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ strace -k cmd  <span class="comment">#show backtrace for each syscall</span></span><br><span class="line">$ strace -t cmd  <span class="comment">#prefix each syscall with walllock time</span></span><br><span class="line">$ strace -D cmd  strace process runs as detached grandchild of cmd</span><br><span class="line">$ strace -p 1234 -f <span class="comment">#addatch to all threads in process-group 1234</span></span><br><span class="line"></span><br><span class="line">strace -Tfe trace=open,<span class="built_in">read</span>,write  ./program</span><br><span class="line">$ strace -f -FF -tt -T -s 1024 -p <span class="variable">$pid</span></span><br><span class="line">$ strace -ttt -T -s 1024 -e trace=%memory -C -o ~/memory.log -f -p <span class="variable">$pid</span></span><br><span class="line">$ strace -ttt -T -s 1024 -e trace=%desc -C -o ~/desc.log -f -p <span class="variable">$pid</span></span><br></pre></td></tr></table></figure>

<h3 id="Calculated-CPU-usage"><a href="#Calculated-CPU-usage" class="headerlink" title="Calculated CPU usage"></a><a target="_blank" rel="noopener" href="https://github.com/Leo-G/DevopsWiki/wiki/How-Linux-CPU-Usage-Time-and-Percentage-is-calculated">Calculated CPU usage</a></h3><p>cpu usage=(idle2-idle1)/(cpu2-cpu1)*100 # script example<br>cpu usage=[(user_2 +sys_2+nice_2) - (user_1 + sys_1+nice_1)]/(total_2 - total_1)*100</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> cat /proc/<span class="built_in">stat</span></span><br><span class="line">     user nice system idle iowait  irq  softirq steal guest guest_nice</span><br><span class="line">cpu  4705 356  584    3699   23    23     0       0     0          0</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> <span class="comment"># by Paul Colby (http://colby.id.au), no rights reserved ;)</span></span><br><span class="line"></span><br><span class="line"> PREV_TOTAL=0</span><br><span class="line"> PREV_IDLE=0</span><br><span class="line"></span><br><span class="line"> <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">   <span class="comment"># Get the total CPU statistics, discarding the &#x27;cpu &#x27; prefix.</span></span><br><span class="line">   CPU=(`sed -n <span class="string">&#x27;s/^cpu\s//p&#x27;</span> /proc/<span class="built_in">stat</span>`)</span><br><span class="line">   IDLE=<span class="variable">$&#123;CPU[3]&#125;</span> <span class="comment"># Just the idle CPU time.</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Calculate the total CPU time.</span></span><br><span class="line">   TOTAL=0</span><br><span class="line">   <span class="keyword">for</span> VALUE <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;CPU[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">     ((TOTAL=<span class="variable">$TOTAL</span>+<span class="variable">$VALUE</span>))</span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Calculate the CPU usage since we last checked.</span></span><br><span class="line">   ((DIFF_IDLE=<span class="variable">$IDLE</span>-<span class="variable">$PREV_IDLE</span>))</span><br><span class="line">   ((DIFF_TOTAL=<span class="variable">$TOTAL</span>-<span class="variable">$PREV_TOTAL</span>))</span><br><span class="line">    </span><br><span class="line">   <span class="comment">## </span></span><br><span class="line">   DIFF_USAGE=$(awk -v diff_idle=<span class="variable">$DIFF_IDLE</span> -v diff_total=<span class="variable">$DIFF_TOTAL</span> <span class="string">&#x27;BEGIN&#123;printf &quot;%.2f&quot;, (diff_total-diff_idle)/diff_total*100&#125;&#x27;</span>)</span><br><span class="line">   <span class="built_in">echo</span> -en <span class="string">&quot;\rCPU: <span class="variable">$DIFF_USAGE</span>%  \b\b&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Remember the total and idle CPU times for the next check.</span></span><br><span class="line">   PREV_TOTAL=<span class="string">&quot;<span class="variable">$TOTAL</span>&quot;</span></span><br><span class="line">   PREV_IDLE=<span class="string">&quot;<span class="variable">$IDLE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># Wait before checking again.</span></span><br><span class="line">   usleep 100000</span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## the lib messages</span></span><br><span class="line">$ <span class="built_in">read</span>(3, <span class="string">&quot;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\20\273\0\0\0\0\0\0&quot;</span>..., 832) = 832</span><br><span class="line"></span><br><span class="line">$ od -bc /lib/x86_64-linux-gnu/libc.so.6 | head -n4</span><br><span class="line">0000000 177 105 114 106 002 001 001 003 000 000 000 000 000 000 000 000</span><br><span class="line">        177   E   L   F 002 001 001 003  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000020 003 000 076 000 001 000 000 000 260 034 002 000 000 000 000 000</span><br><span class="line">        003  \0   &gt;  \0 001  \0  \0  \0 260 034 002  \0  \0  \0  \0  \0</span><br></pre></td></tr></table></figure>

<h3 id="tuna"><a href="#tuna" class="headerlink" title="tuna"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/2144921">tuna</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check kernel threads</span></span><br><span class="line">$ tuna -U -P</span><br><span class="line">                      thread       ctxt_switches</span><br><span class="line">    pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd</span><br><span class="line">  2      OTHER     0    0xfff 386420266      1048922        kthreadd</span><br><span class="line">  4      OTHER     0        0         7            0    kworker/0:0H</span><br><span class="line">  6      OTHER     0        0   4030025         3019     ksoftirqd/0</span><br><span class="line">  7       FIFO    99        0    155252            0     migration/0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Got the voluntary and nonvoluntary ctxt switch</span></span><br><span class="line"><span class="comment"># pid is the io test app</span></span><br><span class="line">grep ctxt_switches /proc/<span class="variable">$&#123;pid&#125;</span>/status</span><br><span class="line">voluntary_ctxt_switches:        2940930 (I/O bound)</span><br><span class="line">nonvoluntary_ctxt_switches:     9042</span><br><span class="line"></span><br><span class="line"><span class="comment"># 147095 is the cpu test app</span></span><br><span class="line">grep ctxt_switches /proc/147095/status</span><br><span class="line">voluntary_ctxt_switches:	478</span><br><span class="line">nonvoluntary_ctxt_switches:	1565 (CPU bound)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disabling automatic IRQ balancing</span></span><br><span class="line">$ systemctl stop irqbalance.service</span><br><span class="line">$ systemctl <span class="built_in">disable</span> irqbalance.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#  the kernel will automatically try to balance the load based on its understanding of the hardware&#x27;s NUMA layout</span></span><br><span class="line">$  <span class="built_in">echo</span> kernel.numa_balancing=0 &gt;&gt; /etc/sysctl.conf ; sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># Isolating CPUs from the process scheduler</span></span><br><span class="line">This step involves setting isolcpus on the kernel<span class="string">&#x27;s cmdline. This removes cores from the process scheduler that you would like to dedicate to your application, so other userland processes do not migrate to them. Please see this solutions document for more information: https://access.redhat.com/solutions/480473</span></span><br><span class="line"><span class="string">NOTE: kernel threads are not able to be disabled and will always be visible on all cores. In ps -eLf output, these show up in brackets, like [ksoftirqd/0]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ grubby --update-kernel=ALL --add-args=&#x27;</span>isolcpus=1-3,5-31<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Show numa node for dev </span></span><br><span class="line"><span class="string">$ numactl -a -N netdev:em1 grep allowed /proc/self/status</span></span><br><span class="line"><span class="string">Cpus_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000055,55555555</span></span><br><span class="line"><span class="string">Cpus_allowed_list:	0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38</span></span><br><span class="line"><span class="string">Mems_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000003</span></span><br><span class="line"><span class="string">Mems_allowed_list:	0-1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## bind to 0,2,4 cores</span></span><br><span class="line"><span class="string">$ numactl -a -N netdev:em1 -C 0,2,4 grep allowed /proc/self/status</span></span><br><span class="line"><span class="string">Cpus_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000015</span></span><br><span class="line"><span class="string">Cpus_allowed_list:	0,2,4</span></span><br><span class="line"><span class="string">Mems_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000003</span></span><br><span class="line"><span class="string">Mems_allowed_list:	0-1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Here has a question, if you recheck the CPU, The CPUs_allowed_list will go to &quot;0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38&quot; again</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## write the it to systemd service config file</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">...other lines...</span></span><br><span class="line"><span class="string">ExecStart=/bin/numactl -aN netdev:em1 -C 6 /path/to/ptpd</span></span><br><span class="line"><span class="string">...other lines...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## about numactl</span></span><br><span class="line"><span class="string">Instead of a number a node can also be:</span></span><br><span class="line"><span class="string">  netdev:DEV the node connected to network device DEV</span></span><br><span class="line"><span class="string">  file:PATH  the node the block device of path is connected to</span></span><br><span class="line"><span class="string">  ip:HOST    the node of the network device host routes through</span></span><br><span class="line"><span class="string">  block:PATH the node of block device path</span></span><br><span class="line"><span class="string">  pci:[seg:]bus:dev[:func] The node of a PCI device</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Dell H330 IR</span></span><br><span class="line"><span class="string">$ lspci -ttv | grep &quot;MegaRAID SAS-3 3008&quot; -B 1</span></span><br><span class="line"><span class="string"> \-[0000:00]-+-00.0  Intel Corporation Xeon E7 v4/Xeon E5 v4/Xeon E3 v4/Xeon D DMI2</span></span><br><span class="line"><span class="string">             +-01.0-[02]----00.0  LSI Logic / Symbios Logic MegaRAID SAS-3 3008 [Fury]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ls -l /sys/class/block</span></span><br><span class="line"><span class="string">sda -&gt; ../../devices/pci0000:00/0000:00:01.0/0000:02:00.0/host0/target0:0:0/0:0:0:0/block/sda</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CPU ID</span></span><br><span class="line"><span class="string">Zero-based CPU ID	0	1	2	3	4	5	6	7	8	9	10	11	12</span></span><br><span class="line"><span class="string">Decimal Value	1	2	4	8	16	32	64	128	256	512	1024	2048	4096</span></span><br><span class="line"><span class="string">Hexadecimal Value	1	2	4	8	10	20	40	80	100	200	400	800	1000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">printf &#x27;</span>%x %x\n<span class="string">&#x27; 1024 4096</span></span><br><span class="line"><span class="string">400 1000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ awk -F &#x27;</span>[ :]+<span class="string">&#x27; &#x27;</span><span class="variable">$0</span>!~/CPU/ &amp;&amp; <span class="variable">$0</span>~/em1/&#123;<span class="built_in">print</span> <span class="variable">$2</span>&#125;<span class="string">&#x27; /proc/interrupts</span></span><br><span class="line"><span class="string">88</span></span><br><span class="line"><span class="string">90</span></span><br><span class="line"><span class="string">91</span></span><br><span class="line"><span class="string">92</span></span><br><span class="line"><span class="string">93</span></span><br><span class="line"><span class="string">94</span></span><br><span class="line"><span class="string">95</span></span><br><span class="line"><span class="string">96</span></span><br><span class="line"><span class="string">97</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ echo 400 &gt; /proc/irq/88/smp_affinitya</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">$ echo 1000 &gt; /proc/irq/97/smp_affinity</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ seq 88 97 | xargs -I% grep -H . /proc/irq/%/smp_affinity</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h3 id="NFS-client"><a href="#NFS-client" class="headerlink" title="NFS client"></a>NFS client</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options sunrpc tcp_slot_table_entries=128&quot;</span> &gt;&gt; /etc/modprobe.d/sunrpc.conf</span><br><span class="line"><span class="comment"># the value default only 2</span></span><br></pre></td></tr></table></figure>

<h3 id="Monitor"><a href="#Monitor" class="headerlink" title="Monitor"></a>Monitor</h3><h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head</span><br><span class="line">$ ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head</span><br></pre></td></tr></table></figure>

<h3 id="selinux-1"><a href="#selinux-1" class="headerlink" title="selinux"></a>selinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setroubleshoot</span><br></pre></td></tr></table></figure>

<h3 id="handle-overflow-in-jiffies"><a href="#handle-overflow-in-jiffies" class="headerlink" title="handle overflow in jiffies"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8206762/how-does-linux-handle-overflow-in-jiffies">handle overflow in jiffies</a></h3><p>1ms = millisecond<br>1us = microsecond !=ms, microsecond = us<br>1ns = billisecond = nanosecond<br>1ps = picosecond</p>
<p>/usr/src/kernels/$(uname -r)/include/linux/jiffies.h</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">These inlines deal with timer wrapping correctly. You are </span><br><span class="line">strongly encouraged to use them</span><br><span class="line">1. Because people otherwise forget</span><br><span class="line">2. Because <span class="keyword">if</span> the timer wrap changes <span class="keyword">in</span> future you won<span class="string">&#x27;t have to</span></span><br><span class="line"><span class="string">   alter your driver code.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">time_after(a,b) returns true if the time a is after time b.</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>time_before(jiffies, timeout)<br>#define time_before(jiffies, timeout) ((long)(jiffies) - (long)(timeout) &lt; 0)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (time_before(jiffies, timeout)</span><br><span class="line">&#123;</span><br><span class="line">    /* we did not time out, good ... */</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    /* we timed out, error ...*</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,time_before(jiffies,timeout));   </span><br></pre></td></tr></table></figure>


<p>/usr/src/kernels/3.10.0-862.11.6.el7.x86_64/include/generated/autoconf.h</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define CONFIG_HZ 1000</span></span><br></pre></td></tr></table></figure>

<p>/usr/src/kernels/$(uname -r)/include/asm-generic/param.h<br>1GHz=1000,000,000 Hz<br>1 second/1000000000<br>awk ‘BEGIN{printf “%.9f\n”,1/1000000000}’<br>0.000000001 (1ns/Hz system precision)</p>
<p>Linux kenrel CONFIG_HZ = 1000</p>
<p>Tick = 1sec / CONFIG_HZ= 1ms<br>average 1ms with once interrput, 1000 time interrupt in single second</p>
<p>The timer tick is a timer interrupt that is usually generated HZ times per second<br>jiffies means the unit of time</p>
<p>the kernel use some macros prevent an overflow, eg: time_before</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#incldue <span class="meta-string">&lt;linux/jiffies.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> i,j,k</span><br><span class="line">j = jiffies;</span><br><span class="line">i = j + HZ;</span><br><span class="line">k = j + HZ*<span class="number">1000</span>;</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __ASM_GENERIC_PARAM_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __ASM_GENERIC_PARAM_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;uapi/asm-generic/param.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">undef</span> HZ</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> HZ		CONFIG_HZ	<span class="comment">/* Internal kernel timer frequency */</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> USER_HZ	100		<span class="comment">/* some user interfaces are */</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> CLOCKS_PER_SEC	(USER_HZ)       <span class="comment">/* in &quot;ticks&quot; like times() */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* __ASM_GENERIC_PARAM_H */</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Prevent-the-data-be-deleted"><a href="#Prevent-the-data-be-deleted" class="headerlink" title="Prevent the data be deleted"></a>Prevent the data be deleted</h3><p>If you files system support attr</p>
<ul>
<li>: Adds the attribute to the existing attribute of the files.<br>– : Removes the attribute to the existing attribute of the files.<br>= : Keep the existing attributes that the files have.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ chattr +i -R demo</span><br><span class="line">$ rm -rf demo/</span><br><span class="line">rm: cannot remove ‘demo/0’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/1’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/2’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/3’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/4’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/5’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/6’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/7’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/8’: Permission denied</span><br><span class="line">rm: cannot remove ‘demo/9’: Permission denied</span><br><span class="line"></span><br><span class="line">$ lsattr demo/</span><br><span class="line">----i----------- demo/0</span><br><span class="line">----i----------- demo/1</span><br><span class="line">----i----------- demo/2</span><br><span class="line">----i----------- demo/3</span><br><span class="line">----i----------- demo/4</span><br><span class="line">----i----------- demo/5</span><br><span class="line">----i----------- demo/6</span><br><span class="line">----i----------- demo/7</span><br><span class="line">----i----------- demo/8</span><br><span class="line">----i----------- demo/9</span><br><span class="line">$ chattr -i -R demo/</span><br><span class="line">$ rm -f demo/*</span><br><span class="line"></span><br><span class="line"><span class="comment">### could be append</span></span><br><span class="line">$ chattr -R +a demo/</span><br><span class="line">$ <span class="built_in">cd</span> demo/</span><br><span class="line">$ ls</span><br><span class="line">0  1  2  3  4  5  6  7  8  9</span><br><span class="line">$ cat 0</span><br><span class="line">0</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; 0</span><br><span class="line">-bash: 0: Operation not permitted</span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt;&gt; 0</span><br><span class="line">$ cat 0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">$ lsattr 0</span><br><span class="line">-----a---------- 0</span><br><span class="line">$ rm -f 0</span><br><span class="line">rm: cannot remove ‘0’: Operation not permitted</span><br><span class="line"></span><br><span class="line">$ chattr -R -a demo</span><br><span class="line">$ rm -f demo/*</span><br></pre></td></tr></table></figure>

<h3 id="errno"><a href="#errno" class="headerlink" title="errno"></a>errno</h3><p><a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/include/uapi/asm-generic/errno.h">https://github.com/torvalds/linux/blob/master/include/uapi/asm-generic/errno.h</a><br>$ man 3 erron</p>
<h3 id="tc"><a href="#tc" class="headerlink" title="tc"></a><a target="_blank" rel="noopener" href="https://colobu.com/2017/04/21/tc-introduction/">tc</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## fixed delay</span></span><br><span class="line">$ tc qdisc add dev eth0 root netem delay 100ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## fixed delay range 100ms ± 10ms</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 10ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## This causes the added delay to be 100ms ± 10ms with the next random element depending 25% on the last one. This isn&#x27;t true statistical correlation, but an approximation.</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 10ms 25%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 0.1% package loss</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem loss 0.1%</span><br><span class="line"></span><br><span class="line">$ tc qdisc change dev eth0 root netem loss 0.3% 25%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1% duplicate package</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem duplicate 1%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 0.1% randomly modify single bit</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem corrupt 0.1%</span><br><span class="line"></span><br><span class="line"><span class="comment">## out of order, 5,10,15,20,25... package send right now, the others delay 10ms, it &#x27;s fixed, not random</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem gap 5 delay 10ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## out of order randomly, 25% will be transmit, the others will be delay 10ms, next and previos has the 50% relevance ??</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 10ms reorder 25% 50%</span><br><span class="line"></span><br><span class="line"><span class="comment">## delay time range at 100ms ± 75ms, it could cause the package out of order</span></span><br><span class="line">$ tc qdisc change dev eth0 root netem delay 100ms 75ms</span><br><span class="line"></span><br><span class="line"><span class="comment">## flow control </span></span><br><span class="line">$ tc qdisc add dev eth0 root handle 1:0 netem delay 100ms</span><br><span class="line">$ tc qdisc add dev eth0 parent 1:1 handle 10: tbf rate 256kbit buffer 1600 <span class="built_in">limit</span> 3000</span><br><span class="line">$ tc -s qdisc ls dev eth0</span><br></pre></td></tr></table></figure>

<h3 id="VNC"><a href="#VNC" class="headerlink" title="VNC"></a>VNC</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall -y <span class="string">&quot;GNOME Desktop&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#if there is no another data in this file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;exec gnome-session&quot;</span> &gt; ~/.xinitrc</span><br><span class="line"></span><br><span class="line">systemctl is-enabled vncserver@.service</span><br><span class="line">systemctl <span class="built_in">enable</span> vncserver@.service</span><br><span class="line"></span><br><span class="line">systemctl get-default</span><br><span class="line">systemctl set-default multi-user.target</span><br><span class="line"></span><br><span class="line">cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:4.service</span><br><span class="line">vi /etc/systemd/system/vncserver@:4.service <span class="comment">## replace root user to normal user</span></span><br><span class="line">ExecStart=/usr/sbin/runuser -l root -c <span class="string">&quot;/usr/bin/vncserver %i&quot;</span></span><br><span class="line">PIDFile=/root/.vnc/%H%i.pid</span><br><span class="line"></span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">ln -s <span class="string">&#x27;/etc/systemd/system/vncserver@:4.service&#x27;</span> <span class="string">&#x27;/etc/systemd/system/multi-user.target.wants/vncserver@:4.service&#x27;</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vncserver@:4.service</span><br><span class="line">systemctl start vncserver@:4.service</span><br></pre></td></tr></table></figure>

<h3 id="Vncserer-was-runing-but-there-is-no-desktop-in-centos-7"><a href="#Vncserer-was-runing-but-there-is-no-desktop-in-centos-7" class="headerlink" title="Vncserer was runing, but there is no desktop in centos 7"></a>Vncserer was runing, but there is no desktop in centos 7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ yum groupinstall Xfce</span><br><span class="line">$ yum install xorg-x11-twm xterm xorg-x11-xinit </span><br><span class="line">$ chmod  755 ~/.vnc/xstartup</span><br><span class="line">$ cat ~/.vnc/xstartup</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> SESSION_MANAGER</span><br><span class="line"><span class="built_in">unset</span> DBUS_SESSION_BUS_ADDRESS</span><br><span class="line"><span class="built_in">exec</span> startxfce4</span><br></pre></td></tr></table></figure>

<h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p>copy mode<br>ctrl + A + esc, press space, scroll up and select the text you want<br>ctrl + A + c, create a new session, and use vim open a file, press i go to insert mode, and press ctrl + a + ], it will copy all text to vim.</p>
<h3 id="VLC"><a href="#VLC" class="headerlink" title="VLC"></a>VLC</h3><h4 id="Not-show-media-title"><a href="#Not-show-media-title" class="headerlink" title="Not show media title"></a>Not show media title</h4><p><a target="_blank" rel="noopener" href="https://forum.videolan.org/viewtopic.php?t=50202">Same question</a><br>Tools–&gt;Preferences–&gt;Subtitles / OSD–&gt; Show media title on media start (disable it)<br>Tools–&gt;Preferences–&gt;Subtitles / OSD–&gt; Enable on screen display (disable it)</p>
<h4 id="Not-resize-interface"><a href="#Not-resize-interface" class="headerlink" title="Not resize interface"></a>Not resize interface</h4><p><img src="/img/vlc-set1.png"></p>
<h3 id="grub"><a href="#grub" class="headerlink" title="grub"></a>grub</h3><p>CentOS 7 add kernel parameter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">grubby --remove-args=<span class="string">&quot;argX argY&quot;</span> --args=<span class="string">&quot;argA argB&quot;</span> --update-kernel /boot/kernel</span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;scsi_mod.use_blk_mq=y dm_mod.use_blk_mq=y&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## set boot order</span></span><br><span class="line">grubby --default-kernel</span><br><span class="line">grubby --default-index</span><br><span class="line">grubby --set-default /boot/vmlinuz-4.2.0-1.fc23.x86_64</span><br><span class="line">grubby --info=ALL</span><br><span class="line">grubby --info /boot/vmlinuz-4.2.0-1.fc23.x86_64</span><br></pre></td></tr></table></figure>

<p>set default boot</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">grubby --info=ALL</span><br><span class="line">index=0</span><br><span class="line">kernel=/boot/vmlinuz-3.10.0-514.6.1.el7.x86_64</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-3.10.0-514.6.1.el7.x86_64.img</span><br><span class="line">title=CentOS Linux (3.10.0-514.6.1.el7.x86_64) 7 (Core)</span><br><span class="line">index=1</span><br><span class="line">kernel=/boot/vmlinuz-3.10.0-327.el7.x86_64</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-3.10.0-327.el7.x86_64.img</span><br><span class="line">title=CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)</span><br><span class="line">index=2</span><br><span class="line">kernel=/boot/vmlinuz-0-rescue-f614a3c482eb4b21add5ae750b3871bb</span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto rd.md.uuid=cc0432b3:6f6f54bf:c2f2b91b:2978ff6a rhgb quiet &quot;</span></span><br><span class="line">root=UUID=5b0e60cf-adf9-42a0-b6e3-0304b919dc33</span><br><span class="line">initrd=/boot/initramfs-0-rescue-f614a3c482eb4b21add5ae750b3871bb.img</span><br><span class="line">title=CentOS Linux (0-rescue-f614a3c482eb4b21add5ae750b3871bb) 7 (Core)</span><br><span class="line">index=3</span><br><span class="line">non linux entry</span><br><span class="line"></span><br><span class="line">grubby --set-default /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64</span><br><span class="line">grubby --info /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64</span><br></pre></td></tr></table></figure>

<h3 id="set-debug-parameters"><a href="#set-debug-parameters" class="headerlink" title="set debug parameters"></a>set debug parameters</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grubby --update-kernel=ALL --args=<span class="string">&#x27;rd.debug rdudevdebug systemd.log_level=debug systemd.log_target=console console=ttyS1,115200n8&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h3><h4 id="nolock"><a href="#nolock" class="headerlink" title="nolock"></a><a target="_blank" rel="noopener" href="https://linux.die.net/man/5/nfs">nolock</a></h4><p>NLM locking is used for this mount point. When using the nolock option, applications can lock files, but such locks provide exclusion only against other applications running on the same client. Remote applications are not affected by these locks.</p>
<h4 id="file-lock"><a href="#file-lock" class="headerlink" title="file lock"></a><a target="_blank" rel="noopener" href="https://docstore.mik.ua/orelly/networking_2ndEd/nfs/ch11_02.htm">file lock</a></h4><p>The NFS (Versions 2 and 3) protocol does not support file locking, but the NFS environment supports an ancillary protocol called NLM, which originally stood for “Network Lock Manager.” When an NFS filesystem on an NFS client gets a request to lock a file, instead of an NFS remote procedure call, it generates an NLM remote procedure call.</p>
<p>The NLM protocol consists of remote procedure calls that pattern fcntl arguments and results. Because blocking locks are supported (a process blocks waiting for a lock that conflicts with another holder), the NLM protocol has the notion of callbacks, from the file server to the NLM client to notify that a lock is available. In this way, the NLM client sometimes acts as an RPC server in order to receive delayed results from lock calls.</p>
<h3 id="How-could-I-found-which-file-cause-pipe-hang"><a href="#How-could-I-found-which-file-cause-pipe-hang" class="headerlink" title="How could I found which file cause pipe hang"></a>How could I found which file cause pipe hang</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ cat /dev/zero | tee /tank/the_file</span><br><span class="line">$ ps aux | grep 63488</span><br><span class="line">root      63488  5.2  0.0 107972   676 pts/9    S+   04:32   0:19 cat /dev/zero</span><br><span class="line"></span><br><span class="line">$ strace -p 63488</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536) = 65536</span><br><span class="line">write(1, <span class="string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536) = 65536</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536) = 65536</span><br><span class="line">write(1, <span class="string">&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>..., 65536</span><br><span class="line">strace: Process 63488 detached</span><br><span class="line"></span><br><span class="line">$ ls -l /proc/63488/fd</span><br><span class="line">total 0</span><br><span class="line">lrwx------ 1 root root 64 Mar 21 04:33 0 -&gt; /dev/pts/9</span><br><span class="line">l-wx------ 1 root root 64 Mar 21 04:33 1 -&gt; pipe:[36710085]</span><br><span class="line">lrwx------ 1 root root 64 Mar 21 04:32 2 -&gt; /dev/pts/9</span><br><span class="line">lr-x------ 1 root root 64 Mar 21 04:33 3 -&gt; /dev/zero</span><br><span class="line">$ lsof | grep 36710085</span><br><span class="line">cat        63488           root    1w     FIFO                0,9         0t0   36710085 pipe</span><br><span class="line">tee        63489           root    0r     FIFO                0,9         0t0   36710085 pipe</span><br><span class="line">$ ls -l /proc/63489/fd</span><br><span class="line">total 0</span><br><span class="line">lr-x------ 1 root root 64 Mar 21 04:33 0 -&gt; pipe:[36710085]</span><br><span class="line">lrwx------ 1 root root 64 Mar 21 04:33 1 -&gt; /dev/pts/9</span><br><span class="line">lrwx------ 1 root root 64 Mar 21 04:32 2 -&gt; /dev/pts/9</span><br><span class="line">l-wx------ 1 root root 64 Mar 21 04:33 3 -&gt; /tank/the_file</span><br></pre></td></tr></table></figure>
<h4 id="If-pipe-change-to-socket"><a href="#If-pipe-change-to-socket" class="headerlink" title="If pipe change to socket"></a>If pipe change to socket</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ ll /proc/333709/fd</span><br><span class="line">total 0</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 0 -&gt; /dev/null</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 1 -&gt; /dev/null</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 10 -&gt; socket:[326105]</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 11 -&gt; socket:[326106]</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 2 -&gt; /dev/null</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 3 -&gt; socket:[304292]</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 4 -&gt; socket:[304294]</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 5 -&gt; socket:[304295]</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 6 -&gt; socket:[304296]</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 7 -&gt; socket:[304297]</span><br><span class="line">lr-x------ 1 root root 64 Mar 20 03:24 8 -&gt; /run/rpcbind.lock</span><br><span class="line">lrwx------ 1 root root 64 Mar 20 03:24 9 -&gt; socket:[334786]</span><br><span class="line"></span><br><span class="line"><span class="comment">#304294 is inode</span></span><br><span class="line"></span><br><span class="line">$ cat /proc/net/tcp | grep -Ei <span class="string">&#x27;local_address|304294&#x27;</span></span><br><span class="line">sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode</span><br><span class="line">8: 00000000:006F 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 304294 1 ffff9ac0e2f8be00 100 0 0 10 0</span><br></pre></td></tr></table></figure>

<h3 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n -i eth0 -A -x dst port 443 and greater 100</span><br><span class="line">$ tcpdump -i eth0 -nt -s 500 port 53 and udp</span><br></pre></td></tr></table></figure>

<h3 id="calculate-upload-download-speed-by-ping"><a href="#calculate-upload-download-speed-by-ping" class="headerlink" title="calculate upload/download speed by ping"></a><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/4575537/calculate-upload-download-speed-by-ping">calculate upload/download speed by ping</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ping -f -c 10000 -s 1472 10.100.100.100</span><br></pre></td></tr></table></figure>
<p>At the end of the result i get: round-trip min/avg/max/stddev = 0.174/0.219/2.078/0.020 ms<br>so in average it takes 0.219 ms to send 1500 bytes and receive 1500 bytes, that’s 24 kb. 24 kb / 0.219 ms = 110 Mb/s<br>If you want to use that to a server on the internet, you need to lower the packet size to something like 1464 (for MTU 1492), drop the -f option and lower the count so it won’t take too long to finish.</p>
<p>1500 TX Bytes + 1500 RX Bytes= 3000 Bytes = 3000 * 8 = 24000 bits<br>24000 / 0.219 = 109.589 Mb/s</p>
<p>It ‘s not represent full throughput. just test single link in your ethernet adapter. not parallel.</p>
<h3 id="MTU-problem-check"><a href="#MTU-problem-check" class="headerlink" title="MTU problem check"></a>MTU problem check</h3><p>Level 3 network, between 2 nodes pass through gateway<br>Tcpdump show some packets loss, nmap show 10.xx.xx.clent port is “open”.<br>There are some packages return, some will not. Does it MTU problem ? ping could check it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ traceroute 10.xx.xx.client</span><br><span class="line">traceroute to 10.xx.xx.client (10.xx.xx.client), 30 hops max, 60 byte packets</span><br><span class="line"> 1  10.10.xx.gateway (10.10.xx.gateway)  2.239 ms  1.901 ms  2.080 ms</span><br><span class="line"> 2  10.xx.xx.client (10.xx.xx.client)  0.606 ms  0.584 ms  0.592 ms</span><br><span class="line">$ traceroute 10.xx.xx.client</span><br><span class="line">traceroute to 10.xx.xx.client (10.xx.xx.client), 30 hops max, 60 byte packets</span><br><span class="line"> 1  10.10.xx.gateway (10.10.xx.gateway)  1.881 ms  2.085 ms  2.245 ms</span><br><span class="line"> 2  10.xx.xx.client (10.xx.xx.client)  0.563 ms * *</span><br><span class="line"></span><br><span class="line">$ ping -f -c 20000 -M <span class="keyword">do</span> -s 8972 10.xx.xx.client</span><br><span class="line">PING 10.xx.xx.client (10.xx.xx.client) 8972(9000) bytes of data.</span><br><span class="line">...................................................................^C</span><br><span class="line">--- 10.xx.xx.client ping statistics ---</span><br><span class="line">67 packets transmitted, 0 received, 100% packet loss, time 1076ms</span><br></pre></td></tr></table></figure>
<p>You can got the issue from tcpdump, all larger than 1500 packets are loss.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">client <span class="comment"># tcpdump -v host 10.53.19.52 and greater 1500</span></span><br><span class="line">tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 65535 bytes</span><br><span class="line">11:23:58.134708 IP (tos 0x0, ttl 63, id 27071, offset 0, flags [DF], proto TCP (6), length 8532)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], cksum 0x496d (incorrect -&gt; 0x5fe6), seq 2359537411:2359545891, ack 3804990367, win 53, options [nop,nop,TS val 1203816317 ecr 81802289], length 8480</span><br><span class="line">11:23:58.136045 IP (tos 0x0, ttl 63, id 27077, offset 0, flags [DF], proto TCP (6), length 7292)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [.], cksum 0x4495 (incorrect -&gt; 0xe386), seq 8480:15720, ack 1, win 53, options [nop,nop,TS val 1203816318 ecr 81802294], length 7240</span><br><span class="line">11:23:58.148023 IP (tos 0x0, ttl 63, id 27083, offset 0, flags [DF], proto TCP (6), length 8588)</span><br><span class="line">    10.53.19.52.988 &gt; test-57-21.exp2: Flags [P.], cksum 0x49a5 (incorrect -&gt; 0x4006), seq 17016:25552, ack 1, win 53, options [nop,nop,TS val 1203816330 ecr 81802295], length 8536</span><br></pre></td></tr></table></figure>
<p>If client MTU is 1500, tcpdump(client) will not receive any large packages. they are loss in switch.</p>
<h3 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h3><h4 id="Exclude-packages"><a href="#Exclude-packages" class="headerlink" title="Exclude packages"></a>Exclude packages</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum update --exclude=kernel*</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span></span><br><span class="line">keepcache=0</span><br><span class="line">debuglevel=2</span><br><span class="line">logfile=/var/<span class="built_in">log</span>/yum.log</span><br><span class="line">exclude=kernel* redhat-release* *.i?86</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10185">reference</a></p>
<h4 id="Switch-version"><a href="#Switch-version" class="headerlink" title="Switch version"></a>Switch version</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ yum --showduplicates list kernel</span><br><span class="line">Installed Packages</span><br><span class="line">Installed Packages</span><br><span class="line">kernel.x86_64       2.6.32-573.el6       @anaconda-CentOS-201508042137.x86_64/6.7</span><br><span class="line">kernel.x86_64       2.6.32-573.8.1.el6   @update                                 </span><br><span class="line">Available Packages</span><br><span class="line">kernel.x86_64       2.6.32-573.el6       base                                    </span><br><span class="line">kernel.x86_64       2.6.32-573.1.1.el6   update                                  </span><br><span class="line">kernel.x86_64       2.6.32-573.3.1.el6   update                                  </span><br><span class="line">kernel.x86_64       2.6.32-573.7.1.el6   update                                  </span><br><span class="line">kernel.x86_64       2.6.32-573.8.1.el6   update                                  </span><br><span class="line">kernel.x86_64       2.6.32-573.12.1.el6  update                                  </span><br><span class="line">kernel.x86_64       2.6.32-573.18.1.el6  update  </span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">#### Yum.conf</span></span><br><span class="line">```apacheconf</span><br><span class="line">keepcache = 1</span><br></pre></td></tr></table></figure>

<h4 id="Download-to-local"><a href="#Download-to-local" class="headerlink" title="Download to local"></a>Download to local</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">yum</span> <span class="string">-y</span> <span class="string">install</span> <span class="string">yum-plugin-downloadonly</span></span><br><span class="line"><span class="string">$</span> <span class="string">yum</span> <span class="string">install</span> <span class="string">--downloadonly</span> <span class="string">--downloaddir=&lt;directory&gt;</span> <span class="string">&lt;package&gt;</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/10154">reference</a></p>
<h4 id="Resolve-dependency-resolution-errors"><a href="#Resolve-dependency-resolution-errors" class="headerlink" title="Resolve dependency resolution errors"></a>Resolve dependency resolution errors</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum update</span></span><br><span class="line">** Found 5 pre-existing rpmdb problem(s), <span class="string">&#x27;yum check&#x27;</span> output follows:</span><br><span class="line">MegaCli-8.04.10-1.noarch is a duplicate with MegaCli-8.04.07-1.noarch</span><br><span class="line">kernel-2.6.32-279.5.1.el6_lustre.gb16fe80.x86_64 has missing requires of kernel-firmware &gt;= (<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2.6.32&#x27;</span>, <span class="string">&#x27;279.5.1.el6_lustre.gb16fe80&#x27;</span>)</span><br><span class="line">kernel-firmware-2.6.32-279.5.1.el6.noarch is a duplicate with kernel-firmware-2.6.32-279.el6.noarch</span><br><span class="line">kernel-headers-2.6.32-279.5.1.el6.x86_64 is a duplicate with kernel-headers-2.6.32-279.el6.x86_64</span><br><span class="line">libcom_err-1.42.3.wc3-7.el6.x86_64 is a duplicate with libcom_err-1.41.12-12.el6.i686</span><br><span class="line">......</span><br><span class="line">You could try using --skip-broken to work around the problem</span><br><span class="line">You could try running: rpm -Va --nofiles --nodigest</span><br></pre></td></tr></table></figure>

<h4 id="Uninstall-rpm-packages-from-rpmdb"><a href="#Uninstall-rpm-packages-from-rpmdb" class="headerlink" title="Uninstall rpm packages from rpmdb"></a>Uninstall rpm packages from rpmdb</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -e --justdb --nodeps <span class="string">&quot;bad rpm packages&quot;</span></span><br><span class="line">$ rpm -ivh --force <span class="string">&quot;replace normal rpm packages&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rebuild rpmdb</span></span><br><span class="line">$ <span class="built_in">cd</span> /var/lib/rpm</span><br><span class="line">$ rm  -f __db*</span><br><span class="line">$ rpm --rebuilddb </span><br><span class="line"></span><br><span class="line">$ yum clean all</span><br><span class="line">$ yum -y update</span><br></pre></td></tr></table></figure>

<h3 id="upgrade-kernel"><a href="#upgrade-kernel" class="headerlink" title="upgrade kernel"></a>upgrade kernel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://sourceware.org/elfutils/ftp/0.170/elfutils-0.170.tar.bz2</span><br><span class="line">$ tar xjvf elfutils-0.170.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> ./elfutils-0.170</span><br><span class="line">$ ./configire; make -j 8; make install</span><br><span class="line">$ <span class="built_in">export</span> C_INCLUDE_PATH=/sources/kernel/elfutils-0.170/libelf:/sources/lib/el7/mpich-3.2.1/include/:<span class="variable">$C_INCLUDE_PATH</span></span><br><span class="line">$ cp -v /boot/config-3.10.0-693.21.1.el7.x86_64 .config</span><br><span class="line">make menuconfig</span><br><span class="line">make rpm-pkg</span><br><span class="line"><span class="comment">### enable what your want</span></span><br></pre></td></tr></table></figure>

<h4 id="BBR"><a href="#BBR" class="headerlink" title="BBR"></a>BBR</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;net.core.default_qdisc=fq&#x27;</span> | sudo tee -a /etc/sysctl.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.tcp_congestion_control=bbr&#x27;</span> | sudo tee -a /etc/sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br><span class="line"></span><br><span class="line">$ sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">net.ipv4.tcp_available_congestion_control = cubic bbr reno</span><br><span class="line"></span><br><span class="line">$ sysctl -n net.ipv4.tcp_congestion_control</span><br><span class="line">bbr</span><br></pre></td></tr></table></figure>

<h3 id="reinstall-grub2-from-boot-livecd"><a href="#reinstall-grub2-from-boot-livecd" class="headerlink" title="reinstall grub2 from boot livecd"></a>reinstall grub2 from boot livecd</h3><p>/dev/sdd2 is my linux root partition, OS is pinguyos(ubuntu)</p>
<h4 id="LVM-partition"><a href="#LVM-partition" class="headerlink" title="LVM partition"></a>LVM partition</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vgscan</span><br><span class="line">$ lvscan</span><br><span class="line">$ lvchange -a y /dev/centos_vg/lv_root</span><br></pre></td></tr></table></figure>

<h4 id="Test-in-ubuntu"><a href="#Test-in-ubuntu" class="headerlink" title="Test in ubuntu"></a>Test in ubuntu</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdd2 /opt</span><br><span class="line">mount --<span class="built_in">bind</span> /dev/ /opt/dev</span><br><span class="line">mount --<span class="built_in">bind</span> /sys/ /opt/sys</span><br><span class="line">mount --<span class="built_in">bind</span> /proc /opt/proc</span><br><span class="line">chroot /opt</span><br><span class="line">grub-install /dev/sdd</span><br><span class="line">grub-install --root-directory=/mnt/sysimages/boot/efi /dev/sdd</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<h4 id="Test-in-CentOS-7-set-boot-menu"><a href="#Test-in-CentOS-7-set-boot-menu" class="headerlink" title="Test in CentOS 7, set boot menu"></a>Test in CentOS 7, set boot menu</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat   /boot/grub2/grub.cfg | grep Windows</span><br><span class="line">menuentry <span class="string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span></span><br><span class="line">grub2-set-default  <span class="string">&quot;Windows 7 (loader) (on /dev/sda1)&quot;</span></span><br><span class="line">grub2-editenv list</span><br><span class="line">saved_entry=Windows 7 (loader) (on /dev/sda1)</span><br><span class="line">or </span><br><span class="line">grub2-set-default <span class="string">&quot;windows&quot;</span></span><br><span class="line"></span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.conf</span><br></pre></td></tr></table></figure>

<h4 id="Re-install-EFI"><a href="#Re-install-EFI" class="headerlink" title="Re-install EFI"></a>Re-install EFI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /opt/boot /opt/root</span><br><span class="line">$ mount /dev/sda1 /opt/root</span><br><span class="line">$ mount /dev/sda2 /opt/root/boot/efi</span><br><span class="line"></span><br><span class="line">$ mount --<span class="built_in">bind</span> /dev/ /opt/dev</span><br><span class="line">$ mount --<span class="built_in">bind</span> /sys/ /opt/sys</span><br><span class="line">$ mount --<span class="built_in">bind</span> /proc /opt/proc</span><br><span class="line"></span><br><span class="line">$ chroot /opt</span><br><span class="line"></span><br><span class="line">$ grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</span><br><span class="line">$ yum install grub2-efi</span><br><span class="line">$ efibootmgr -c --disk /dev/sda --part 2 -l <span class="string">&#x27;\EFI\centos\shimx64.efi&#x27;</span> -L <span class="string">&quot;CentOS Linux&quot;</span>    </span><br><span class="line">// --part 2 point EFI partition number,-l \\EFI\\FEDORA\\GRUBX64.EFI point the GRUB EFI boot loader</span><br></pre></td></tr></table></figure>

<h3 id="rdesktop-to-win10"><a href="#rdesktop-to-win10" class="headerlink" title="rdesktop to win10"></a>rdesktop to win10</h3><h4 id="Enable-remote-desktop"><a href="#Enable-remote-desktop" class="headerlink" title="Enable remote desktop"></a>Enable remote desktop</h4><p><img src="/img/e_desktop.png"><br><img src="/img/e_firewall.png"></p>
<h4 id="Modify-registry-from-win10"><a href="#Modify-registry-from-win10" class="headerlink" title="Modify registry from win10"></a>Modify registry from win10</h4><p>\HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\SecurityLayer<br>from DWORD Hex ‘2’ to a value of ‘1’</p>
<p><a target="_blank" rel="noopener" href="http://ubuntuforums.org/showthread.php?t=2287213">reference</a></p>
<h3 id="record-and-replay-linux-terminal"><a href="#record-and-replay-linux-terminal" class="headerlink" title="record and replay linux terminal"></a>record and replay linux terminal</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ script --timing=time.txt script.log</span><br><span class="line"><span class="comment"># record what you do</span></span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ scriptreplay --timing=time.txt script.log</span><br><span class="line"><span class="comment"># replay</span></span><br></pre></td></tr></table></figure>

<h3 id="traceroute-error"><a href="#traceroute-error" class="headerlink" title="traceroute error"></a><a target="_blank" rel="noopener" href="https://www.ibm.com/support/knowledgecenter/TI0003M/p8hcg/p8hcg_traceroute.htm">traceroute error</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">!H</span><br><span class="line">Host unreachable</span><br><span class="line">!N</span><br><span class="line">Network unreachable</span><br><span class="line">!P</span><br><span class="line">Protocol unreachable</span><br><span class="line">!S</span><br><span class="line">Source route failed</span><br><span class="line">!F</span><br><span class="line">Fragmentation needed</span><br></pre></td></tr></table></figure>

<h3 id="Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable"><a href="#Getting-Error-su-cannot-set-user-id-Resource-temporarily-unavailable" class="headerlink" title="Getting Error su: cannot set user id: Resource temporarily unavailable"></a>Getting Error su: cannot set user id: Resource temporarily unavailable</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ulimit -u </span><br><span class="line">1024</span><br><span class="line"></span><br><span class="line">$ ulimit -u 10240</span><br><span class="line"></span><br><span class="line">$ &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line">testuser         -      nproc          10240</span><br><span class="line"></span><br><span class="line">$ cat &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;threads-max</span><br><span class="line">1026188</span><br></pre></td></tr></table></figure>

<h3 id="lshw"><a href="#lshw" class="headerlink" title="lshw"></a>lshw</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lshw -c network -businfo</span><br><span class="line">Bus info          Device      Class          Description</span><br><span class="line">========================================================</span><br><span class="line">pci@0000:04:00.0  em1         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe</span><br><span class="line">pci@0000:04:00.1  em2         network        NetXtreme BCM5720 2-port Gigabit Ethernet PCIe</span><br><span class="line">pci@0000:65:00.0  p2p1        network        Ethernet 10G 2P X520 Adapter</span><br><span class="line">pci@0000:65:00.1  p2p2        network        Ethernet 10G 2P X520 Adapter</span><br><span class="line">                  bond0       network        Ethernet interface</span><br></pre></td></tr></table></figure>

<h3 id="CentOS8"><a href="#CentOS8" class="headerlink" title="CentOS8"></a>CentOS8</h3><h4 id="bonding"><a href="#bonding" class="headerlink" title="bonding"></a>bonding</h4><p>Because my ansible was generate the config file in network-scripts, but restart NetworkManger centos 8 not work.<br>I got the compatible mode.</p>
<p>Load the config same with centos 7, after loading, it will work in centos 8<br>Please don’t add “NM_CONTROLLED=no”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f0</span><br><span class="line">$ nmcli connection load /etc/sysconfig/network-scripts/ifcfg-enp1s0f1</span><br><span class="line">$ nmcli connection reload</span><br></pre></td></tr></table></figure>

<h3 id="fio-test-multiple-nodes"><a href="#fio-test-multiple-nodes" class="headerlink" title="fio test multiple nodes"></a>fio test multiple nodes</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ fio --server</span><br><span class="line"><span class="comment">## start fio process in each test server</span></span><br><span class="line"></span><br><span class="line">$ cat fio-test</span><br><span class="line">Server-A-ip</span><br><span class="line">Server-B-ip</span><br><span class="line">Server-C-ip</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ fio --client=fio_hosts.list /mnt/fio.cfg</span><br><span class="line"></span><br><span class="line">All clients: (groupid=0, <span class="built_in">jobs</span>=8): err= 0: pid=0: Fri Mar  6 17:08:04 2020</span><br><span class="line">   <span class="built_in">read</span>: IOPS=1147, BW=1148Mi (1203M)(1011GiB/902172msec)</span><br><span class="line">    slat (nsec): min=58, max=368519, avg=450.92, stdev=799.19</span><br><span class="line">    clat (usec): min=1355, max=4778.4k, avg=58198.62, stdev=114448.04</span><br><span class="line">     lat (usec): min=1356, max=4778.4k, avg=58199.07, stdev=114448.07</span><br><span class="line">   bw (  KiB/s): min= 2043, max=2654208, per=12.74%, avg=149910.02, stdev=178032.72, samples=14109</span><br><span class="line">   iops        : min=    1, max= 2592, avg=146.33, stdev=173.87, samples=14109</span><br><span class="line">  write: IOPS=1146, BW=1146Mi (1202M)(1010GiB/902172msec)</span><br><span class="line">    slat (nsec): min=162, max=916488, avg=799.05, stdev=783.74</span><br><span class="line">    clat (usec): min=1345, max=3839.9k, avg=52775.15, stdev=105530.38</span><br><span class="line">     lat (usec): min=1346, max=3839.9k, avg=52775.95, stdev=105530.41</span><br></pre></td></tr></table></figure>

<h3 id="Permission"><a href="#Permission" class="headerlink" title="Permission"></a>Permission</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">SUID (Set owner User ID up on execution)</span><br><span class="line">chmod 4555/u+s /<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">ls -l /usr/bin/passwd  /etc/shadow</span><br><span class="line">----------  1 root root  1005 Feb 14 14:15 /etc/shadow</span><br><span class="line">-rwsr-xr-x. 1 root root 27856 Aug  9  2019 /usr/bin/passwd</span><br><span class="line"></span><br><span class="line">SUID is defined as giving temporary permissions to a user to run a program/file with the permissions of the file owner rather that the user who runs it</span><br><span class="line"></span><br><span class="line">SGID</span><br><span class="line">chmod 2555/g+s /dir </span><br><span class="line">similar with SUID, it <span class="string">&#x27;s the group bit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Sticky Bit</span></span><br><span class="line"><span class="string">chmod 1777/chmod +t /tmp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- T refers to when the execute permissions are off.</span></span><br><span class="line"><span class="string">- t refers to when the execute permissions are on.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The sticky bit is primarily used on shared directories. </span></span><br><span class="line"><span class="string">[For example if user bob creates a file named /tmp/bob, other user tom can not delete this file even when the /tmp directory has permission of 777. If sticky bit is not set then tom can delete /tmp/bob, as the /tmp/bob file inherits the parent directory permissions.](https://www.thegeekdiary.com/what-is-suid-sgid-and-sticky-bit/)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### set time</span></span><br><span class="line"><span class="string">#### back access time</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">$ atime=$(stat -c%X $filename)</span></span><br><span class="line"><span class="string">$ touch -a --date=@$&#123;atime&#125; $newpath</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ mtime=$(stat -c%Z $filename)</span></span><br><span class="line"><span class="string">$ touch -m --date=@$&#123;mtime&#125; $newpath</span></span><br></pre></td></tr></table></figure>

<h3 id="screen-1"><a href="#screen-1" class="headerlink" title="screen"></a>screen</h3><p>background run command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;screen -dmS collectl su -s /bin/bash nobody -c &quot;</span>\<span class="string">&#x27;&quot;collectl --export graphite,$ip,d=2 -i60 -s CMDN --netfilt &quot;\&quot;&quot;eth|en|p[0-9]|em&quot;\&quot;&quot; --dskfilt &quot;\&quot;&quot;nvme|sd&quot;\&quot;\&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Add-systemd-service"><a href="#Add-systemd-service" class="headerlink" title="Add systemd service"></a>Add systemd service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/etc/systemd/system/apm.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Local system resume actions</span><br><span class="line">After=suspend.target hybrid-sleep.target hibernate.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/hdparm -B 254 /dev/sda</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sleep.target</span><br></pre></td></tr></table></figure>

<h3 id="route-config"><a href="#route-config" class="headerlink" title="route config"></a>route config</h3><h4 id="static-route"><a href="#static-route" class="headerlink" title="static route"></a>static route</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">subnet mask could be</span><br><span class="line">01011000  255.255.255.88</span><br><span class="line"></span><br><span class="line">just recommend against using noncontiguous subnet masks.</span><br><span class="line"></span><br><span class="line">cat /etc/sysconfig/network-scripts/route-em1</span><br><span class="line">ADDRESS0=10.64.0.0</span><br><span class="line">NETMASK0=255.240.0.0</span><br><span class="line">GATEWAY0=192.168</span><br><span class="line">ADDRESS1=10.200.0.0</span><br><span class="line">NETMASK1=255.252.0.0</span><br><span class="line">GATEWAY1=10.64.64.247</span><br><span class="line">ADDRESS2=10.236.0.0</span><br><span class="line">NETMASK2=255.255.0.0</span><br><span class="line">GATEWAY2=10.64.64.247</span><br></pre></td></tr></table></figure>

<h3 id="Check-NIC-driver-err"><a href="#Check-NIC-driver-err" class="headerlink" title="Check NIC driver err"></a>Check NIC driver err</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ethtool -S enp129s0f0 | grep -Ei <span class="string">&#x27;fail|crc|dis|drop|miss|err|over|timeout|jabb&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="collectl"><a href="#collectl" class="headerlink" title="collectl"></a>collectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ collectl --top iokb</span><br><span class="line">$ collectl --vmstat</span><br><span class="line">$ collectl -sZ</span><br><span class="line">$ collectl -c10 -f /opt</span><br><span class="line">$ collectl -m -p /var/<span class="built_in">log</span>/collectl/2daygeek-20170105-150152.raw.gz -oT</span><br><span class="line">$ collectl -m -p /var/<span class="built_in">log</span>/collectl/2daygeek-20170105-150152.raw.gz -oT --from 15:02:00 --thru 15:02:05</span><br><span class="line">$ collectl --showoptions</span><br><span class="line">$ collectl --showsubsys</span><br><span class="line">$ collectl --showsubopts</span><br><span class="line">$ collectl --showtopopts</span><br></pre></td></tr></table></figure>

<h3 id="process-mointor"><a href="#process-mointor" class="headerlink" title="process mointor"></a>process mointor</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ pstree -sg 25153 # get process tree</span><br><span class="line">systemd(1)───sshd(3266)───sshd(32704)───hydra_pmi_proxy(32706)───test.sh(32725)</span><br><span class="line"></span><br><span class="line">$ pstree -sga 32725</span><br><span class="line">systemd,1 --switched-root --system --deserialize 22</span><br><span class="line">  └─sshd,3266 -D</span><br><span class="line">      └─sshd,32704</span><br><span class="line">          └─hydra_pmi_proxy,32706 --control-port centos7-test:38001 --rmk user --launcher ssh --demux poll --pgid 0 --retries 10--u</span><br><span class="line">              └─test.sh,32725 &#x2F;root&#x2F;test.sh &#x2F;mnt</span><br><span class="line"></span><br><span class="line">$ pidstat -drsuw</span><br><span class="line">    * CPU utilization</span><br><span class="line">    * IO</span><br><span class="line">    * page faults and memory utilization</span><br><span class="line">    * stack utilization</span><br><span class="line">    * task switching</span><br><span class="line">$ collectl -i:1 -sZ --procopts wt --procfilt p$pid -oT</span><br><span class="line">$ collectl -i:1 -sZ --procopts wt --procfilt u$uid -oT</span><br><span class="line"></span><br><span class="line">$ iotop -b -n1 -o -P</span><br><span class="line"></span><br><span class="line">$ atop -d -c -PPRD 1 1  | sort -nr -k 13 -k 15  | head</span><br><span class="line">                                                                           reads    read sec     writes write sec(512B)</span><br><span class="line">PRD kvm-manager-a23-1 1585239068 2020&#x2F;03&#x2F;27 00:11:08 4256 4006 (bash) S n y 1758081744 1758081744 64      64              48 4006 n y</span><br><span class="line">last line &#39;y&#39; means not thread</span><br><span class="line"></span><br><span class="line">$ atop -d -c -PPRD 1 1  | awk &#39;NF&gt;10 &#123;if($(NF-6)+$(NF-4)&gt;120000) &#123;if($NF&#x3D;&#x3D;&quot;y&quot;) print $0&#125;&#125;&#39; </span><br><span class="line"># show the proc&#x2F;thread read or write &gt; 60MB</span><br></pre></td></tr></table></figure>

<h3 id="time"><a href="#time" class="headerlink" title="time"></a>time</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time -f <span class="string">&quot;%E real,%U user,%S sys&quot;</span> sleep 2</span><br><span class="line">0:02.00 real,0.00 user,0.00 sys</span><br><span class="line"></span><br><span class="line">$ /usr/bin/time -f <span class="string">&quot;%e real&quot;</span> sleep 70</span><br><span class="line">70.00 real</span><br></pre></td></tr></table></figure>

<h3 id="youtube-download"><a href="#youtube-download" class="headerlink" title="youtube download"></a>youtube download</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ proxychains4 youtube-dl -F https://www.youtube.com/watch?v=_xxxxxx</span><br><span class="line">[info] Available formats <span class="keyword">for</span> _12OJxATpsA:</span><br><span class="line">format code  extension  resolution note</span><br><span class="line">249          webm       audio only tiny   62k , opus @ 50k (48000Hz), 51.86MiB</span><br><span class="line">250          webm       audio only tiny   81k , opus @ 70k (48000Hz), 68.24MiB</span><br><span class="line">140          m4a        audio only tiny  136k , m4a_dash container, mp4a.40.2@128k (44100Hz), 139.88MiB</span><br><span class="line">251          webm       audio only tiny  158k , opus @160k (48000Hz), 136.13MiB</span><br><span class="line">278          webm       256x144    144p  103k , webm container, vp9, 30fps, video only, 100.43MiB</span><br><span class="line">160          mp4        256x144    144p  115k , avc1.4d400c, 30fps, video only, 83.46MiB</span><br><span class="line">242          webm       426x240    240p  250k , vp9, 30fps, video only, 202.66MiB</span><br><span class="line">133          mp4        426x240    240p  257k , avc1.4d4015, 30fps, video only, 168.64MiB</span><br><span class="line">243          webm       640x360    360p  611k , vp9, 30fps, video only, 377.13MiB</span><br><span class="line">134          mp4        640x360    360p  665k , avc1.4d401e, 30fps, video only, 442.58MiB</span><br><span class="line">244          webm       854x480    480p 1052k , vp9, 30fps, video only, 677.08MiB</span><br><span class="line">135          mp4        854x480    480p 1343k , avc1.4d401f, 30fps, video only, 868.67MiB</span><br><span class="line">247          webm       1280x720   720p 2410k , vp9, 30fps, video only, 1.35GiB</span><br><span class="line">136          mp4        1280x720   720p 2678k , avc1.4d401f, 30fps, video only, 1.66GiB</span><br><span class="line">248          webm       1920x1080  1080p 4356k , vp9, 30fps, video only, 2.42GiB</span><br><span class="line">137          mp4        1920x1080  1080p 4525k , avc1.640028, 30fps, video only, 3.06GiB</span><br><span class="line">271          webm       2560x1440  1440p 9330k , vp9, 30fps, video only, 7.15GiB</span><br><span class="line">18           mp4        640x360    360p  622k , avc1.42001E, mp4a.40.2@ 96k (44100Hz), 685.04MiB</span><br><span class="line">22           mp4        1280x720   720p 1673k , avc1.64001F, mp4a.40.2@192k (44100Hz) (best)</span><br><span class="line"></span><br><span class="line">$ proxychains4 youtube-dl -f 137+bestaudio --merge-output-format mkv https://www.youtube.com/watch?v=_xxxxxx</span><br></pre></td></tr></table></figure>

<h3 id="uptime-and-vmstat-running"><a href="#uptime-and-vmstat-running" class="headerlink" title="uptime and vmstat running"></a>uptime and vmstat running</h3><ul>
<li><p>(uptime) number of processes that are either in a runnable or uninterruptable state.</p>
<ul>
<li>runnable state is either using the CPU or waiting to use the  CPU. <ul>
<li>A process in uninterruptable state is waiting for some I/O access.</li>
</ul>
</li>
</ul>
</li>
<li><p>(vmstat) Procs r: The number of runnable processes (running or waiting for run time, no contains uninterruptable state)</p>
</li>
</ul>
<h3 id="kernel-do-IRQ-X-Y-No-irq-handler-for-vector-irq-1"><a href="#kernel-do-IRQ-X-Y-No-irq-handler-for-vector-irq-1" class="headerlink" title="kernel: do_IRQ: X.Y No irq handler for vector (irq -1)"></a>kernel: do_IRQ: X.Y No irq handler for vector (irq -1)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * do_IRQ handles all normal device IRQ&#x27;s (the special</span></span><br><span class="line"><span class="comment"> * SMP cross-CPU interrupts have their own specific</span></span><br><span class="line"><span class="comment"> * handlers).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">__visible <span class="keyword">void</span> __irq_entry <span class="title">do_IRQ</span><span class="params">(struct pt_regs *regs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pt_regs</span> *<span class="title">old_regs</span> = <span class="title">set_irq_regs</span>(<span class="title">regs</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">irq_desc</span> * <span class="title">desc</span>;</span></span><br><span class="line">	<span class="comment">/* high bit used in ret_from_ code  */</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="built_in">vector</span> = ~regs-&gt;orig_ax;</span><br><span class="line"></span><br><span class="line">	entering_irq();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* entering_irq() tells RCU that we&#x27;re not quiescent.  Check it. */</span></span><br><span class="line">	RCU_LOCKDEP_WARN(!rcu_is_watching(), <span class="string">&quot;IRQ failed to wake up RCU&quot;</span>);</span><br><span class="line"></span><br><span class="line">	desc = __this_cpu_read(vector_irq[<span class="built_in">vector</span>]);</span><br><span class="line">	<span class="keyword">if</span> (likely(!IS_ERR_OR_NULL(desc))) &#123;</span><br><span class="line">		<span class="keyword">if</span> (IS_ENABLED(CONFIG_X86_32))</span><br><span class="line">			handle_irq(desc, regs);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			generic_handle_irq_desc(desc);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		ack_APIC_irq();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (desc == VECTOR_UNUSED) &#123;</span><br><span class="line">			pr_emerg_ratelimited(<span class="string">&quot;%s: %d.%d No irq handler for vector\n&quot;</span>,</span><br><span class="line">					     __func__, smp_processor_id(),</span><br><span class="line">					     <span class="built_in">vector</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			__this_cpu_write(vector_irq[<span class="built_in">vector</span>], VECTOR_UNUSED);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	exiting_irq();</span><br><span class="line"></span><br><span class="line">	set_irq_regs(old_regs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>system log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[Tue Apr 28 09:09:19 2020] do_IRQ: 6.95 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 09:23:21 2020] do_IRQ: 2.163 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 09:38:13 2020] do_IRQ: 2.151 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 09:48:55 2020] do_IRQ: 0.155 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 09:49:25 2020] do_IRQ: 2.205 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 09:51:51 2020] do_IRQ: 4.123 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 09:53:05 2020] do_IRQ: 2.208 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 10:29:52 2020] do_IRQ: 6.180 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 10:41:23 2020] do_IRQ: 2.133 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 11:30:06 2020] do_IRQ: 6.191 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 11:39:22 2020] do_IRQ: 4.234 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 11:42:23 2020] do_IRQ: 0.137 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 11:46:53 2020] do_IRQ: 2.38 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 11:57:25 2020] do_IRQ: 6.98 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 12:35:11 2020] do_IRQ: 4.121 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 12:39:12 2020] do_IRQ: 2.163 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 13:05:26 2020] do_IRQ: 0.223 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 14:00:30 2020] do_IRQ: 6.91 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 14:08:06 2020] do_IRQ: 0.159 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line">[Tue Apr 28 14:26:09 2020] do_IRQ: 6.110 No irq handler <span class="keyword">for</span> vector (irq -1)</span><br><span class="line"></span><br><span class="line">$ grep -wEi <span class="string">&#x27;95|98|38|91|121|163&#x27;</span> /proc/interrupts</span><br><span class="line">  38:   98081083          0  142920345          0  123688922          0  172399026          0   PCI-MSI-edge      0000:00:11.4</span><br><span class="line">  91:         34          0         11          0         23          0         18          0   PCI-MSI-edge      em4-fp-7</span><br><span class="line"></span><br><span class="line">00:11.4 SATA controller: Intel Corporation C610/X99 series chipset sSATA Controller [AHCI mode] (rev 05)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Hardware issue # ipmi elist is ok</p>
</li>
<li><p>The hardware driver register num overflow</p>
</li>
<li><p>The hardware driver/firmware bug cause responds hobbledown</p>
</li>
<li><p>The bad APIC(programmable interrupt controller) got the wrong IRQ number</p>
<ul>
<li>disable APIC,  noapic pci=nomsi,noaer,acpi=off</li>
</ul>
</li>
</ul>
<h3 id="multipath-issue"><a href="#multipath-issue" class="headerlink" title="multipath issue"></a><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/2437991">multipath issue</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: blk_cloned_rq_check_limits: over max size <span class="built_in">limit</span>.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: device-mapper: multipath: Failing path 70:64.</span><br><span class="line">Jun 14 09:33:38 testhost kernel: device-mapper: multipath: Failing path 71:80.</span><br><span class="line">Jun 14 09:33:38 testhost multipathd: 70:64: mark as failed</span><br><span class="line">Jun 14 09:33:38 testhost multipathd: nsd_crs_04: remaining active paths: 1</span><br><span class="line">Jun 14 09:33:38 testhost multipathd: 71:80: mark as failed</span><br><span class="line"></span><br><span class="line">$ cat /etc/udev/rules.d/99-custom.rules <span class="comment"># lfs must set to 16383</span></span><br><span class="line">ACTION!=<span class="string">&quot;add|change&quot;</span>, GOTO=<span class="string">&quot;rule_end&quot;</span> ENV&#123;ID_VENDOR&#125;==<span class="string">&quot;NETAPP*&quot;</span>,  RUN+=<span class="string">&quot;/bin/sh -c &#x27;echo 16383 &gt; /sys%p/queue/max_sectors_kb&#x27;&quot;</span> LABEL=<span class="string">&quot;rule_end&quot;</span></span><br><span class="line"></span><br><span class="line">or you could add <span class="string">&quot; max_sectors_kb          16383 &quot;</span> to multipath.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">### add to initramfs</span></span><br><span class="line">$ cp  -av  /boot/initramfs-$(uname -r).img  /boot/initramfs-$(uname -r).img.bak</span><br><span class="line">dracut -f -v -i /etc/udev/rules.d/99-custom.rules /etc/udev/rules.d/99-custom.rules</span><br><span class="line">or</span><br><span class="line">dracut -f -v -i /etc/udev/rules.d/99-custom.rules /etc/multipath.conf</span><br></pre></td></tr></table></figure>

<h3 id="sshfs"><a href="#sshfs" class="headerlink" title="sshfs"></a>sshfs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sshfs testuser@<span class="variable">$&#123;server_ip&#125;</span>:/sshfs /Users/<span class="built_in">test</span>/Downloads -o noatime</span><br></pre></td></tr></table></figure>

<h3 id="scan-file-size"><a href="#scan-file-size" class="headerlink" title="scan file size"></a>scan file size</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find /tank -<span class="built_in">printf</span> <span class="string">&#x27;%p\t%Y\t%b\t%s\t%U\t%G\t%A@\n&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="System-err-for-monitor"><a href="#System-err-for-monitor" class="headerlink" title="System err for monitor"></a>System err for monitor</h3><p>scsi:<br>has been suspended<br>attempting host reset<br>mpt.*sas_cm.*Command Timeout<br>Medium.*Error<br>Unrecovered</p>
<p>kernel:<br>Got BUG: soft lockup<br>NMI watchdog.*BUG</p>
<p>mem:<br>page allocation failure<br>Err.*bit ECC</p>
<p>irq:<br>No irq handler for vector</p>
<p>nvme:<br>nvme nvme.*I/O.*timeout, aborting<br>reset controller<br>Device not ready; aborting reset<br>probe failure status</p>
<p>kernel:<br>INFO: task xxx:xxx blocked for more than 120 seconds.<br>kernel process or thread hang, could not be wake up at 120s<br>    hungtask<br>        hung_task_panic        0<br>        hung_task_check_count  32768<br>        hung_task_timeout_secs 120s<br>        hung_task_warnings     10x times</p>
<p>softlockup<br>NMI watchdog: BUG: soft lockup - CPU#0 stuck for 23s! [cat:153]<br>softlockup deadlock, check the kernel schdule is ok, if trigger the softlockup, the kernel could not be schduled.<br>When hrtimer wake up the kernel thread and update watchdog_touch_ts, if time now - watchdog_touch_ts &gt; timeout value, it will show this error, that mean schdule timeout.<br>/proc/sys/kernel/nmi_watchdog      hard lockup<br>/proc/sys/kernel/soft_watchdog     soft lockup<br>/proc/sys/kernel/watchdog          watchdog<br>/proc/sys/kernel/watchdog_cpumask  watchdog cpumaks，<br>/proc/sys/kernel/watchdog_thresh   watchdog timeoout</p>
<p>softlockup : the kernel loop in kernel mode without giving other tasks a chance to run, a kernel task won’t be unlock the CPU.<br>             A soft lockup is when a running task is executing kernel code and wont yield the CPU to allow other tasks to run.<br>             The default soft lockup threshold is 60 seconds for RHEL5/6 and 20 seconds on RHEL7.<br>hardlockup : the kernel loop in kernel mode without letting other interrupts have change to run, the interrupts aren’t being processes.<br>             A hard lockup is when a CPU has interrupts disabled for a long time, which might block important communication between processes or hardware.<br>             The default hard lockup threshold is 30 second on RHEL5/6 and 10 seconds on RHEL7.</p>
<p>In redhat <a target="_blank" rel="noopener" href="https://access.redhat.com/articles/1353303">doc</a><br>Each CPU has registered it’s own high resolution timer and both hard and soft lockup detection are closely connected with it.<br>This timer is fired approximately every [watchdog_thresh * 2 / 5]-seconds and does mainly three things:</p>
<ol>
<li><p>Wakes up a CPU specific watchdog task with the highest possible priority, in order to get scheduled as soon as possible. This task’s main job is to update a PER_CPU timestamp called watchdog_touch_ts.</p>
</li>
<li><p>Checks if watchdog_touch_ts + watchdog_thresh is smaller than current actual time. If yes, or in other words, if the watchdog task didn’t run for longer than watchdog_thresh, then a soft lockup is reported.</p>
</li>
<li><p>Increments a CPU specific interrupt counter called hrtimer_interrupts, denoting that an interrupt happened on the CPU.</p>
</li>
</ol>
<p>Detecting a hard lockup is a bit trickier, since the CPU is stuck and has disabled interrupts. In order to detect it, each CPU has registered a watchdog perf event, which ensures that the CPU hardware issues an NMI (non-maskable interrupt) every [hard lockup threshold]-seconds. Generally approximately 2-3 high resolution timer interrupts are supposed to happen in-between 2 of these NMIs.<br>The handler function of this NMI will check the hrtimer_interrupts counter and copy-save it’s current value. If it sees the same value as it has saved before, it reports a hard lockup, because it means that no interrupt happened during [hard lockup threshold]-seconds.</p>
<p>Usually a CPU lockup is caused by a task stuck in a loop. Sometimes it’s due to a code loop where the termination condition has not yet been met. For example it may be an unbounded list (ie while !list_empty()). In cases like this the code should limit the maximum iterations of the loop before voluntarily yielding the CPU (ie cond_resched()).</p>
<p>Often CPU lockups are caused by tasks trying to acquire a spinlock that for some reason cannot be acquired in a reasonable time. This could be due to current owner of the lock not relinquishing the lock or it may be a case of starvation where excessive activity on the lock delays some tasks long enough to exceed the watchdog threshold (ie RHEL5 spinlocks on numa).</p>
<p>Other cases involve a loop where the termination condition is never going to be met. For example the code expects a state change that isn’t going to happen.</p>
<p>It’s also possible to get false reports from the watchdog on virtual machines where the host system stalls the guest for longer than the watchdog threshold period. The watchdog will think the guest has been running during that time but the CPUs have not been able to make progress.</p>
<p>##default is enabled<br>$ sysctl kernel.softlockup_panic kernel.hardlockup_panic<br>kernel.softlockup_panic = 0<br>kernel.hardlockup_panic = 0</p>
<p>##disable, there is no soft lockup watchdog here<br>echo 1 &gt; /proc/sys/kernel/softlockup_panic</p>
<p><a target="_blank" rel="noopener" href="https://blog.seibert-media.com/2018/01/04/log-book-linux-cpu-lockups/#:~:text=A%20'hard%20lockup'%20is%20defined,the%20good%20old%20DOS%20days.">Provoke lockups with your own kernel module</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">hog.c</span><br><span class="line">#include &lt;linux&#x2F;init.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;module.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;kernel.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;kthread.h&gt;</span><br><span class="line"> </span><br><span class="line">MODULE_LICENSE(&quot;GPL&quot;);</span><br><span class="line"> </span><br><span class="line">static int</span><br><span class="line">hog_thread(void *data)</span><br><span class="line">&#123;</span><br><span class="line">    printk(KERN_INFO &quot;Hogging a CPU now\n&quot;);</span><br><span class="line">    while (1);</span><br><span class="line"> </span><br><span class="line">    &#x2F;* unreached *&#x2F;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">static int __init</span><br><span class="line">hog_init(void)</span><br><span class="line">&#123;</span><br><span class="line">    kthread_run(hog_thread, NULL, &quot;hog&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">module_init(hog_init);</span><br><span class="line"></span><br><span class="line">#makefile</span><br><span class="line">obj-m +&#x3D; hog.o</span><br><span class="line"> </span><br><span class="line">all:</span><br><span class="line">    make -C &#x2F;lib&#x2F;modules&#x2F;$(shell uname -r)&#x2F;build&#x2F; M&#x3D;$(PWD) modules</span><br><span class="line">clean:</span><br><span class="line">    make -C &#x2F;lib&#x2F;modules&#x2F;$(shell uname -r)&#x2F;build&#x2F; M&#x3D;$(PWD) clean</span><br><span class="line"></span><br><span class="line"># in centos </span><br><span class="line">$ cat Makefile</span><br><span class="line">obj-m +&#x3D; hog.o</span><br><span class="line"></span><br><span class="line">all: make -C &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;build&#x2F; M&#x3D;$(pwd) modules</span><br><span class="line">clean: make -C &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;build&#x2F; M&#x3D;$(pwd) clean</span><br><span class="line"></span><br><span class="line">$ make -C &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;build&#x2F; M&#x3D;$(pwd) modules</span><br><span class="line">make: Entering directory &#96;&#x2F;usr&#x2F;src&#x2F;kernels&#x2F;3.10.0-1062.1.1.el7.x86_64&#39;</span><br><span class="line">  CC [M]  &#x2F;root&#x2F;hog&#x2F;hog.o</span><br><span class="line">  Building modules, stage 2.</span><br><span class="line">  MODPOST 1 modules</span><br><span class="line">  CC      &#x2F;root&#x2F;hog&#x2F;hog.mod.o</span><br><span class="line">  LD [M]  &#x2F;root&#x2F;hog&#x2F;hog.ko</span><br><span class="line">make: Leaving directory &#96;&#x2F;usr&#x2F;src&#x2F;kernels&#x2F;3.10.0-1062.1.1.el7.x86_64&#39;</span><br><span class="line"></span><br><span class="line">$ ls </span><br><span class="line">hog.c  hog.ko  hog.mod.c  hog.mod.o  hog.o  Makefile  modules.order  Module.symvers</span><br><span class="line"></span><br><span class="line">$ insmod hog.ko</span><br><span class="line">$ lsmod | grep hog</span><br><span class="line">hog                    12386  0</span><br><span class="line"></span><br><span class="line"> kernel:NMI watchdog: BUG: soft lockup - CPU#0 stuck for 23s! [hog:2308]</span><br><span class="line"></span><br><span class="line">[Mon Jun  8 03:32:28 2020] NMI watchdog: BUG: soft lockup - CPU#0 stuck for 23s! [hog:2308]</span><br><span class="line">[Mon Jun  8 03:32:28 2020] Modules linked in: hog(OE) dell_rbu dcdbas sunrpc nfit libnvdimm zfs(POE) zunicode(POE) zavl(POE) icp(POE) ppdev iosf_mbi crc32_pclmul ghash_clmulni_intel joydev zcommon(POE) znvpair(POE) spl(OE) sg aesni_intel virtio_balloon virtio_rng lrw gf128mul glue_helper ablk_helper cryptd pcspkr i2c_piix4 parport_pc parport binfmt_misc ip_tables xfs libcrc32c sr_mod sd_mod cdrom crc_t10dif crct10dif_generic ata_generic pata_acpi virtio_console virtio_net virtio_blk virtio_scsi qxl drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ttm drm crct10dif_pclmul crct10dif_common crc32c_intel ata_piix ahci libahci libata serio_raw virtio_pci virtio_ring virtio floppy drm_panel_orientation_quirks dm_mirror dm_region_hash dm_log dm_mod</span><br><span class="line">[Mon Jun  8 03:32:28 2020] CPU: 0 PID: 2308 Comm: hog Kdump: loaded Tainted: P           OE  ------------   3.10.0-1062.1.1.el7.x86_64 #1</span><br><span class="line">[Mon Jun  8 03:32:28 2020] Hardware name: Red Hat KVM, BIOS 1.11.1-4.module_el8.0.0+189+f9babebb 04&#x2F;01&#x2F;2014</span><br><span class="line">[Mon Jun  8 03:32:28 2020] task: ffff9c0335878000 ti: ffff9c03356a4000 task.ti: ffff9c03356a4000</span><br><span class="line">[Mon Jun  8 03:32:28 2020] RIP: 0010:[&lt;ffffffffc0721017&gt;]  [&lt;ffffffffc0721017&gt;] hog_thread+0x17&#x2F;0x1000 [hog]</span><br><span class="line">[Mon Jun  8 03:32:28 2020] RSP: 0018:ffff9c03356a7ec0  EFLAGS: 00000246</span><br><span class="line">[Mon Jun  8 03:32:28 2020] RAX: 0000000000000011 RBX: ffff9c03356a7e50 RCX: 0000000000000000</span><br><span class="line">[Mon Jun  8 03:32:28 2020] RDX: 0000000000000000 RSI: ffff9c033dc13898 RDI: ffff9c033dc13898</span><br><span class="line">[Mon Jun  8 03:32:28 2020] RBP: ffff9c03356a7ec0 R08: 0000000000000000 R09: 0000000000000040</span><br><span class="line">[Mon Jun  8 03:32:28 2020] R10: 000000000000029a R11: 0000000000aaaaaa R12: 0000000000000000</span><br><span class="line">[Mon Jun  8 03:32:28 2020] R13: ffffffffc0721000 R14: 0000000000000000 R15: ffff9c03352ebc90</span><br><span class="line">[Mon Jun  8 03:32:28 2020] FS:  0000000000000000(0000) GS:ffff9c033dc00000(0000) knlGS:0000000000000000</span><br><span class="line">[Mon Jun  8 03:32:28 2020] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[Mon Jun  8 03:32:28 2020] CR2: 0000561560589e20 CR3: 0000000006010000 CR4: 00000000003606f0</span><br><span class="line">[Mon Jun  8 03:32:28 2020] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000</span><br><span class="line">[Mon Jun  8 03:32:28 2020] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400</span><br><span class="line">[Mon Jun  8 03:32:28 2020] Call Trace:</span><br><span class="line">[Mon Jun  8 03:32:28 2020]  [&lt;ffffffffa08c50d1&gt;] kthread+0xd1&#x2F;0xe0</span><br><span class="line">[Mon Jun  8 03:32:28 2020]  [&lt;ffffffffa08c5000&gt;] ? insert_kthread_work+0x40&#x2F;0x40</span><br><span class="line">[Mon Jun  8 03:32:28 2020]  [&lt;ffffffffa0f8cd37&gt;] ret_from_fork_nospec_begin+0x21&#x2F;0x21</span><br><span class="line">[Mon Jun  8 03:32:28 2020]  [&lt;ffffffffa08c5000&gt;] ? insert_kthread_work+0x40&#x2F;0x40</span><br><span class="line">[Mon Jun  8 03:32:28 2020] Code: &lt;eb&gt; fe 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br></pre></td></tr></table></figure>


<p>Enable nmi_watchdog=1 in kernel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">cat hard.c</span><br><span class="line">#include &lt;linux&#x2F;init.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;module.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;kernel.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;kthread.h&gt;</span><br><span class="line">#include &lt;linux&#x2F;spinlock.h&gt;</span><br><span class="line"> </span><br><span class="line">MODULE_LICENSE(&quot;GPL&quot;);</span><br><span class="line"> </span><br><span class="line">static int</span><br><span class="line">hog_thread(void *data)</span><br><span class="line">&#123;</span><br><span class="line">    static DEFINE_SPINLOCK(lock);</span><br><span class="line">    unsigned long flags;</span><br><span class="line"> </span><br><span class="line">    printk(KERN_INFO &quot;Hogging a CPU now\n&quot;);</span><br><span class="line">    spin_lock_irqsave(&amp;lock, flags);</span><br><span class="line">    while (1);</span><br><span class="line"> </span><br><span class="line">    &#x2F;* unreached *&#x2F;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">static int __init</span><br><span class="line">hog_init(void)</span><br><span class="line">&#123;</span><br><span class="line">    kthread_run(hog_thread, NULL, &quot;hog&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">module_init(hog_init);</span><br><span class="line"></span><br><span class="line">obj-m +&#x3D; hard.o</span><br><span class="line"></span><br><span class="line">all: make -C &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;build&#x2F; M&#x3D;$(pwd) modules</span><br><span class="line">clean: make -C &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;build&#x2F; M&#x3D;$(pwd) clean</span><br><span class="line"></span><br><span class="line">$  make -C &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;build&#x2F; M&#x3D;$(pwd) modules</span><br><span class="line">make: Entering directory &#96;&#x2F;usr&#x2F;src&#x2F;kernels&#x2F;3.10.0-1062.1.1.el7.x86_64&#39;</span><br><span class="line">  CC [M]  &#x2F;root&#x2F;hardhog&#x2F;hard.o</span><br><span class="line">  Building modules, stage 2.</span><br><span class="line">  MODPOST 1 modules</span><br><span class="line">  CC      &#x2F;root&#x2F;hardhog&#x2F;hard.mod.o</span><br><span class="line">  LD [M]  &#x2F;root&#x2F;hardhog&#x2F;hard.ko</span><br><span class="line"></span><br><span class="line">$ insmod hard.ko</span><br><span class="line"></span><br><span class="line"># after insmod, the KVM ssh not respond too.</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://kernelnewbies.org/FAQ/FastpathAndSlowpath">In general</a>, “fast path” is the commonly run code that should finish very quickly. For example, when it comes to spinlocks the fast path is that nobody is holding the spinlock and the CPU that wants it can just take it.<br>Conversely, the slow path for spinlocks is that the lock is already taken by somebody else and the CPU will have to wait for the lock to be freed.<br>The first case is the common one that should be optimized.<br>The second one is not as important and does not need to be optimized much at all.</p>
<h3 id="cgroup-limit-resource"><a href="#cgroup-limit-resource" class="headerlink" title="cgroup limit resource"></a>cgroup limit resource</h3><p>limit memory size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cgcreate -g memory:DBLimitedGroup</span><br><span class="line">$ <span class="built_in">echo</span> 16G &gt; /sys/fs/cgroup/memory/DBLimitedGroup/memory.limit_in_bytes</span><br><span class="line">$ sync; <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">$ cgclassify -g memory:DBLimitedGroup $(pid)</span><br></pre></td></tr></table></figure>

<h3 id="About-WB-SYNC-NONE-and-WB-SYNC-ALL"><a href="#About-WB-SYNC-NONE-and-WB-SYNC-ALL" class="headerlink" title="About WB_SYNC_NONE and WB_SYNC_ALL"></a>About WB_SYNC_NONE and WB_SYNC_ALL</h3><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v3.10.108/source/fs/fs-writeback.c#L140">https://elixir.bootlin.com/linux/v3.10.108/source/fs/fs-writeback.c#L140</a><br>/**</p>
<ul>
<li>bdi_start_writeback - start writeback</li>
<li>@bdi: the backing device to write from</li>
<li>@nr_pages: the number of pages to write</li>
<li>@reason: reason why some writeback work was initiated</li>
<li></li>
<li>Description:</li>
<li>This does WB_SYNC_NONE opportunistic writeback. The IO is only</li>
<li>started when this function returns, we make no guarantees on</li>
<li>completion. Caller need not hold sb s_umount semaphore.</li>
<li></li>
<li>/</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v3.10.108/source/include/linux/writeback.h#L34">https://elixir.bootlin.com/linux/v3.10.108/source/include/linux/writeback.h#L34</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum writeback_sync_modes &#123;</span><br><span class="line">	WB_SYNC_NONE,	&#x2F;* Don&#39;t wait on anything *&#x2F;</span><br><span class="line">	WB_SYNC_ALL,	&#x2F;* Wait on every mapping *&#x2F;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><h4 id="ldd"><a href="#ldd" class="headerlink" title="ldd"></a>ldd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ldd /bin/ls</span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007fff59353000)</span><br><span class="line">	libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fa12b999000)</span><br><span class="line">	libcap.so.2 =&gt; /lib64/libcap.so.2 (0x00007fa12b794000)</span><br><span class="line">	libacl.so.1 =&gt; /lib64/libacl.so.1 (0x00007fa12b58b000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fa12b1bd000)</span><br><span class="line">	libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007fa12af5b000)</span><br><span class="line">	libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fa12ad57000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007fa12bbc0000)</span><br><span class="line">	libattr.so.1 =&gt; /lib64/libattr.so.1 (0x00007fa12ab52000)</span><br><span class="line">	libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fa12a936000)</span><br></pre></td></tr></table></figure>

<h4 id="Read-ELF-Executable-and-Linking-Format"><a href="#Read-ELF-Executable-and-Linking-Format" class="headerlink" title="Read ELF(Executable and Linking Format)"></a>Read ELF(Executable and Linking Format)</h4><p>Relocatable file (eg: xx.o)<br>Executable file<br>Dynamic Linking Library (eg: xx.so)<br>Static Linking Library  (eg: xx.a)</p>
<p>ELF Header<br>ELF Program Header Table/Program Headers<br>ELF Section Header Table/Section Headers<br>ELF Sections<br>multiple sections merge to a segment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -h /bin/ls</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2<span class="string">&#x27;s complement, little endian</span></span><br><span class="line"><span class="string">  Version:                           1 (current)</span></span><br><span class="line"><span class="string">  OS/ABI:                            UNIX - System V</span></span><br><span class="line"><span class="string">  ABI Version:                       0</span></span><br><span class="line"><span class="string">  Type:                              EXEC (Executable file)</span></span><br><span class="line"><span class="string">  Machine:                           Advanced Micro Devices X86-64</span></span><br><span class="line"><span class="string">  Version:                           0x1</span></span><br><span class="line"><span class="string">  Entry point address:               0x404324</span></span><br><span class="line"><span class="string">  Start of program headers:          64 (bytes into file)</span></span><br><span class="line"><span class="string">  Start of section headers:          115688 (bytes into file)</span></span><br><span class="line"><span class="string">  Flags:                             0x0</span></span><br><span class="line"><span class="string">  Size of this header:               64 (bytes)</span></span><br><span class="line"><span class="string">  Size of program headers:           56 (bytes)</span></span><br><span class="line"><span class="string">  Number of program headers:         9</span></span><br><span class="line"><span class="string">  Size of section headers:           64 (bytes)</span></span><br><span class="line"><span class="string">  Number of section headers:         30</span></span><br><span class="line"><span class="string">  Section header string table index: 29</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$  readelf -S /bin/ls | grep debug</span></span><br><span class="line"><span class="string">  [27] .gnu_debuglink    PROGBITS         0000000000000000  0001b600</span></span><br><span class="line"><span class="string">  [28] .gnu_debugdata    PROGBITS         0000000000000000  0001b610 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ readelf -all /bin/ls</span></span><br><span class="line"><span class="string">......</span></span><br></pre></td></tr></table></figure>

<h4 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -i </span><br><span class="line"><span class="comment"># Display a list showing all architectures and object formats available for specification with -b or -m.</span></span><br><span class="line">...</span><br><span class="line">$ gcc -O2 -ggdb3 -c -o sort.o sort.c</span><br><span class="line">$ objdump -d sort.o</span><br><span class="line"><span class="comment">#Display the assembler mnemonics for the machine instructions from objfile</span></span><br><span class="line"></span><br><span class="line">sort.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;sort&gt;:</span><br><span class="line">   0:	31 c0                	xor    %eax,%eax</span><br><span class="line">   2:	b9 01 00 00 00       	mov    <span class="variable">$0x1</span>,%ecx</span><br><span class="line">   7:	83 f8 1e             	cmp    <span class="variable">$0x1e</span>,%eax</span><br><span class="line">   a:	7e 0b                	jle    17 &lt;sort+0x17&gt;</span><br><span class="line">   c:	84 c9                	<span class="built_in">test</span>   %cl,%cl</span><br><span class="line">   e:	75 36                	jne    46 &lt;sort+0x46&gt;</span><br><span class="line">  10:	b9 01 00 00 00       	mov    <span class="variable">$0x1</span>,%ecx</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ objdump -t sort.o</span><br><span class="line"><span class="comment"># Print the symbol table entries of the file</span></span><br><span class="line"></span><br><span class="line">sort.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">SYMBOL TABLE:</span><br><span class="line">0000000000000000 l    df *ABS*	0000000000000000 sort.c</span><br><span class="line">0000000000000000 l    d  .text	0000000000000000 .text</span><br><span class="line">0000000000000000 l    d  .data	0000000000000000 .data</span><br><span class="line">0000000000000000 l    d  .bss	0000000000000000 .bss</span><br><span class="line">0000000000000000 l    d  .rodata.str1.1	0000000000000000 .rodata.str1.1</span><br><span class="line">0000000000000000 l    d  .text.startup	0000000000000000 .text.startup</span><br><span class="line">0000000000000000 l    d  .debug_info	0000000000000000 .debug_info</span><br><span class="line">0000000000000000 l    d  .debug_abbrev	0000000000000000 .debug_abbrev</span><br><span class="line">0000000000000000 l    d  .debug_loc	0000000000000000 .debug_loc</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h4><p>list symbols from object files</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ nm .&#x2F;walk</span><br><span class="line">                 U atoi@@GLIBC_2.2.5</span><br><span class="line">00000000006020a4 B __bss_start</span><br><span class="line">                 U closedir@@GLIBC_2.2.5</span><br><span class="line">00000000006020a8 b completed.6355</span><br><span class="line">00000000006020a0 D __data_start</span><br><span class="line">00000000006020a0 W data_start</span><br><span class="line">0000000000400880 t deregister_tm_clones</span><br><span class="line">00000000004008f0 t __do_global_dtors_aux</span><br><span class="line">0000000000601e18 t __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000400d18 R __dso_handle</span><br><span class="line"></span><br><span class="line">$ nm -e .&#x2F;walk</span><br><span class="line">                 U atoi@@GLIBC_2.2.5</span><br><span class="line">00000000006020a4 B __bss_start</span><br><span class="line">                 U closedir@@GLIBC_2.2.5</span><br><span class="line">00000000006020a8 b completed.6355</span><br><span class="line">00000000006020a0 D __data_start</span><br><span class="line">00000000006020a0 W data_start</span><br><span class="line">0000000000400880 t deregister_tm_clones</span><br><span class="line">00000000004008f0 t __do_global_dtors_aux</span><br><span class="line">0000000000601e18 t __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000400d18 R __dso_handle</span><br></pre></td></tr></table></figure>

<p>kernel symbol table</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$  grep CONFIG_KALLSYMS &#x2F;boot&#x2F;config-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">CONFIG_KALLSYMS&#x3D;y</span><br><span class="line">CONFIG_KALLSYMS_ALL&#x3D;y</span><br><span class="line"></span><br><span class="line">$ grep &quot; tcp_v4_do_rcv&quot;  &#x2F;proc&#x2F;kallsyms</span><br><span class="line">ffffffff936c0c70 T tcp_v4_do_rcv</span><br><span class="line">## Why addr is change ?</span><br><span class="line"></span><br><span class="line">$ grep CONFIG_RANDOMIZE_BASE &#x2F;boot&#x2F;config-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">CONFIG_RANDOMIZE_BASE&#x3D;y</span><br><span class="line"></span><br><span class="line">## ALL info, the compiler optimize cause some symbols missing in kallsyms</span><br><span class="line">$ grep &quot; tcp_v4_do_rcv&quot;  &#x2F;boot&#x2F;System.map-3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">ffffffff816c0c70 T tcp_v4_do_rcv</span><br></pre></td></tr></table></figure>



<p>uppercase: global(external) symbol<br>lowercase: local symbol<br>T The symbol is in the text(code) section<br>D The symbol is in the initialized data section<br>R The sysbol is in a read only data section<br>t static<br>d static<br>R const<br>r static const</p>
<h4 id="size"><a href="#size" class="headerlink" title="size"></a>size</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">size add_lock</span><br><span class="line">   text	   data	    bss	    dec	    hex	filename</span><br><span class="line">   5008	    660	      4	   5672	   1628	add_lock</span><br></pre></td></tr></table></figure>

<p>代码段： 只读，可共享; 代码段（code segment/text segment ）通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读, 某些架构也允许代码段为可写，即允许修改程序。在代码段中，也有可能包含一些只读的常数变量，例如字符串常量等。<br>数据段： 储存已被初始化了的静态数据。数据段（data segment ）通常是指用来存放程序中已初始化的全局变量的一块内存区域。数据段属于静态内存分配。<br>BSS 段：未初始化的数据段. BSS 段（bss segment ）通常是指用来存放程序中未初始化的全局变量的一块内存区域。BSS 是英文Block Started by Symbol 的简称。BSS 段属于静态内存分配。<br>堆（heap ）：low to high, 堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用malloc 等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用free 等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）<br>栈(stack) ： high to low, 栈又称堆栈，是用户存放程序临时创建的局部变量，也就是说我们函数括弧“{} ”中定义的变量（但不包括static 声明的变量，static 意味着在数据段中存放变量）。除此以外，在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的先进先出特点，所以栈特别方便用来保存/ 恢复调用现场。从这个意义上讲，我们可以把堆栈看成一个寄存、交换临时数据的内存区。<br>另外, 在高地址还储存了命令行参数及环境变量.</p>
<p>The heap is, generally speaking, one specific memory region created by the C runtime, and managed by malloc (which in turn uses the brk and sbrk system calls to grow and shrink).<br>mmap is a way of creating new memory regions, independently of malloc (and so independently of the heap). munmap is simply its inverse, it releases these regions.<br>Some picture show mmap high addr to low addr, same direction with stack</p>
<h3 id="process-schduler"><a href="#process-schduler" class="headerlink" title="process schduler"></a>process schduler</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ chrt -p <span class="variable">$pid</span></span><br><span class="line">$ chrt -m</span><br><span class="line">$ chrt [-b/-f/-o/-r/-i/-d] -p <span class="variable">$priority</span> <span class="variable">$pid</span></span><br><span class="line">-b SCHED_BATCH</span><br><span class="line">-f SCHED_FIFO</span><br><span class="line">-o SCHED_OTHER</span><br><span class="line">-r SCHED_RR</span><br><span class="line">-i SCHED_IDLE</span><br><span class="line">-d SCHED_DEADLINE</span><br></pre></td></tr></table></figure>

<h3 id="vim-jump-cursor"><a href="#vim-jump-cursor" class="headerlink" title="vim jump cursor"></a>vim jump cursor</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:cal cursor(30, 5)</span><br></pre></td></tr></table></figure>

<h3 id="gpart-recovery-partition-table"><a href="#gpart-recovery-partition-table" class="headerlink" title="gpart recovery partition table"></a>gpart recovery partition table</h3><p>boot by freebsd livecd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gpart disk list</span><br><span class="line">$ gpart recover /dev/sda</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/07/18/centos/">http://yoursite.com/2019/07/18/centos/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/centos/">centos</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/10/10/golang/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">golang</div></div></a></div><div class="next-post pull-right"><a href="/2019/07/18/ubuntu/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">ubuntu</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>