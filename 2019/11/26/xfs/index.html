<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>xfs | b946c5a0bf547c89</title><meta name="description" content="reference format1234567#Raid 60  24 HDD ，12HDD&#x2F;per raid6   （12-2）× 2 ， Raid stripe size 64KB$ mkfs.xfs -f -d sunit&#x3D;64,swidth&#x3D;$((64*20)) &#x2F;dev&#x2F;sdxx1#su: Stripe unit, which is the RAID chunk size, in byt"><meta name="keywords" content="xfs"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2019/11/26/xfs/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="xfs"><meta property="og:url" content="http://yoursite.com/2019/11/26/xfs/"><meta property="og:site_name" content="b946c5a0bf547c89"><meta property="og:description" content="reference format1234567#Raid 60  24 HDD ，12HDD&#x2F;per raid6   （12-2）× 2 ， Raid stripe size 64KB$ mkfs.xfs -f -d sunit&#x3D;64,swidth&#x3D;$((64*20)) &#x2F;dev&#x2F;sdxx1#su: Stripe unit, which is the RAID chunk size, in byt"><meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><meta property="article:published_time" content="2019-11-26T08:12:19.000Z"><meta property="article:modified_time" content="2020-09-27T14:59:09.950Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime: '',
  date_suffix: {"one_hour":"Just","hours":"hours ago","day":"days ago"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-09-27 22:59:09'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">59</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">66</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#format"><span class="toc-number">1.</span> <span class="toc-text">format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Grow"><span class="toc-number">2.</span> <span class="toc-text">Grow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Suspend-file-system"><span class="toc-number">3.</span> <span class="toc-text">Suspend file system</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Quota"><span class="toc-number">4.</span> <span class="toc-text">Quota</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Backup-and-restore"><span class="toc-number">5.</span> <span class="toc-text">Backup and restore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compare-with-ext4"><span class="toc-number">6.</span> <span class="toc-text">Compare with ext4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Defragment"><span class="toc-number">7.</span> <span class="toc-text">Defragment</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xfs-admin"><span class="toc-number">8.</span> <span class="toc-text">xfs_admin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Repair"><span class="toc-number">9.</span> <span class="toc-text">Repair</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Recover-file"><span class="toc-number">10.</span> <span class="toc-text">Recover file</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-estimate"><span class="toc-number"></span> <span class="toc-text">xfs_estimate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-info"><span class="toc-number"></span> <span class="toc-text">xfs_info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xfs-logprint"><span class="toc-number"></span> <span class="toc-text">xfs_logprint</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#About-barriers"><span class="toc-number">1.</span> <span class="toc-text">About barriers</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-file-block"><span class="toc-number"></span> <span class="toc-text">The file block</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-from-this-article"><span class="toc-number"></span> <span class="toc-text">copy from this article</span></a></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">b946c5a0bf547c89</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">xfs</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-11-26T08:12:19.000Z" title="Created 2019-11-26 16:12:19">2019-11-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-09-27T14:59:09.950Z" title="Updated 2020-09-27 22:59:09">2020-09-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/filesystem/">filesystem</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p><a target="_blank" rel="noopener" href="http://fibrevillage.com/storage">reference</a></p>
<h4 id="format"><a href="#format" class="headerlink" title="format"></a>format</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Raid 60  24 HDD ，12HDD/per raid6   （12-2）× 2 ， Raid stripe size 64KB</span></span><br><span class="line">$ mkfs.xfs -f -d sunit=64,swidth=$((<span class="number">64</span>*<span class="number">20</span>)) /dev/sdxx1</span><br><span class="line"><span class="comment">#su: Stripe unit, which is the RAID chunk size, in bytes</span></span><br><span class="line"><span class="comment">#sw: Multiplier of the stripe unit, i.e. number of data disks</span></span><br><span class="line"></span><br><span class="line">$ mkfs.xfs /dev/device</span><br><span class="line">$ mkfs. xfs -d su= 64k,sw= 4 /dev/device</span><br></pre></td></tr></table></figure>
<p>su = value<br>    Specifies a stripe unit or RAID chunk size. The value must be specified in bytes, with an optional k, m, or g suffix.<br>sw= value<br>    Specifies the number of data disks in a RAID device, or the number of stripe units in the stripe.</p>
<a id="more"></a>

<h4 id="Grow"><a href="#Grow" class="headerlink" title="Grow"></a>Grow</h4><p>While XFS file systems can be grown while mounted</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_growfs /mount/point -D size</span><br></pre></td></tr></table></figure>

<h4 id="Suspend-file-system"><a href="#Suspend-file-system" class="headerlink" title="Suspend file system"></a>Suspend file system</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_freeze -f /mount/point</span><br><span class="line"></span><br><span class="line"><span class="comment">#unfreeze</span></span><br><span class="line">$ xfs_freeze -u /mount/point</span><br></pre></td></tr></table></figure>
<p>When taking an LVM snapshot, it is not necessary to use xfs_freeze to suspend the file system first.</p>
<h4 id="Quota"><a href="#Quota" class="headerlink" title="Quota"></a>Quota</h4><p>uquota User quotas<br>gquota Group quotas<br>pquota Project quota</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ mount -o uquota /dev/mapper/LUN13 /lun13</span><br><span class="line">$ xfs_quota  /lun13</span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27;limit isoft=500 ihard=700 trteam&#x27;</span> /lun13</span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27; limit -g bsoft=1000 m bhard=1200m test &#x27;</span> /lun13</span><br><span class="line"></span><br><span class="line"><span class="comment"># report</span></span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27;report -bih&#x27;</span> /lun13</span><br><span class="line"></span><br><span class="line"><span class="comment">#project quota</span></span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27; project -s projectname&#x27;</span> project_path</span><br><span class="line">$ xfs_quota -x -c <span class="string">&#x27; limit -p bsoft=1000m bhard=1200m projectname&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="Backup-and-restore"><a href="#Backup-and-restore" class="headerlink" title="Backup and restore"></a>Backup and restore</h4><p>To perform a full backup, perform a level 0 dump on the file system.<br>A level 1 dump is the first incremental backup after a full backup. The next incremental backup would be level 2, which only backs up files that have changed since the last level 1 dump; and so on, to a maximum of level 9.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ xfsdump -l level [-L label] -f backup-destination path-to-xfs-filesystem</span><br><span class="line">$ xfsdump -l 0 -f /backup-files/data.xfsdump /data</span><br><span class="line">$ xfsdump -l 0 -L <span class="string">&quot;backup_data&quot;</span> -f /dev/st0 /data</span><br><span class="line"></span><br><span class="line"><span class="comment"># restore</span></span><br><span class="line">$ xfsrestore [-r] [-S session-id] [-L session-label] [-i] -f backup-location restoration-path</span><br><span class="line">$ xfsrestore -f /backup-files/data.xfsdump /mnt/data/</span><br><span class="line">$ xfsrestore -f /dev/st0 -L <span class="string">&quot;backup_data&quot;</span> /mnt/data/</span><br><span class="line"></span><br><span class="line">$ xfsrestore -I <span class="comment"># get the session ID</span></span><br><span class="line">$ xfsrestore -f /dev/st0 -S <span class="string">&quot;45e9af35-efd2-4244-87bc-4762e476cbab&quot;</span> /mnt/data/</span><br><span class="line"></span><br><span class="line">$ xfs_metadump /dev/mapper/vg0-data /home/vg0-data.metadump</span><br><span class="line">$ xfs_mdrestore /home/vg0-data.metadump /home/vg0-data.img</span><br></pre></td></tr></table></figure>

<h4 id="Compare-with-ext4"><a href="#Compare-with-ext4" class="headerlink" title="Compare with ext4"></a>Compare with ext4</h4><table>
<thead>
<tr>
<th>Task</th>
<th>Ext3/4</th>
<th>XFS</th>
</tr>
</thead>
<tbody><tr>
<td>File System check</td>
<td>e2fsck</td>
<td>xfs_repair</td>
</tr>
<tr>
<td>REsizing a File System</td>
<td>resize2fs</td>
<td>xfs_growfs</td>
</tr>
<tr>
<td>Save an image of a file system</td>
<td>e2image</td>
<td>xfs_metadump and xfs_mdrestore</td>
</tr>
<tr>
<td>Label or tune a File System</td>
<td>tune2fs</td>
<td>xfs_admin</td>
</tr>
<tr>
<td>Backup a File System</td>
<td>dump and restore</td>
<td>xfsdump xfsrestore</td>
</tr>
</tbody></table>
<h4 id="Defragment"><a href="#Defragment" class="headerlink" title="Defragment"></a>Defragment</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_db -r  /dev/sdb</span><br><span class="line">$ xfs_db&gt; frag</span><br><span class="line"></span><br><span class="line"><span class="comment"># Defragment</span></span><br><span class="line">$ xfs_fsr -t 3600  -v /lun10</span><br></pre></td></tr></table></figure>
<h4 id="xfs-admin"><a href="#xfs-admin" class="headerlink" title="xfs_admin"></a>xfs_admin</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_admin -l /dev/sdb</span><br><span class="line">$ xfs_admin -L <span class="string">&quot;data&quot;</span> /dev/sdb</span><br><span class="line"></span><br><span class="line">$ xfs_admin -u /dev/sdb</span><br><span class="line">$ xfs_admin -U generate-id /dev/sdb</span><br><span class="line">$ xfs_admin -U nil /dev/sdb</span><br><span class="line"></span><br><span class="line">$ xfs_admin -c 0 /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment">#Enable xfs lazy counters</span></span><br><span class="line">$ xfs_admin -c 1 /dev/sdb</span><br></pre></td></tr></table></figure>

<h4 id="Repair"><a href="#Repair" class="headerlink" title="Repair"></a>Repair</h4><p>-n     No modify mode. Specifies that xfs_repair should not modify the filesystem  but  should  only  scan the filesystem and indicate what repairs would have been made</p>
<p>-L The xfs_repair utility cannot repair an XFS file system with a dirty log. To clear the log, mount and unmount the XFS file system. force log zeroing to clean log<br>-v option gives you xfs_repair verbose outpt, inaddition to the regular repair message +extra verbosity, it has a summary for each repair phase.<br>-d Repair  dangerously.  Allow  xfs_repair to repair an XFS filesystem mounted read only. This is typically done on a root filesystem from single user mode, immediately followed by a reboot.<br>-l option, external log<br>-f Specifies  that  the  filesystem  image  to  be processed is stored in a regular file at device (see the mkfs.xfs -d file option). This might happen if an image copy of a filesystem has been copied or written into an ordinary file.  This option implies that any external log or realtime section is also in an ordinary file.<br>-P option, disable prefetching<br>-t interval Modify reporting interval, specified in seconds. During long runs xfs_repair outputs its progress every 15 minutes. Reporting is only activated when ag_stride is enabled.<br>-m Specifies the approximate maximum amount of memory, in megabytes, to use for xfs_repair.  xfs_repair has its own internal block cache which  will  scale  out  up  to  the lesser of the process’s virtual address limit or about 75% of the system’s physical RAM.  This option overrides these limits. NOTE: These memory limits are only approximate and may use more than the specified limit</p>
<p>If xfs_repair failed in phase 1, you must restore lost files from backups.<br>If xfs_repair failed in phase 2 or later, you may be able to restore files from the disk by backing up and restoring the files on the file system<br>    * Mount the file system using mount -r (read-only).<br>    * Make a file system backup with xfsdump.<br>    * Use mkfs to a make new file system on the same disk partition or XLV logical volume.<br>    * Restore the files from the backup with xfsrestore.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mount -r /dev/sdb /mnt</span><br><span class="line">$ mount /dev/sdb /mnt -o norecover</span><br></pre></td></tr></table></figure>


<p>Without any option, xfs_repair will check and repair errors that it encounters.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_repair -n &#x2F;dev&#x2F;device</span><br><span class="line">Phase 1 - find and verify superblock...</span><br><span class="line">Phase 2 - using internal log</span><br><span class="line">        - scan filesystem freespace and inode maps...</span><br><span class="line">        - found root inode chunk</span><br><span class="line">Phase 3 - for each AG...</span><br><span class="line">        - scan (but don&#39;t clear) agi unlinked lists...</span><br><span class="line">        - process known inodes and perform inode discovery...</span><br><span class="line">        - agno &#x3D; 0</span><br><span class="line">        - agno &#x3D; 1</span><br><span class="line">        - agno &#x3D; 2</span><br><span class="line">        - agno &#x3D; 3</span><br><span class="line">        - process newly discovered inodes...</span><br><span class="line">Phase 4 - check for duplicate blocks...</span><br><span class="line">        - setting up duplicate extent list...</span><br><span class="line">        - check for inodes claiming duplicate blocks...</span><br><span class="line">        - agno &#x3D; 0</span><br><span class="line">        - agno &#x3D; 1</span><br><span class="line">        - agno &#x3D; 2</span><br><span class="line">        - agno &#x3D; 3</span><br><span class="line">No modify flag set, skipping phase 5</span><br><span class="line">Phase 6 - check inode connectivity...</span><br><span class="line">        - traversing filesystem ...</span><br><span class="line">        - traversal finished ...</span><br><span class="line">        - moving disconnected inodes to lost+found ...</span><br><span class="line">Phase 7 - verify link counts...</span><br><span class="line">No modify flag set, skipping filesystem flush and exiting.</span><br><span class="line"></span><br><span class="line">$ xfs_repair -L &#x2F;dev&#x2F;device</span><br><span class="line">$ xfs_repair -d &#x2F;</span><br></pre></td></tr></table></figure>
<ol>
<li>Inode  and inode blockmap (addressing) checks:bad magic number  in inode, bad magic numbers in inode blockmap  blocks,  extents out  of  order,  incorrect  number of records in inode blockmap blocks, blocks claimed that are not in a legal data area of the filesystem, blocks that are claimed by more than one inode.</li>
<li>Inode  allocation  map  checks:bad  magic number in inode map blocks, inode state as indicated by map (free or in-use) inconsistent with state indicated by the inode, inodes referenced by the filesystem that do not appear in the inode allocation  map, inode  allocation  map referencing blocks that do not appear to contain inodes.</li>
<li>Size checks:number of blocks  claimed  by  inode  inconsistent with  inode  size, directory size not block aligned, inode size not consistent with inode format.</li>
<li>Directory checks:bad magic numbers in directory blocks, incorrect  number  of  entries  in  a directory block, bad freespace information in a directory leaf block,  entry  pointing  to  an unallocated  (free) or out of range inode, overlapping entries, missing or incorrect dot and dotdot  entries,  entries  out  of hashvalue  order, incorrect internal directory pointers, directory type not consistent with inode format and size.</li>
<li>Pathname checks:files or directories not referenced by a pathname starting from the filesystem root, illegal pathname components.</li>
<li>Link count checks:link counts that do not agree with the  number of directory references to the inode.</li>
<li>Freemap  checks: blocks  claimed  free by the freemap but also claimed by an inode, blocks unclaimed  by  any  inode  but  not appearing in the freemap.</li>
<li>Super  Block  checks: total free block and/or free i-node count incorrect, filesystem geometry inconsistent, secondary and primary superblocks contradictory.</li>
</ol>
<h4 id="Recover-file"><a href="#Recover-file" class="headerlink" title="Recover file"></a>Recover file</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ ls -ih</span><br><span class="line">70179 -r-xr-xr-x 1 solexa solexa    0 Jan 10  2013 report.htm</span><br><span class="line"></span><br><span class="line">$ xfs_db -r /dev/sdb -c <span class="string">&quot;inode 70179&quot;</span> -c <span class="string">&quot;bmap&quot;</span></span><br><span class="line">data offset 0 startblock 2459337662 (9/43418558) count 1 flag 0a</span><br><span class="line"></span><br><span class="line">$ agblocks=$(xfs_db -r /dev/sdb -c sb -c p | grep ^agblocks | sed <span class="string">&#x27;s/.* = //&#x27;</span>)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$agblocks</span></span><br><span class="line">268435455</span><br><span class="line">$ agcount=9</span><br><span class="line">$ b=43418558</span><br><span class="line">$ c=1</span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="variable">$agblocks</span>*<span class="variable">$agcount</span>+<span class="variable">$b</span>)) </span><br><span class="line">2459337653</span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">2459337662</span>-<span class="number">9</span>))</span><br><span class="line">2459337653</span><br><span class="line"></span><br><span class="line">$ dd <span class="keyword">if</span>=/dev/sdb bs=4096 skip=$((<span class="variable">$agblocks</span>*<span class="variable">$agcount</span>+<span class="variable">$b</span>)) count=<span class="variable">$c</span> of=/tmp/report.htm</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">4096 bytes (4.1 kB) copied, 4.6345e-05 s, 88.4 MB/s</span><br><span class="line"></span><br><span class="line">$ cat /tmp/report.htm   <span class="comment"># file come back</span></span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=gbk&quot;</span>/&gt;</span><br><span class="line">&lt;style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="xfs-estimate"><a href="#xfs-estimate" class="headerlink" title="xfs_estimate"></a>xfs_estimate</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xfs_estimate -v &#x2F;mnt</span><br><span class="line">directory                               bsize   blocks    megabytes    logsize</span><br><span class="line">&#x2F;mnt                                     4096     1138        4.4MB    4096000</span><br><span class="line">$ xfs_estimate -v -b 512 &#x2F;mnt</span><br><span class="line">directory                               bsize   blocks    megabytes    logsize</span><br><span class="line">&#x2F;mnt                                      512     1138        0.6MB     512000</span><br><span class="line">$ xfs_estimate -v -b 4096 &#x2F;mnt</span><br><span class="line">directory                               bsize   blocks    megabytes    logsize</span><br><span class="line">&#x2F;mnt                                     4096     1138        4.4MB    4096000</span><br></pre></td></tr></table></figure>

<h3 id="xfs-info"><a href="#xfs-info" class="headerlink" title="xfs_info"></a>xfs_info</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_info /mnt</span><br><span class="line">meta-data=/dev/sdb               isize=512    agcount=16, agsize=4799984 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=76799744, imaxpct=25</span><br><span class="line">         =                       sunit=16     swidth=32 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=37504, version=2</span><br><span class="line">         =                       sectsz=512   sunit=16 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>

<h3 id="xfs-logprint"><a href="#xfs-logprint" class="headerlink" title="xfs_logprint"></a>xfs_logprint</h3><p>-t print out transactional view of an xfs log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">xfs_logprint -t  /dev/sdb</span><br><span class="line">xfs_logprint:</span><br><span class="line">xfs_logprint: /dev/sdb contains a mounted and writable filesystem</span><br><span class="line">    data device: 0x810</span><br><span class="line">    <span class="built_in">log</span> device: 0x810 daddr: 307199104 length: 300032</span><br><span class="line"></span><br><span class="line">    <span class="built_in">log</span> tail: 256 head: 512 state: &lt;DIRTY&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LOG REC AT LSN cycle 1 block 256 (0x1, 0x100)</span><br><span class="line">============================================================================</span><br><span class="line">TRANS: tid:0xb4cdd37c  <span class="built_in">type</span>:SWAPEXT  <span class="comment">#items:2  trans:0xb4cdd37c  q:0x20bcbe0</span></span><br><span class="line">BUF: cnt:2 total:2 a:0x20bd010 len:24 a:0x20bd060 len:384</span><br><span class="line">	BUF:  <span class="comment">#regs:2   start blkno:0x0   len:1   bmap size:1   flags:0x9000</span></span><br><span class="line">	SUPER Block Buffer:</span><br><span class="line"></span><br><span class="line">LOG REC AT LSN cycle 1 block 384 (0x1, 0x180)</span><br><span class="line">============================================================================</span><br><span class="line">TRANS: tid:0xb84fc956  <span class="built_in">type</span>:SWAPEXT  <span class="comment">#items:2  trans:0xb84fc956  q:0x20bcbe0</span></span><br><span class="line">BUF: cnt:2 total:2 a:0x20bd010 len:24 a:0x20cd250 len:384</span><br><span class="line">	BUF:  <span class="comment">#regs:2   start blkno:0x0   len:1   bmap size:1   flags:0x9000</span></span><br><span class="line">	SUPER Block Buffer:</span><br></pre></td></tr></table></figure>
<p>-i extract and print inode info<br>-q extract and print quota info<br>-e, exit when an error is found in the log<br>-c, Attempt to continue when an error is detected</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xfs_logprint -C xfs.log /dev/sdb</span><br></pre></td></tr></table></figure>

<h4 id="About-barriers"><a href="#About-barriers" class="headerlink" title="About barriers"></a><a target="_blank" rel="noopener" href="https://xfs.org/index.php/XFS_FAQ#Write_barrier_support.">About barriers</a></h4><p>Write barrier support is enabled by default in XFS since kernel version 2.6.17. It is disabled by mounting the filesystem with “nobarrier”. Barrier support will flush the write back cache at the appropriate times (such as on XFS log writes). </p>
<h3 id="The-file-block"><a href="#The-file-block" class="headerlink" title="The file block"></a>The file block</h3><p>sdc is the 4K block device, the xfs count by 512 Bytes  </p>
<p>Here is the 1MB file, it ‘s aligned   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ df -h /mnt</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdc2       948M   36M  913M   4% /mnt</span><br><span class="line"></span><br><span class="line">$ xfs_info /dev/sdc2</span><br><span class="line">meta-data=/dev/sdc2              isize=512    agcount=4, agsize=61056 blks</span><br><span class="line">         =                       sectsz=4096  attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=1 spinodes=0 rmapbt=0</span><br><span class="line">         =                       reflink=0</span><br><span class="line">data     =                       bsize=4096   blocks=244224, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=1605, version=2</span><br><span class="line">         =                       sectsz=4096  sunit=1 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line"></span><br><span class="line">$ dd <span class="keyword">if</span>=/dev/zero of=<span class="built_in">test</span> bs=1M count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00214354 s, 489 MB/s</span><br><span class="line"></span><br><span class="line">$ ls -shl</span><br><span class="line">total 1.0M</span><br><span class="line">1.0M -rw-r--r-- 1 root root 1.0M April 17 22:16 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">$ xfs_bmap -v ./<span class="built_in">test</span></span><br><span class="line">./<span class="built_in">test</span>:</span><br><span class="line"> EXT: FILE-OFFSET      BLOCK-RANGE      AG AG-OFFSET        TOTAL</span><br><span class="line">   0: [0..2047]:       160..2207         0 (160..2207)       2048</span><br><span class="line"></span><br><span class="line"><span class="comment">#BLOCK-RANGE start at 160 block and total blocks: 2048; 2048 x 512</span></span><br><span class="line">$ dd <span class="keyword">if</span>=/dev/sdc2 of=dd-test bs=512 skip=160 count=2048</span><br><span class="line">2048+0 records <span class="keyword">in</span></span><br><span class="line">2048+0 records out</span><br><span class="line">1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00779449 s, 135 MB/s</span><br><span class="line"></span><br><span class="line">$ du -hs <span class="built_in">test</span> dd-test</span><br><span class="line">1.0M	<span class="built_in">test</span></span><br><span class="line">1.0M	dd-test</span><br><span class="line"></span><br><span class="line">$ md5sum ./*</span><br><span class="line">b6d81b360a5672d80c27430f39153e2c  ./<span class="built_in">test</span></span><br><span class="line">b6d81b360a5672d80c27430f39153e2c  ./dd-test</span><br></pre></td></tr></table></figure>

<p>Not aligned example  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">$ openssl rand -hex 255 &gt; flag1</span><br><span class="line">$ openssl rand -hex 255 &gt; flag2</span><br><span class="line">$ openssl rand -hex 255 &gt; flag3</span><br><span class="line">$ cat flag* &gt; flag</span><br><span class="line"></span><br><span class="line">$ xfs_bmap -v ./flag</span><br><span class="line">./flag:</span><br><span class="line"> EXT: FILE-OFFSET      BLOCK-RANGE      AG AG-OFFSET          TOTAL</span><br><span class="line">   0: [0..7]:          1052728..1052735  0 (1052728..1052735)     8</span><br><span class="line"></span><br><span class="line"><span class="comment">## it &#x27;s 4K file ?</span></span><br><span class="line">$ dd <span class="keyword">if</span>=/dev/sdc2 of=flag-copy bs=512 skip=1052728 count=8</span><br><span class="line">8+0 records <span class="keyword">in</span></span><br><span class="line">8+0 records out</span><br><span class="line">4096 bytes (4.1 kB, 4.0 KiB) copied, 0.00178995 s, 2.3 MB/s</span><br><span class="line"></span><br><span class="line">$ md5sum flag-copy flag</span><br><span class="line">fd39ee533070b2bbd46f38f81e16c72f  flag-copy</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ hexdump -C flag</span><br><span class="line">...</span><br><span class="line">000005c0  34 33 31 66 63 62 63 30  64 35 66 31 31 32 63 33  |431fcbc0d5f112c3|</span><br><span class="line">000005d0  64 34 34 35 30 30 33 35  65 38 35 37 33 38 36 63  |d4450035e857386c|</span><br><span class="line">000005e0  32 34 32 33 31 34 39 30  36 32 64 62 36 39 61 30  |2423149062db69a0|</span><br><span class="line">000005f0  64 33 31 66 61 64 34 66  38 37 62 30 0a           |d31fad4f87b0.|</span><br><span class="line">000005fd</span><br><span class="line"></span><br><span class="line">$ hexdump -C flag-copy</span><br><span class="line">000005d0  64 34 34 35 30 30 33 35  65 38 35 37 33 38 36 63  |d4450035e857386c|</span><br><span class="line">000005e0  32 34 32 33 31 34 39 30  36 32 64 62 36 39 61 30  |2423149062db69a0|</span><br><span class="line">000005f0  64 33 31 66 61 64 34 66  38 37 62 30 0a 00 00 00  |d31fad4f87b0....|</span><br><span class="line">00000600  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00001000</span><br><span class="line"></span><br><span class="line"><span class="comment"># it &#x27;s just 1533 Bytes, not 4K</span></span><br><span class="line">$  <span class="built_in">stat</span> flag</span><br><span class="line">  File: flag</span><br><span class="line">  Size: 1533      	Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 822h/2082d	Inode: 105         Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2020-04-18 01:00:50.197468163 +0800</span><br><span class="line">Modify: 2020-04-18 01:00:48.173261473 +0800</span><br><span class="line">Change: 2020-04-18 01:00:48.173261473 +0800</span><br><span class="line"> Birth: -</span><br><span class="line"></span><br><span class="line"><span class="comment"># just overwrite the 1533 Bytes in the 4K file...</span></span><br><span class="line">$  dd <span class="keyword">if</span>=/dev/sdc2 of=flag-copy conv=notrunc bs=1 skip=$((<span class="number">1052728</span>*<span class="number">512</span>)) count=1533</span><br><span class="line">1533+0 records <span class="keyword">in</span></span><br><span class="line">1533+0 records out</span><br><span class="line">1533 bytes (1.5 kB, 1.5 KiB) copied, 0.00655476 s, 234 kB/s</span><br><span class="line">root@homerl-To-be-filled-by-O-E-M:/mnt<span class="comment"># md5sum flag-copy flag</span></span><br><span class="line">fd39ee533070b2bbd46f38f81e16c72f  flag-copy</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag</span><br><span class="line"></span><br><span class="line">$ ls -shl</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  1.5K April  18 01:00 flag</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag1</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag2</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag3</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  4.0K April  18 01:07 flag-copy</span><br><span class="line"></span><br><span class="line">$ rm flag-copy</span><br><span class="line">$ dd <span class="keyword">if</span>=/dev/sdc2 of=flag-copy conv=notrunc bs=1 skip=$((<span class="number">1052728</span>*<span class="number">512</span>)) count=1533</span><br><span class="line">$ ls -shl</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  1.5K April  18 01:00 flag</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag1</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag2</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root   511 April  18 01:00 flag3</span><br><span class="line"> 4.0K -rw-r--r-- 1 root root  1.5K April  18 01:07 flag-copy</span><br><span class="line"></span><br><span class="line">$ md5sum flag-copy flag</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag-copy</span><br><span class="line">a24e60a419445879e2be061ea414e301  flag</span><br></pre></td></tr></table></figure>

<p>Big file   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">$ dd <span class="keyword">if</span>=/dev/zero of=big-file bs=1M count=1000</span><br><span class="line">$ xfs_bmap -v big-file </span><br><span class="line">big-file:</span><br><span class="line"> EXT: FILE-OFFSET         BLOCK-RANGE      AG AG-OFFSET          TOTAL</span><br><span class="line">   0: [0..1048447]:       4280..1052727     0 (4280..1052727)  1048448</span><br><span class="line">   1: [1048448..2047999]: 1953376..2952927  1 (96..999647)      999552</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">stat</span> big-file </span><br><span class="line">  File: big-file</span><br><span class="line">  Size: 1048576000	Blocks: 2048000    IO Block: 4096   regular file</span><br><span class="line">Device: 822h/2082d	Inode: 104         Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2020-04-18 01:00:37.464167969 +0800</span><br><span class="line">Modify: 2020-04-18 01:00:39.196344841 +0800</span><br><span class="line">Change: 2020-04-18 01:38:26.999014414 +0800</span><br><span class="line"> Birth: -</span><br><span class="line"></span><br><span class="line">$ hexdump -C big-file</span><br><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">3e800000</span><br><span class="line"></span><br><span class="line">$ cat flag1 flag2 flag3 </span><br><span class="line">56c80696e82e2f88984e369e5dcee45142b3682020adf733e68f692a70747b99b307b15022ed21f3d843cba8abf52e3432e6203fe2bf5bc2ecd79891dcfc133ae3350c0b8ea8d5c7d9e449938959a411ee96ca9a56653b34f2de236ddd3007b30a9876bcedcfeb73489d17a263b0af5b7a069848280dc55ecfeaccca6af46f0a637d97fcd94dd3c3d75bd871398753da6abe52d3c8d54abc6339acb094a2c33a1b772c8d51a0306ad20920c8a749d334030b5a072049572fc2d7c1183e575bd66aa2020f115b62d05bb15ddd07000e6fde5387d2807ec21605286190bfe3b77e2d3f4991bed0a716c8419ca5d4ddd7815f39e3579090040ff77be5fe730dbc</span><br><span class="line">6baa2fc5a2115063030d7d4a8633974f2fc14cd502ec6df38f575d2d6dcff299b7dcdeca9d4dd513d7d77a6099aa8604108628109f871ac414942f0f5efe58b61f5b160f5bdf34bb30ff6655f958b62731c0097ed92090ec1c2433e7baa0bca9e385f9c7b3dd1188aaedaefdfd6a9e6dadaf6bd08a7096c2219b4c8e9d9cf1daa0bbeb3dd9994666cbbd1c45e5d07afefbe0af42f508b49869f54edd34865423cb0bdd71a99f6c2f0f19f1aa494f0694b6baa3ebe090b3aeb6443b7b5f210b00560aba8bdbfdd15ab8ae909c6d99477dde90a5ad9ac28338dbe2abc663cb8092519b7258fdbba92f62d2c9dd70861274acb5180dbd8371ccf6469d5fc4940c</span><br><span class="line">b621e3e516b0a54defdde7e05b846dc8a91c29f191d2f74305b7d6e5f742c5cb1ce793450b83f2d1e5f692d78994d558ed47e8e3fe58db32aab4dc87d10452db5cf99bab7fa5915b30cc6844e4d1393bd41c56c65a7ed8eb916976d122dbf955035bd2c39ba320838d39b0e1d4cee3db53c35bfa860412f4aeef71f3e3b4d6d1edaff216e385fa667c0e08cbd780e1246adb8ae932a261f0df9c8e4a0e627e6775ddb602308efaa49e0e6413edcb577660b0ea749a3b737a00f9ef56dbb834505f4ce0950a04dce4c159d2c459f382e4d41cf517c4329d3b241e5d8eb8872b0bdd431fcbc0d5f112c3d4450035e857386c2423149062db69a0d31fad4f87b0</span><br><span class="line"></span><br><span class="line">$ dd <span class="keyword">if</span>=flag1 of=/dev/sdc2 bs=512 seek=4280</span><br><span class="line">0+1 records <span class="keyword">in</span></span><br><span class="line">0+1 records out</span><br><span class="line">511 bytes copied, 0.000275702 s, 1.9 MB/s</span><br><span class="line"></span><br><span class="line">$ dd <span class="keyword">if</span>=flag2 of=/dev/sdc2 bs=512 seek=1953376</span><br><span class="line">0+1 records <span class="keyword">in</span></span><br><span class="line">0+1 records out</span><br><span class="line">511 bytes copied, 0.0125594 s, 40.7 kB/s</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> ~</span><br><span class="line">$ umount /mnt</span><br><span class="line">$ mount /dev/sdc2 /mnt</span><br><span class="line">$ <span class="built_in">cd</span> /mnt/</span><br><span class="line">$ hexdump -C big-file</span><br><span class="line">00000000  35 36 63 38 30 36 39 36  65 38 32 65 32 66 38 38  |56c80696e82e2f88|</span><br><span class="line">.....</span><br><span class="line">000001f0  66 37 37 62 65 35 66 65  37 33 30 64 62 63 0a 00  |f77be5fe730dbc..|</span><br><span class="line">00000200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">1fff0000  36 62 61 61 32 66 63 35  61 32 31 31 35 30 36 33  |6baa2fc5a2115063|</span><br><span class="line">.....</span><br><span class="line">1fff01f0  66 36 34 36 39 64 35 66  63 34 39 34 30 63 0a 00  |f6469d5fc4940c..|</span><br><span class="line">1fff0200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">3e800000</span><br><span class="line"></span><br><span class="line">$ cp big-file big-file-2</span><br><span class="line">$ xfs_bmap -v big-file-2</span><br><span class="line">big-file-2:</span><br><span class="line"> EXT: FILE-OFFSET         BLOCK-RANGE      AG AG-OFFSET           TOTAL</span><br><span class="line">   0: [0..900551]:        1052728..1953279  0 (1052728..1953279) 900552</span><br><span class="line">   1: [900552..902695]:   160..2303         0 (160..2303)          2144</span><br><span class="line">   2: [902696..1854375]:  2952928..3904607  1 (999648..1951327)  951680</span><br><span class="line">   3: [1854376..2047999]: 4975584..5169207  2 (1069024..1262647) 193624</span><br><span class="line">$ big-file*</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file-2</span><br><span class="line"></span><br><span class="line">$ ls -lhs big-file-2-p* </span><br><span class="line">440M -rw-r--r-- 1 root root 440M April  18 01:54 big-file-2-p1</span><br><span class="line">1.1M -rw-r--r-- 1 root root 1.1M April  18 01:55 big-file-2-p2</span><br><span class="line">465M -rw-r--r-- 1 root root 465M April  18 01:55 big-file-2-p3</span><br><span class="line"> 95M -rw-r--r-- 1 root root  95M April  18 01:56 big-file-2-p4</span><br><span class="line"></span><br><span class="line"><span class="comment"># if the file not out of order</span></span><br><span class="line">$ hexdump -C big-file-2-p1 </span><br><span class="line">00000000  35 36 63 38 30 36 39 36  65 38 32 65 32 66 38 38  |56c80696e82e2f88|</span><br><span class="line">...</span><br><span class="line">000001f0  66 37 37 62 65 35 66 65  37 33 30 64 62 63 0a 00  |f77be5fe730dbc..|</span><br><span class="line">00000200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">1b7b9000</span><br><span class="line"></span><br><span class="line">$ hexdump -C big-file-2-p2 </span><br><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">0010c000</span><br><span class="line"></span><br><span class="line">$ hexdump -C big-file-2-p3</span><br><span class="line">00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">0472b000  36 62 61 61 32 66 63 35  61 32 31 31 35 30 36 33  |6baa2fc5a2115063|</span><br><span class="line">...</span><br><span class="line">0472b1f0  66 36 34 36 39 64 35 66  63 34 39 34 30 63 0a 00  |f6469d5fc4940c..|</span><br><span class="line">0472b200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">1d0b0000</span><br><span class="line"></span><br><span class="line"><span class="comment"># second flag show at 1fff0000 (536805376)</span></span><br><span class="line"><span class="comment"># p1 end at 1b7b9000 (461082624)</span></span><br><span class="line"><span class="comment"># p2 from 0x0 to 0010c000 (1097728)</span></span><br><span class="line"><span class="comment"># p3 from 0x0 to 0472b000 (74625024)</span></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">461082624</span>+<span class="number">1097728</span>+<span class="number">74625024</span>))</span><br><span class="line">536805376</span><br><span class="line"></span><br><span class="line"><span class="comment"># it &#x27;s the 1fff0000 (536805376)</span></span><br><span class="line"></span><br><span class="line">$ cat big-file-2-p1 big-file-2-p2 big-file-2-p3 big-file-2-p4 &gt; big-file-3</span><br><span class="line">$ md5sum big-file-2 big-file-3</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file-2</span><br><span class="line">c14a4c7a949d75c9b855aa0ebd8bf67f  big-file-3</span><br></pre></td></tr></table></figure>

<h3 id="copy-from-this-article"><a href="#copy-from-this-article" class="headerlink" title="copy from this article"></a><a target="_blank" rel="noopener" href="https://righteousit.wordpress.com/2018/05/21/xfs-part-1-superblock/">copy from this article</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">00000000  58 46 53 42 00 00 10 00  00 00 00 00 06 <span class="built_in">fc</span> 85 00  |XFSB............|</span><br><span class="line">magicnum = 0x58465342  <span class="comment"># 0-3 bytes mangic num: &quot;58 46 53 42&quot; XFSB</span></span><br><span class="line">blocksize = 4096       <span class="comment"># 4-7  &quot;00 00 10 00&quot;</span></span><br><span class="line">dblocks = 117212416    <span class="comment"># 8-15 &quot;00 00 00 00 06 fc 85 00&quot; Total blocks in file system</span></span><br><span class="line">                       <span class="comment"># echo $((117212416*4096))=480102055936 ;</span></span><br><span class="line">                  <span class="comment"># blockdev --getsz /dev/sdg1 937699328; echo $((937699328*512))=480102055936</span></span><br><span class="line"></span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">rblocks = 0 <span class="comment"># 16-23    Num blocks in real-time device</span></span><br><span class="line">rextents = 0 <span class="comment"># 24-31    Num extents in real-time device</span></span><br><span class="line"></span><br><span class="line">00000020  ce 72 48 bd 0f 2e 4b 04  a4 77 bc <span class="built_in">cd</span> a5 91 67 <span class="built_in">cd</span>  |.rH...K..w....g.|</span><br><span class="line">uuid = ce7248bd-0f2e-4b04-a477-bccda59167cd</span><br><span class="line"></span><br><span class="line">00000030  00 00 00 00 04 00 00 07  00 00 00 00 00 00 00 60  |...............`|</span><br><span class="line">logstart = 67108871  <span class="comment">## 48-55 bytes,First block of journal &quot;00 00 00 00 04 00 00 07&quot;</span></span><br><span class="line">rootino = 96  <span class="comment">## 56-63 bytes,Root directory&#x27;s inode &quot;00 00 00 00 00 00 00 60&quot;</span></span><br><span class="line"></span><br><span class="line">00000040  00 00 00 00 00 00 00 61  00 00 00 00 00 00 00 62  |.......a.......b|</span><br><span class="line">rbmino = 97 <span class="comment"># 64-71    Real-time extents bitmap inode</span></span><br><span class="line">rsumino = 98 <span class="comment"># 72-79    Real-time bitmap summary inode</span></span><br><span class="line"></span><br><span class="line">00000050  00 00 00 01 01 bf 21 40  00 00 00 04 00 00 00 00  |......!@........|</span><br><span class="line">rextsize = 1 <span class="comment">#80-83    Real-time extent size (in blocks)</span></span><br><span class="line">agblocks = 29303104 <span class="comment">#84-87 1bf2140=29303104   single AG size (in blocks), there are 4x AGs , awk &#x27;BEGIN&#123;print 29303104*4096*4&#125;&#x27; = 480102055936, same with dblocks echo $((117212416*4096))=480102055936</span></span><br><span class="line">agcount = 4    <span class="comment">#88-91    Number of AGs # 4 x AG</span></span><br><span class="line">rbmblocks = 0  <span class="comment">#92-95    Num of real-time bitmap blocks</span></span><br><span class="line"></span><br><span class="line">00000060  00 00 df 90 bc a5 10 00  02 00 00 08 00 00 00 00  |................|</span><br><span class="line">logblocks = 57232 <span class="comment"># 96-99, 00 00 df 90, Num of journal blocks</span></span><br><span class="line">versionnum = 0xbca5 <span class="comment">#100-101 File system version and flags</span></span><br><span class="line">sectsize = 4096 <span class="comment">#102-103, 10 00 ,Sector size</span></span><br><span class="line">inodesize = 512 <span class="comment">#104-105, 02 00 ,inode size</span></span><br><span class="line">inopblock = 8   <span class="comment">#106-107, indoes/block, 00 08</span></span><br><span class="line"></span><br><span class="line">                                              <span class="comment">#108</span></span><br><span class="line">00000060  00 00 df 90 bc a5 10 00  02 00 00 08 00 00 00 00  |................|</span><br><span class="line">00000070  00 00 00 00 00 00 00 00  0c 0c 09 03 19 00 00 19  |................|</span><br><span class="line">fname = <span class="string">&quot;\000\000\000\000\000\000\000\000\000\000\000\000&quot;</span> <span class="comment">#108-119 file system name, not set</span></span><br><span class="line">                                  <span class="comment">#120</span></span><br><span class="line">00000070  00 00 00 00 00 00 00 00  0c 0c 09 03 19 00 00 19  |................|</span><br><span class="line">blocklog = 12 <span class="comment">#120      log2(block size)           0xc</span></span><br><span class="line">sectlog = 12  <span class="comment">#121      log2(sector size)          0xc</span></span><br><span class="line">inodelog = 9  <span class="comment">#122      log2(inode size)           0x9</span></span><br><span class="line">inopblog = 3  <span class="comment">#123      log2(inode/block)          0x3</span></span><br><span class="line">agblklog = 25 <span class="comment">#124      log2(AG size) rounded up   0x19</span></span><br><span class="line"><span class="comment"># From logstart = 67108871(10) 0x4000007  ## 48-55 bytes First block of journal</span></span><br><span class="line"><span class="comment">#0x4000007 =      10          0 000 000 000 000 000 000 000 111</span></span><br><span class="line"><span class="comment">#AG# in upper 2 bits---/\---22 bits of relative block offset</span></span><br><span class="line"><span class="comment">#10 means beginning of AG 2</span></span><br><span class="line"><span class="comment">#111 means the journal starts at relative block offset 7</span></span><br><span class="line"><span class="comment">#The physical block offset can be calculated as follows</span></span><br><span class="line"><span class="comment">#AG num (2) x  (blocks per ag, #84-87, agblocks = 29303104) + (relative block offset 7)=58606215</span></span><br><span class="line"><span class="comment">#dd if=/dev/sdg1 bs=4096 skip=$((2*29303104 + 4)) count=1 | xxd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#inode addr</span></span><br><span class="line"><span class="comment">#123(3) + #124(25) = 28</span></span><br><span class="line"><span class="comment">#The inode address of the root directory just inode offset 64 from AG 0</span></span><br><span class="line"><span class="comment"># rootino = 96 0x60  ## 56-63 bytes,Root directory&#x27;s inode</span></span><br><span class="line"></span><br><span class="line">rextslog = 0  <span class="comment"># 125      log2(real-time extents)   0</span></span><br><span class="line">inprogress = 0 <span class="comment"># 126      log2(real-time extents)  0</span></span><br><span class="line">imax_pct = 25  <span class="comment"># 127      log2(real-time extents)  0x19</span></span><br><span class="line"></span><br><span class="line">00000080  00 00 00 00 00 00 00 40  00 00 00 00 00 00 00 3b  |.......@.......;|</span><br><span class="line">icount = 128  <span class="comment"># 128-135  Number of allocated inodes , 0x40=64=1000000 2^7=128</span></span><br><span class="line">ifree = 119   <span class="comment"># 136-143  Number of free inodes, 3b=111011, 2^1+2^2+2^0+2^4+2^5+2^6=119</span></span><br><span class="line">??? <span class="comment"># not understand</span></span><br><span class="line"></span><br><span class="line">00000090  00 00 00 00 06 f7 bd 4b  00 00 00 00 00 00 00 00  |.......K........|</span><br><span class="line">fdblocks = 116890690 <span class="comment">#144-151  Number of free blocks</span></span><br><span class="line">frextents = 0        <span class="comment">#152-159  Number of free real-time extents</span></span><br><span class="line"></span><br><span class="line">000000a0  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br><span class="line">uquotino = null <span class="comment"># 160-167  User quota inode</span></span><br><span class="line">gquotino = null <span class="comment"># 168-175  Group quota inode</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000000b0  00 00 00 00 00 00 00 04  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">qflags = 0 <span class="comment">#176-177  Quota flags</span></span><br><span class="line">flags = 0  <span class="comment">#178      Misc flags</span></span><br><span class="line">shared_vn = 0  <span class="comment">#178      Misc flags</span></span><br><span class="line">inoalignmt = 4 <span class="comment">#180-183  Inode alignment (in blocks)</span></span><br><span class="line">unit = 0       <span class="comment">#184-187  RAID unit (in blocks)</span></span><br><span class="line">width = 0      <span class="comment">#188-191  RAID stripe (in blocks)</span></span><br><span class="line"></span><br><span class="line">000000c0  00 0c 10 00 00 00 10 00  00 00 01 8a 00 00 01 8a  |................|</span><br><span class="line">dirblklog = 0    <span class="comment">#192      log2(dir blk allocation granularity)</span></span><br><span class="line">logsectlog = 12  <span class="comment">#193      log2(sector size of externl journal device)</span></span><br><span class="line">logsectsize = 4096 <span class="comment">#194-195  Sector size of external journal device</span></span><br><span class="line">logsunit = 4096  <span class="comment">#196-199  Stripe/unit size of external journal device</span></span><br><span class="line">features2 = 0x18a <span class="comment">#200-203  Additional flags</span></span><br><span class="line">bad_features2 = 0x18a <span class="comment">#204-207  Repeat additional flags (for alignment)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000000d0  00 00 00 00 00 00 00 00  00 00 00 01 00 00 00 00  |................|</span><br><span class="line">features_compat = 0   <span class="comment">#204-207  Repeat additional flags (for alignment)</span></span><br><span class="line">features_ro_compat = 0 <span class="comment">#212-215  Read-only feature flags</span></span><br><span class="line">features_incompat = 0x1 <span class="comment">#216-219  Read-write incompatibility flags</span></span><br><span class="line">features_log_incompat = 0 <span class="comment">#220-223  Read-write incompat flags for log (unused)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">000000e0  1f c6 e0 48 00 00 00 00  ff ff ff ff ff ff ff ff  |...H............|</span><br><span class="line">crc = 0x64b05119 (correct)  <span class="comment">#224-227  CRC32 checksum for superblock</span></span><br><span class="line">spino_align = 0  <span class="comment">#228-231  Sparse inode alignment</span></span><br><span class="line">pquotino = null <span class="comment">#232-239  Project quota inode</span></span><br><span class="line"></span><br><span class="line">000000f0  00 00 00 01 00 00 00 90  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">lsn = 0x1000000c8 240-247  Log seq number of last superblock update</span><br><span class="line">meta_uuid = 00000000-0000-0000-0000-000000000000 <span class="comment"># 248-263  UUID used if INCOMPAT_META_UUID feature      zeroed</span></span><br><span class="line"></span><br><span class="line">                                  <span class="comment">#264</span></span><br><span class="line">00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">264-271  If INCOMPAT_META_RMAPBT, inode of RM btree   zeroed</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/11/26/xfs/">http://yoursite.com/2019/11/26/xfs/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/xfs/">xfs</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/11/26/smartctl/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">smartctl</div></div></a></div><div class="next-post pull-right"><a href="/2019/10/31/bcc/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">bcc tools</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>