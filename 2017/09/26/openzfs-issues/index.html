<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>openzfs issues | 己不由心，身又岂能由己</title><meta name="keywords" content="zfs"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="OpenZFS on linux issues record">
<meta property="og:type" content="article">
<meta property="og:title" content="openzfs issues">
<meta property="og:url" content="http://yoursite.com/2017/09/26/openzfs-issues/index.html">
<meta property="og:site_name" content="己不由心，身又岂能由己">
<meta property="og:description" content="OpenZFS on linux issues record">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg">
<meta property="article:published_time" content="2017-09-26T08:30:03.000Z">
<meta property="article:modified_time" content="2020-10-09T12:57:28.238Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="zfs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2017/09/26/openzfs-issues/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-10-09 20:57:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/244247-guts.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-SMR-HDD"><span class="toc-number">1.</span> <span class="toc-text">About SMR HDD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#I-don-%E2%80%98t-think-it-%E2%80%98s-the-MMP-issue-because-the-same-issue-in-OpenZFS-0-6-5-7"><span class="toc-number">2.</span> <span class="toc-text">I don ‘t think it ‘s the MMP issue, because the same issue in OpenZFS 0.6.5.7</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Reproduce-the-issue-and-my-work-experiences"><span class="toc-number">2.1.</span> <span class="toc-text">Reproduce the issue and my work experiences.</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Looks-like-MMP-will-cause-more-issues-on-zfs-0-7-9"><span class="toc-number">2.1.1.</span> <span class="toc-text">Looks like MMP will cause more issues on zfs 0.7.9</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Openzfs-issue"><span class="toc-number">2.2.</span> <span class="toc-text">Openzfs issue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zpool-could-not-mount"><span class="toc-number">3.</span> <span class="toc-text">[zpool could not mount]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Replace-FX-parameter"><span class="toc-number">4.</span> <span class="toc-text">[Replace FX parameter]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#very-dangerours"><span class="toc-number">4.1.</span> <span class="toc-text">very dangerours</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Import-zpool-hang-single-dev-just-respond-very-slow-cause-all-zpool-command-hang"><span class="toc-number">4.2.</span> <span class="toc-text">Import zpool hang, single dev just respond very slow cause all zpool command hang</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenZFS-multihost-writes-failed-about-Invalid-DWORD-count"><span class="toc-number">5.</span> <span class="toc-text">OpenZFS multihost writes failed (about Invalid DWORD count)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#For-Low-memroy-server"><span class="toc-number">6.</span> <span class="toc-text">For Low memroy server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zpool-could-not-be-import-because-single-HDD-failure-in-raidz3"><span class="toc-number">7.</span> <span class="toc-text">zpool could not be import because single HDD failure in raidz3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#I-guess-there-are-4-x-HDDs-could-read-zfs-metadata-in-this-zpool"><span class="toc-number">7.1.</span> <span class="toc-text">I guess there are 4 x HDDs could read zfs metadata in this zpool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ban-the-sddi"><span class="toc-number">7.2.</span> <span class="toc-text">Ban the sddi</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Single-HDD-hang-cause-LSI-HBA-reset-self"><span class="toc-number">8.</span> <span class="toc-text">Single HDD hang cause LSI HBA reset self</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Error-ICRC-ABRT-at-LBA-in-SATA-device"><span class="toc-number">9.</span> <span class="toc-text">Error: ICRC, ABRT at LBA in SATA device</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enable-TLER-ERC-CCTL-function-for-SATA-device"><span class="toc-number">10.</span> <span class="toc-text">Enable TLER&#x2F;ERC&#x2F;CCTL function for SATA device</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SAS-smart-status"><span class="toc-number">11.</span> <span class="toc-text">SAS smart status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#replace-sas-devices"><span class="toc-number">12.</span> <span class="toc-text">replace sas devices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zfs-IO-merging-issue"><span class="toc-number">13.</span> <span class="toc-text">zfs IO merging issue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Disable-the-throttle-increase-write-throughput"><span class="toc-number">14.</span> <span class="toc-text">Disable the throttle, increase write throughput</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">己不由心，身又岂能由己</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">openzfs issues</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2017-09-26T08:30:03.000Z" title="Created 2017-09-26 16:30:03">2017-09-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-10-09T12:57:28.238Z" title="Updated 2020-10-09 20:57:28">2020-10-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Storage/">Storage</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>OpenZFS on linux issues record</p>
<a id="more"></a>

<h3 id="About-SMR-HDD"><a href="#About-SMR-HDD" class="headerlink" title="About SMR HDD"></a><a target="_blank" rel="noopener" href="https://github.com/zfsonlinux/zfs/issues/4877">About SMR HDD</a></h3><p>Another thing you might try is to leave the block size set at 1M but increase the zfs_vdev_aggregation_limit to 16M. This way as long as your doing 1M aligned IO you should never write partial blocks and leave holes. ZFS will aggregate these 1M blocks in to larger 16M IOs to the disk.</p>
<h3 id="I-don-‘t-think-it-‘s-the-MMP-issue-because-the-same-issue-in-OpenZFS-0-6-5-7"><a href="#I-don-‘t-think-it-‘s-the-MMP-issue-because-the-same-issue-in-OpenZFS-0-6-5-7" class="headerlink" title="I don ‘t think it ‘s the MMP issue, because the same issue in OpenZFS 0.6.5.7"></a>I don ‘t think it ‘s the MMP issue, because the same issue in OpenZFS 0.6.5.7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"> state: DEGRADED<br>status: One or more devices could not be used because the label is missing or<br>        invalid.  Sufficient replicas exist <span class="hljs-keyword">for</span> the pool to <span class="hljs-built_in">continue</span><br>        functioning <span class="hljs-keyword">in</span> a degraded state.<br></code></pre></td></tr></table></figure>

<h4 id="Reproduce-the-issue-and-my-work-experiences"><a href="#Reproduce-the-issue-and-my-work-experiences" class="headerlink" title="Reproduce the issue and my work experiences."></a>Reproduce the issue and my work experiences.</h4><ol>
<li>offline 4 disks at the single zpool<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> 1 &gt; /sys/block/sdc/device/delete<br><span class="hljs-built_in">echo</span> 1 &gt; /sys/block/sdd/device/delete<br><span class="hljs-built_in">echo</span> 1 &gt; /sys/block/sde/device/delete<br><span class="hljs-built_in">echo</span> 1 &gt; /sys/block/sdf/device/delete<br></code></pre></td></tr></table></figure></li>
<li>Plug out SAS expander or SAS Adapter or SAS cable you could reproduce it</li>
<li>Bad SAS cable, replace cable</li>
<li>SAS HBA,Expander,device Firmware update could reslove it<br> especially some of 10TB HDD old firmware, the hdd could be idle, hang, cause the system timeout<br><img src="http://homerl.github.io/2018/06/05/SAS-JBOD-issues/" alt="For more info"></li>
</ol>
<h5 id="Looks-like-MMP-will-cause-more-issues-on-zfs-0-7-9"><a href="#Looks-like-MMP-will-cause-more-issues-on-zfs-0-7-9" class="headerlink" title="Looks like MMP will cause more issues on zfs 0.7.9"></a>Looks like MMP will cause more issues on zfs 0.7.9</h5><p><a target="_blank" rel="noopener" href="https://github.com/zfsonlinux/zfs/issues/745">745</a>, The origin of Evil, because lustre, lustre will destory everything ,haha<br><a target="_blank" rel="noopener" href="https://github.com/zfsonlinux/zfs/issues/7045">7045</a>, because some of sas dev too busy, improve the check time<br><a target="_blank" rel="noopener" href="https://github.com/zfsonlinux/zfs/issues/7118">7118</a>, MMP cause more issues, if your JBOD/HBD/HDD has not return immediately<br><a target="_blank" rel="noopener" href="https://github.com/zfsonlinux/zfs/issues/7709">7709</a></p>
<p>zfs_multihost_fail_intervals:Max allowed period without a successful mmp write<br>zfs_multihost_import_intervals:Number of zfs_multihost_interval periods to wait for activity<br>zfs_multihost_interval:Milliseconds between mmp writes to each leaf</p>
<p>echo 100 &gt;  /sys/module/zfs/parameters/zfs_multihost_fail_intervals;<br>echo 200 &gt; /sys/module/zfs/parameters/zfs_multihost_import_intervals<br>echo 6000 &gt; /sys/module/zfs/parameters/zfs_multihost_interval<br>100 zfs_multihost_fail_intervals * 6000 zfs_multihost_interval = 600,000 ms</p>
<p>When  zfs_multihost_fail_intervals &gt; 0 then sequential mul‐tihost write failures will cause the pool to be  suspended.<br>      This occurs when zfs_multihost_fail_intervals * zfs_multi‐host_interval milliseconds have passed since the last successful<br>      multihost write.  This guarantees the activity test will see multihost writes if the pool is imported.</p>
<p>zfs_multihost_fail_intervals &gt;= zfs_multihost_import_intervals which could allow a pool to be imported on two nodes without any warnings.<br>MMP writes are done in the context of the sync thread</p>
<p>Looks like you have to reduce block timeout to avoid zfs MMP timeout, that too bad</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">  pool: zpool<br> state: ONLINE<br>status: The pool is suspended because multihost writes failed or were delayed;<br>	another system could import the pool undetected<br></code></pre></td></tr></table></figure>

<h4 id="Openzfs-issue"><a href="#Openzfs-issue" class="headerlink" title="Openzfs issue"></a>Openzfs issue</h4><p><img src="https://github.com/zfsonlinux/zfs/issues/7118" alt="7118"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> 100 &gt;/sys/module/zfs/parameters/zfs_multihost_history<br>&lt;run <span class="hljs-built_in">test</span>&gt;<br>cat /proc/spl/kstat/zfs/&lt;pool&gt;/multihost<br><br>or you could increase the timeout intervals at zfs_multihost_fail_intervals <br>my production env zfs version is 0.7.3<br><br><span class="hljs-comment">## get zpool log</span><br>zpool events -v<br></code></pre></td></tr></table></figure>

<h3 id="zpool-could-not-mount"><a href="#zpool-could-not-mount" class="headerlink" title="[zpool could not mount]"></a>[zpool could not mount]</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ zpool import -o <span class="hljs-built_in">readonly</span>=on -o cachefile=none tank<br>$ zpool import -Nm tank<br></code></pre></td></tr></table></figure>

<h3 id="Replace-FX-parameter"><a href="#Replace-FX-parameter" class="headerlink" title="[Replace FX parameter]"></a>[Replace FX parameter]</h3><h4 id="very-dangerours"><a href="#very-dangerours" class="headerlink" title="very dangerours"></a>very dangerours</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">### -F will cause unrecoverable result, don &#x27;t use it</span><br>$ zpool import -fFX -R /tmp/tank ost_11<br><br><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">### Just check, not take action</span><br>pool=<span class="hljs-string">&quot;your_pool_name&quot;</span><br><span class="hljs-comment">#find a vdev of pool</span><br>vdev=<span class="hljs-string">&quot;/dev/mapper/35000cca2515fc6ac&quot;</span><br>zdb -lu <span class="hljs-variable">$vdev</span> |grep <span class="hljs-string">&quot;txg &quot;</span> |cut -d <span class="hljs-string">&quot; &quot;</span> -f 3 &gt; /tmp/txg<br><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> LINE;<br><span class="hljs-keyword">do</span><br>zdb -e <span class="hljs-variable">$pool</span> -d -t <span class="hljs-variable">$LINE</span><br><span class="hljs-keyword">done</span> &lt; /tmp/txg<br></code></pre></td></tr></table></figure>


<h4 id="Import-zpool-hang-single-dev-just-respond-very-slow-cause-all-zpool-command-hang"><a href="#Import-zpool-hang-single-dev-just-respond-very-slow-cause-all-zpool-command-hang" class="headerlink" title="Import zpool hang, single dev just respond very slow cause all zpool command hang"></a>Import zpool hang, single dev just respond very slow cause all zpool command hang</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> 1 &gt; /sys/class/block/sddh/device/delete<br><span class="hljs-comment">### remove the dev, all has been imported</span><br><br><span class="hljs-comment">## issue log</span><br>$ lsscsi -git  | grep sg118<br>[17:0:116:0] disk    sas:0x5000c500a65b61f1          /dev/sddh  35000c500a65b61f3  /dev/sg118<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: Attached scsi generic sg178 <span class="hljs-built_in">type</span> 0<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Enabling DIF Type 2 protection<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] 19134414848 512-byte logical blocks: (9.79 TB/8.91 TiB)<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] 4096-byte physical blocks<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Write Protect is off<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Mode Sense: d7 00 10 08<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Write cache: enabled, <span class="hljs-built_in">read</span> cache: enabled, supports DPO and FUA<br>[Sun Sep 23 11:03:43 2018]  sdfm: sdfm1 sdfm9<br>[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Attached SCSI disk<br>[Sun Sep 23 11:03:44 2018] scsi 17:0:177:0: Attached scsi generic sg179 <span class="hljs-built_in">type</span> 3<br>[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: attempting task abort! scmd(ffff88100abf2f40)<br>[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: [sg118] CDB: Inquiry 12 01 dc 01 52 00<br>[Sun Sep 23 11:07:09 2018] scsi target17:0:116: handle(0x0087), sas_address(0x5000c500a65b61f1), phy(34)<br>[Sun Sep 23 11:07:09 2018] scsi target17:0:116: enclosure_logical_id(0x50050cc11ac01572), slot(56)<br>[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: task abort: SUCCESS scmd(ffff88100abf2f40)<br>[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: attempting task abort! scmd(ffff880fe9784ec0)<br>[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: [sg118] CDB: Inquiry 12 01 dc 01 52 00<br>[Sun Sep 23 11:07:09 2018] scsi target17:0:116: handle(0x0087), sas_address(0x5000c500a65b61f1), phy(34)<br>[Sun Sep 23 11:07:09 2018] scsi target17:0:116: enclosure_logical_id(0x50050cc11ac01572), slot(56)<br>[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: task abort: SUCCESS scmd(ffff880fe9784ec0)<br>[Sun Sep 23 11:07:58 2018] INFO: task zpool:3155 blocked <span class="hljs-keyword">for</span> more than 120 seconds.<br>[Sun Sep 23 11:07:58 2018] <span class="hljs-string">&quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot;</span> disables this message.<br>[Sun Sep 23 11:07:58 2018] zpool           D ffffffffc0ade588     0  3155   3152 0x00000084<br>[Sun Sep 23 11:07:58 2018]  ffff881011267ce0 0000000000000082 ffff881025d0cf10 ffff881011267fd8<br>[Sun Sep 23 11:07:58 2018]  ffff881011267fd8 ffff881011267fd8 ffff881025d0cf10 ffffffffc0ade580<br>[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881025d0cf10 00000000ffffffff ffffffffc0ade588<br>[Sun Sep 23 11:07:58 2018] Call Trace:<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d0744&gt;] spa_import+0x54/0x730 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc062cfc2&gt;] ? nvlist_lookup_common.part.71+0xa2/0xb0 [znvpair]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc090bc37&gt;] zfs_ioc_pool_import+0x147/0x160 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0910846&gt;] zfsdev_ioctl+0x606/0x650 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff812151bd&gt;] do_vfs_ioctl+0x33d/0x540<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b0091&gt;] ? __do_page_fault+0x171/0x450<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff81215461&gt;] SyS_ioctl+0xa1/0xc0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b5089&gt;] system_call_fastpath+0x16/0x1b<br>[Sun Sep 23 11:07:58 2018] INFO: task zpool:3157 blocked <span class="hljs-keyword">for</span> more than 120 seconds.<br>[Sun Sep 23 11:07:58 2018] <span class="hljs-string">&quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot;</span> disables this message.<br>[Sun Sep 23 11:07:58 2018] zpool           D ffffffffc0ade588     0  3157   3153 0x00000084<br>[Sun Sep 23 11:07:58 2018]  ffff881011283c60 0000000000000086 ffff88103b1fdee0 ffff881011283fd8<br>[Sun Sep 23 11:07:58 2018]  ffff881011283fd8 ffff881011283fd8 ffff88103b1fdee0 ffffffffc0ade580<br>[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff88103b1fdee0 00000000ffffffff ffffffffc0ade588<br>[Sun Sep 23 11:07:58 2018] Call Trace:<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff8118cb26&gt;] ? __alloc_pages_nodemask+0x176/0x420<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf334&gt;] spa_get_stats+0x54/0x550 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc06021a0&gt;] ? spl_kmem_zalloc+0xc0/0x170 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811ddbee&gt;] ? __kmalloc_node+0x27e/0x2b0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc090c019&gt;] zfs_ioc_pool_stats+0x39/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0910846&gt;] zfsdev_ioctl+0x606/0x650 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff812151bd&gt;] do_vfs_ioctl+0x33d/0x540<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b0091&gt;] ? __do_page_fault+0x171/0x450<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff81215461&gt;] SyS_ioctl+0xa1/0xc0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b5089&gt;] system_call_fastpath+0x16/0x1b<br>[Sun Sep 23 11:07:58 2018] INFO: task zpool:3159 blocked <span class="hljs-keyword">for</span> more than 120 seconds.<br>[Sun Sep 23 11:07:58 2018] <span class="hljs-string">&quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot;</span> disables this message.<br>[Sun Sep 23 11:07:58 2018] zpool           D ffffffffc0ade588     0  3159   3156 0x00000084<br>[Sun Sep 23 11:07:58 2018]  ffff88101128bc60 0000000000000086 ffff88102fb3af70 ffff88101128bfd8<br>[Sun Sep 23 11:07:58 2018]  ffff88101128bfd8 ffff88101128bfd8 ffff88102fb3af70 ffffffffc0ade580<br>[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff88102fb3af70 00000000ffffffff ffffffffc0ade588<br>[Sun Sep 23 11:07:58 2018] Call Trace:<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff8118cb26&gt;] ? __alloc_pages_nodemask+0x176/0x420<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf334&gt;] spa_get_stats+0x54/0x550 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc06021a0&gt;] ? spl_kmem_zalloc+0xc0/0x170 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811ddbee&gt;] ? __kmalloc_node+0x27e/0x2b0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc090c019&gt;] zfs_ioc_pool_stats+0x39/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0910846&gt;] zfsdev_ioctl+0x606/0x650 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff812151bd&gt;] do_vfs_ioctl+0x33d/0x540<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b0091&gt;] ? __do_page_fault+0x171/0x450<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff81215461&gt;] SyS_ioctl+0xa1/0xc0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b5089&gt;] system_call_fastpath+0x16/0x1b<br>[Sun Sep 23 11:07:58 2018] INFO: task z_zvol:5492 blocked <span class="hljs-keyword">for</span> more than 120 seconds.<br>[Sun Sep 23 11:07:58 2018] <span class="hljs-string">&quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot;</span> disables this message.<br>[Sun Sep 23 11:07:58 2018] z_zvol          D ffffffffc0ade588     0  5492      2 0x00000080<br>[Sun Sep 23 11:07:58 2018]  ffff88100ef0f9a0 0000000000000046 ffff881033e46eb0 ffff88100ef0ffd8<br>[Sun Sep 23 11:07:58 2018]  ffff88100ef0ffd8 ffff88100ef0ffd8 ffff881033e46eb0 ffffffffc0ade580<br>[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881033e46eb0 00000000ffffffff ffffffffc0ade588<br>[Sun Sep 23 11:07:58 2018] Call Trace:<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08761d6&gt;] ? dbuf_rele+0x36/0x40 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf2d3&gt;] spa_open+0x13/0x20 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08ad4f3&gt;] dsl_pool_hold+0x33/0x80 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0885935&gt;] dmu_objset_hold+0x35/0xd0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af0d4&gt;] dsl_prop_get+0x44/0xa0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af14e&gt;] dsl_prop_get_integer+0x1e/0x20 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc094269b&gt;] zvol_create_minors_cb+0x3b/0x140 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08c0880&gt;] ? rrw_exit+0x60/0x170 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884692&gt;] dmu_objset_find_impl+0x112/0x430 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc088476e&gt;] dmu_objset_find_impl+0x1ee/0x430 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884e58&gt;] dmu_objset_find+0x58/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0944a7b&gt;] zvol_task_cb+0x52b/0x5a0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a902d&gt;] ? __schedule+0x39d/0x8b0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604ed6&gt;] taskq_thread+0x246/0x470 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810c4820&gt;] ? wake_up_state+0x20/0x20<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604c90&gt;] ? taskq_thread_spawn+0x60/0x60 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br>[Sun Sep 23 11:07:58 2018] INFO: task spa_async:6766 blocked <span class="hljs-keyword">for</span> more than 120 seconds.<br>[Sun Sep 23 11:07:58 2018] <span class="hljs-string">&quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot;</span> disables this message.<br>[Sun Sep 23 11:07:58 2018] spa_async       D ffffffffc0ade588     0  6766      2 0x00000080<br>[Sun Sep 23 11:07:58 2018]  ffff880fd3d3bdc0 0000000000000046 ffff881033689fa0 ffff880fd3d3bfd8<br>[Sun Sep 23 11:07:58 2018]  ffff880fd3d3bfd8 ffff880fd3d3bfd8 ffff881033689fa0 ffffffffc0ade580<br>[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881033689fa0 00000000ffffffff ffffffffc0ade588<br>[Sun Sep 23 11:07:58 2018] Call Trace:<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2f44&gt;] spa_async_thread+0x244/0x300 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811dee33&gt;] ? kfree+0x103/0x140<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603fa1&gt;] thread_generic_wrapper+0x71/0x80 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603f30&gt;] ? __thread_exit+0x20/0x20 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br>[Sun Sep 23 11:07:58 2018] INFO: task z_zvol:6806 blocked <span class="hljs-keyword">for</span> more than 120 seconds.<br>[Sun Sep 23 11:07:58 2018] <span class="hljs-string">&quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot;</span> disables this message.<br>[Sun Sep 23 11:07:58 2018] z_zvol          D ffffffffc0ade588     0  6806      2 0x00000080<br>[Sun Sep 23 11:07:58 2018]  ffff8810104cb9a0 0000000000000046 ffff881010b0af70 ffff8810104cbfd8<br>[Sun Sep 23 11:07:58 2018]  ffff8810104cbfd8 ffff8810104cbfd8 ffff881010b0af70 ffffffffc0ade580<br>[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881010b0af70 00000000ffffffff ffffffffc0ade588<br>[Sun Sep 23 11:07:58 2018] Call Trace:<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08761d6&gt;] ? dbuf_rele+0x36/0x40 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf2d3&gt;] spa_open+0x13/0x20 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08ad4f3&gt;] dsl_pool_hold+0x33/0x80 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0885935&gt;] dmu_objset_hold+0x35/0xd0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af0d4&gt;] dsl_prop_get+0x44/0xa0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af14e&gt;] dsl_prop_get_integer+0x1e/0x20 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc094269b&gt;] zvol_create_minors_cb+0x3b/0x140 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08c0880&gt;] ? rrw_exit+0x60/0x170 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884692&gt;] dmu_objset_find_impl+0x112/0x430 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc088476e&gt;] dmu_objset_find_impl+0x1ee/0x430 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884e58&gt;] dmu_objset_find+0x58/0x90 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0944a7b&gt;] zvol_task_cb+0x52b/0x5a0 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a902d&gt;] ? __schedule+0x39d/0x8b0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604ed6&gt;] taskq_thread+0x246/0x470 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810c4820&gt;] ? wake_up_state+0x20/0x20<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604c90&gt;] ? taskq_thread_spawn+0x60/0x60 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br>[Sun Sep 23 11:07:58 2018] INFO: task spa_async:7267 blocked <span class="hljs-keyword">for</span> more than 120 seconds.<br>[Sun Sep 23 11:07:58 2018] <span class="hljs-string">&quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot;</span> disables this message.<br>[Sun Sep 23 11:07:58 2018] spa_async       D ffffffffc0ade588     0  7267      2 0x00000080<br>[Sun Sep 23 11:07:58 2018]  ffff88107d987dc0 0000000000000046 ffff8810113fcf10 ffff88107d987fd8<br>[Sun Sep 23 11:07:58 2018]  ffff88107d987fd8 ffff88107d987fd8 ffff8810113fcf10 ffffffffc0ade580<br>[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff8810113fcf10 00000000ffffffff ffffffffc0ade588<br>[Sun Sep 23 11:07:58 2018] Call Trace:<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2f44&gt;] spa_async_thread+0x244/0x300 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811dee33&gt;] ? kfree+0x103/0x140<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603fa1&gt;] thread_generic_wrapper+0x71/0x80 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603f30&gt;] ? __thread_exit+0x20/0x20 [spl]<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90<br>[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40<br></code></pre></td></tr></table></figure>


<h3 id="OpenZFS-multihost-writes-failed-about-Invalid-DWORD-count"><a href="#OpenZFS-multihost-writes-failed-about-Invalid-DWORD-count" class="headerlink" title="OpenZFS multihost writes failed (about Invalid DWORD count)"></a>OpenZFS multihost writes failed (about Invalid DWORD count)</h3><pre><code>Invalid DWORD count = 124
Loss of DWORD synchronization = 31</code></pre>
<p><a target="_blank" rel="noopener" href="//www.c0t0d0s0.org/archives/7601-Check-both-sides-or-Errors-on-the-SAN.html">The interesting part is the highlighted one. A massive increase in invalid tx word count. When you see an massively increased counter here, your HBA just received rubbish from the storage. I never saw a different reason for this than a problem between the interface to the optics on the HBA and the interface to the optics on the switch ranging from not properly seated transceivers to blatant cases of ignoring the minimum bending radius of the fibre optic cables.</a></p>
<p>Suggestions to the customer based on the rule “check cheapest solution first”:<br>reseat cables<br>reseat transceivers<br>use a new cable<br>use new transceivers</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs bash">status: The pool is suspended because multihost writes failed or were delayed;<br>	another system could import the pool undetected.<br>action: Make sure the pool<span class="hljs-string">&#x27;s devices are connected, then reboot your system and</span><br><span class="hljs-string">	import the pool.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff9285b2736a00)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#10 CDB: Read(16) 88 00 00 00 00 02 45 fb ce 48 00 00 00 81 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff9285b2736a00)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#10 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#10 CDB: Read(16) 88 00 00 00 00 02 45 fb ce 48 00 00 00 81 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064840</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff9285af232f40)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#6 CDB: Read(16) 88 00 00 00 00 02 45 fb cd 2f 00 00 00 ed 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff9285af232f40)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#6 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#6 CDB: Read(16) 88 00 00 00 00 02 45 fb cd 2f 00 00 00 ed 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064559</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff926d3ab36d80)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#5 CDB: Read(16) 88 00 00 00 00 02 45 fb cc 41 00 00 00 d8 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff926d3ab36d80)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#5 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#5 CDB: Read(16) 88 00 00 00 00 02 45 fb cc 41 00 00 00 d8 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064321</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff9267c58cea00)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#4 CDB: Read(16) 88 00 00 00 00 02 45 fb cb 69 00 00 00 97 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff9267c58cea00)</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#4 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#4 CDB: Read(16) 88 00 00 00 00 02 45 fb cb 69 00 00 00 97 00 00</span><br><span class="hljs-string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064105</span><br><span class="hljs-string">[Tue May 14 15:14:14 2019] WARNING: MMP writes to pool &#x27;</span>ost_64<span class="hljs-string">&#x27; have not succeeded in over 20s; suspending pool</span><br><span class="hljs-string">[Tue May 14 15:14:14 2019] WARNING: Pool &#x27;</span>ost_64<span class="hljs-string">&#x27; has encountered an uncorrectable I/O failure and has been suspended.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">sdff smart info:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Error counter log:</span><br><span class="hljs-string">           Errors Corrected by           Total   Correction     Gigabytes    Total</span><br><span class="hljs-string">               ECC          rereads/    errors   algorithm      processed    uncorrected</span><br><span class="hljs-string">           fast | delayed   rewrites  corrected  invocations   [10^9 bytes]  errors</span><br><span class="hljs-string">read:          0   493902         0    493902   12129373      97757.816           0</span><br><span class="hljs-string">write:         0        1         0         1     654716      29124.879           0</span><br><span class="hljs-string">verify:        0        0         0         0    7052436          0.000           0</span><br><span class="hljs-string"></span><br><span class="hljs-string">Non-medium error count:        0</span><br><span class="hljs-string"></span><br><span class="hljs-string">No self-tests have been logged</span><br><span class="hljs-string"></span><br><span class="hljs-string">Background scan results log</span><br><span class="hljs-string">  Status: scan is active</span><br><span class="hljs-string">    Accumulated power on time, hours:minutes 17258:47 [1035527 minutes]</span><br><span class="hljs-string">    Number of background scans performed: 63,  scan progress: 64.66%</span><br><span class="hljs-string">    Number of background medium scans performed: 63</span><br><span class="hljs-string"></span><br><span class="hljs-string">Protocol Specific port log page for SAS SSP</span><br><span class="hljs-string">relative target port id = 1</span><br><span class="hljs-string">  generation code = 49</span><br><span class="hljs-string">  number of phys = 1</span><br><span class="hljs-string">  phy identifier = 0</span><br><span class="hljs-string">    attached device type: expander device</span><br><span class="hljs-string">    attached reason: hard reset</span><br><span class="hljs-string">    reason: unknown</span><br><span class="hljs-string">    negotiated logical link rate: reserved [11]</span><br><span class="hljs-string">    attached initiator port: ssp=0 stp=0 smp=0</span><br><span class="hljs-string">    attached target port: ssp=0 stp=0 smp=1</span><br><span class="hljs-string">    SAS address = 0x5000cca251b4462d</span><br><span class="hljs-string">    attached SAS address = 0x500304800928dc3f</span><br><span class="hljs-string">    attached phy identifier = 37</span><br><span class="hljs-string">    Invalid DWORD count = 56</span><br><span class="hljs-string">    Running disparity error count = 0</span><br><span class="hljs-string">    Loss of DWORD synchronization = 14</span><br><span class="hljs-string">    Phy reset problem = 0</span><br><span class="hljs-string">    Phy event descriptors:</span><br><span class="hljs-string">     Invalid word count: 56</span><br><span class="hljs-string">     Running disparity error count: 0</span><br><span class="hljs-string">     Loss of dword synchronization count: 14</span><br><span class="hljs-string">     Phy reset problem count: 0</span><br><span class="hljs-string">relative target port id = 2</span><br><span class="hljs-string">  generation code = 49</span><br><span class="hljs-string">  number of phys = 1</span><br><span class="hljs-string">  phy identifier = 1</span><br><span class="hljs-string">    attached device type: expander device</span><br><span class="hljs-string">    attached reason: hard reset</span><br><span class="hljs-string">    reason: unknown</span><br><span class="hljs-string">    negotiated logical link rate: reserved [11]</span><br><span class="hljs-string">    attached initiator port: ssp=0 stp=0 smp=0</span><br><span class="hljs-string">    attached target port: ssp=0 stp=0 smp=1</span><br><span class="hljs-string">    SAS address = 0x5000cca251b4462e</span><br><span class="hljs-string">    attached SAS address = 0x500304800928dd3f</span><br><span class="hljs-string">    attached phy identifier = 37</span><br><span class="hljs-string">    Invalid DWORD count = 124</span><br><span class="hljs-string">    Running disparity error count = 0</span><br><span class="hljs-string">    Loss of DWORD synchronization = 31</span><br><span class="hljs-string">    Phy reset problem = 0</span><br><span class="hljs-string">    Phy event descriptors:</span><br><span class="hljs-string">     Invalid word count: 124</span><br><span class="hljs-string">     Running disparity error count: 0</span><br><span class="hljs-string">     Loss of dword synchronization count: 31</span><br><span class="hljs-string">     Phy reset problem count: 0</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>


<h3 id="For-Low-memroy-server"><a href="#For-Low-memroy-server" class="headerlink" title="For Low memroy server"></a>For Low memroy server</h3><p>I attacht 168 HDDs with 32GB memroy server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">kernel: mpt2sas1: iomem(0x0000000091c40000), mapped(0xffffc90003760000), size(65536)<br>kernel: mpt2sas1: ioport(0x0000000000002000), size(256)<br>kernel: mpt2sas1: Allocated physical memory: size(17329 kB)<br>kernel: mpt2sas1: Current Controller Queue Depth(9979), Max Controller Queue Depth(10240)<br>....<br><br>kernel: Out of memory: Kill process 7795 (collectl) score 0 or sacrifice child<br>kernel: Killed process 7795 (collectl) total-vm:177612kB, anon-rss:21400kB, file-rss:0kB, shmem-rss:0kB<br>kernel: collectl: page allocation failure: order:0, mode:0x2015a<br>...<br>kernel: Out of memory: Kill process 4013 (tuned) score 0 or sacrifice child<br>kernel: Killed process 4013 (tuned) total-vm:573848kB, anon-rss:13472kB, file-rss:0kB, shmem-rss:0kB<br>systemd: tuned.service: main process exited, code=killed, status=9/KILL<br>systemd: Unit tuned.service entered failed state<br><br>CONFIG_SCSI_MPT2SAS_MAX_SGE: This option allows you to specify the<br> maximum number of scatter-gather entries per I/O. The driver default<br> is 128, <span class="hljs-built_in">which</span> matches MAX_HW_SEGMENTS. However, it may decreased<br> down to 16. Decreasing this parameter will reduce memory requirements<br> on a per controller instance.<br><br>$ cat /etc/modprobe.d/mpt2sas.conf<br>options mpt2sas max_msix_vectors=4<br>options mpt2sas command_retry_count=32 <span class="hljs-comment">#if you have long timeout and much more retry count will cause the issue HDD retry many times</span><br><br>options mpt2sas max_sgl_entries=32 <span class="hljs-comment">#for low memory system</span><br>options mpt2sas max_queue_depth=300<br><br>options mpt3sas max_queue_depth=512 <span class="hljs-comment">#</span><br>options mpt3sas max_sgl_entries=256 <span class="hljs-comment"># enough memroy</span><br><br><span class="hljs-built_in">echo</span> 5000 &gt; /sys/module/zfs/parameters/zfs_multihost_interval<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> /sys/class/block/*/device/timeout; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> 90 &gt; <span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> /sys/block/*/device/queue_depth; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> 254 &gt; <span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>

<h3 id="zpool-could-not-be-import-because-single-HDD-failure-in-raidz3"><a href="#zpool-could-not-be-import-because-single-HDD-failure-in-raidz3" class="headerlink" title="zpool could not be import because single HDD failure in raidz3"></a>zpool could not be import because single HDD failure in raidz3</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">zpool</span> <span class="hljs-string">import</span> <span class="hljs-string">-f</span> <span class="hljs-string">-o</span>  <span class="hljs-string">cachefile=none</span> <span class="hljs-string">-o</span> <span class="hljs-string">readonly=on</span> <span class="hljs-string">ost_61</span><br><span class="hljs-string">cannot</span> <span class="hljs-string">import</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">I/O</span> <span class="hljs-string">error</span> <span class="hljs-string">Destroy</span> <span class="hljs-string">and</span> <span class="hljs-string">re-create</span> <span class="hljs-string">the</span> <span class="hljs-string">pool</span> <span class="hljs-string">from</span> <span class="hljs-string">a</span> <span class="hljs-string">backup</span> <span class="hljs-string">source.</span><br><br><span class="hljs-string">------------------------oh</span> <span class="hljs-string">shit--------------------</span><br><br><span class="hljs-string">zpool</span> <span class="hljs-string">import</span> <span class="hljs-string">show</span> <br><br>     <span class="hljs-attr">pool:</span> <span class="hljs-string">ost_61</span><br>     <span class="hljs-attr">id:</span> <span class="hljs-number">15498746923132605816</span><br>  <span class="hljs-attr">state:</span> <span class="hljs-string">FAULTED</span><br> <span class="hljs-attr">status:</span> <span class="hljs-string">The</span> <span class="hljs-string">pool</span> <span class="hljs-string">metadata</span> <span class="hljs-string">is</span> <span class="hljs-string">corrupted.</span><br> <span class="hljs-attr">action:</span> <span class="hljs-string">The</span> <span class="hljs-string">pool</span> <span class="hljs-string">cannot</span> <span class="hljs-string">be</span> <span class="hljs-string">imported</span> <span class="hljs-string">due</span> <span class="hljs-string">to</span> <span class="hljs-string">damaged</span> <span class="hljs-string">devices</span> <span class="hljs-string">or</span> <span class="hljs-string">data.</span><br>        <span class="hljs-string">The</span> <span class="hljs-string">pool</span> <span class="hljs-string">may</span> <span class="hljs-string">be</span> <span class="hljs-string">active</span> <span class="hljs-string">on</span> <span class="hljs-string">another</span> <span class="hljs-string">system,</span> <span class="hljs-string">but</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">imported</span> <span class="hljs-string">using</span><br>        <span class="hljs-string">the</span> <span class="hljs-string">&#x27;-f&#x27;</span> <span class="hljs-string">flag.</span><br>   <span class="hljs-attr">see:</span> <span class="hljs-string">http://zfsonlinux.org/msg/ZFS-8000-72</span><br> <span class="hljs-attr">config:</span>        <span class="hljs-string">ost_61</span>                      <span class="hljs-string">FAULTED</span>  <span class="hljs-string">corrupted</span> <span class="hljs-string">data</span><br>          <span class="hljs-string">raidz3-0</span>                  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">sddd</span>                    <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">sdde</span>                    <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">sddf</span>                    <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">sddg</span>                    <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">sddh</span>                    <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">sddi</span>                    <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a66c86f7</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a675b907</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a665afe7</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a670c7a3</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a66d665f</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a65a86b7</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a664a617</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a665b353</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a670c9fb</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a670b10f</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a65a9027</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a65a02af</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a670b213</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a670b157</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a665b1b3</span>  <span class="hljs-string">ONLINE</span><br>            <span class="hljs-string">scsi-35000c500a670c5fb</span>  <span class="hljs-string">ONLINE</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">zpool</span> <span class="hljs-string">import</span> <span class="hljs-string">-f</span> <span class="hljs-string">-o</span>  <span class="hljs-string">cachefile=none</span> <span class="hljs-string">-F</span> <span class="hljs-string">-n</span> <span class="hljs-string">ost_61</span><br><span class="hljs-string">$</span> <span class="hljs-string">echo</span> <span class="hljs-string">$?</span><br><span class="hljs-number">1</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <br><span class="hljs-attr">Configuration for import:</span><br>        <span class="hljs-attr">vdev_children:</span> <span class="hljs-number">1</span><br>        <span class="hljs-attr">version:</span> <span class="hljs-number">5000</span><br>        <span class="hljs-attr">pool_guid:</span> <span class="hljs-number">15498746923132605816</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;ost_61&#x27;</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-number">0</span><br>        <span class="hljs-attr">hostid:</span> <span class="hljs-number">3219179115</span><br>        <span class="hljs-attr">hostname:</span> <span class="hljs-string">&#x27;cngb-oss-c25-4.cngb.sz.hpc&#x27;</span><br>        <span class="hljs-attr">vdev_tree:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;root&#x27;</span><br>            <span class="hljs-attr">id:</span> <span class="hljs-number">0</span><br>            <span class="hljs-attr">guid:</span> <span class="hljs-number">15498746923132605816</span><br>            <span class="hljs-string">children[0]:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;raidz&#x27;</span><br>                <span class="hljs-attr">id:</span> <span class="hljs-number">0</span><br>                <span class="hljs-attr">guid:</span> <span class="hljs-number">18120440563767675975</span><br>                <span class="hljs-attr">nparity:</span> <span class="hljs-number">3</span><br>                <span class="hljs-attr">metaslab_array:</span> <span class="hljs-number">65</span><br>                <span class="hljs-attr">metaslab_shift:</span> <span class="hljs-number">40</span><br>                <span class="hljs-attr">ashift:</span> <span class="hljs-number">9</span><br>                <span class="hljs-attr">asize:</span> <span class="hljs-number">215529714352128</span><br>                <span class="hljs-attr">is_log:</span> <span class="hljs-number">0</span><br>                <span class="hljs-attr">create_txg:</span> <span class="hljs-number">4</span><br>                <span class="hljs-string">children[0]:</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;disk&#x27;</span><br>                    <span class="hljs-attr">id:</span> <span class="hljs-number">0</span><br>                    <span class="hljs-attr">guid:</span> <span class="hljs-number">691489041564037318</span><br>                    <span class="hljs-attr">whole_disk:</span> <span class="hljs-number">1</span><br>                    <span class="hljs-attr">DTL:</span> <span class="hljs-number">277</span><br>                    <span class="hljs-attr">create_txg:</span> <span class="hljs-number">4</span><br>                    <span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;/dev/sddd1&#x27;</span><br>                    <span class="hljs-attr">devid:</span> <span class="hljs-string">&#x27;scsi-35000c500a670b7bf-part1&#x27;</span><br>                    <span class="hljs-attr">phys_path:</span> <span class="hljs-string">&#x27;pci-0000:b3:00.0-sas-0x5000c500a670b7bd-lun-0&#x27;</span><br><br><span class="hljs-string">......</span><br><br> <span class="hljs-string">children[20]:</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;disk&#x27;</span><br>                    <span class="hljs-attr">id:</span> <span class="hljs-number">20</span><br>                    <span class="hljs-attr">guid:</span> <span class="hljs-number">3278057294213455851</span><br>                    <span class="hljs-attr">whole_disk:</span> <span class="hljs-number">1</span><br>                    <span class="hljs-attr">DTL:</span> <span class="hljs-number">257</span><br>                    <span class="hljs-attr">create_txg:</span> <span class="hljs-number">4</span><br>                    <span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;/dev/disk/by-id/scsi-35000c500a665b1b3-part1&#x27;</span><br>                    <span class="hljs-attr">devid:</span> <span class="hljs-string">&#x27;scsi-35000c500a665b1b3-part1&#x27;</span><br>                    <span class="hljs-attr">phys_path:</span> <span class="hljs-string">&#x27;pci-0000:b3:00.0-sas-0x5000c500a665b1b1-lun-0&#x27;</span><br>                <span class="hljs-string">children[21]:</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;disk&#x27;</span><br>                    <span class="hljs-attr">id:</span> <span class="hljs-number">21</span><br>                    <span class="hljs-attr">guid:</span> <span class="hljs-number">10749955888611927037</span><br>                    <span class="hljs-attr">whole_disk:</span> <span class="hljs-number">1</span><br>                    <span class="hljs-attr">DTL:</span> <span class="hljs-number">256</span><br>                    <span class="hljs-attr">create_txg:</span> <span class="hljs-number">4</span><br>                    <span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;/dev/disk/by-id/scsi-35000c500a670c5fb-part1&#x27;</span><br>                    <span class="hljs-attr">devid:</span> <span class="hljs-string">&#x27;scsi-35000c500a670c5fb-part1&#x27;</span><br>                    <span class="hljs-attr">phys_path:</span> <span class="hljs-string">&#x27;pci-0000:b3:00.0-sas-0x5000c500a670c5f9-lun-0&#x27;</span><br>        <span class="hljs-attr">rewind-policy:</span><br>            <span class="hljs-attr">rewind-request-txg:</span> <span class="hljs-number">18446744073709551615</span><br>            <span class="hljs-attr">rewind-request:</span> <span class="hljs-number">2</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br></code></pre></td></tr></table></figure>


<h4 id="I-guess-there-are-4-x-HDDs-could-read-zfs-metadata-in-this-zpool"><a href="#I-guess-there-are-4-x-HDDs-could-read-zfs-metadata-in-this-zpool" class="headerlink" title="I guess there are 4 x HDDs could read zfs metadata in this zpool"></a>I guess there are 4 x HDDs could read zfs metadata in this zpool</h4><p>Try it one by one</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">$</span> <span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">scsi-35000c500a665afe7</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">mos</span> [<span class="hljs-string">META</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">509M,</span> <span class="hljs-number">284</span> <span class="hljs-string">objects</span><br><br>    <span class="hljs-string">Object</span>  <span class="hljs-string">lvl</span>   <span class="hljs-string">iblk</span>   <span class="hljs-string">dblk</span>  <span class="hljs-string">dsize</span>  <span class="hljs-string">dnsize</span>  <span class="hljs-string">lsize</span>   <span class="hljs-string">%full</span>  <span class="hljs-string">type</span><br>         <span class="hljs-number">0</span>    <span class="hljs-number">2</span>   <span class="hljs-string">128K</span>    <span class="hljs-string">16K</span>   <span class="hljs-string">736K</span>     <span class="hljs-number">512</span>   <span class="hljs-string">592K</span>   <span class="hljs-number">23.99</span>  <span class="hljs-string">DMU</span> <span class="hljs-string">dnode</span><br><br><span class="hljs-string">$</span> <span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">sddi</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span> <br><br><span class="hljs-string">$</span> <span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1274825</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">mos</span> [<span class="hljs-string">META</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">492M,</span> <span class="hljs-number">284</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61/ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">155</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1744</span><span class="hljs-string">,</span> <span class="hljs-number">59.</span><span class="hljs-string">3T,</span> <span class="hljs-number">662232</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">51</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-number">68.</span><span class="hljs-string">1K,</span> <span class="hljs-number">6</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_blocks</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">1</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_dnode</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">sha512</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">skein</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">edonr</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">userobj_accounting</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">2</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">----sddh--finish-----</span><br><span class="hljs-string">----sddi-----</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414018</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414019</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414020</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414021</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414022</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414023</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414025</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><br><span class="hljs-string">......</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1274813</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">mos</span> [<span class="hljs-string">META</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">492M,</span> <span class="hljs-number">284</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61/ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">155</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1744</span><span class="hljs-string">,</span> <span class="hljs-number">59.</span><span class="hljs-string">3T,</span> <span class="hljs-number">662232</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">51</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-number">68.</span><span class="hljs-string">1K,</span> <span class="hljs-number">6</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_blocks</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">1</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_dnode</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">sha512</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">skein</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">edonr</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">userobj_accounting</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">2</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1274814</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">mos</span> [<span class="hljs-string">META</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">492M,</span> <span class="hljs-number">284</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61/ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">155</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1744</span><span class="hljs-string">,</span> <span class="hljs-number">59.</span><span class="hljs-string">3T,</span> <span class="hljs-number">662232</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">51</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-number">68.</span><span class="hljs-string">1K,</span> <span class="hljs-number">6</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_blocks</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">1</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_dnode</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">sha512</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">skein</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">edonr</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">userobj_accounting</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">2</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1414007</span><br><span class="hljs-attr">zdb:</span> <span class="hljs-string">can&#x27;t</span> <span class="hljs-string">open</span> <span class="hljs-attr">&#x27;ost_61&#x27;:</span> <span class="hljs-string">Input/output</span> <span class="hljs-string">error</span><br><span class="hljs-string">.....</span><br><br><span class="hljs-string">----sddi--finish-----</span><br><span class="hljs-string">----scsi-35000c500a66c86f7-----</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1274826</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">mos</span> [<span class="hljs-string">META</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">492M,</span> <span class="hljs-number">284</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61/ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">155</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1744</span><span class="hljs-string">,</span> <span class="hljs-number">59.</span><span class="hljs-string">3T,</span> <span class="hljs-number">662232</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">51</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-number">68.</span><span class="hljs-string">1K,</span> <span class="hljs-number">6</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_blocks</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">1</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_dnode</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">sha512</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">skein</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">edonr</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">userobj_accounting</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">2</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">zdb</span> <span class="hljs-string">-e</span> <span class="hljs-string">ost_61</span> <span class="hljs-string">-d</span> <span class="hljs-string">-t</span> <span class="hljs-number">1274827</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">mos</span> [<span class="hljs-string">META</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">492M,</span> <span class="hljs-number">284</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61/ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">155</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1744</span><span class="hljs-string">,</span> <span class="hljs-number">59.</span><span class="hljs-string">3T,</span> <span class="hljs-number">662232</span> <span class="hljs-string">objects</span><br><br><span class="hljs-string">......</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">mos</span> [<span class="hljs-string">META</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">492M,</span> <span class="hljs-number">284</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61/ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">155</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1744</span><span class="hljs-string">,</span> <span class="hljs-number">59.</span><span class="hljs-string">3T,</span> <span class="hljs-number">662232</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Dataset</span> <span class="hljs-string">ost_61</span> [<span class="hljs-string">ZPL</span>]<span class="hljs-string">,</span> <span class="hljs-string">ID</span> <span class="hljs-number">51</span><span class="hljs-string">,</span> <span class="hljs-string">cr_txg</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-number">68.</span><span class="hljs-string">1K,</span> <span class="hljs-number">6</span> <span class="hljs-string">objects</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_blocks</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">1</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">large_dnode</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">sha512</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">skein</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">edonr</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">0</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span><br><span class="hljs-string">Verified</span> <span class="hljs-string">userobj_accounting</span> <span class="hljs-string">feature</span> <span class="hljs-string">refcount</span> <span class="hljs-string">of</span> <span class="hljs-number">2</span> <span class="hljs-string">is</span> <span class="hljs-string">correct</span> <br></code></pre></td></tr></table></figure>
<p>Only sddi show input/output error</p>
<h4 id="Ban-the-sddi"><a href="#Ban-the-sddi" class="headerlink" title="Ban the sddi"></a>Ban the sddi</h4><p>This is the <a target="_blank" rel="noopener" href="https://github.com/zfsonlinux/zfs/issues/7184">zfs bug</a>, the easy way is use zdb -lu /dev/sd(all zpool devices), you could compare txg number, single device has the wrong txg number with the others. </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@cngb-oss-c25-3.cngb.sz.hpc</span> <span class="hljs-string">/tmp/zdb</span>]<span class="hljs-comment"># diff sdcu sdcv # it &#x27;s ok</span><br>[<span class="hljs-string">root@cngb-oss-c25-3.cngb.sz.hpc</span> <span class="hljs-string">/tmp/zdb</span>]<span class="hljs-comment"># diff sdcu sddi # found the wrong device</span><br><span class="hljs-number">25</span><span class="hljs-string">,37c25,37</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674112</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2673986</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674114</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674115</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674116</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674117</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674118</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674119</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674120</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674121</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674122</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674123</span><br><span class="hljs-string">&lt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">2674124</span><br><span class="hljs-meta">---</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727315</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727443</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727317</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727318</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727319</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727320</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727321</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727322</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727323</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727324</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727325</span><br><span class="hljs-string">&gt;</span> 	<span class="hljs-string">txg</span> <span class="hljs-string">=</span> <span class="hljs-number">7727453</span><br><br><span class="hljs-string">echo</span> <span class="hljs-number">1</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">/sys/class/block/sddi/device/delete</span><br></code></pre></td></tr></table></figure>
<p>After ban the sddi, the zpool could be imported……wipe the sweat, wipe the sweat……<br>The issue because this device (sddi) has been in two diff zpool(server A and server B) at the same time</p>
<h3 id="Single-HDD-hang-cause-LSI-HBA-reset-self"><a href="#Single-HDD-hang-cause-LSI-HBA-reset-self" class="headerlink" title="Single HDD hang cause LSI HBA reset self"></a>Single HDD hang cause LSI HBA reset self</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><code class="hljs bash">Mar 13 17:47:16 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>Mar 13 17:47:16 your_hostname kernel: mf:<span class="hljs-comment">#012#011000000a3 00000000 00000000 00000000 00000000 00000018 00000000 0000012c #012#01100000000 00000006 00000000 00000000 00000000 00000000 00000000 02000000 #012#01100000012 0000002c 00000000 00000000 00000000 00000000 00000000 00000000</span><br>Mar 13 17:47:16 your_hostname kernel: mpt3sas_cm0: issue target reset: handle = (0x00a3)<br>Mar 13 17:47:44 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>Mar 13 17:47:44 your_hostname kernel: mf:<span class="hljs-comment">#012#011000000a3 00000000 00000000 00000000 00000000 00000018 00000000 0000012c #012#01100000000 00000006 00000000 00000000 00000000 00000000 00000000 02000000 #012#01100000012 0000002c 00000000 00000000 00000000 00000000 00000000 00000000</span><br>Mar 13 17:47:44 your_hostname kernel: mpt3sas_cm0: issue target reset: handle = (0x00a3)<br>Mar 13 17:47:52 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f4c57e31340)<br>Mar 13 17:47:52 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="hljs-comment">#13 CDB: Test Unit Ready 00 00 00 00 00 00</span><br>Mar 13 17:47:52 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)<br>Mar 13 17:47:52 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)<br>Mar 13 17:47:52 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )<br>Mar 13 17:47:52 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f4c57e31340)<br>Mar 13 17:47:58 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f4e947adb00)<br>Mar 13 17:47:58 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="hljs-comment">#172 CDB: Log Sense 4d 00 6f 00 00 00 00 10 00 00</span><br>Mar 13 17:47:58 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)<br>Mar 13 17:47:58 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)<br>Mar 13 17:47:58 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )<br>Mar 13 17:47:58 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f4e947adb00)<br>.......<br>Mar 13 17:51:40 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f4e21ff0e00)<br>Mar 13 17:51:40 your_hostname kernel: sd 17:0:144:0: tag<span class="hljs-comment">#0 CDB: Read capacity(16) 9e 10 00 00 00 00 00 00 00 00 00 00 00 20 00 00</span><br>Mar 13 17:51:40 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)<br>Mar 13 17:51:40 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)<br>Mar 13 17:51:40 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )<br>Mar 13 17:51:40 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f4e21ff0e00)<br>Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f480939bf00)<br>Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: tag<span class="hljs-comment">#0 CDB: Read capacity(16) 9e 10 00 00 00 00 00 00 00 00 00 00 00 20 00 00</span><br>Mar 13 17:52:11 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)<br>Mar 13 17:52:11 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)<br>Mar 13 17:52:11 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )<br>Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f480939bf00)<br>Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: [sdeh] Read Capacity(16) failed: Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK<br>Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: [sdeh] Sense not available.<br>Mar 13 17:52:42 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f491c216c80)<br>Mar 13 17:52:42 your_hostname kernel: sd 17:0:144:0: tag<span class="hljs-comment">#0 CDB: Read Capacity(10) 25 00 00 00 00 00 00 00 00 00</span><br>......<br>Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f43a0ff6580)<br>Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="hljs-comment">#33 CDB: Test Unit Ready 00 00 00 00 00 00</span><br>Mar 13 19:26:20 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)<br>Mar 13 19:26:20 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)<br>Mar 13 19:26:20 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )<br>Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f43a0ff6580)<br>Mar 13 19:26:20 your_hostname kernel: mpt3sas_cm0: attempting host reset! scmd(ffff9f43a0ff6580)<br>Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="hljs-comment">#33 CDB: Inquiry 12 01 83 00 f0 00</span><br>Mar 13 19:26:20 your_hostname kernel: mpt3sas_cm0: sending diag reset !!<br>Mar 13 19:26:21 your_hostname kernel: mpt3sas_cm0: diag reset: SUCCESS<br>Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: IOC Number : 0<br>Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: CurrentHostPageSize is 0: Setting default host page size to 4k<br>Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: FW Package Version(16.17.00.03)<br>Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: LSISAS3008: FWVersion(16.00.04.00), ChipRevision(0x02), BiosVersion(18.00.00.00)<br>Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: Dell 12Gbps SAS HBA<br>Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: Protocol=(Initiator,Target), Capabilities=(TLR,EEDP,Snapshot Buffer,Diag Trace Buffer,Task Set Full,NCQ)<br>Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: sending port <span class="hljs-built_in">enable</span> !!<br>Mar 13 19:26:24 your_hostname kernel: WARNING: MMP writes to pool <span class="hljs-string">&#x27;ost_6&#x27;</span> have not succeeded <span class="hljs-keyword">in</span> over 25s; suspending pool<br>Mar 13 19:26:24 your_hostname kernel: WARNING: Pool <span class="hljs-string">&#x27;ost_6&#x27;</span> has encountered an uncorrectable I/O failure and has been suspended.<br><br>line number, message<br>27567:Mar 13 17:47:16 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>27570:Mar 13 17:47:44 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>28676:Mar 13 17:49:36 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>29851:Mar 13 17:58:36 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31211:Mar 13 17:59:51 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31817:Mar 13 18:00:26 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31852:Mar 13 18:01:47 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31855:Mar 13 18:02:13 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31878:Mar 13 18:03:33 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31881:Mar 13 18:03:57 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31910:Mar 13 18:05:13 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31913:Mar 13 18:05:37 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31931:Mar 13 18:06:48 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31940:Mar 13 18:07:17 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31961:Mar 13 18:08:28 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31964:Mar 13 18:08:52 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>31996:Mar 13 18:10:12 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32012:Mar 13 18:10:47 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32057:Mar 13 18:12:07 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32060:Mar 13 18:12:32 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32101:Mar 13 18:13:53 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32116:Mar 13 18:14:37 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32162:Mar 13 18:15:57 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32165:Mar 13 18:16:22 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32182:Mar 13 18:17:33 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32191:Mar 13 18:18:02 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32218:Mar 13 18:19:16 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32233:Mar 13 18:19:57 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32250:Mar 13 18:20:57 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32265:Mar 13 18:21:55 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32280:Mar 13 18:22:42 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32309:Mar 13 18:23:40 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32324:Mar 13 18:24:16 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32339:Mar 13 18:25:28 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32355:Mar 13 18:26:15 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32370:Mar 13 18:27:02 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32387:Mar 13 18:27:49 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32402:Mar 13 18:28:40 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32417:Mar 13 18:29:29 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32435:Mar 13 18:30:13 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32453:Mar 13 18:31:07 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32468:Mar 13 18:32:00 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32495:Mar 13 18:33:27 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32498:Mar 13 18:34:18 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32525:Mar 13 18:35:34 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32543:Mar 13 18:36:46 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32570:Mar 13 18:38:09 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32585:Mar 13 18:38:58 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32600:Mar 13 18:39:57 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32621:Mar 13 18:41:19 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32642:Mar 13 18:42:31 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32657:Mar 13 18:43:26 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32672:Mar 13 18:44:39 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32690:Mar 13 18:45:51 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32705:Mar 13 18:46:58 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32735:Mar 13 18:48:03 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32752:Mar 13 18:48:52 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32770:Mar 13 18:50:23 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32794:Mar 13 18:51:15 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32809:Mar 13 18:52:25 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32818:Mar 13 18:53:03 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32857:Mar 13 18:55:09 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32863:Mar 13 18:55:52 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32884:Mar 13 18:57:12 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32887:Mar 13 18:58:01 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32914:Mar 13 18:59:44 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32920:Mar 13 19:00:21 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32965:Mar 13 19:01:55 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>32968:Mar 13 19:02:33 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33007:Mar 13 19:04:28 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33010:Mar 13 19:05:14 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33028:Mar 13 19:06:14 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33055:Mar 13 19:07:24 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33070:Mar 13 19:08:35 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33091:Mar 13 19:09:52 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33097:Mar 13 19:10:32 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33115:Mar 13 19:11:45 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33130:Mar 13 19:12:45 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33157:Mar 13 19:13:59 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33160:Mar 13 19:14:39 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33190:Mar 13 19:16:11 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33205:Mar 13 19:17:05 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33232:Mar 13 19:18:27 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33235:Mar 13 19:19:06 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33253:Mar 13 19:20:24 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33283:Mar 13 19:21:38 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33298:Mar 13 19:22:32 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33313:Mar 13 19:23:34 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33328:Mar 13 19:24:30 your_hostname kernel: mpt3sas_cm0: Command Timeout<br>33364:Mar 13 19:25:59 your_hostname kernel: mpt3sas_cm0: Command Timeout<br><br>after 90 <span class="hljs-built_in">times</span> timeout, the HBA reset itself<br><br>33400:Mar 13 19:26:21 your_hostname kernel: mpt3sas_cm0: diag reset: SUCCESS<br><br>$ zpool status your-pool<br>  pool: your-pool<br> state: ONLINE<br>  scan: resilvered 510K <span class="hljs-keyword">in</span> 0h0m with 0 errors on Sat Jan 26 17:05:55 2019<br>config:<br><br>        NAME                        STATE     READ WRITE CKSUM<br>        ost_84                      ONLINE       0     0     0<br>          raidz3-0                  ONLINE       0     0     0<br>            scsi-35000c500a670c507  ONLINE       0     0     0<br>            scsi-35000c500a65b41f7  ONLINE       0     0     0<br>            scsi-35000c500a6753d4b  ONLINE       0     0     0<br>            scsi-35000c500a670ccf3  ONLINE       0     0     0<br>            scsi-35000c500a670b117  ONLINE       0     0     0<br>            scsi-35000c500a675a767  ONLINE       0     0     0<br>            scsi-35000c500a6754883  ONLINE       0     0     0<br>            scsi-35000c500957e33f7  ONLINE       0     0     0<br>            scsi-35000c500a675a25b  ONLINE       0     0     0<br>            scsi-35000c500a670c393  ONLINE       0     0     0<br>            scsi-35000c500a65a9e53  ONLINE       0     0     0<br>            scsi-35000c500a6515413  ONLINE       0     0     0<br>            scsi-35000c500a663e253  ONLINE       0     0     0<br>            scsi-35000cca26c1b754c  ONLINE       0     0     0<br>            scsi-35000c500a663b1f7  ONLINE       0     0     0<br>            scsi-35000c500a670c503  ONLINE       0     0     0<br>            scsi-35000c500a6753c5b  ONLINE       0     0     0<br>            scsi-35000c500a663b05b  ONLINE       0     0     0<br>            scsi-35000c500a670b917  ONLINE       0     0     0<br>            scsi-35000c500a670c1af  ONLINE       0     0     0<br>            scsi-35000c500a65a8e9b  ONLINE       0     0     0<br>            scsi-35000c500a6756753  ONLINE       0     0     0<br><br>errors: No known data errors<br><br><span class="hljs-comment">## In this raid, only sdap is HGST dev, the others are seagate</span><br><br>avg-cpu:  %user   %nice %system %iowait  %steal   %idle<br>           0.00    0.00   20.99   47.76    0.00   31.25<br><br>Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util<br>sdo               0.00     0.00   10.00   60.00     0.14     5.35   160.51     6.87  105.14   94.95  106.83  14.28  99.95<br>sdp               0.00     0.00   10.50   41.50     0.15     3.72   152.37     7.65  154.65  151.67  155.41  19.21  99.90<br>sdr               0.00     0.00   12.50   35.50     0.19     3.16   143.05     7.30  141.66   98.84  156.73  20.81  99.90<br>sdq               0.00     0.00    9.50   55.00     0.14     4.98   162.49     6.82  111.70   87.21  115.93  15.49  99.90<br>sdap              0.00     0.00   12.50   71.00     0.19     3.61    93.22     0.23    2.71   14.28    0.67   1.96  16.40<br>sdad              0.00     0.00   13.50   52.50     0.21     4.69   151.88     6.93  113.20   69.00  124.56  15.14  99.90<br>sdv               0.00     0.00   10.50   68.50     0.16     5.06   135.30     6.71   78.85  155.86   67.04  12.64  99.85<br>sdak              0.00     0.00    9.50   85.50     0.19     6.53   144.90     5.53   65.13   99.84   61.27  10.36  98.40<br>sdal              0.00     0.00   10.50   48.00     0.19     4.27   156.03     6.87  116.79   84.00  123.97  17.07  99.85<br>sdan              0.00     0.00    9.00   39.50     0.16     3.56   156.88     6.58  125.02   57.61  140.38  20.60  99.90<br>sdu               0.00     0.00   12.00   61.50     0.16     5.53   158.49     7.11  104.78   95.92  106.50  13.59  99.85<br>sdaf              0.00     0.00   11.00   38.50     0.19     3.42   149.39     6.93  128.40   79.00  142.52  20.17  99.85<br>sdac              0.00     0.00   11.00   62.50     0.18     4.27   123.96     5.17   67.90   97.59   62.67  13.28  97.60<br>sdag              0.00     0.00   10.00   41.00     0.19     3.77   158.72     7.08  139.36  102.00  148.48  19.58  99.85<br>sdao              0.00     0.00    8.50   54.00     0.14     4.90   165.24     6.91  115.50  100.65  117.84  15.97  99.80<br>sdaj              0.00     0.00   11.00   66.00     0.20     5.48   151.16     6.83   92.98  115.36   89.25  12.96  99.80<br>sdai              0.00     0.00   11.00   35.00     0.20     3.13   148.52     6.82  145.83   68.82  170.03  21.70  99.80<br>sdt               0.00     0.00   13.50   44.00     0.18     3.90   145.22     6.78  117.48   53.89  136.99  17.36  99.80<br>sdah              0.00     0.00   12.00   53.50     0.20     4.79   156.21     7.39  115.08  110.71  116.06  15.24  99.80<br>sds               0.00     0.00   10.50   53.00     0.12     4.77   157.54     6.86  111.13   51.00  123.05  15.71  99.75<br>sdae              0.00     0.00   11.00   42.50     0.19     3.66   147.39     6.85  133.48   73.23  149.07  18.64  99.75<br>sdam              0.00     0.00    8.00   50.00     0.15     4.61   167.91     6.31  114.64   40.50  126.50  17.19  99.70<br><br>avg-cpu:  %user   %nice %system %iowait  %steal   %idle<br>           0.20    0.00   22.24   34.84    0.00   42.71<br><br>Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util<br>sdo               0.00     0.00    0.50   86.00     0.02     6.59   156.42     5.86   67.03   20.00   67.31  11.55  99.95<br>sdp               0.00     0.00    1.00   84.50     0.03     7.16   172.36     7.03   70.34   33.50   70.78  11.70 100.00<br>sdr               0.00     0.00    1.00   72.50     0.03     6.08   170.44     6.22   90.38   21.00   91.34  13.61 100.00<br>sdq               0.00     0.00    1.00   84.00     0.03     7.01   169.64     6.08   69.63   13.50   70.30  11.76 100.00<br>sdap              0.00     0.00    0.50  129.50     0.02     6.47   102.29     0.07    0.53   13.00    0.48   0.32   4.10<br>sdad              0.00     0.00    1.00   76.50     0.03     6.42   170.63     6.21   77.92  216.00   76.12  12.90 100.00<br>sdv               0.00     0.00    1.00   84.00     0.03     6.79   164.50     8.07   73.64   73.00   73.65  11.76 100.00<br>sdak              0.00     0.00    1.00   83.00     0.03     6.34   155.41     5.95   66.38  106.00   65.90  11.83  99.40<br>sdal              0.00     0.00    1.00   67.50     0.03     5.59   167.98     6.07   92.59   76.50   92.83  14.60 100.00<br>sdan              0.00     0.00    1.00   73.50     0.03     6.19   171.05     7.69   75.56   41.50   76.02  13.42  99.95<br>sdu               0.00     0.00    1.00   80.00     0.03     6.40   162.69     6.04   73.44   54.00   73.69  12.35 100.00<br>sdaf              0.00     0.00    1.00   78.00     0.01     6.69   173.73     6.45   77.08   94.00   76.87  12.66 100.00<br>sdac              0.00     0.00    1.50   83.00     0.03     6.68   162.79     6.28   74.35  237.33   71.40  11.84 100.05<br>sdag              0.00     0.00    0.50   83.50     0.01     7.11   173.65     7.13   70.86   77.00   70.82  11.90 100.00<br>sdao              0.00     0.00    1.00   87.00     0.02     7.19   167.85     6.57   75.49  418.00   71.56  11.37 100.05<br>sdaj              0.00     0.00    1.00   75.00     0.03     6.16   166.95     6.82   75.19   66.50   75.31  13.16 100.00<br>sdai              0.00     0.00    1.00   79.00     0.03     6.74   173.41     7.01   75.91   18.00   76.64  12.51 100.05<br>sdt               0.00     0.00    1.50   78.50     0.03     6.56   168.79     6.58   85.08  239.33   82.13  12.50 100.00<br>sdah              0.00     0.00    0.50   79.00     0.02     6.69   172.81     7.25   76.71   37.00   76.96  12.58 100.00<br>sds               0.00     0.00    1.00   81.50     0.03     6.90   172.09     8.08   74.24   80.00   74.17  12.13 100.05<br>sdae              0.00     0.00    1.00   80.00     0.01     6.77   171.45     6.18   79.00  257.00   76.78  12.35 100.05<br>sdam              0.00     0.00    1.00   78.50     0.03     6.64   171.82     6.02   79.11   24.50   79.81  12.58 100.05<br><br>avg-cpu:  %user   %nice %system %iowait  %steal   %idle<br>           1.17    0.00   20.85   37.54    0.00   40.44<br><br>Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util<br>sdo               0.00     0.00    2.00   85.00     0.00     7.11   167.36     5.37   56.57   74.25   56.15  10.51  91.40<br>sdp               0.00     0.00    3.00   83.50     0.00     6.95   164.62     5.70   62.18  158.50   58.72  10.81  93.50<br>sdr               0.00     0.00    2.00   90.50     0.00     7.43   164.43     6.44   59.36  112.25   58.19  10.79  99.85<br>sdq               0.00     0.00    1.50   91.00     0.00     7.58   167.91     6.70   65.33  330.33   60.96  10.74  99.30<br>sdap              0.00     0.00    2.50  143.50     0.00     7.53   105.66     0.11    0.76    9.00    0.62   0.42   6.10<br>sdad              0.00     0.00    2.50   85.00     0.00     7.00   163.93     6.48   64.74  242.60   59.51  10.70  93.60<br>sdv               0.00     0.00    2.00   74.50     0.00     6.58   176.24     6.50   90.99  229.50   87.27  13.07 100.00<br>sdak              0.00     0.00    2.00   90.00     0.00     8.06   179.35     6.99   59.90  163.50   57.59  10.87 100.00<br>sdal              0.00     0.00    4.50   79.50     0.00     6.71   163.76     6.76   82.09  202.89   75.25  11.90 100.00<br>sdan              0.00     0.00    2.50   87.50     0.00     7.24   164.77     6.21   62.68  115.80   61.17  10.43  93.90<br>sdu               0.00     0.00    2.00   85.00     0.00     7.61   179.13     6.41   73.32  184.00   70.72  11.49 100.00<br>sdaf              0.00     0.00    2.00   88.00     0.00     7.82   177.91     6.83   74.74  414.00   67.03  11.11 100.00<br>sdac              0.00     0.00    1.50   88.50     0.00     7.14   162.38     6.69   66.64  101.33   66.06  10.69  96.25<br>sdag              0.00     0.00    0.50   87.50     0.00     7.21   167.86     6.95   67.72  240.00   66.73  11.03  97.10<br>sdao              0.00     0.00    2.50   90.50     0.00     7.24   159.50     5.69   60.65  119.20   59.03  10.36  96.35<br>sdaj              0.00     0.00    3.00   86.50     0.00     7.37   168.70     7.64   82.65  508.17   67.90  11.17 100.00<br>sdai              0.00     0.00    1.50   80.50     0.00     6.68   166.99     5.25   62.49   55.67   62.62  11.07  90.75<br>sdt               0.00     0.00    2.50   88.00     0.00     7.90   178.77     6.47   70.90  183.80   67.69  11.05 100.00<br>sdah              0.00     0.00    2.50   87.50     0.00     7.79   177.33     6.26   69.06   73.00   68.95  11.11 100.00<br>sds               0.00     0.00    1.00   94.00     0.00     8.42   181.62     7.84   65.32   35.50   65.63  10.53 100.00<br>sdae              0.00     0.00    2.00   82.00     0.00     6.92   168.83     6.91   79.28  140.25   77.79  11.90 100.00<br>sdam              0.00     0.00    3.50   77.50     0.00     6.40   161.80     5.96   73.86  198.14   68.25  11.69  94.70<br><br></code></pre></td></tr></table></figure>
<p>In this raidz3, only sdap is HGST dev, the others are seagate HDD<br>In a pair of another server not use the HDD, the bug will cause the server HBA reset again because the single dev timeout<br>Bad HDD verdor is seagate, when the HDD use ratio up to 75%, that too terrible, the HDD firmware is TT54, when you disable read buff, seagate HDD read/write jitter is very serious, 100x ~ 400x bad than WD(HGST), I guess it nothing to do with firmware, I don ‘t think TT55 could resolve it.<br>When you reset JBOD encolsure, Out of a week, the issue will show again.</p>
<p>$ sdparm -s RCE=0 /dev/sdxx could reduce the seagate latency</p>
<p>In client, read are very slow</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">[&lt;ffffffff811315c0&gt;] sync_page+0x40/0x50<br>[&lt;ffffffff811315de&gt;] sync_page_killable+0xe/0x40<br>[&lt;ffffffff811314e7&gt;] __lock_page_killable+0x67/0x70<br>[&lt;ffffffff81133254&gt;] generic_file_aio_read+0x4c4/0x710<br>[&lt;ffffffffa0b7f02c&gt;] ll_file_aio_read+0x1ec/0x4c0 [lustre]<br>[&lt;ffffffffa0b8024a&gt;] ll_file_read+0x13a/0x270 [lustre]<br>[&lt;ffffffff8119d927&gt;] vfs_read+0xb7/0x1a0<br>[&lt;ffffffff8119dc71&gt;] sys_read+0x51/0xb0<br>[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34<br>[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff<br>--------<br>[&lt;ffffffff811315c0&gt;] sync_page+0x40/0x50<br>[&lt;ffffffff811315de&gt;] sync_page_killable+0xe/0x40<br>[&lt;ffffffff811314e7&gt;] __lock_page_killable+0x67/0x70<br>[&lt;ffffffff81133278&gt;] generic_file_aio_read+0x4e8/0x710<br>[&lt;ffffffffa0bd0d52&gt;] vvp_io_read_start+0x302/0x570 [lustre]<br>[&lt;ffffffffa073975a&gt;] cl_io_start+0x6a/0x140 [obdclass]<br>[&lt;ffffffffa073c459&gt;] cl_io_loop+0x129/0xb20 [obdclass]<br>[&lt;ffffffffa0b7e5d1&gt;] ll_file_io_generic+0x231/0xaa0 [lustre]<br>[&lt;ffffffffa0b7f1e3&gt;] ll_file_aio_read+0x3a3/0x4c0 [lustre]<br>[&lt;ffffffffa0b8024a&gt;] ll_file_read+0x13a/0x270 [lustre]<br>[&lt;ffffffff8119d927&gt;] vfs_read+0xb7/0x1a0<br>[&lt;ffffffff8119dc71&gt;] sys_read+0x51/0xb0<br>[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34<br>[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff<br>--------<br>[&lt;ffffffff811315c0&gt;] sync_page+0x40/0x50<br>[&lt;ffffffff811315de&gt;] sync_page_killable+0xe/0x40<br>[&lt;ffffffff811314e7&gt;] __lock_page_killable+0x67/0x70<br>[&lt;ffffffff81133254&gt;] generic_file_aio_read+0x4c4/0x710<br>[&lt;ffffffffa0b7f02c&gt;] ll_file_aio_read+0x1ec/0x4c0 [lustre]<br>[&lt;ffffffffa0b8024a&gt;] ll_file_read+0x13a/0x270 [lustre]<br>[&lt;ffffffff8119d927&gt;] vfs_read+0xb7/0x1a0<br>[&lt;ffffffff8119dc71&gt;] sys_read+0x51/0xb0<br>[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34<br>[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff<br>--------<br>[&lt;ffffffffa0739d35&gt;] cl_sync_io_wait+0x2a5/0x380 [obdclass]<br>[&lt;ffffffffa07386ae&gt;] cl_lock_request+0x1ce/0x200 [obdclass]<br>[&lt;ffffffffa0bc9d13&gt;] cl_glimpse_lock+0x113/0x2b0 [lustre]<br>[&lt;ffffffffa0bca097&gt;] cl_glimpse_size0+0x1e7/0x240 [lustre]<br>[&lt;ffffffffa0b857cc&gt;] ll_getattr+0x31c/0x8a0 [lustre]<br>[&lt;ffffffff811a2e44&gt;] vfs_getattr+0x54/0x90<br>[&lt;ffffffff811a2ee4&gt;] vfs_fstatat+0x64/0xa0<br>[&lt;ffffffff811a304b&gt;] vfs_stat+0x1b/0x20<br>[&lt;ffffffff811a3074&gt;] sys_newstat+0x24/0x50<br>[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34<br>[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff<br></code></pre></td></tr></table></figure>

<h3 id="Error-ICRC-ABRT-at-LBA-in-SATA-device"><a href="#Error-ICRC-ABRT-at-LBA-in-SATA-device" class="headerlink" title="Error: ICRC, ABRT at LBA in SATA device"></a>Error: ICRC, ABRT at LBA in SATA device</h3><p>zfs show a lot of check sum error<br>fix it by upgrade IO expander firmware</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">Error 17 occurred at disk power-on lifetime: 1903 hours (79 days + 7 hours)<br>  When the <span class="hljs-built_in">command</span> that caused the error occurred, the device was doing SMART Offline or Self-test.<br><br>  After <span class="hljs-built_in">command</span> completion occurred, registers were:<br>  ER ST SC SN CL CH DH<br>  -- -- -- -- -- -- --<br>  84 41 00 00 00 00 00  Error: ICRC, ABRT at LBA = 0x00000000 = 0<br><br>  Commands leading to the <span class="hljs-built_in">command</span> that caused the error were:<br>  CR FR SC SN CL CH DH DC   Powered_Up_Time  Command/Feature_Name<br>  -- -- -- -- -- -- -- --  ----------------  --------------------<br>  61 05 10 b2 8e 78 40 00  23d+05:55:53.717  WRITE FPDMA QUEUED<br>  61 01 38 b1 8e 78 40 00  23d+05:55:53.716  WRITE FPDMA QUEUED<br>  61 01 30 d9 8e 78 40 00  23d+05:55:53.716  WRITE FPDMA QUEUED<br>  61 01 28 d8 8e 78 40 00  23d+05:55:53.716  WRITE FPDMA QUEUED<br>  61 0a 20 68 ac 53 40 00  23d+05:55:53.715  WRITE FPDMA QUEUED<br><br>  pool: tank<br> state: ONLINE<br>status: One or more devices has experienced an unrecoverable error.  An<br>	attempt was made to correct the error.  Applications are unaffected.<br>action: Determine <span class="hljs-keyword">if</span> the device needs to be replaced, and clear the errors<br>	using <span class="hljs-string">&#x27;zpool clear&#x27;</span> or replace the device with <span class="hljs-string">&#x27;zpool replace&#x27;</span>.<br>   see: http://zfsonlinux.org/msg/ZFS-8000-9P<br>  scan: scrub repaired 55.5K <span class="hljs-keyword">in</span> 11h11m with 0 errors on Mon Mar 18 09:57:08 2019<br>config:<br><br>	NAME        STATE     READ WRITE CKSUM<br>	tank        ONLINE       0     0     0<br>	  raidz3-0  ONLINE       0     0     0<br>	    sdh     ONLINE       0     0    51<br>	    sdi     ONLINE       0     0    13<br>	    sdj     ONLINE       0     0    19<br>	    sdk     ONLINE       0     0    10<br>	    sdl     ONLINE       0     0    28<br>	    sdm     ONLINE       0     0    39<br>	    sdn     ONLINE       0     0    70<br>	    sdo     ONLINE       0     0    25<br></code></pre></td></tr></table></figure>

<h3 id="Enable-TLER-ERC-CCTL-function-for-SATA-device"><a href="#Enable-TLER-ERC-CCTL-function-for-SATA-device" class="headerlink" title="Enable TLER/ERC/CCTL function for SATA device"></a>Enable TLER/ERC/CCTL function for SATA device</h3><p>Some vendor default value was disabled</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smartctl -l scterc,70,70 /dev/sdab<br>smartctl 6.5 2016-05-07 r4318 [x86_64-linux-3.10.0-957.el7_lustre.x86_64] (<span class="hljs-built_in">local</span> build)<br>Copyright (C) 2002-16, Bruce Allen, Christian Franke, www.smartmontools.org<br><br>SCT Error Recovery Control <span class="hljs-built_in">set</span> to:<br>           Read:     70 (7.0 seconds)<br>          Write:     70 (7.0 seconds)<br><br>$ smartctl -l scterc /dev/sdab<br>smartctl 6.5 2016-05-07 r4318 [x86_64-linux-3.10.0-957.el7_lustre.x86_64] (<span class="hljs-built_in">local</span> build)<br>Copyright (C) 2002-16, Bruce Allen, Christian Franke, www.smartmontools.org<br><br>SCT Error Recovery Control:<br>           Read:     70 (7.0 seconds)<br>          Write:     70 (7.0 seconds)<br></code></pre></td></tr></table></figure>


<h3 id="SAS-smart-status"><a href="#SAS-smart-status" class="headerlink" title="SAS smart status"></a>SAS smart status</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">20c20<br>&lt; Local Time is:        Tue Jun  4 19:01:23 2019 CST<br>---<br>&gt; Local Time is:        Tue Jun  4 19:00:14 2019 CST<br>39c39<br>&lt;   Blocks sent to initiator = 30411897006194688<br>---<br>&gt;   Blocks sent to initiator = 30411894288285696<br>45,46c45,46<br>&lt; <span class="hljs-built_in">read</span>:          0  1074545         0   1813692   56373220      72544.663         180<br>&lt; write:         0        1         0         3    4864356      42356.396           0<br>---<br>&gt; <span class="hljs-built_in">read</span>:          0  1074502         0   1813649   56371166      72544.656         180<br>&gt; write:         0        1         0         3    4864355      42356.390           0<br><br>Error counter <span class="hljs-built_in">log</span>:<br>           Errors Corrected by           Total   Correction     Gigabytes    Total<br>               ECC          rereads/    errors   algorithm      processed    uncorrected<br>           fast | delayed   rewrites  corrected  invocations   [10^9 bytes]  errors<br><span class="hljs-built_in">read</span>:          0  1074545         0   1813692   56373220      72544.663         180<br>write:         0        1         0         3    4864356      42356.396           0<br>...<br><span class="hljs-built_in">read</span>:          0  1074502         0   1813649   56371166      72544.656         180<br>write:         0        1         0         3    4864355      42356.390           0<br></code></pre></td></tr></table></figure>

<h3 id="replace-sas-devices"><a href="#replace-sas-devices" class="headerlink" title="replace sas devices"></a>replace sas devices</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs bash">[Wed Jun  5 11:10:29 2019] sd 13:0:59:0: device_block, handle(0x0047)<br>[Wed Jun  5 11:10:31 2019] sd 13:0:59:0: device_unblock and setting to running, handle(0x0047)<br>[Wed Jun  5 11:10:31 2019] sd 13:0:59:0: [sdes] Synchronizing SCSI cache<br>[Wed Jun  5 11:10:31 2019] sd 13:0:59:0: [sdes] Synchronize Cache(10) failed: Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK<br><br><span class="hljs-comment"># echo 1 &gt; delete</span><br><br>[Wed Jun  5 11:10:31 2019] mpt3sas_cm2: removing handle(0x0047), sas_addr(0x5000cca2516f15ae)<br>[Wed Jun  5 11:10:31 2019] mpt3sas_cm2: enclosure logical id(0x500304800928a0bf), slot(6)<br>[Wed Jun  5 11:10:31 2019] mpt3sas_cm2: enclosure level(0x0001),connector name(     )<br>[Wed Jun  5 11:13:50 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:50 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:50 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:05 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:05 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:08 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)<br>[Wed Jun  5 11:14:08 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)<br>[Wed Jun  5 11:14:08 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)<br>[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: Direct-Access     HGST     HUH721010AL5200  A21D PQ: 0 ANSI: 6<br>[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: SSP: handle(0x0069), sas_addr(0x5000cca2519ae8fe), phy(7), device_name(0x5000cca2519ae8ff)<br>[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: enclosure logical id(0x500304800928a0bf), slot(6)<br>[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: enclosure level(0x0001), connector name(     )<br>[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: serial_number(        7PJS61HC)<br>[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: qdepth(254), tagged(1), simple(0), ordered(0), scsi_level(7), cmd_que(1)<br>[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: Attached scsi generic sg154 <span class="hljs-built_in">type</span> 0<br>[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] 19532873728 512-byte logical blocks: (10.0 TB/9.09 TiB)<br>[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] 4096-byte physical blocks<br>[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Write Protect is off<br>[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Mode Sense: f7 00 10 08<br>[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Write cache: enabled, <span class="hljs-built_in">read</span> cache: enabled, supports DPO and FUA<br>[Wed Jun  5 11:14:09 2019]  sdes:<br>[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Attached SCSI disk<br><br><br><span class="hljs-comment">### zfs cksum error</span><br><span class="hljs-comment">#### Cache issue</span><br>Some <span class="hljs-built_in">times</span> you could not found any errro from scsi, drvier, cable, hba, IO expander, smart check HDD is ok, no error<br>Looks like smartctl -t long could not check SAS/SATA device <span class="hljs-built_in">read</span>/write cache<br>If you <span class="hljs-built_in">disable</span> the device write cache, the cksum error is missing<br></code></pre></td></tr></table></figure>
<p>Dec 18 2019 03:34:03.733962748 ereport.fs.zfs.checksum<br>        class = “ereport.fs.zfs.checksum”<br>        ena = 0xe4ec5ccfb8a01001<br>        detector = (embedded nvlist)<br>                version = 0x0<br>                scheme = “zfs”<br>                pool = 0x2c8f99507dfa8d55<br>                vdev = 0x43a5020a3f617b3a<br>        (end detector)<br>        pool = “ost_48”<br>        pool_guid = 0x2c8f99507dfa8d55<br>        pool_state = 0x0<br>        pool_context = 0x0<br>        pool_failmode = “wait”<br>        vdev_guid = 0x43a5020a3f617b3a<br>        vdev_type = “disk”<br>        vdev_path = “/dev/disk/by-id/scsi-35000cca251b14e3c”<br>        vdev_ashift = 0xc<br>        vdev_complete_ts = 0x60e4ec5af404e<br>        vdev_delta_ts = 0xf254e8<br>        vdev_read_errors = 0x0<br>        vdev_write_errors = 0x0<br>        vdev_cksum_errors = 0x3865<br>        parent_guid = 0x7ed8241b267c55ce<br>        parent_type = “raidz”<br>        vdev_spare_paths =<br>        vdev_spare_guids =<br>        zio_err = 0x0<br>        zio_flags = 0x1008b0<br>        zio_stage = 0x100000<br>        zio_pipeline = 0xf80000<br>        zio_delay = 0x0<br>        zio_timestamp = 0x0<br>        zio_delta = 0x0<br>        zio_offset = 0x35b7ff04400<br>        zio_size = 0x2a00<br>        zio_objset = 0x2b<br>        zio_object = 0xd988<br>        zio_level = 0x0<br>        zio_blkid = 0x8654<br>        bad_ranges = 0x0 0x2a00<br>        bad_ranges_min_gap = 0x8<br>        bad_range_sets = 0x2956<br>        bad_range_clears = 0x855f<br>        bad_set_histogram = 0x76 0x7e 0xbc 0xc8 0xd6 0x9c 0xcc 0x96 0x6c 0x81 0xb0 0xce 0xd7 0x74 0xcb 0x8b 0x72 0x74 0xbe 0xcd 0xc6 0x92 0xb2 0x96 0x7a 0x93 0xc3 0xe1 0xd7 0x9b 0xce 0x88 0x7c 0x72 0xaa 0xdd 0xbe 0x86 0xbc 0x83 0x6d 0x74 0xcc 0xc2 0xc6 0x86 0xc1 0x87 0x74 0x8b 0xbe 0xc0 0xc2 0xa0 0xce 0x8c 0x73 0x8e 0xb3 0xe4 0xc8 0x8a 0xbc 0x9a<br>        bad_cleared_histogram = 0x253 0x242 0x1ff 0x1d8 0x1e5 0x233 0x1d9 0x22a 0x243 0x24b 0x20b 0x1f9 0x1dc 0x24b 0x1f7 0x23f 0x23c 0x25b 0x1fa 0x1db 0x1e9 0x223 0x1f7 0x20f 0x235 0x224 0x1ff 0x1ee 0x1d3 0x225 0x1fa 0x23b 0x253 0x271 0x20f 0x1ec 0x1e5 0x221 0x1fb 0x248 0x24e 0x228 0x1e7 0x1e0 0x1ed 0x24f 0x1f2 0x24f 0x264 0x22d 0x202 0x1e5 0x1ff 0x236 0x1ca 0x222 0x250 0x230 0x217 0x1e6 0x1d6 0x22b 0x1e7 0x238<br>        time = 0x5df92dab 0x2bbf61fc<br>        eid = 0x6ec1ab2</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs"><br><br><br>### zpool subspend zfs 0.7.9<br>```bash<br>multihost = on<br>       while (!mmp-&gt;mmp_thread_exiting) &#123;<br>                uint64_t mmp_fail_intervals = zfs_multihost_fail_intervals; # default = 5<br><br>        hrtime_t max_fail_ns = zfs_multihost_fail_intervals *<br>            MSEC2NSEC(MAX(zfs_multihost_interval, MMP_MIN_INTERVAL));<br><br><br>                if ((mmp_interval * mmp_fail_intervals) &lt; max_fail_ns) &#123;<br>                        max_fail_ns = ((31 * max_fail_ns) + (mmp_interval *<br>                            mmp_fail_intervals)) / 32;<br>                &#125; else &#123;<br>                        max_fail_ns = mmp_interval * mmp_fail_intervals; ### there is no 43 seconds<br>                &#125;<br><br>                if ((!last_spa_multihost &amp;&amp; multihost) ||<br>                    (last_spa_suspended &amp;&amp; !suspended)) &#123;<br>                        mutex_enter(&amp;mmp-&gt;mmp_io_lock);<br>                        mmp-&gt;mmp_last_write = gethrtime();<br><br><br>                max_fail_ns= 5 * 5000<br>                                        5                  on<br>                if (!suspended &amp;&amp; mmp_fail_intervals &amp;&amp; multihost &amp;&amp;<br>                    (gethrtime() - mmp-&gt;mmp_last_write) &gt; max_fail_ns) &#123;<br>                        cmn_err(CE_WARN, &quot;MMP writes to pool &#x27;%s&#x27; have not &quot;<br>                            &quot;succeeded in over %llus; suspending pool&quot;,<br>                            spa_name(spa),<br>                            NSEC2SEC(gethrtime() - mmp-&gt;mmp_last_write));<br>                        zio_suspend(spa, NULL, ZIO_SUSPEND_MMP);<br>                &#125;<br><br>[Wed May 20 11:27:44 2020] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)<br>[Wed May 20 11:27:44 2020] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10)<br>[Wed May 20 11:27:44 2020] scsi target13:0:10: enclosure level(0x0000), connector name(     )<br>[Wed May 20 11:27:44 2020] sd 13:0:10:0: task abort: SUCCESS scmd(ffff99cb3306a300)<br>[Wed May 20 11:27:44 2020] sd 13:0:10:0: [sdff] tag#2 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK<br>[Wed May 20 11:27:44 2020] sd 13:0:10:0: [sdff] tag#2 CDB: Read(16) 88 00 00 00 00 04 6a 25 dc 13 00 00 00 01 00 00<br>[Wed May 20 11:27:44 2020] blk_update_request: I/O error, dev sdff, sector 18960735251<br>[Wed May 20 11:27:44 2020] WARNING: MMP writes to pool &#x27;ost_64&#x27; have not succeeded in over 43s; suspending pool<br>[Wed May 20 11:27:44 2020] WARNING: Pool &#x27;ost_64&#x27; has encountered an uncorrectable I/O failure and has been suspended.<br><br>$ mmp_interval=9000;mmp_fail_interval=5<br>$ echo $(($((31*$((mmp_interval*mmp_fail_interval))+((mmp_interval*mmp_fail_interva))))/32))<br></code></pre></td></tr></table></figure>

<h3 id="zfs-IO-merging-issue"><a href="#zfs-IO-merging-issue" class="headerlink" title="zfs IO merging issue"></a><a target="_blank" rel="noopener" href="https://github.com/openzfs/zfs/issues/8472">zfs IO merging issue</a></h3><h3 id="Disable-the-throttle-increase-write-throughput"><a href="#Disable-the-throttle-increase-write-throughput" class="headerlink" title="Disable the throttle, increase write throughput"></a>Disable the throttle, increase write throughput</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> 1 &gt; zio_dva_throttle_enabled<br></code></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2017/09/26/openzfs-issues/">http://yoursite.com/2017/09/26/openzfs-issues/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/zfs/">zfs</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2017/11/21/linux_calls/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Linux system calls</div></div></a></div><div class="next-post pull-right"><a href="/2017/04/13/dell/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Dell command line in linux</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2019/04/02/lxc_with_zfs/" title="linux container with zfs"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-04-02</div><div class="title">linux container with zfs</div></div></a></div><div><a href="/2015/12/04/openzfs-replace/" title="Replace HDD for openzfs"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2015-12-04</div><div class="title">Replace HDD for openzfs</div></div></a></div><div><a href="/2015/11/20/recovery-zfs-partition-table/" title="Recover openzfs partition table"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2015-11-20</div><div class="title">Recover openzfs partition table</div></div></a></div><div><a href="/2015/11/06/deploy_lfs_and_zfs/" title="Deploy Lfs and OpenZFS"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2015-11-06</div><div class="title">Deploy Lfs and OpenZFS</div></div></a></div><div><a href="/2016/12/28/learn-zfs-internals-p1-p5/" title="A copy about ZFS Internals(p1-p5)"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2016-12-28</div><div class="title">A copy about ZFS Internals(p1-p5)</div></div></a></div><div><a href="/2016/12/04/openzfs-tips/" title="openzfs tips"><img class="cover" src="/img/photo_by_spacex.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2016-12-04</div><div class="title">openzfs tips</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '0b9d5b98d0a972b33cf7',
      clientSecret: '769efc11b32f6c0d03bcbf3ee800dfc4e2690459',
      repo: 'homerl.github.io',
      owner: 'homerl',
      admin: ['homerl'],
      id: 'e8a28bc794e20f8534bed77753d2e988',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>