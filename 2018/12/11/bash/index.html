<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Bash tips | b946c5a0bf547c89</title><meta name="description" content="Background exec script by ssh1$ while read line; do echo -------- $line  -----------; ssh -n -t $line &amp;#x27;sh -c &quot;( ( nohup &#x2F;opt&#x2F;test.sh &amp;&gt;&#x2F;dev&#x2F;null ) &amp; )&quot;&amp;#x27;; done &lt; hosts"><meta name="keywords" content="bash"><meta name="author" content="Ginger"><meta name="copyright" content="Ginger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/stout-shield.png"><link rel="canonical" href="http://yoursite.com/2018/12/11/bash/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Bash tips"><meta property="og:url" content="http://yoursite.com/2018/12/11/bash/"><meta property="og:site_name" content="b946c5a0bf547c89"><meta property="og:description" content="Background exec script by ssh1$ while read line; do echo -------- $line  -----------; ssh -n -t $line &amp;#x27;sh -c &quot;( ( nohup &#x2F;opt&#x2F;test.sh &amp;&gt;&#x2F;dev&#x2F;null ) &amp; )&quot;&amp;#x27;; done &lt; hosts"><meta property="og:image" content="http://yoursite.com/img/photo_by_spacex.jpg"><meta property="article:published_time" content="2018-12-11T03:04:49.000Z"><meta property="article:modified_time" content="2020-09-27T14:59:09.922Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime: '',
  date_suffix: {"one_hour":"Just","hours":"hours ago","day":"days ago"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-09-27 22:59:09'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/244247-guts.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">59</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">66</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Background-exec-script-by-ssh"><span class="toc-number">1.</span> <span class="toc-text">Background exec script by ssh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bash-set"><span class="toc-number">2.</span> <span class="toc-text">[bash set]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bash-double-quotes-single-quotes"><span class="toc-number">3.</span> <span class="toc-text">bash double-quotes, single-quotes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bash-replace-expect-script"><span class="toc-number">4.</span> <span class="toc-text">bash replace expect script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#expect"><span class="toc-number">5.</span> <span class="toc-text">expect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh-remote-exec-command"><span class="toc-number">6.</span> <span class="toc-text">ssh remote exec command</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#single-command-jump-2-nodes"><span class="toc-number">6.1.</span> <span class="toc-text">single command jump 2 nodes</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#remove-name-begin-with-%E2%80%9C-%E2%80%9C"><span class="toc-number">7.</span> <span class="toc-text">remove name begin with “-“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IFS"><span class="toc-number">8.</span> <span class="toc-text">IFS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test-match"><span class="toc-number">9.</span> <span class="toc-text">test match</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#is-a-integer"><span class="toc-number">9.1.</span> <span class="toc-text">is a integer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#String-Ternary-conditional-operator-three"><span class="toc-number">10.</span> <span class="toc-text">String, Ternary conditional operator (three)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arrary"><span class="toc-number">11.</span> <span class="toc-text">Arrary</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Associative-array"><span class="toc-number">11.0.1.</span> <span class="toc-text">Associative array</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#array"><span class="toc-number">11.0.2.</span> <span class="toc-text">array</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Avoid-multiple-JBOD-devs-across-in-single-raidz"><span class="toc-number">12.</span> <span class="toc-text">Avoid multiple JBOD devs across in single raidz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Wait-sub-process-finish"><span class="toc-number">13.</span> <span class="toc-text">Wait sub process finish</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sed"><span class="toc-number">14.</span> <span class="toc-text">Sed</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#print-line-from-16224-to-16482"><span class="toc-number">14.1.</span> <span class="toc-text">print line from 16224 to 16482</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AWK"><span class="toc-number">15.</span> <span class="toc-text">AWK</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#single-character-fields"><span class="toc-number">15.1.</span> <span class="toc-text">single character fields</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter"><span class="toc-number">15.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#awk-match-bash-variable"><span class="toc-number">15.3.</span> <span class="toc-text">awk match bash variable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#awk-sort-key-and-value"><span class="toc-number">15.4.</span> <span class="toc-text">awk sort key and value</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Got-int-to-variable"><span class="toc-number">15.5.</span> <span class="toc-text">Got int to variable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bash-strings"><span class="toc-number">16.</span> <span class="toc-text">bash strings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subprocess"><span class="toc-number">17.</span> <span class="toc-text">Subprocess</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exit-err"><span class="toc-number">17.1.</span> <span class="toc-text">exit err</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Termination-Signals-https-www-gnu-org-software-libc-manual-html-node-Termination-Signals-html"><span class="toc-number">18.</span> <span class="toc-text">[Termination Signals] (https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;libc&#x2F;manual&#x2F;html_node&#x2F;Termination-Signals.html)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Random"><span class="toc-number">19.</span> <span class="toc-text">Random</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#number"><span class="toc-number">19.1.</span> <span class="toc-text">number</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed"><span class="toc-number">20.</span> <span class="toc-text">sed</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-bash-variable"><span class="toc-number">20.1.</span> <span class="toc-text">Get bash variable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-scsi-serial-number-by-bash"><span class="toc-number">21.</span> <span class="toc-text">Get scsi serial number by bash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-parent-id-info"><span class="toc-number">22.</span> <span class="toc-text">Get parent id info</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rsync-copy-to-change-ssh-cipher"><span class="toc-number">23.</span> <span class="toc-text">rsync copy to change ssh cipher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Parallel-ssh"><span class="toc-number">24.</span> <span class="toc-text">Parallel ssh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-sparse-file"><span class="toc-number">25.</span> <span class="toc-text">Create sparse file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Num-convert"><span class="toc-number">26.</span> <span class="toc-text">Num convert</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Printf-convert-oct-hex-dec"><span class="toc-number">26.1.</span> <span class="toc-text">Printf convert oct,hex,dec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Integer-ASCII-value-to-character"><span class="toc-number">26.2.</span> <span class="toc-text">Integer ASCII value to character</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xargs"><span class="toc-number">27.</span> <span class="toc-text">xargs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#taskset"><span class="toc-number">28.</span> <span class="toc-text">taskset</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#zfs-and-nfs"><span class="toc-number">28.1.</span> <span class="toc-text">zfs and nfs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stat"><span class="toc-number">29.</span> <span class="toc-text">stat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xargs-1"><span class="toc-number">30.</span> <span class="toc-text">xargs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-old-script"><span class="toc-number">31.</span> <span class="toc-text">the old script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Read-write-by-Byte-by-dd"><span class="toc-number">32.</span> <span class="toc-text">Read write by Byte by dd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parallel"><span class="toc-number">33.</span> <span class="toc-text">parallel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pipe-single-big-file"><span class="toc-number">33.1.</span> <span class="toc-text">Pipe single big file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#For-multiple-files"><span class="toc-number">33.2.</span> <span class="toc-text">For multiple files</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-parameter"><span class="toc-number">33.3.</span> <span class="toc-text">Get parameter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Function"><span class="toc-number">33.4.</span> <span class="toc-text">Function</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#man-page-setting"><span class="toc-number">34.</span> <span class="toc-text">man page setting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#expect-auto-add-ssh-key"><span class="toc-number">35.</span> <span class="toc-text">expect auto add ssh key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#print-last-column"><span class="toc-number">36.</span> <span class="toc-text">print last column</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#use-tee-write-the-same-data-to-the-match-files"><span class="toc-number">37.</span> <span class="toc-text">use tee write the same data to the match files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#another-bash-trap"><span class="toc-number">38.</span> <span class="toc-text">another bash trap</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/photo_by_spacex.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">b946c5a0bf547c89</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Bash tips</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-12-11T03:04:49.000Z" title="Created 2018-12-11 11:04:49">2018-12-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-09-27T14:59:09.922Z" title="Updated 2020-09-27 22:59:09">2020-09-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/bash/">bash</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="Background-exec-script-by-ssh"><a href="#Background-exec-script-by-ssh" class="headerlink" title="Background exec script by ssh"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/29142/getting-ssh-to-execute-a-command-in-the-background-on-target-machine">Background exec script by ssh</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="built_in">echo</span> -------- <span class="variable">$line</span>  -----------; ssh -n -t <span class="variable">$line</span> <span class="string">&#x27;sh -c &quot;( ( nohup /opt/test.sh &amp;&gt;/dev/null ) &amp; )&quot;&#x27;</span>; <span class="keyword">done</span> &lt; hosts</span><br></pre></td></tr></table></figure>

<h3 id="bash-set"><a href="#bash-set" class="headerlink" title="[bash set]"></a>[bash set]</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-f</span><br><span class="line">Disable filename expansion (globbing).</span><br><span class="line"></span><br><span class="line">-v</span><br><span class="line">Print shell input lines as they are <span class="built_in">read</span>.</span><br></pre></td></tr></table></figure>

<h3 id="bash-double-quotes-single-quotes"><a href="#bash-double-quotes-single-quotes" class="headerlink" title="bash double-quotes, single-quotes"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/13826149/how-have-both-local-and-remote-variable-inside-an-ssh-command">bash double-quotes, single-quotes</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">A=100;</span><br><span class="line">ssh name@host <span class="string">&quot;A=101;echo \$A&quot;</span></span><br><span class="line">101</span><br><span class="line"></span><br><span class="line">ssh name@host <span class="string">&quot;A=101;echo <span class="variable">$A</span>&quot;</span></span><br><span class="line">100</span><br><span class="line"><span class="comment">#bash expands it to:</span></span><br><span class="line">ssh name@host <span class="string">&quot;A=101; echo 100&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#use single-quotes</span></span><br><span class="line">ssh name@host <span class="string">&#x27;A=101;echo $A&#x27;</span></span><br><span class="line">101</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="bash-replace-expect-script"><a href="#bash-replace-expect-script" class="headerlink" title="bash replace expect script"></a>bash replace expect script</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;connect\nshow ld\nexit\n&quot;</span> | ./runCLI.sh</span><br></pre></td></tr></table></figure>

<h3 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="keyword">set</span> timeout <span class="number">60</span></span><br><span class="line">spawn <span class="string">&quot;/opt/CLI_ESD/runCLI.sh&quot;</span></span><br><span class="line">expect <span class="string">&quot;RAIDCmd&quot;</span> &#123; send <span class="string">&quot;connect\r&quot;</span> &#125;</span><br><span class="line">expect <span class="string">&quot;Successful&quot;</span> &#123; send <span class="string">&quot;show ld\r&quot;</span> &#125;</span><br><span class="line">expect <span class="string">&quot;logical volume&quot;</span> &#123; send <span class="string">&quot;exit\r&quot;</span> &#125;</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>

<h3 id="ssh-remote-exec-command"><a href="#ssh-remote-exec-command" class="headerlink" title="ssh remote exec command"></a>ssh remote exec command</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#sometimes ssh remote exec command not work</span><br><span class="line">ssh -n name@host  &#39;your command&#39;</span><br><span class="line"></span><br><span class="line">#-t  Force pseudo-terminal allocation.  This can be used to execute arbitrary screen-based programs on a remote machine, which can be very useful, e.g. when implementing menu services.  Multiple -t options force tty allocation, even if ssh has no local tty.</span><br></pre></td></tr></table></figure>

<p>There are a big issue cause I can ‘t parallel exec ssh in bash script, randomly connection closed.<br>I try setting sshd_config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/ssh/sshd_config | grep max -i</span><br><span class="line">MaxSessions 512</span><br><span class="line">ClientAliveCountMax 512</span><br><span class="line">MaxStartups 500:1:500</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -n -t -o TCPKeepAlive&#x3D;yes -o ServerAliveInterval&#x3D;30 -o GSSAPIAuthentication&#x3D;no -o ControlPersist&#x3D;600 $line &#39;$your command&#39;</span><br></pre></td></tr></table></figure>
<p>There is no any help</p>
<p>Fine, I use screen background the command avoid this issue, mpich has the same issue.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">ssh -n -t -o TCPKeepAlive=yes -o GSSAPIAuthentication=no <span class="variable">$line</span> <span class="string">&#x27;screen -dmS fio-read &quot;/root/run-fio-read.sh&quot;&#x27;</span></span><br><span class="line"><span class="keyword">done</span> &lt; test_hosts</span><br></pre></td></tr></table></figure>

<h4 id="single-command-jump-2-nodes"><a href="#single-command-jump-2-nodes" class="headerlink" title="single command jump 2 nodes"></a>single command jump 2 nodes</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -t user1@<span class="variable">$server1</span> -o GSSAPIAuthentication=no <span class="string">&#x27;sudo scp tmp.sh root@$server_ip:&#x27;</span></span><br><span class="line">ssh -t user1@<span class="variable">$server1</span> -o GSSAPIAuthentication=no <span class="string">&#x27;sudo ssh -n root@$server2_ip sh ./tmp.sh&#x27;</span></span><br></pre></td></tr></table></figure>


<h3 id="remove-name-begin-with-“-“"><a href="#remove-name-begin-with-“-“" class="headerlink" title="remove name begin with “-“"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/1519/how-do-i-delete-a-file-whose-name-begins-with-hyphen-a-k-a-dash-or-minus">remove name begin with “-“</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -- --<span class="built_in">help</span></span><br><span class="line">rm ./--<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="IFS"><a href="#IFS" class="headerlink" title="IFS"></a>IFS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default value, &lt;space&gt;&lt;tab&gt;&lt;newline&gt;</span></span><br><span class="line">$ IFS=$<span class="string">&#x27; \t\n&#x27;</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ IFS=<span class="string">&#x27;input from keyboard space,tab,newline&#x27;</span></span><br><span class="line"><span class="comment"># read IFS</span></span><br><span class="line">$ cat -etv &lt;&lt;&lt; <span class="variable">$IFS</span></span><br><span class="line"> ^I$</span><br><span class="line">$</span><br><span class="line"></span><br><span class="line">$ IFS=$(<span class="built_in">echo</span> <span class="string">&quot; \n\t&quot;</span>); <span class="built_in">printf</span> <span class="string">&quot;%s&quot;</span> <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span>|xxd</span><br><span class="line">00000000: 205c 6e5c 74</span><br><span class="line"></span><br><span class="line"><span class="comment"># backup the value</span></span><br><span class="line">OLDIFS=<span class="variable">$IFS</span> </span><br></pre></td></tr></table></figure>

<h3 id="test-match"><a href="#test-match" class="headerlink" title="test match"></a>test match</h3><h4 id="is-a-integer"><a href="#is-a-integer" class="headerlink" title="is a integer"></a>is a integer</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=1</span><br><span class="line">[[ <span class="variable">$a</span> == *[[:digit:]]* ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> is an integer&quot;</span></span><br><span class="line">[[ <span class="variable">$1</span> == ?(-)+([0-9]) ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> is an integer&quot;</span></span><br><span class="line"><span class="comment">#match yes</span></span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$response</span>&quot;</span> =~ ^([yY][eE][sS]|[yY])+$ ]]</span><br></pre></td></tr></table></figure>

<h3 id="String-Ternary-conditional-operator-three"><a href="#String-Ternary-conditional-operator-three" class="headerlink" title="String, Ternary conditional operator (three)"></a>String, Ternary conditional operator (three)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">VAR1=<span class="string">&quot;BASH&quot;</span></span><br><span class="line">VAR1+=<span class="string">&quot; SCRIPT&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$VAR1</span>&quot;</span></span><br><span class="line">BASH SCRIPT</span><br><span class="line"></span><br><span class="line">n=4</span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 $((<span class="variable">$n</span> &gt; <span class="number">0</span>? <span class="variable">$n</span>-<span class="number">1</span>: <span class="number">0</span>))); <span class="keyword">do</span> </span><br><span class="line">  result+=<span class="string">&quot;rank-<span class="variable">$i</span>&quot;</span></span><br><span class="line">  result+=<span class="string">&quot; &quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line">rank-0 rank-1 rank-2 rank-3</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time_interval=$((<span class="variable">$1</span> &gt; <span class="number">36000</span>? <span class="number">36000</span>: <span class="number">3600</span>))</span><br></pre></td></tr></table></figure>


<h3 id="Arrary"><a href="#Arrary" class="headerlink" title="Arrary"></a>Arrary</h3><h5 id="Associative-array"><a href="#Associative-array" class="headerlink" title="Associative array"></a>Associative array</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">declare -A array</span><br><span class="line">array[foo]&#x3D;bar</span><br><span class="line">array[bar]&#x3D;foo</span><br><span class="line"></span><br><span class="line">for i in &quot;$&#123;!array[@]&#125;&quot;</span><br><span class="line">do</span><br><span class="line">  echo -n &quot;key : $i; &quot;</span><br><span class="line">  echo &quot;value: $&#123;array[$i]&#125;&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4069188/how-to-pass-an-associative-array-as-argument-to-a-function-in-bash/46085661#46085661">direct access array in function</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/tmp</span><br><span class="line">AA 11</span><br><span class="line">BB 22</span><br><span class="line">CC 33</span><br><span class="line">DD 44</span><br><span class="line">ZZ 55</span><br><span class="line">YY 66</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A ARR</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   key=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">   value=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   ARR[<span class="variable">$key</span>]=<span class="variable">$value</span></span><br><span class="line"><span class="keyword">done</span> &lt; /tmp/tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">fun</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!ARR[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">          <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$i</span>&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot; <span class="variable">$&#123;ARR[$i]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line">fun <span class="string">&quot;hahaha&quot;</span></span><br></pre></td></tr></table></figure>

<p>If you want copy array    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -A ARR</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!ARR[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  ARRAY[<span class="string">&quot;<span class="variable">$key</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$&#123;ARR[&quot;$key&quot;]&#125;</span>&quot;</span></span><br><span class="line">  <span class="comment"># ARRAY+=( [&quot;$key&quot;]=&quot;$&#123;ARR[&quot;$key&quot;]&#125;&quot; )</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>bash 4.4 in ubuntu</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A ARR</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   key=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">   value=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   ARR[<span class="variable">$key</span>]=<span class="variable">$value</span></span><br><span class="line"><span class="keyword">done</span> &lt; /tmp/tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print_ARR</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> -n array=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!array[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">          <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$i</span>&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot; <span class="variable">$&#123;array[$i]&#125;</span>&quot;</span></span><br><span class="line">     <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!ARR[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> -n <span class="string">&quot;key: <span class="variable">$i</span> &quot;</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;value: <span class="variable">$&#123;ARR[$i]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> ---------<span class="keyword">in</span> func ----------</span><br><span class="line">print_ARR <span class="string">&quot;ARR&quot;</span></span><br></pre></td></tr></table></figure>

<p>or you could </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   key=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">   value=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   ARR[<span class="variable">$key</span>]=<span class="variable">$value</span></span><br><span class="line"><span class="keyword">done</span> &lt;&lt;&lt; <span class="string">&quot;<span class="subst">$([[ ! -z $var ]] &amp;&amp; awk  &#x27;&#123;print $1,$2&#125;&#x27; your_file)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="array"><a href="#array" class="headerlink" title="array"></a>array</h5><p>split string to array</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ lsscsi_out&#x3D;$(lsscsi | awk &#39;$NF!~&#x2F;-&#x2F; &#123;print $NF&#125;&#39;)</span><br><span class="line">$ read -r -a noroot_dev &lt;&lt;&lt; $lsscsi_out ## you could change IFS for your need, IFS&#x3D;&#39;, &#39; read -r -a array &lt;&lt;&lt; &quot;$string&quot;</span><br><span class="line">$ echo $&#123;#noroot_dev[@]&#125;</span><br><span class="line">6</span><br><span class="line">$ echo $&#123;noroot_dev[@]&#125;</span><br><span class="line">&#x2F;dev&#x2F;sda &#x2F;dev&#x2F;sdf &#x2F;dev&#x2F;sde &#x2F;dev&#x2F;sdd &#x2F;dev&#x2F;sdc &#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">var&#x3D;($(.&#x2F;test.sh))</span><br><span class="line"></span><br><span class="line">echo $&#123;var[0]&#125;</span><br><span class="line">echo $&#123;var[1]&#125;</span><br><span class="line">echo $&#123;var[2]&#125;</span><br><span class="line"></span><br><span class="line"># another example</span><br><span class="line">arr&#x3D;($(echo $m | tr &quot; &quot; &quot;\n&quot;))</span><br><span class="line"></span><br><span class="line">ARRAY&#x3D;()</span><br><span class="line">ARRAY+&#x3D;(&#39;foo&#39;)</span><br><span class="line">ARRAY+&#x3D;(&#39;bar&#39;)</span><br><span class="line">for i in &quot;$&#123;!ARRAY[@]&#125;&quot;; do echo $i; done</span><br><span class="line">for i in &quot;$&#123;ARRAY[@]&#125;&quot;; do echo $i; done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">declare -a names</span><br><span class="line"></span><br><span class="line">names[0]&#x3D;1111</span><br><span class="line">names[1]&#x3D;2222</span><br><span class="line">or</span><br><span class="line">names&#x3D;(&#39;1111&#39; &#39;2222&#39;)</span><br><span class="line">or</span><br><span class="line">names&#x3D;([0]&#x3D;&#39;1111&#39; [1]&#x3D;&#39;2222&#39;)</span><br><span class="line"></span><br><span class="line">$ cat files.txt</span><br><span class="line">1111111</span><br><span class="line">2222222</span><br><span class="line">3333333</span><br><span class="line"></span><br><span class="line"># get array from file</span><br><span class="line">names&#x3D;($(cat files.txt))</span><br><span class="line">$ echo $&#123;names[1]&#125;</span><br><span class="line">2222222</span><br><span class="line">$ echo $&#123;names[2]&#125;</span><br><span class="line">3333333</span><br><span class="line">$ echo $&#123;names[3]&#125;</span><br><span class="line">$ echo $&#123;#names[@]&#125;</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">$ echo $&#123;names[@]:0:1&#125;</span><br><span class="line">1111111</span><br><span class="line">$ echo $&#123;names[@]:0:2&#125;</span><br><span class="line">1111111 2222222</span><br><span class="line"></span><br><span class="line">echo $&#123;names[@]:1&#125;</span><br><span class="line">2222222 333333</span><br><span class="line"></span><br><span class="line">$ names1&#x3D;([0]&#x3D;&#39;1111&#39; [2]&#x3D;&#39;2222&#39; [4]&#x3D;&#39;3333&#39;)</span><br><span class="line">$ echo $&#123;#adobe[@]&#125;</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">$ names&#x3D;(&#39;1111&#39; &#39;2222&#39; &#39;3333&#39; &#39;4444&#39; &#39;5555&#39;)</span><br><span class="line">$ names2&#x3D;(&#39;6666&#39; &#39;7777&#39;)</span><br><span class="line">$ names3&#x3D;($&#123;names[@]&#125; $&#123;names2[@]&#125;)</span><br><span class="line">$ echo $&#123;#names3[@]&#125;</span><br><span class="line">7</span><br><span class="line"></span><br><span class="line">### delete array</span><br><span class="line">$ names&#x3D;(&#39;1111&#39; &#39;2222&#39; &#39;3333&#39; &#39;4444&#39;)</span><br><span class="line">$ echo $&#123;names[@]&#x2F;1111&#x2F;0000&#125;</span><br><span class="line">0000 2222 3333 4444</span><br><span class="line"></span><br><span class="line">$ for item in $&#123;names[@]&#125;;do echo $item; done</span><br><span class="line">1111</span><br><span class="line">2222</span><br><span class="line">3333</span><br><span class="line">4444</span><br><span class="line"></span><br><span class="line">$ len&#x3D;$&#123;#names[@]&#125;</span><br><span class="line">$ for ((i&#x3D;0;i&lt;$len;i++));do echo $&#123;names[$i]&#125;;done</span><br><span class="line"></span><br><span class="line">## delete array element</span><br><span class="line">$ noroot_dev&#x3D;($&#123;noroot_dev[@]&#x2F;$j&#x2F;&#125;)</span><br><span class="line"></span><br><span class="line">rclocal&#x3D;&quot;&#x2F;etc&#x2F;rc.d&#x2F;rc.local&quot;</span><br><span class="line">grep -iE &#39;ethtool&#39; $rclocal  || ls &#x2F;sys&#x2F;class&#x2F;net | egrep &#39;(eth|en|p|em|bond|br)&#39; | egrep -v &#39;bonding_masters|vir&#39; | while read nic</span><br><span class="line">do</span><br><span class="line">    nicbuff+&#x3D;($(ethtool -g $nic | grep -A 4 &quot;Pre-set maximums&quot; | grep -vEi &#39;maximums|mini|jumbo&#39; | awk &#39;&#123;print $NF&#125;&#39;))</span><br><span class="line">    echo ethtool -G $nic rx $&#123;nicbuff[0]&#125; tx $&#123;nicbuff[1]&#125; &gt;&gt; $rclocal</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h3 id="Avoid-multiple-JBOD-devs-across-in-single-raidz"><a href="#Avoid-multiple-JBOD-devs-across-in-single-raidz" class="headerlink" title="Avoid multiple JBOD devs across in single raidz"></a>Avoid multiple JBOD devs across in single raidz</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tempdir=/tmp;</span><br><span class="line">lsscsi -tiv  | sed -z <span class="string">&#x27;s/\n  dir:/ /g&#x27;</span> | awk -v tempdir=<span class="string">&quot;<span class="variable">$tempdir</span>&quot;</span> -F <span class="string">&#x27;[:\\[/ ]+&#x27;</span> <span class="string">&#x27;$10!~/-/ &amp;&amp; $0~/disk/ &amp;&amp; $7~/sas/ &#123;print &quot;/dev/disk/by-id/scsi-&quot;$11,$2 &gt; tempdir&quot;/&quot;$30&quot;_&quot;$31&quot;_&quot;$32&quot;_&quot;$33&quot;_&quot;$34&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Wait-sub-process-finish"><a href="#Wait-sub-process-finish" class="headerlink" title="Wait sub process finish"></a>Wait sub process finish</h3><p>Here is example to paralle running SMcli to collect MD34xx’s log. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        SMcli localhost -n <span class="variable">$line</span> -c <span class="string">&quot;save storageArray supportdata file=\&quot;/root/<span class="variable">$&#123;1&#125;</span>/smcli_<span class="variable">$&#123;line&#125;</span>_controller\&quot; force=true;&quot;</span> &amp;</span><br><span class="line">        <span class="built_in">echo</span> $! &gt;&gt; <span class="variable">$dell_pids</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$dell_names</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> Begin to <span class="built_in">wait</span> smcli <span class="variable">$line</span></span><br><span class="line">    <span class="built_in">wait</span> <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$dell_pids</span></span><br></pre></td></tr></table></figure>
<h3 id="Sed"><a href="#Sed" class="headerlink" title="Sed"></a><a target="_blank" rel="noopener" href="https://www.oakton.edu/user/2/rjtaylor/cis218/Handouts/sed.txt">Sed</a></h3><h4 id="print-line-from-16224-to-16482"><a href="#print-line-from-16224-to-16482" class="headerlink" title="print line from 16224 to 16482"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/83329/how-can-i-extract-a-predetermined-range-of-lines-from-a-text-file-on-unix">print line from 16224 to 16482</a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n &#39;16224,16482p;16483q&#39; filename &gt; newfile</span><br><span class="line">p - Print out the pattern space (to the standard output). This command is usually only used in conjunction with the -n command-line option.</span><br><span class="line"></span><br><span class="line">n - If auto-print is not disabled, print the pattern space, then, regardless, replace the pattern space with the next line of input. If there is no more input then sed exits without processing any more commands.</span><br><span class="line"></span><br><span class="line">q - Exit sed without processing any more commands or input. Note that the current pattern space is printed if auto-print is not disabled with the -n option.</span><br></pre></td></tr></table></figure>

<p>modify first display key word</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># match second match colume</span></span><br><span class="line">$ sed <span class="string">&#x27;s/unix/to_linux/2&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 to_linux unix  8</span><br><span class="line">4 5 unix to_linux unix 2</span><br><span class="line">7 unix 9 to_linux 12  unix</span><br><span class="line">unix 11 12 to_linux 14  unix</span><br><span class="line">unix 14 to_linux unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line">$ sed <span class="string">&#x27;0,/unix/ &#123;s/unix/to_linux/&#125;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 to_linux 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line">second ~ last match colume</span><br><span class="line">$ sed <span class="string">&#x27;s/unix/to_that/2g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 to_that to_that  8</span><br><span class="line">4 5 unix to_that to_that 2</span><br><span class="line">7 unix 9 to_that 12  to_that</span><br><span class="line">unix 11 12 to_that 14  to_that</span><br><span class="line">unix 14 to_that to_that 16  19 to_that 228</span><br><span class="line"></span><br><span class="line">$ sed <span class="string">&#x27;s/unix/to_that/3g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix to_that  8</span><br><span class="line">4 5 unix unix to_that 2</span><br><span class="line">7 unix 9 unix 12  to_that</span><br><span class="line">unix 11 12 unix 14  to_that</span><br><span class="line">unix 14 unix to_that 16  19 to_that 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># or you can</span></span><br><span class="line">$ sed <span class="string">&#x27;s_http://_www_&#x27;</span> file.txt</span><br><span class="line">$ sed <span class="string">&#x27;s|http://|www|&#x27;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># use &amp; as the match string</span></span><br><span class="line">$ sed <span class="string">&#x27;s/unix/&#123;&amp;&#125;/&#x27;</span> /tmp/test.txt</span><br><span class="line">1 &#123;unix&#125; 3 unix unix  8</span><br><span class="line">4 5 &#123;unix&#125; unix unix 2</span><br><span class="line">7 &#123;unix&#125; 9 unix 12  unix</span><br><span class="line">&#123;unix&#125; 11 12 unix 14  unix</span><br><span class="line">&#123;unix&#125; 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line">$ sed -n <span class="string">&#x27;s/unix/linux/p&#x27;</span> /tmp/test.txt <span class="comment"># only print match line</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#multiple command</span></span><br><span class="line">$ sed -e <span class="string">&#x27;s/unix/linux/&#x27;</span> -e <span class="string">&#x27;s/9/system/&#x27;</span>  /tmp/test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># only replace some line </span></span><br><span class="line">$ sed <span class="string">&#x27;3 s/unix/to_linux/g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 to_linux 9 to_linux 12  to_linux</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># from 1~3 lines</span></span><br><span class="line">$ sed <span class="string">&#x27;1,3 s/unix/to_linux/g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 to_linux 3 to_linux to_linux  8</span><br><span class="line">4 5 to_linux to_linux to_linux 2</span><br><span class="line">7 to_linux 9 to_linux 12  to_linux</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># only replace match line</span></span><br><span class="line">$ sed <span class="string">&#x27;/4 5/ s/unix/centos/&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 centos unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete line</span></span><br><span class="line">$ sed <span class="string">&#x27;2 d&#x27;</span> /tmp/test.txt</span><br><span class="line">$ sed <span class="string">&#x27;5,$ d&#x27;</span> /tmp/test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#duplicate text</span></span><br><span class="line">$ sed <span class="string">&#x27;p&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/unix/ p&#x27;</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep -v</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/unix/ !p&#x27;</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add line after a match</span></span><br><span class="line">$ sed <span class="string">&#x27;/4 5/ a &quot;Add a new line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">sed <span class="string">&#x27;/4 5/ a &quot;Add a new line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line"><span class="string">&quot;Add a new line&quot;</span></span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add a line before a match</span></span><br><span class="line">$ sed <span class="string">&#x27;/4 5/ i &quot;Add a new line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line"><span class="string">&quot;Add a new line&quot;</span></span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the whole line</span></span><br><span class="line">sed <span class="string">&#x27;/4 5/ c &quot;Change line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line"><span class="string">&quot;Change line&quot;</span></span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br></pre></td></tr></table></figure>

<h3 id="AWK"><a href="#AWK" class="headerlink" title="AWK"></a>AWK</h3><h4 id="single-character-fields"><a href="#single-character-fields" class="headerlink" title="single character fields"></a><a target="_blank" rel="noopener" href="https://www.gnu.org/software/gawk/manual/html_node/Single-Character-Fields.html">single character fields</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> a b | gawk <span class="string">&#x27;BEGIN &#123; FS = &quot;&quot; &#125;</span></span><br><span class="line"><span class="string">&gt;                  &#123;</span></span><br><span class="line"><span class="string">&gt;                      for (i = 1; i &lt;= NF; i = i + 1)</span></span><br><span class="line"><span class="string">&gt;                          print &quot;Field&quot;, i, &quot;is&quot;, $i</span></span><br><span class="line"><span class="string">&gt;                  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>If you want use ‘[‘ and ‘]’ become the separator </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">&#x27;[][ :]+&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="awk-match-bash-variable"><a href="#awk-match-bash-variable" class="headerlink" title="awk match bash variable"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39384283/how-to-match-a-pattern-given-in-a-variable-in-awk">awk match bash variable</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v pat=<span class="string">&quot;<span class="variable">$pattern</span>&quot;</span> -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;$0~pat&#123;print $1, $2, $3, $4 &#125;&#x27;</span> file</span><br></pre></td></tr></table></figure>

<h4 id="awk-sort-key-and-value"><a href="#awk-sort-key-and-value" class="headerlink" title="awk sort key and value"></a><a target="_blank" rel="noopener" href="https://www.gnu.org/software/gawk/manual/html_node/Controlling-Scanning.html">awk sort key and value</a></h4><p>out of order the line</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sort -R file_name</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PROCINFO[<span class="string">&quot;sorted_in&quot;</span>] = <span class="string">&quot;@val_num_desc&quot;</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> a) <span class="built_in">print</span> i, a[i]</span><br></pre></td></tr></table></figure>

<p>awk absolute match $0~/ / /<br>sed absolute match sed -i “/&lt;${i}&gt;/d”</p>
<h4 id="Got-int-to-variable"><a href="#Got-int-to-variable" class="headerlink" title="Got int to variable"></a>Got int to variable</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[int(<span class="variable">$NF</span>/1000)]++</span><br></pre></td></tr></table></figure>

<h3 id="bash-strings"><a href="#bash-strings" class="headerlink" title="bash strings"></a>bash strings</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># string length</span></span><br><span class="line">[[ <span class="variable">$&#123;#f_check&#125;</span> -le 8 ]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># variable is a number</span></span><br><span class="line">[[ <span class="variable">$VAR</span> = *[[:digit:]]* ]]</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$b</span></span><br><span class="line"><span class="comment">#50_5000cca26b90c3b1</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$c</span></span><br><span class="line">5000cca26b90c3b1</span><br><span class="line"></span><br><span class="line">$ [[ <span class="variable">$b</span> =~ <span class="variable">$c</span> ]] &amp;&amp; <span class="built_in">echo</span> ok</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>

<p>awk statement “next” to immediately continue with processing the next input record.</p>
<h3 id="Subprocess"><a href="#Subprocess" class="headerlink" title="Subprocess"></a>Subprocess</h3><h4 id="exit-err"><a href="#exit-err" class="headerlink" title="exit err"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/48533/exit-shell-script-from-a-subshell">exit err</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -E</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;[ &quot;$?&quot; -ne 33 ] || exit 33&#x27;</span> ERR</span><br><span class="line">lfs getstripe <span class="variable">$namespace</span> &gt; /dev/null 2&gt;&amp;1 || (<span class="built_in">echo</span> <span class="string">&quot;Not found lustre filesystem&quot;</span> &amp;&amp; <span class="built_in">exit</span> 33)</span><br><span class="line"><span class="built_in">set</span> +E</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -E</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;[ &quot;$?&quot; -ne 33 ] || exit 33&#x27;</span> ERR</span><br><span class="line"><span class="keyword">for</span> ((i=0;i&lt;=9;i++)); <span class="keyword">do</span> <span class="built_in">echo</span> ----<span class="variable">$i</span> ; <span class="keyword">if</span> [[ <span class="variable">$i</span> -eq 3 ]]; <span class="keyword">then</span> lll || (<span class="built_in">echo</span> <span class="string">&quot;show error&quot;</span> &amp;&amp; <span class="built_in">exit</span> 33); <span class="keyword">else</span> <span class="built_in">echo</span> -----------<span class="variable">$i</span>---------------; <span class="keyword">fi</span> ; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">set</span> +E</span><br><span class="line"><span class="built_in">echo</span> haha out of</span><br></pre></td></tr></table></figure>

<h3 id="Termination-Signals-https-www-gnu-org-software-libc-manual-html-node-Termination-Signals-html"><a href="#Termination-Signals-https-www-gnu-org-software-libc-manual-html-node-Termination-Signals-html" class="headerlink" title="[Termination Signals] (https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html)"></a>[Termination Signals] (<a target="_blank" rel="noopener" href="https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html">https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html</a>)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">* 1 SIGHUP The SIGHUP (<span class="string">&quot;hang-up&quot;</span>) signal is used to report that the user<span class="string">&#x27;s terminal is disconnected, perhaps because a network or telephone connection was broken.</span></span><br><span class="line"><span class="string">* 2 SIGINT The SIGINT (program interrupt) signal is sent when the user types the INTR character (normally C-c).</span></span><br><span class="line"><span class="string">* 3 The SIGQUIT signal is similar to SIGINT, except that it’s controlled by a different key-the QUIT character, usually C-\-and produces a core dump when it terminates the process, just like a program error signal. You can think of this as a program error condition &quot;detected&quot; by the user</span></span><br><span class="line"><span class="string">* 9 The SIGKILL signal is used to cause immediate program termination. It cannot be handled or ignored, and is therefore always fatal. It is also not possible to block this signal</span></span><br><span class="line"><span class="string">* 15 The SIGTERM signal is a generic signal used to cause program termination. Unlike SIGKILL, this signal can be blocked, handled, and ignored. It is the normal way to politely ask a program to terminate.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Trap</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">mytrap () &#123;</span></span><br><span class="line"><span class="string">  echo hahahahaha</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">trap mytrap SIGHUP SIGINT SIGQUIT SIGTERM ERR EXIT</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">myfunc () &#123;</span></span><br><span class="line"><span class="string"> trap  mytrap RETURN</span></span><br><span class="line"><span class="string"> #trap  mytrap EXIT #no output</span></span><br><span class="line"><span class="string"> echo &quot;I&#x27;</span>ve got a bad feeling about this...<span class="string">&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">myfunc | cat</span></span><br><span class="line"><span class="string">sleep 10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">###############################</span></span><br><span class="line"><span class="string">Number	SIG	Meaning</span></span><br><span class="line"><span class="string">0	0	On exit from shell</span></span><br><span class="line"><span class="string">1	SIGHUP	Clean tidyup</span></span><br><span class="line"><span class="string">2	SIGINT	Interrupt</span></span><br><span class="line"><span class="string">3	SIGQUIT	Quit</span></span><br><span class="line"><span class="string">6	SIGABRT	Abort</span></span><br><span class="line"><span class="string">9	SIGKILL	Die Now (cannot be trapped)</span></span><br><span class="line"><span class="string">14	SIGALRM	Alarm Clock</span></span><br><span class="line"><span class="string">15	SIGTERM	Terminate</span></span><br></pre></td></tr></table></figure>

<h3 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h3><h4 id="number"><a href="#number" class="headerlink" title="number"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2556190/random-number-from-a-range-in-a-bash-script">number</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from 2000~65000</span></span><br><span class="line">$ shuf -i 2000-65000 -n 1</span><br></pre></td></tr></table></figure>

<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><h4 id="Get-bash-variable"><a href="#Get-bash-variable" class="headerlink" title="Get bash variable"></a>Get bash variable</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i <span class="string">&quot;s/524335808/<span class="variable">$&#123;mem&#125;</span>/&quot;</span></span><br><span class="line">$ sed <span class="string">&quot;/\&lt;<span class="variable">$&#123;a&#125;</span>\&gt;/d&quot;</span> zfs_free_dev <span class="comment"># like grep -w , \&lt;\&gt; force an exact match</span></span><br></pre></td></tr></table></figure>

<h3 id="Get-scsi-serial-number-by-bash"><a href="#Get-scsi-serial-number-by-bash" class="headerlink" title="Get scsi serial number by bash"></a>Get scsi serial number by bash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ strings /sys/block/sda/device/vpd_pg80 | tr -d <span class="string">&#x27;\040\011\012\015&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Get-parent-id-info"><a href="#Get-parent-id-info" class="headerlink" title="Get parent id info"></a>Get parent id info</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ pstree -sg 25153</span><br><span class="line">systemd(1)───qemu-kvm(25147)─┬─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             └─&#123;qemu-kvm&#125;(25147)</span><br></pre></td></tr></table></figure>

<h3 id="rsync-copy-to-change-ssh-cipher"><a href="#rsync-copy-to-change-ssh-cipher" class="headerlink" title="rsync copy to change ssh cipher"></a>rsync copy to change ssh cipher</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## -c arcfour could show support cipher</span></span><br><span class="line">$ rsync -aHAXvP -e <span class="string">&quot;ssh -T -c chacha20-poly1305@openssh.com -o Compression=no -x&quot;</span> <span class="built_in">source</span>:/xxxx <span class="variable">$ipaddr</span>:/xxx</span><br></pre></td></tr></table></figure>

<h3 id="Parallel-ssh"><a href="#Parallel-ssh" class="headerlink" title="Parallel ssh"></a>Parallel ssh</h3><ul>
<li>Don ‘t need install anything (pdsh or cluster shell, ansible)</li>
<li>Compatibility<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   ssh -n <span class="variable">$line</span> <span class="string">&quot;your command &gt; your log 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; hosts</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Create-sparse-file"><a href="#Create-sparse-file" class="headerlink" title="Create sparse file"></a>Create sparse file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ fallocate -l 5G -o 5G bar</span><br><span class="line">$ ls -lhs bar</span><br><span class="line">5.0G -rw-r--r-- 1 root root 10G Aug 23 08:58 bar</span><br><span class="line"></span><br><span class="line">$ truncate -s 512M bar</span><br><span class="line">0 -rw-rw-r-- 1 root root 512M 10月  4 22:07 bar</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Num-convert"><a href="#Num-convert" class="headerlink" title="Num convert"></a>Num convert</h3><p>hex -&gt; bin num</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dc -e &#39;16i2o0x6003p&#39;</span><br><span class="line">110000000000011</span><br><span class="line">110,0000,0000,0011</span><br></pre></td></tr></table></figure>

<p>bin &lt;-&gt; dec</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bin -&gt; dec</span></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">2#1010</span>))</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line"><span class="comment">#dec -&gt; bin</span></span><br><span class="line"><span class="comment"># 0-255</span></span><br><span class="line">$ bin=(&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;a[5]&#125;</span></span><br><span class="line">00000101</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;a[255]&#125;</span></span><br><span class="line">11111111</span><br><span class="line"></span><br><span class="line">$ var=<span class="string">&quot;304&quot;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;obase=2; <span class="variable">$var</span>&quot;</span> | bc</span><br><span class="line">100110000</span><br></pre></td></tr></table></figure>

<h4 id="Printf-convert-oct-hex-dec"><a href="#Printf-convert-oct-hex-dec" class="headerlink" title="Printf convert oct,hex,dec"></a>Printf convert oct,hex,dec</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">printf</span> <span class="string">&quot;%d %d %x %o\n&quot;</span> 0x10 010 16 0xf</span><br><span class="line">16 8 10 17</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">16#f</span>))</span><br><span class="line">15</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">8#10</span>))</span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<h4 id="Integer-ASCII-value-to-character"><a href="#Integer-ASCII-value-to-character" class="headerlink" title="Integer ASCII value to character"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/890262/integer-ascii-value-to-character-in-bash-using-printf">Integer ASCII value to character</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">printf</span> <span class="string">&quot;\x<span class="subst">$(printf %x 65)</span>&quot;</span></span><br><span class="line">A</span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;printf &quot;%c&quot;, 65&#125;&#x27;</span></span><br><span class="line">A</span><br></pre></td></tr></table></figure>

<h3 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h3><p>same with while read line</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ seq 88 97 | xargs -I% grep -H . /proc/irq/%/smp_affinity</span><br></pre></td></tr></table></figure>

<h3 id="taskset"><a href="#taskset" class="headerlink" title="taskset"></a>taskset</h3><h4 id="zfs-and-nfs"><a href="#zfs-and-nfs" class="headerlink" title="zfs and nfs"></a>zfs and nfs</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> i=13</span><br><span class="line">ps -C nfsd | awk <span class="string">&#x27;$0!~/PID/ &#123;print $1&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        [[ <span class="variable">$i</span> -gt 19 ]] &amp;&amp; <span class="built_in">export</span> i=13</span><br><span class="line">        taskset -p -c <span class="variable">$i</span> <span class="variable">$line</span></span><br><span class="line">        ((i=i+2))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> core=0</span><br><span class="line">[[ $(grep MHz /proc/cpuinfo -c) -gt 3 ]] &amp;&amp; maxcpu=8 &amp;&amp; <span class="keyword">for</span> i <span class="keyword">in</span> $(pgrep <span class="string">&#x27;z_wr_iss$&#x27;</span>);</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        [[ <span class="variable">$core</span> -gt <span class="variable">$maxcpu</span> ]] &amp;&amp; core=0;    taskset -p -c <span class="variable">$core</span> <span class="variable">$i</span>;    ((core++)); ((core++));</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get moidfy time from </span></span><br><span class="line">$ <span class="built_in">stat</span> -c%Z file</span><br><span class="line"></span><br><span class="line"><span class="comment"># now</span></span><br><span class="line">$ date +%s</span><br></pre></td></tr></table></figure>

<h3 id="xargs-1"><a href="#xargs-1" class="headerlink" title="xargs"></a>xargs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -n <span class="variable">$your_server</span> <span class="string">&quot;lsscsi -gis | awk &#x27;\$0~/3500/&#123;print \$6&#125;&#x27; | xargs -I&#123;&#125; sdparm -s RCD=0 &#123;&#125; &quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="the-old-script"><a href="#the-old-script" class="headerlink" title="the old script"></a>the old script</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head -c 10k test1 | tail -c 1k </span><br><span class="line">$ dd <span class="keyword">if</span>=test1 of=test2 bs=1k skip=9 count=1</span><br></pre></td></tr></table></figure>

<h3 id="Read-write-by-Byte-by-dd"><a href="#Read-write-by-Byte-by-dd" class="headerlink" title="Read write by Byte by dd"></a>Read write by Byte by dd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       ibs=BYTES</span><br><span class="line">              <span class="built_in">read</span> up to BYTES bytes at a time (default: 512)</span><br><span class="line">       obs=BYTES</span><br><span class="line">              write BYTES bytes at a time (default: 512)</span><br><span class="line">       bs=BYTES</span><br><span class="line">              <span class="built_in">read</span> and write up to BYTES bytes at a time (default: 512); overrides ibs and obs</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> bs=1 </span><br></pre></td></tr></table></figure>

<h3 id="parallel"><a href="#parallel" class="headerlink" title="parallel"></a>parallel</h3><h4 id="Pipe-single-big-file"><a href="#Pipe-single-big-file" class="headerlink" title="Pipe single big file"></a>Pipe single big file</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat bigfile.bin | parallel --pipe --recend <span class="string">&#x27;&#x27;</span> -k bzip2 --best &gt; compressedfile.bz2</span><br><span class="line">cat bigfile.txt | parallel --block 10M --pipe grep <span class="string">&#x27;pattern&#x27;</span></span><br><span class="line">cat rands20M.txt | parallel --pipe awk \<span class="string">&#x27;&#123;s+=\$1&#125; END &#123;print s&#125;\&#x27;</span> | awk <span class="string">&#x27;&#123;s+=$1&#125; END &#123;print s&#125;&#x27;</span></span><br><span class="line">cat bigfile.txt | parallel  --pipe wc -l | awk <span class="string">&#x27;&#123;s+=$1&#125; END &#123;print s&#125;&#x27;</span></span><br><span class="line">cat bigfile.txt | parallel --pipe sed s^old^new^g</span><br></pre></td></tr></table></figure>

<h4 id="For-multiple-files"><a href="#For-multiple-files" class="headerlink" title="For multiple files"></a>For multiple files</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&#x27;*.html&#x27;</span> | parallel gzip --best</span><br></pre></td></tr></table></figure>

<h4 id="Get-parameter"><a href="#Get-parameter" class="headerlink" title="Get parameter"></a>Get parameter</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ seq 10 | parallel <span class="built_in">echo</span> test_&#123;&#125;</span><br><span class="line">test_1</span><br><span class="line">test_2</span><br><span class="line">test_3</span><br><span class="line">test_4</span><br><span class="line">test_5</span><br><span class="line">test_6</span><br><span class="line">test_7</span><br><span class="line">test_8</span><br><span class="line">test_9</span><br><span class="line">test_10</span><br><span class="line"></span><br><span class="line">$ parallel <span class="built_in">echo</span> ::: <span class="string">&quot;123&quot;</span> <span class="string">&quot;456&quot;</span> <span class="built_in">test</span> zzz</span><br><span class="line">123</span><br><span class="line">456</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">zzz</span><br><span class="line"></span><br><span class="line">$ parallel <span class="built_in">echo</span> ::: A B C ::: D E F</span><br><span class="line">A D</span><br><span class="line">A E</span><br><span class="line">A F</span><br><span class="line">B D</span><br><span class="line">B E</span><br><span class="line">B F</span><br><span class="line">C D</span><br><span class="line">C E</span><br><span class="line">C F</span><br><span class="line"></span><br><span class="line">$ parallel -a abc-file -a def-file <span class="built_in">echo</span></span><br><span class="line">$ cat abc-file | parallel -a - -a def-file <span class="built_in">echo</span></span><br><span class="line"><span class="comment"># replace - by ::::</span></span><br><span class="line">$ cat abc-file | parallel <span class="built_in">echo</span> :::: - def-file</span><br><span class="line"><span class="comment"># &quot;:::&quot; is stand input, :::: is file</span></span><br><span class="line">$ parallel <span class="built_in">echo</span> ::: A B C :::: def-file</span><br><span class="line"></span><br><span class="line">$ parallel --xapply <span class="built_in">echo</span> ::: A B C ::: D E F</span><br><span class="line">A D</span><br><span class="line">B E</span><br><span class="line">C F</span><br><span class="line">$ seq 50 | parallel -n0 -q  curl <span class="string">&#x27;example.com&#x27;</span></span><br><span class="line"><span class="comment">#  -n 0 means read one argument, but insert 0 arguments on the command line.</span></span><br><span class="line"><span class="comment">#  -q       Quote command.  This will quote the command line so special characters are not interpreted by the shell.</span></span><br></pre></td></tr></table></figure>

<h4 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">doit</span></span>() &#123;</span><br><span class="line">    x=<span class="variable">$1</span></span><br><span class="line">    do_something <span class="variable">$x</span></span><br><span class="line">    [... 100 lines that <span class="keyword">do</span> something with <span class="variable">$x</span> ...]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">export</span> -f doit</span><br><span class="line">  cat list | parallel doit</span><br></pre></td></tr></table></figure>

<h3 id="man-page-setting"><a href="#man-page-setting" class="headerlink" title="man page setting"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10535432/tmux-man-page-search-highlighting">man page setting</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Colored man pages: http://linuxtidbits.wordpress.com/2009/03/23/less-colors-for-man-pages/</span></span><br><span class="line"><span class="comment"># Less Colors for Man Pages</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_mb=$<span class="string">&#x27;\E[01;31m&#x27;</span>       <span class="comment"># begin blinking</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_md=$<span class="string">&#x27;\E[01;38;5;74m&#x27;</span>  <span class="comment"># begin bold</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_me=$<span class="string">&#x27;\E[0m&#x27;</span>           <span class="comment"># end mode</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_se=$<span class="string">&#x27;\E[0m&#x27;</span>           <span class="comment"># end standout-mode</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_so=$<span class="string">&#x27;\E[38;5;016m\E[48;5;220m&#x27;</span>    <span class="comment"># begin standout-mode - info box</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_ue=$<span class="string">&#x27;\E[0m&#x27;</span>           <span class="comment"># end underline</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_us=$<span class="string">&#x27;\E[04;38;5;146m&#x27;</span> <span class="comment"># begin underline</span></span><br></pre></td></tr></table></figure>

<h3 id="expect-auto-add-ssh-key"><a href="#expect-auto-add-ssh-key" class="headerlink" title="expect auto add ssh key"></a>expect auto add ssh key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="built_in">set</span> timeout 10</span><br><span class="line"><span class="built_in">set</span> ipaddr [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> path [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 2]</span><br><span class="line"><span class="built_in">set</span> user testuser</span><br><span class="line"><span class="built_in">set</span> password 11111111</span><br><span class="line">spawn ssh-copy-id  -i <span class="variable">$path</span>/.ssh/id_rsa.pub <span class="variable">$user</span>@<span class="variable">$ipaddr</span></span><br><span class="line"></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">&quot;*yes/no*&quot;</span> &#123; send <span class="string">&quot;yes\r&quot;</span>; exp_continue&#125;</span><br><span class="line"><span class="string">&quot;*because they already exist*&quot;</span> &#123; send <span class="string">&quot;\r&quot;</span>; <span class="built_in">exit</span>&#125;</span><br><span class="line"><span class="string">&quot;*password:&quot;</span> &#123; send <span class="string">&quot;<span class="variable">$password</span>\r&quot;</span> &#125;</span><br><span class="line">timeout  &#123; puts <span class="string">&quot;timed out during login&quot;</span>; <span class="built_in">exit</span> 1 &#125;</span><br><span class="line">&#125;</span><br><span class="line">expect eof</span><br><span class="line"></span><br><span class="line">$ ./exp-test 192.168.1.1 /root testuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># expect return var to bash</span></span><br><span class="line">$ x=$(expect -c <span class="string">&#x27;send &quot;hello&quot;; exit 5;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> $?; <span class="built_in">echo</span> <span class="variable">$x</span></span><br><span class="line">5</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h3 id="print-last-column"><a href="#print-last-column" class="headerlink" title="print last column"></a>print last column</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Your string here&quot;</span>| tr <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span> | tail -n1</span><br></pre></td></tr></table></figure>

<h3 id="use-tee-write-the-same-data-to-the-match-files"><a href="#use-tee-write-the-same-data-to-the-match-files" class="headerlink" title="use tee write the same data to the match files"></a>use tee write the same data to the match files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">1  2  3  4  5  6  7  8  9</span><br><span class="line">$ <span class="built_in">echo</span> -n | tee ./*</span><br><span class="line">$ cat 1</span><br><span class="line">$ <span class="built_in">echo</span> 123 | tee ./*</span><br><span class="line">123</span><br><span class="line">$ cat ./*</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h3 id="another-bash-trap"><a href="#another-bash-trap" class="headerlink" title="another bash trap"></a>another bash trap</h3><p>er……<br>“&amp;&amp;” will change your return value in bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">:raidz1</span><br><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">:raidz1</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ginger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/12/11/bash/">http://yoursite.com/2018/12/11/bash/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/bash/">bash</a></div><div class="post_share"><div class="social-share" data-image="/img/photo_by_spacex.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2018/12/11/multipath/"><img class="prev-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">multipath</div></div></a></div><div class="next-post pull-right"><a href="/2018/12/02/process/"><img class="next-cover" src="/img/photo_by_spacex.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">process</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ginger</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  var script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>