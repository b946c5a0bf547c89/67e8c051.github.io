<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Bash tips | b946c5a0bf547c89</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Background exec script by ssh1$ while read line; do echo -------- $line  -----------; ssh -n -t $line &amp;#x27;sh -c &quot;( ( nohup &#x2F;opt&#x2F;test.sh &amp;&gt;&#x2F;dev&#x2F;null ) &amp; )&quot;&amp;#x27;; done &lt; hosts">
<meta property="og:type" content="article">
<meta property="og:title" content="Bash tips">
<meta property="og:url" content="http://yoursite.com/2018/12/11/bash/index.html">
<meta property="og:site_name" content="b946c5a0bf547c89">
<meta property="og:description" content="Background exec script by ssh1$ while read line; do echo -------- $line  -----------; ssh -n -t $line &amp;#x27;sh -c &quot;( ( nohup &#x2F;opt&#x2F;test.sh &amp;&gt;&#x2F;dev&#x2F;null ) &amp; )&quot;&amp;#x27;; done &lt; hosts">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-12-11T03:04:49.000Z">
<meta property="article:modified_time" content="2020-09-27T14:59:09.922Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="bash">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="b946c5a0bf547c89" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">b946c5a0bf547c89</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-bash" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/11/bash/" class="article-date">
  <time datetime="2018-12-11T03:04:49.000Z" itemprop="datePublished">2018-12-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bash/">bash</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Bash tips
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Background-exec-script-by-ssh"><a href="#Background-exec-script-by-ssh" class="headerlink" title="Background exec script by ssh"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/29142/getting-ssh-to-execute-a-command-in-the-background-on-target-machine">Background exec script by ssh</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="built_in">echo</span> -------- <span class="variable">$line</span>  -----------; ssh -n -t <span class="variable">$line</span> <span class="string">&#x27;sh -c &quot;( ( nohup /opt/test.sh &amp;&gt;/dev/null ) &amp; )&quot;&#x27;</span>; <span class="keyword">done</span> &lt; hosts</span><br></pre></td></tr></table></figure>

<h3 id="bash-set"><a href="#bash-set" class="headerlink" title="[bash set]"></a>[bash set]</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-f</span><br><span class="line">Disable filename expansion (globbing).</span><br><span class="line"></span><br><span class="line">-v</span><br><span class="line">Print shell input lines as they are <span class="built_in">read</span>.</span><br></pre></td></tr></table></figure>

<h3 id="bash-double-quotes-single-quotes"><a href="#bash-double-quotes-single-quotes" class="headerlink" title="bash double-quotes, single-quotes"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/13826149/how-have-both-local-and-remote-variable-inside-an-ssh-command">bash double-quotes, single-quotes</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">A=100;</span><br><span class="line">ssh name@host <span class="string">&quot;A=101;echo \$A&quot;</span></span><br><span class="line">101</span><br><span class="line"></span><br><span class="line">ssh name@host <span class="string">&quot;A=101;echo <span class="variable">$A</span>&quot;</span></span><br><span class="line">100</span><br><span class="line"><span class="comment">#bash expands it to:</span></span><br><span class="line">ssh name@host <span class="string">&quot;A=101; echo 100&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#use single-quotes</span></span><br><span class="line">ssh name@host <span class="string">&#x27;A=101;echo $A&#x27;</span></span><br><span class="line">101</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="bash-replace-expect-script"><a href="#bash-replace-expect-script" class="headerlink" title="bash replace expect script"></a>bash replace expect script</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;connect\nshow ld\nexit\n&quot;</span> | ./runCLI.sh</span><br></pre></td></tr></table></figure>

<h3 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="keyword">set</span> timeout <span class="number">60</span></span><br><span class="line">spawn <span class="string">&quot;/opt/CLI_ESD/runCLI.sh&quot;</span></span><br><span class="line">expect <span class="string">&quot;RAIDCmd&quot;</span> &#123; send <span class="string">&quot;connect\r&quot;</span> &#125;</span><br><span class="line">expect <span class="string">&quot;Successful&quot;</span> &#123; send <span class="string">&quot;show ld\r&quot;</span> &#125;</span><br><span class="line">expect <span class="string">&quot;logical volume&quot;</span> &#123; send <span class="string">&quot;exit\r&quot;</span> &#125;</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>

<h3 id="ssh-remote-exec-command"><a href="#ssh-remote-exec-command" class="headerlink" title="ssh remote exec command"></a>ssh remote exec command</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#sometimes ssh remote exec command not work</span><br><span class="line">ssh -n name@host  &#39;your command&#39;</span><br><span class="line"></span><br><span class="line">#-t  Force pseudo-terminal allocation.  This can be used to execute arbitrary screen-based programs on a remote machine, which can be very useful, e.g. when implementing menu services.  Multiple -t options force tty allocation, even if ssh has no local tty.</span><br></pre></td></tr></table></figure>

<p>There are a big issue cause I can ‘t parallel exec ssh in bash script, randomly connection closed.<br>I try setting sshd_config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/ssh/sshd_config | grep max -i</span><br><span class="line">MaxSessions 512</span><br><span class="line">ClientAliveCountMax 512</span><br><span class="line">MaxStartups 500:1:500</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -n -t -o TCPKeepAlive&#x3D;yes -o ServerAliveInterval&#x3D;30 -o GSSAPIAuthentication&#x3D;no -o ControlPersist&#x3D;600 $line &#39;$your command&#39;</span><br></pre></td></tr></table></figure>
<p>There is no any help</p>
<p>Fine, I use screen background the command avoid this issue, mpich has the same issue.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">ssh -n -t -o TCPKeepAlive=yes -o GSSAPIAuthentication=no <span class="variable">$line</span> <span class="string">&#x27;screen -dmS fio-read &quot;/root/run-fio-read.sh&quot;&#x27;</span></span><br><span class="line"><span class="keyword">done</span> &lt; test_hosts</span><br></pre></td></tr></table></figure>

<h4 id="single-command-jump-2-nodes"><a href="#single-command-jump-2-nodes" class="headerlink" title="single command jump 2 nodes"></a>single command jump 2 nodes</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -t user1@<span class="variable">$server1</span> -o GSSAPIAuthentication=no <span class="string">&#x27;sudo scp tmp.sh root@$server_ip:&#x27;</span></span><br><span class="line">ssh -t user1@<span class="variable">$server1</span> -o GSSAPIAuthentication=no <span class="string">&#x27;sudo ssh -n root@$server2_ip sh ./tmp.sh&#x27;</span></span><br></pre></td></tr></table></figure>


<h3 id="remove-name-begin-with-“-“"><a href="#remove-name-begin-with-“-“" class="headerlink" title="remove name begin with “-“"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/1519/how-do-i-delete-a-file-whose-name-begins-with-hyphen-a-k-a-dash-or-minus">remove name begin with “-“</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -- --<span class="built_in">help</span></span><br><span class="line">rm ./--<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="IFS"><a href="#IFS" class="headerlink" title="IFS"></a>IFS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default value, &lt;space&gt;&lt;tab&gt;&lt;newline&gt;</span></span><br><span class="line">$ IFS=$<span class="string">&#x27; \t\n&#x27;</span></span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">$ IFS=<span class="string">&#x27;input from keyboard space,tab,newline&#x27;</span></span><br><span class="line"><span class="comment"># read IFS</span></span><br><span class="line">$ cat -etv &lt;&lt;&lt; <span class="variable">$IFS</span></span><br><span class="line"> ^I$</span><br><span class="line">$</span><br><span class="line"></span><br><span class="line">$ IFS=$(<span class="built_in">echo</span> <span class="string">&quot; \n\t&quot;</span>); <span class="built_in">printf</span> <span class="string">&quot;%s&quot;</span> <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span>|xxd</span><br><span class="line">00000000: 205c 6e5c 74</span><br><span class="line"></span><br><span class="line"><span class="comment"># backup the value</span></span><br><span class="line">OLDIFS=<span class="variable">$IFS</span> </span><br></pre></td></tr></table></figure>

<h3 id="test-match"><a href="#test-match" class="headerlink" title="test match"></a>test match</h3><h4 id="is-a-integer"><a href="#is-a-integer" class="headerlink" title="is a integer"></a>is a integer</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=1</span><br><span class="line">[[ <span class="variable">$a</span> == *[[:digit:]]* ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> is an integer&quot;</span></span><br><span class="line">[[ <span class="variable">$1</span> == ?(-)+([0-9]) ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> is an integer&quot;</span></span><br><span class="line"><span class="comment">#match yes</span></span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$response</span>&quot;</span> =~ ^([yY][eE][sS]|[yY])+$ ]]</span><br></pre></td></tr></table></figure>

<h3 id="String-Ternary-conditional-operator-three"><a href="#String-Ternary-conditional-operator-three" class="headerlink" title="String, Ternary conditional operator (three)"></a>String, Ternary conditional operator (three)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">VAR1=<span class="string">&quot;BASH&quot;</span></span><br><span class="line">VAR1+=<span class="string">&quot; SCRIPT&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$VAR1</span>&quot;</span></span><br><span class="line">BASH SCRIPT</span><br><span class="line"></span><br><span class="line">n=4</span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 $((<span class="variable">$n</span> &gt; <span class="number">0</span>? <span class="variable">$n</span>-<span class="number">1</span>: <span class="number">0</span>))); <span class="keyword">do</span> </span><br><span class="line">  result+=<span class="string">&quot;rank-<span class="variable">$i</span>&quot;</span></span><br><span class="line">  result+=<span class="string">&quot; &quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line">rank-0 rank-1 rank-2 rank-3</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time_interval=$((<span class="variable">$1</span> &gt; <span class="number">36000</span>? <span class="number">36000</span>: <span class="number">3600</span>))</span><br></pre></td></tr></table></figure>


<h3 id="Arrary"><a href="#Arrary" class="headerlink" title="Arrary"></a>Arrary</h3><h5 id="Associative-array"><a href="#Associative-array" class="headerlink" title="Associative array"></a>Associative array</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">declare -A array</span><br><span class="line">array[foo]&#x3D;bar</span><br><span class="line">array[bar]&#x3D;foo</span><br><span class="line"></span><br><span class="line">for i in &quot;$&#123;!array[@]&#125;&quot;</span><br><span class="line">do</span><br><span class="line">  echo -n &quot;key : $i; &quot;</span><br><span class="line">  echo &quot;value: $&#123;array[$i]&#125;&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4069188/how-to-pass-an-associative-array-as-argument-to-a-function-in-bash/46085661#46085661">direct access array in function</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/tmp</span><br><span class="line">AA 11</span><br><span class="line">BB 22</span><br><span class="line">CC 33</span><br><span class="line">DD 44</span><br><span class="line">ZZ 55</span><br><span class="line">YY 66</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A ARR</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   key=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">   value=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   ARR[<span class="variable">$key</span>]=<span class="variable">$value</span></span><br><span class="line"><span class="keyword">done</span> &lt; /tmp/tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">fun</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!ARR[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">          <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$i</span>&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot; <span class="variable">$&#123;ARR[$i]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line">fun <span class="string">&quot;hahaha&quot;</span></span><br></pre></td></tr></table></figure>

<p>If you want copy array    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -A ARR</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!ARR[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  ARRAY[<span class="string">&quot;<span class="variable">$key</span>&quot;</span>]=<span class="string">&quot;<span class="variable">$&#123;ARR[&quot;$key&quot;]&#125;</span>&quot;</span></span><br><span class="line">  <span class="comment"># ARRAY+=( [&quot;$key&quot;]=&quot;$&#123;ARR[&quot;$key&quot;]&#125;&quot; )</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>bash 4.4 in ubuntu</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A ARR</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   key=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">   value=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   ARR[<span class="variable">$key</span>]=<span class="variable">$value</span></span><br><span class="line"><span class="keyword">done</span> &lt; /tmp/tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print_ARR</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> -n array=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!array[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">          <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$i</span>&quot;</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot; <span class="variable">$&#123;array[$i]&#125;</span>&quot;</span></span><br><span class="line">     <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!ARR[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> -n <span class="string">&quot;key: <span class="variable">$i</span> &quot;</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;value: <span class="variable">$&#123;ARR[$i]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> ---------<span class="keyword">in</span> func ----------</span><br><span class="line">print_ARR <span class="string">&quot;ARR&quot;</span></span><br></pre></td></tr></table></figure>

<p>or you could </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   key=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">   value=$(<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   ARR[<span class="variable">$key</span>]=<span class="variable">$value</span></span><br><span class="line"><span class="keyword">done</span> &lt;&lt;&lt; <span class="string">&quot;<span class="subst">$([[ ! -z $var ]] &amp;&amp; awk  &#x27;&#123;print $1,$2&#125;&#x27; your_file)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="array"><a href="#array" class="headerlink" title="array"></a>array</h5><p>split string to array</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ lsscsi_out&#x3D;$(lsscsi | awk &#39;$NF!~&#x2F;-&#x2F; &#123;print $NF&#125;&#39;)</span><br><span class="line">$ read -r -a noroot_dev &lt;&lt;&lt; $lsscsi_out ## you could change IFS for your need, IFS&#x3D;&#39;, &#39; read -r -a array &lt;&lt;&lt; &quot;$string&quot;</span><br><span class="line">$ echo $&#123;#noroot_dev[@]&#125;</span><br><span class="line">6</span><br><span class="line">$ echo $&#123;noroot_dev[@]&#125;</span><br><span class="line">&#x2F;dev&#x2F;sda &#x2F;dev&#x2F;sdf &#x2F;dev&#x2F;sde &#x2F;dev&#x2F;sdd &#x2F;dev&#x2F;sdc &#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">var&#x3D;($(.&#x2F;test.sh))</span><br><span class="line"></span><br><span class="line">echo $&#123;var[0]&#125;</span><br><span class="line">echo $&#123;var[1]&#125;</span><br><span class="line">echo $&#123;var[2]&#125;</span><br><span class="line"></span><br><span class="line"># another example</span><br><span class="line">arr&#x3D;($(echo $m | tr &quot; &quot; &quot;\n&quot;))</span><br><span class="line"></span><br><span class="line">ARRAY&#x3D;()</span><br><span class="line">ARRAY+&#x3D;(&#39;foo&#39;)</span><br><span class="line">ARRAY+&#x3D;(&#39;bar&#39;)</span><br><span class="line">for i in &quot;$&#123;!ARRAY[@]&#125;&quot;; do echo $i; done</span><br><span class="line">for i in &quot;$&#123;ARRAY[@]&#125;&quot;; do echo $i; done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">declare -a names</span><br><span class="line"></span><br><span class="line">names[0]&#x3D;1111</span><br><span class="line">names[1]&#x3D;2222</span><br><span class="line">or</span><br><span class="line">names&#x3D;(&#39;1111&#39; &#39;2222&#39;)</span><br><span class="line">or</span><br><span class="line">names&#x3D;([0]&#x3D;&#39;1111&#39; [1]&#x3D;&#39;2222&#39;)</span><br><span class="line"></span><br><span class="line">$ cat files.txt</span><br><span class="line">1111111</span><br><span class="line">2222222</span><br><span class="line">3333333</span><br><span class="line"></span><br><span class="line"># get array from file</span><br><span class="line">names&#x3D;($(cat files.txt))</span><br><span class="line">$ echo $&#123;names[1]&#125;</span><br><span class="line">2222222</span><br><span class="line">$ echo $&#123;names[2]&#125;</span><br><span class="line">3333333</span><br><span class="line">$ echo $&#123;names[3]&#125;</span><br><span class="line">$ echo $&#123;#names[@]&#125;</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">$ echo $&#123;names[@]:0:1&#125;</span><br><span class="line">1111111</span><br><span class="line">$ echo $&#123;names[@]:0:2&#125;</span><br><span class="line">1111111 2222222</span><br><span class="line"></span><br><span class="line">echo $&#123;names[@]:1&#125;</span><br><span class="line">2222222 333333</span><br><span class="line"></span><br><span class="line">$ names1&#x3D;([0]&#x3D;&#39;1111&#39; [2]&#x3D;&#39;2222&#39; [4]&#x3D;&#39;3333&#39;)</span><br><span class="line">$ echo $&#123;#adobe[@]&#125;</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">$ names&#x3D;(&#39;1111&#39; &#39;2222&#39; &#39;3333&#39; &#39;4444&#39; &#39;5555&#39;)</span><br><span class="line">$ names2&#x3D;(&#39;6666&#39; &#39;7777&#39;)</span><br><span class="line">$ names3&#x3D;($&#123;names[@]&#125; $&#123;names2[@]&#125;)</span><br><span class="line">$ echo $&#123;#names3[@]&#125;</span><br><span class="line">7</span><br><span class="line"></span><br><span class="line">### delete array</span><br><span class="line">$ names&#x3D;(&#39;1111&#39; &#39;2222&#39; &#39;3333&#39; &#39;4444&#39;)</span><br><span class="line">$ echo $&#123;names[@]&#x2F;1111&#x2F;0000&#125;</span><br><span class="line">0000 2222 3333 4444</span><br><span class="line"></span><br><span class="line">$ for item in $&#123;names[@]&#125;;do echo $item; done</span><br><span class="line">1111</span><br><span class="line">2222</span><br><span class="line">3333</span><br><span class="line">4444</span><br><span class="line"></span><br><span class="line">$ len&#x3D;$&#123;#names[@]&#125;</span><br><span class="line">$ for ((i&#x3D;0;i&lt;$len;i++));do echo $&#123;names[$i]&#125;;done</span><br><span class="line"></span><br><span class="line">## delete array element</span><br><span class="line">$ noroot_dev&#x3D;($&#123;noroot_dev[@]&#x2F;$j&#x2F;&#125;)</span><br><span class="line"></span><br><span class="line">rclocal&#x3D;&quot;&#x2F;etc&#x2F;rc.d&#x2F;rc.local&quot;</span><br><span class="line">grep -iE &#39;ethtool&#39; $rclocal  || ls &#x2F;sys&#x2F;class&#x2F;net | egrep &#39;(eth|en|p|em|bond|br)&#39; | egrep -v &#39;bonding_masters|vir&#39; | while read nic</span><br><span class="line">do</span><br><span class="line">    nicbuff+&#x3D;($(ethtool -g $nic | grep -A 4 &quot;Pre-set maximums&quot; | grep -vEi &#39;maximums|mini|jumbo&#39; | awk &#39;&#123;print $NF&#125;&#39;))</span><br><span class="line">    echo ethtool -G $nic rx $&#123;nicbuff[0]&#125; tx $&#123;nicbuff[1]&#125; &gt;&gt; $rclocal</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h3 id="Avoid-multiple-JBOD-devs-across-in-single-raidz"><a href="#Avoid-multiple-JBOD-devs-across-in-single-raidz" class="headerlink" title="Avoid multiple JBOD devs across in single raidz"></a>Avoid multiple JBOD devs across in single raidz</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tempdir=/tmp;</span><br><span class="line">lsscsi -tiv  | sed -z <span class="string">&#x27;s/\n  dir:/ /g&#x27;</span> | awk -v tempdir=<span class="string">&quot;<span class="variable">$tempdir</span>&quot;</span> -F <span class="string">&#x27;[:\\[/ ]+&#x27;</span> <span class="string">&#x27;$10!~/-/ &amp;&amp; $0~/disk/ &amp;&amp; $7~/sas/ &#123;print &quot;/dev/disk/by-id/scsi-&quot;$11,$2 &gt; tempdir&quot;/&quot;$30&quot;_&quot;$31&quot;_&quot;$32&quot;_&quot;$33&quot;_&quot;$34&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Wait-sub-process-finish"><a href="#Wait-sub-process-finish" class="headerlink" title="Wait sub process finish"></a>Wait sub process finish</h3><p>Here is example to paralle running SMcli to collect MD34xx’s log. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        SMcli localhost -n <span class="variable">$line</span> -c <span class="string">&quot;save storageArray supportdata file=\&quot;/root/<span class="variable">$&#123;1&#125;</span>/smcli_<span class="variable">$&#123;line&#125;</span>_controller\&quot; force=true;&quot;</span> &amp;</span><br><span class="line">        <span class="built_in">echo</span> $! &gt;&gt; <span class="variable">$dell_pids</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$dell_names</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> Begin to <span class="built_in">wait</span> smcli <span class="variable">$line</span></span><br><span class="line">    <span class="built_in">wait</span> <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$dell_pids</span></span><br></pre></td></tr></table></figure>
<h3 id="Sed"><a href="#Sed" class="headerlink" title="Sed"></a><a target="_blank" rel="noopener" href="https://www.oakton.edu/user/2/rjtaylor/cis218/Handouts/sed.txt">Sed</a></h3><h4 id="print-line-from-16224-to-16482"><a href="#print-line-from-16224-to-16482" class="headerlink" title="print line from 16224 to 16482"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/83329/how-can-i-extract-a-predetermined-range-of-lines-from-a-text-file-on-unix">print line from 16224 to 16482</a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n &#39;16224,16482p;16483q&#39; filename &gt; newfile</span><br><span class="line">p - Print out the pattern space (to the standard output). This command is usually only used in conjunction with the -n command-line option.</span><br><span class="line"></span><br><span class="line">n - If auto-print is not disabled, print the pattern space, then, regardless, replace the pattern space with the next line of input. If there is no more input then sed exits without processing any more commands.</span><br><span class="line"></span><br><span class="line">q - Exit sed without processing any more commands or input. Note that the current pattern space is printed if auto-print is not disabled with the -n option.</span><br></pre></td></tr></table></figure>

<p>modify first display key word</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># match second match colume</span></span><br><span class="line">$ sed <span class="string">&#x27;s/unix/to_linux/2&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 to_linux unix  8</span><br><span class="line">4 5 unix to_linux unix 2</span><br><span class="line">7 unix 9 to_linux 12  unix</span><br><span class="line">unix 11 12 to_linux 14  unix</span><br><span class="line">unix 14 to_linux unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line">$ sed <span class="string">&#x27;0,/unix/ &#123;s/unix/to_linux/&#125;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 to_linux 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line">second ~ last match colume</span><br><span class="line">$ sed <span class="string">&#x27;s/unix/to_that/2g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 to_that to_that  8</span><br><span class="line">4 5 unix to_that to_that 2</span><br><span class="line">7 unix 9 to_that 12  to_that</span><br><span class="line">unix 11 12 to_that 14  to_that</span><br><span class="line">unix 14 to_that to_that 16  19 to_that 228</span><br><span class="line"></span><br><span class="line">$ sed <span class="string">&#x27;s/unix/to_that/3g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix to_that  8</span><br><span class="line">4 5 unix unix to_that 2</span><br><span class="line">7 unix 9 unix 12  to_that</span><br><span class="line">unix 11 12 unix 14  to_that</span><br><span class="line">unix 14 unix to_that 16  19 to_that 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># or you can</span></span><br><span class="line">$ sed <span class="string">&#x27;s_http://_www_&#x27;</span> file.txt</span><br><span class="line">$ sed <span class="string">&#x27;s|http://|www|&#x27;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># use &amp; as the match string</span></span><br><span class="line">$ sed <span class="string">&#x27;s/unix/&#123;&amp;&#125;/&#x27;</span> /tmp/test.txt</span><br><span class="line">1 &#123;unix&#125; 3 unix unix  8</span><br><span class="line">4 5 &#123;unix&#125; unix unix 2</span><br><span class="line">7 &#123;unix&#125; 9 unix 12  unix</span><br><span class="line">&#123;unix&#125; 11 12 unix 14  unix</span><br><span class="line">&#123;unix&#125; 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line">$ sed -n <span class="string">&#x27;s/unix/linux/p&#x27;</span> /tmp/test.txt <span class="comment"># only print match line</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#multiple command</span></span><br><span class="line">$ sed -e <span class="string">&#x27;s/unix/linux/&#x27;</span> -e <span class="string">&#x27;s/9/system/&#x27;</span>  /tmp/test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># only replace some line </span></span><br><span class="line">$ sed <span class="string">&#x27;3 s/unix/to_linux/g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 to_linux 9 to_linux 12  to_linux</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># from 1~3 lines</span></span><br><span class="line">$ sed <span class="string">&#x27;1,3 s/unix/to_linux/g&#x27;</span> /tmp/test.txt</span><br><span class="line">1 to_linux 3 to_linux to_linux  8</span><br><span class="line">4 5 to_linux to_linux to_linux 2</span><br><span class="line">7 to_linux 9 to_linux 12  to_linux</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># only replace match line</span></span><br><span class="line">$ sed <span class="string">&#x27;/4 5/ s/unix/centos/&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 centos unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete line</span></span><br><span class="line">$ sed <span class="string">&#x27;2 d&#x27;</span> /tmp/test.txt</span><br><span class="line">$ sed <span class="string">&#x27;5,$ d&#x27;</span> /tmp/test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#duplicate text</span></span><br><span class="line">$ sed <span class="string">&#x27;p&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/unix/ p&#x27;</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep -v</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/unix/ !p&#x27;</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add line after a match</span></span><br><span class="line">$ sed <span class="string">&#x27;/4 5/ a &quot;Add a new line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">sed <span class="string">&#x27;/4 5/ a &quot;Add a new line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line"><span class="string">&quot;Add a new line&quot;</span></span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add a line before a match</span></span><br><span class="line">$ sed <span class="string">&#x27;/4 5/ i &quot;Add a new line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line"><span class="string">&quot;Add a new line&quot;</span></span><br><span class="line">4 5 unix unix unix 2</span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the whole line</span></span><br><span class="line">sed <span class="string">&#x27;/4 5/ c &quot;Change line&quot;&#x27;</span> /tmp/test.txt</span><br><span class="line">1 unix 3 unix unix  8</span><br><span class="line"><span class="string">&quot;Change line&quot;</span></span><br><span class="line">7 unix 9 unix 12  unix</span><br><span class="line">unix 11 12 unix 14  unix</span><br><span class="line">unix 14 unix unix 16  19 unix 228</span><br></pre></td></tr></table></figure>

<h3 id="AWK"><a href="#AWK" class="headerlink" title="AWK"></a>AWK</h3><h4 id="single-character-fields"><a href="#single-character-fields" class="headerlink" title="single character fields"></a><a target="_blank" rel="noopener" href="https://www.gnu.org/software/gawk/manual/html_node/Single-Character-Fields.html">single character fields</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> a b | gawk <span class="string">&#x27;BEGIN &#123; FS = &quot;&quot; &#125;</span></span><br><span class="line"><span class="string">&gt;                  &#123;</span></span><br><span class="line"><span class="string">&gt;                      for (i = 1; i &lt;= NF; i = i + 1)</span></span><br><span class="line"><span class="string">&gt;                          print &quot;Field&quot;, i, &quot;is&quot;, $i</span></span><br><span class="line"><span class="string">&gt;                  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>If you want use ‘[‘ and ‘]’ become the separator </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">&#x27;[][ :]+&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="awk-match-bash-variable"><a href="#awk-match-bash-variable" class="headerlink" title="awk match bash variable"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39384283/how-to-match-a-pattern-given-in-a-variable-in-awk">awk match bash variable</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v pat=<span class="string">&quot;<span class="variable">$pattern</span>&quot;</span> -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;$0~pat&#123;print $1, $2, $3, $4 &#125;&#x27;</span> file</span><br></pre></td></tr></table></figure>

<h4 id="awk-sort-key-and-value"><a href="#awk-sort-key-and-value" class="headerlink" title="awk sort key and value"></a><a target="_blank" rel="noopener" href="https://www.gnu.org/software/gawk/manual/html_node/Controlling-Scanning.html">awk sort key and value</a></h4><p>out of order the line</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sort -R file_name</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PROCINFO[<span class="string">&quot;sorted_in&quot;</span>] = <span class="string">&quot;@val_num_desc&quot;</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> a) <span class="built_in">print</span> i, a[i]</span><br></pre></td></tr></table></figure>

<p>awk absolute match $0~/ / /<br>sed absolute match sed -i “/&lt;${i}&gt;/d”</p>
<h4 id="Got-int-to-variable"><a href="#Got-int-to-variable" class="headerlink" title="Got int to variable"></a>Got int to variable</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[int(<span class="variable">$NF</span>/1000)]++</span><br></pre></td></tr></table></figure>

<h3 id="bash-strings"><a href="#bash-strings" class="headerlink" title="bash strings"></a>bash strings</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># string length</span></span><br><span class="line">[[ <span class="variable">$&#123;#f_check&#125;</span> -le 8 ]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># variable is a number</span></span><br><span class="line">[[ <span class="variable">$VAR</span> = *[[:digit:]]* ]]</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$b</span></span><br><span class="line"><span class="comment">#50_5000cca26b90c3b1</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$c</span></span><br><span class="line">5000cca26b90c3b1</span><br><span class="line"></span><br><span class="line">$ [[ <span class="variable">$b</span> =~ <span class="variable">$c</span> ]] &amp;&amp; <span class="built_in">echo</span> ok</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>

<p>awk statement “next” to immediately continue with processing the next input record.</p>
<h3 id="Subprocess"><a href="#Subprocess" class="headerlink" title="Subprocess"></a>Subprocess</h3><h4 id="exit-err"><a href="#exit-err" class="headerlink" title="exit err"></a><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/48533/exit-shell-script-from-a-subshell">exit err</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -E</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;[ &quot;$?&quot; -ne 33 ] || exit 33&#x27;</span> ERR</span><br><span class="line">lfs getstripe <span class="variable">$namespace</span> &gt; /dev/null 2&gt;&amp;1 || (<span class="built_in">echo</span> <span class="string">&quot;Not found lustre filesystem&quot;</span> &amp;&amp; <span class="built_in">exit</span> 33)</span><br><span class="line"><span class="built_in">set</span> +E</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -E</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;[ &quot;$?&quot; -ne 33 ] || exit 33&#x27;</span> ERR</span><br><span class="line"><span class="keyword">for</span> ((i=0;i&lt;=9;i++)); <span class="keyword">do</span> <span class="built_in">echo</span> ----<span class="variable">$i</span> ; <span class="keyword">if</span> [[ <span class="variable">$i</span> -eq 3 ]]; <span class="keyword">then</span> lll || (<span class="built_in">echo</span> <span class="string">&quot;show error&quot;</span> &amp;&amp; <span class="built_in">exit</span> 33); <span class="keyword">else</span> <span class="built_in">echo</span> -----------<span class="variable">$i</span>---------------; <span class="keyword">fi</span> ; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">set</span> +E</span><br><span class="line"><span class="built_in">echo</span> haha out of</span><br></pre></td></tr></table></figure>

<h3 id="Termination-Signals-https-www-gnu-org-software-libc-manual-html-node-Termination-Signals-html"><a href="#Termination-Signals-https-www-gnu-org-software-libc-manual-html-node-Termination-Signals-html" class="headerlink" title="[Termination Signals] (https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html)"></a>[Termination Signals] (<a target="_blank" rel="noopener" href="https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html">https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html</a>)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">* 1 SIGHUP The SIGHUP (<span class="string">&quot;hang-up&quot;</span>) signal is used to report that the user<span class="string">&#x27;s terminal is disconnected, perhaps because a network or telephone connection was broken.</span></span><br><span class="line"><span class="string">* 2 SIGINT The SIGINT (program interrupt) signal is sent when the user types the INTR character (normally C-c).</span></span><br><span class="line"><span class="string">* 3 The SIGQUIT signal is similar to SIGINT, except that it’s controlled by a different key-the QUIT character, usually C-\-and produces a core dump when it terminates the process, just like a program error signal. You can think of this as a program error condition &quot;detected&quot; by the user</span></span><br><span class="line"><span class="string">* 9 The SIGKILL signal is used to cause immediate program termination. It cannot be handled or ignored, and is therefore always fatal. It is also not possible to block this signal</span></span><br><span class="line"><span class="string">* 15 The SIGTERM signal is a generic signal used to cause program termination. Unlike SIGKILL, this signal can be blocked, handled, and ignored. It is the normal way to politely ask a program to terminate.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Trap</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">mytrap () &#123;</span></span><br><span class="line"><span class="string">  echo hahahahaha</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">trap mytrap SIGHUP SIGINT SIGQUIT SIGTERM ERR EXIT</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">myfunc () &#123;</span></span><br><span class="line"><span class="string"> trap  mytrap RETURN</span></span><br><span class="line"><span class="string"> #trap  mytrap EXIT #no output</span></span><br><span class="line"><span class="string"> echo &quot;I&#x27;</span>ve got a bad feeling about this...<span class="string">&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">myfunc | cat</span></span><br><span class="line"><span class="string">sleep 10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">###############################</span></span><br><span class="line"><span class="string">Number	SIG	Meaning</span></span><br><span class="line"><span class="string">0	0	On exit from shell</span></span><br><span class="line"><span class="string">1	SIGHUP	Clean tidyup</span></span><br><span class="line"><span class="string">2	SIGINT	Interrupt</span></span><br><span class="line"><span class="string">3	SIGQUIT	Quit</span></span><br><span class="line"><span class="string">6	SIGABRT	Abort</span></span><br><span class="line"><span class="string">9	SIGKILL	Die Now (cannot be trapped)</span></span><br><span class="line"><span class="string">14	SIGALRM	Alarm Clock</span></span><br><span class="line"><span class="string">15	SIGTERM	Terminate</span></span><br></pre></td></tr></table></figure>

<h3 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h3><h4 id="number"><a href="#number" class="headerlink" title="number"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2556190/random-number-from-a-range-in-a-bash-script">number</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from 2000~65000</span></span><br><span class="line">$ shuf -i 2000-65000 -n 1</span><br></pre></td></tr></table></figure>

<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><h4 id="Get-bash-variable"><a href="#Get-bash-variable" class="headerlink" title="Get bash variable"></a>Get bash variable</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i <span class="string">&quot;s/524335808/<span class="variable">$&#123;mem&#125;</span>/&quot;</span></span><br><span class="line">$ sed <span class="string">&quot;/\&lt;<span class="variable">$&#123;a&#125;</span>\&gt;/d&quot;</span> zfs_free_dev <span class="comment"># like grep -w , \&lt;\&gt; force an exact match</span></span><br></pre></td></tr></table></figure>

<h3 id="Get-scsi-serial-number-by-bash"><a href="#Get-scsi-serial-number-by-bash" class="headerlink" title="Get scsi serial number by bash"></a>Get scsi serial number by bash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ strings /sys/block/sda/device/vpd_pg80 | tr -d <span class="string">&#x27;\040\011\012\015&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Get-parent-id-info"><a href="#Get-parent-id-info" class="headerlink" title="Get parent id info"></a>Get parent id info</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ pstree -sg 25153</span><br><span class="line">systemd(1)───qemu-kvm(25147)─┬─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             ├─&#123;qemu-kvm&#125;(25147)</span><br><span class="line">                             └─&#123;qemu-kvm&#125;(25147)</span><br></pre></td></tr></table></figure>

<h3 id="rsync-copy-to-change-ssh-cipher"><a href="#rsync-copy-to-change-ssh-cipher" class="headerlink" title="rsync copy to change ssh cipher"></a>rsync copy to change ssh cipher</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## -c arcfour could show support cipher</span></span><br><span class="line">$ rsync -aHAXvP -e <span class="string">&quot;ssh -T -c chacha20-poly1305@openssh.com -o Compression=no -x&quot;</span> <span class="built_in">source</span>:/xxxx <span class="variable">$ipaddr</span>:/xxx</span><br></pre></td></tr></table></figure>

<h3 id="Parallel-ssh"><a href="#Parallel-ssh" class="headerlink" title="Parallel ssh"></a>Parallel ssh</h3><ul>
<li>Don ‘t need install anything (pdsh or cluster shell, ansible)</li>
<li>Compatibility<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   ssh -n <span class="variable">$line</span> <span class="string">&quot;your command &gt; your log 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; hosts</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Create-sparse-file"><a href="#Create-sparse-file" class="headerlink" title="Create sparse file"></a>Create sparse file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ fallocate -l 5G -o 5G bar</span><br><span class="line">$ ls -lhs bar</span><br><span class="line">5.0G -rw-r--r-- 1 root root 10G Aug 23 08:58 bar</span><br><span class="line"></span><br><span class="line">$ truncate -s 512M bar</span><br><span class="line">0 -rw-rw-r-- 1 root root 512M 10月  4 22:07 bar</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Num-convert"><a href="#Num-convert" class="headerlink" title="Num convert"></a>Num convert</h3><p>hex -&gt; bin num</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dc -e &#39;16i2o0x6003p&#39;</span><br><span class="line">110000000000011</span><br><span class="line">110,0000,0000,0011</span><br></pre></td></tr></table></figure>

<p>bin &lt;-&gt; dec</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bin -&gt; dec</span></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">2#1010</span>))</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line"><span class="comment">#dec -&gt; bin</span></span><br><span class="line"><span class="comment"># 0-255</span></span><br><span class="line">$ bin=(&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;&#123;0..1&#125;)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;a[5]&#125;</span></span><br><span class="line">00000101</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;a[255]&#125;</span></span><br><span class="line">11111111</span><br><span class="line"></span><br><span class="line">$ var=<span class="string">&quot;304&quot;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;obase=2; <span class="variable">$var</span>&quot;</span> | bc</span><br><span class="line">100110000</span><br></pre></td></tr></table></figure>

<h4 id="Printf-convert-oct-hex-dec"><a href="#Printf-convert-oct-hex-dec" class="headerlink" title="Printf convert oct,hex,dec"></a>Printf convert oct,hex,dec</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">printf</span> <span class="string">&quot;%d %d %x %o\n&quot;</span> 0x10 010 16 0xf</span><br><span class="line">16 8 10 17</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">16#f</span>))</span><br><span class="line">15</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> $((<span class="number">8#10</span>))</span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<h4 id="Integer-ASCII-value-to-character"><a href="#Integer-ASCII-value-to-character" class="headerlink" title="Integer ASCII value to character"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/890262/integer-ascii-value-to-character-in-bash-using-printf">Integer ASCII value to character</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">printf</span> <span class="string">&quot;\x<span class="subst">$(printf %x 65)</span>&quot;</span></span><br><span class="line">A</span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;printf &quot;%c&quot;, 65&#125;&#x27;</span></span><br><span class="line">A</span><br></pre></td></tr></table></figure>

<h3 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h3><p>same with while read line</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ seq 88 97 | xargs -I% grep -H . /proc/irq/%/smp_affinity</span><br></pre></td></tr></table></figure>

<h3 id="taskset"><a href="#taskset" class="headerlink" title="taskset"></a>taskset</h3><h4 id="zfs-and-nfs"><a href="#zfs-and-nfs" class="headerlink" title="zfs and nfs"></a>zfs and nfs</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> i=13</span><br><span class="line">ps -C nfsd | awk <span class="string">&#x27;$0!~/PID/ &#123;print $1&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        [[ <span class="variable">$i</span> -gt 19 ]] &amp;&amp; <span class="built_in">export</span> i=13</span><br><span class="line">        taskset -p -c <span class="variable">$i</span> <span class="variable">$line</span></span><br><span class="line">        ((i=i+2))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> core=0</span><br><span class="line">[[ $(grep MHz /proc/cpuinfo -c) -gt 3 ]] &amp;&amp; maxcpu=8 &amp;&amp; <span class="keyword">for</span> i <span class="keyword">in</span> $(pgrep <span class="string">&#x27;z_wr_iss$&#x27;</span>);</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        [[ <span class="variable">$core</span> -gt <span class="variable">$maxcpu</span> ]] &amp;&amp; core=0;    taskset -p -c <span class="variable">$core</span> <span class="variable">$i</span>;    ((core++)); ((core++));</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get moidfy time from </span></span><br><span class="line">$ <span class="built_in">stat</span> -c%Z file</span><br><span class="line"></span><br><span class="line"><span class="comment"># now</span></span><br><span class="line">$ date +%s</span><br></pre></td></tr></table></figure>

<h3 id="xargs-1"><a href="#xargs-1" class="headerlink" title="xargs"></a>xargs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -n <span class="variable">$your_server</span> <span class="string">&quot;lsscsi -gis | awk &#x27;\$0~/3500/&#123;print \$6&#125;&#x27; | xargs -I&#123;&#125; sdparm -s RCD=0 &#123;&#125; &quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="the-old-script"><a href="#the-old-script" class="headerlink" title="the old script"></a>the old script</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head -c 10k test1 | tail -c 1k </span><br><span class="line">$ dd <span class="keyword">if</span>=test1 of=test2 bs=1k skip=9 count=1</span><br></pre></td></tr></table></figure>

<h3 id="Read-write-by-Byte-by-dd"><a href="#Read-write-by-Byte-by-dd" class="headerlink" title="Read write by Byte by dd"></a>Read write by Byte by dd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       ibs=BYTES</span><br><span class="line">              <span class="built_in">read</span> up to BYTES bytes at a time (default: 512)</span><br><span class="line">       obs=BYTES</span><br><span class="line">              write BYTES bytes at a time (default: 512)</span><br><span class="line">       bs=BYTES</span><br><span class="line">              <span class="built_in">read</span> and write up to BYTES bytes at a time (default: 512); overrides ibs and obs</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> bs=1 </span><br></pre></td></tr></table></figure>

<h3 id="parallel"><a href="#parallel" class="headerlink" title="parallel"></a>parallel</h3><h4 id="Pipe-single-big-file"><a href="#Pipe-single-big-file" class="headerlink" title="Pipe single big file"></a>Pipe single big file</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat bigfile.bin | parallel --pipe --recend <span class="string">&#x27;&#x27;</span> -k bzip2 --best &gt; compressedfile.bz2</span><br><span class="line">cat bigfile.txt | parallel --block 10M --pipe grep <span class="string">&#x27;pattern&#x27;</span></span><br><span class="line">cat rands20M.txt | parallel --pipe awk \<span class="string">&#x27;&#123;s+=\$1&#125; END &#123;print s&#125;\&#x27;</span> | awk <span class="string">&#x27;&#123;s+=$1&#125; END &#123;print s&#125;&#x27;</span></span><br><span class="line">cat bigfile.txt | parallel  --pipe wc -l | awk <span class="string">&#x27;&#123;s+=$1&#125; END &#123;print s&#125;&#x27;</span></span><br><span class="line">cat bigfile.txt | parallel --pipe sed s^old^new^g</span><br></pre></td></tr></table></figure>

<h4 id="For-multiple-files"><a href="#For-multiple-files" class="headerlink" title="For multiple files"></a>For multiple files</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&#x27;*.html&#x27;</span> | parallel gzip --best</span><br></pre></td></tr></table></figure>

<h4 id="Get-parameter"><a href="#Get-parameter" class="headerlink" title="Get parameter"></a>Get parameter</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ seq 10 | parallel <span class="built_in">echo</span> test_&#123;&#125;</span><br><span class="line">test_1</span><br><span class="line">test_2</span><br><span class="line">test_3</span><br><span class="line">test_4</span><br><span class="line">test_5</span><br><span class="line">test_6</span><br><span class="line">test_7</span><br><span class="line">test_8</span><br><span class="line">test_9</span><br><span class="line">test_10</span><br><span class="line"></span><br><span class="line">$ parallel <span class="built_in">echo</span> ::: <span class="string">&quot;123&quot;</span> <span class="string">&quot;456&quot;</span> <span class="built_in">test</span> zzz</span><br><span class="line">123</span><br><span class="line">456</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">zzz</span><br><span class="line"></span><br><span class="line">$ parallel <span class="built_in">echo</span> ::: A B C ::: D E F</span><br><span class="line">A D</span><br><span class="line">A E</span><br><span class="line">A F</span><br><span class="line">B D</span><br><span class="line">B E</span><br><span class="line">B F</span><br><span class="line">C D</span><br><span class="line">C E</span><br><span class="line">C F</span><br><span class="line"></span><br><span class="line">$ parallel -a abc-file -a def-file <span class="built_in">echo</span></span><br><span class="line">$ cat abc-file | parallel -a - -a def-file <span class="built_in">echo</span></span><br><span class="line"><span class="comment"># replace - by ::::</span></span><br><span class="line">$ cat abc-file | parallel <span class="built_in">echo</span> :::: - def-file</span><br><span class="line"><span class="comment"># &quot;:::&quot; is stand input, :::: is file</span></span><br><span class="line">$ parallel <span class="built_in">echo</span> ::: A B C :::: def-file</span><br><span class="line"></span><br><span class="line">$ parallel --xapply <span class="built_in">echo</span> ::: A B C ::: D E F</span><br><span class="line">A D</span><br><span class="line">B E</span><br><span class="line">C F</span><br><span class="line">$ seq 50 | parallel -n0 -q  curl <span class="string">&#x27;example.com&#x27;</span></span><br><span class="line"><span class="comment">#  -n 0 means read one argument, but insert 0 arguments on the command line.</span></span><br><span class="line"><span class="comment">#  -q       Quote command.  This will quote the command line so special characters are not interpreted by the shell.</span></span><br></pre></td></tr></table></figure>

<h4 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">doit</span></span>() &#123;</span><br><span class="line">    x=<span class="variable">$1</span></span><br><span class="line">    do_something <span class="variable">$x</span></span><br><span class="line">    [... 100 lines that <span class="keyword">do</span> something with <span class="variable">$x</span> ...]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">export</span> -f doit</span><br><span class="line">  cat list | parallel doit</span><br></pre></td></tr></table></figure>

<h3 id="man-page-setting"><a href="#man-page-setting" class="headerlink" title="man page setting"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10535432/tmux-man-page-search-highlighting">man page setting</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Colored man pages: http://linuxtidbits.wordpress.com/2009/03/23/less-colors-for-man-pages/</span></span><br><span class="line"><span class="comment"># Less Colors for Man Pages</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_mb=$<span class="string">&#x27;\E[01;31m&#x27;</span>       <span class="comment"># begin blinking</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_md=$<span class="string">&#x27;\E[01;38;5;74m&#x27;</span>  <span class="comment"># begin bold</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_me=$<span class="string">&#x27;\E[0m&#x27;</span>           <span class="comment"># end mode</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_se=$<span class="string">&#x27;\E[0m&#x27;</span>           <span class="comment"># end standout-mode</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_so=$<span class="string">&#x27;\E[38;5;016m\E[48;5;220m&#x27;</span>    <span class="comment"># begin standout-mode - info box</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_ue=$<span class="string">&#x27;\E[0m&#x27;</span>           <span class="comment"># end underline</span></span><br><span class="line"><span class="built_in">export</span> LESS_TERMCAP_us=$<span class="string">&#x27;\E[04;38;5;146m&#x27;</span> <span class="comment"># begin underline</span></span><br></pre></td></tr></table></figure>

<h3 id="expect-auto-add-ssh-key"><a href="#expect-auto-add-ssh-key" class="headerlink" title="expect auto add ssh key"></a>expect auto add ssh key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="built_in">set</span> timeout 10</span><br><span class="line"><span class="built_in">set</span> ipaddr [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> path [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 2]</span><br><span class="line"><span class="built_in">set</span> user testuser</span><br><span class="line"><span class="built_in">set</span> password 11111111</span><br><span class="line">spawn ssh-copy-id  -i <span class="variable">$path</span>/.ssh/id_rsa.pub <span class="variable">$user</span>@<span class="variable">$ipaddr</span></span><br><span class="line"></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">&quot;*yes/no*&quot;</span> &#123; send <span class="string">&quot;yes\r&quot;</span>; exp_continue&#125;</span><br><span class="line"><span class="string">&quot;*because they already exist*&quot;</span> &#123; send <span class="string">&quot;\r&quot;</span>; <span class="built_in">exit</span>&#125;</span><br><span class="line"><span class="string">&quot;*password:&quot;</span> &#123; send <span class="string">&quot;<span class="variable">$password</span>\r&quot;</span> &#125;</span><br><span class="line">timeout  &#123; puts <span class="string">&quot;timed out during login&quot;</span>; <span class="built_in">exit</span> 1 &#125;</span><br><span class="line">&#125;</span><br><span class="line">expect eof</span><br><span class="line"></span><br><span class="line">$ ./exp-test 192.168.1.1 /root testuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># expect return var to bash</span></span><br><span class="line">$ x=$(expect -c <span class="string">&#x27;send &quot;hello&quot;; exit 5;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> $?; <span class="built_in">echo</span> <span class="variable">$x</span></span><br><span class="line">5</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h3 id="print-last-column"><a href="#print-last-column" class="headerlink" title="print last column"></a>print last column</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Your string here&quot;</span>| tr <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span> | tail -n1</span><br></pre></td></tr></table></figure>

<h3 id="use-tee-write-the-same-data-to-the-match-files"><a href="#use-tee-write-the-same-data-to-the-match-files" class="headerlink" title="use tee write the same data to the match files"></a>use tee write the same data to the match files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">1  2  3  4  5  6  7  8  9</span><br><span class="line">$ <span class="built_in">echo</span> -n | tee ./*</span><br><span class="line">$ cat 1</span><br><span class="line">$ <span class="built_in">echo</span> 123 | tee ./*</span><br><span class="line">123</span><br><span class="line">$ cat ./*</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h3 id="another-bash-trap"><a href="#another-bash-trap" class="headerlink" title="another bash trap"></a>another bash trap</h3><p>er……<br>“&amp;&amp;” will change your return value in bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">:raidz1</span><br><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">~$ rcode=$?;[[ ! <span class="variable">$rcode</span> -eq 0 ]] &amp;&amp; <span class="built_in">echo</span> -n <span class="string">&quot;:raidz&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$rcode</span></span><br><span class="line">:raidz1</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/11/bash/" data-id="ckfzgl84p00593xo626qj963n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash/" rel="tag">bash</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/12/11/multipath/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          multipath
        
      </div>
    </a>
  
  
    <a href="/2018/12/02/process/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">process</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ansible/">ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/awk/">awk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bash/">bash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/benchmark/">benchmark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bios/">bios</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/block/">block</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/container/">container</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/debug/">debug</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/device-mapper/">device_mapper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/filesystem/">filesystem</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gdb/">gdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ha/">ha</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hardware/">hardware</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ipmi/">ipmi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mdraid/">mdraid</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/proc/">proc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/raid/">raid</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scsi/">scsi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storage/">storage</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/virtualization/">virtualization</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/" rel="tag">architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/" rel="tag">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bcc/" rel="tag">bcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/benchmark/" rel="tag">benchmark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bios/" rel="tag">bios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/block/" rel="tag">block</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bpf/" rel="tag">bpf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/calls/" rel="tag">calls</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cpu/" rel="tag">cpu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/" rel="tag">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dell/" rel="tag">dell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dm/" rel="tag">dm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/driver/" rel="tag">driver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ext4/" rel="tag">ext4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fio/" rel="tag">fio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fsck/" rel="tag">fsck</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftrace/" rel="tag">ftrace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gpt/" rel="tag">gpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ha/" rel="tag">ha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hardware/" rel="tag">hardware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ipmi/" rel="tag">ipmi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/irq/" rel="tag">irq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/isdct/" rel="tag">isdct</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kvm/" rel="tag">kvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lfs/" rel="tag">lfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lxc/" rel="tag">lxc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/megaraid/" rel="tag">megaraid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mem/" rel="tag">mem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memory/" rel="tag">memory</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/multipath/" rel="tag">multipath</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nfs/" rel="tag">nfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nic/" rel="tag">nic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pci/" rel="tag">pci</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perf/" rel="tag">perf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/posix/" rel="tag">posix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/" rel="tag">postgresql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/privoxy/" rel="tag">privoxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/process/" rel="tag">process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/" rel="tag">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/racadm/" rel="tag">racadm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raid/" rel="tag">raid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ratio/" rel="tag">ratio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sas/" rel="tag">sas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sata/" rel="tag">sata</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/schdule/" rel="tag">schdule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scsi/" rel="tag">scsi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/smcli/" rel="tag">smcli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sparse/" rel="tag">sparse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssd/" rel="tag">ssd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/system/" rel="tag">system</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/topology/" rel="tag">topology</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/trace/" rel="tag">trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virt/" rel="tag">virt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualization/" rel="tag">virtualization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xfs/" rel="tag">xfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zfs/" rel="tag">zfs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/architecture/" style="font-size: 10px;">architecture</a> <a href="/tags/awk/" style="font-size: 10px;">awk</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/bcc/" style="font-size: 12px;">bcc</a> <a href="/tags/benchmark/" style="font-size: 14px;">benchmark</a> <a href="/tags/bios/" style="font-size: 10px;">bios</a> <a href="/tags/block/" style="font-size: 16px;">block</a> <a href="/tags/bpf/" style="font-size: 12px;">bpf</a> <a href="/tags/calls/" style="font-size: 10px;">calls</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/cpu/" style="font-size: 12px;">cpu</a> <a href="/tags/debug/" style="font-size: 12px;">debug</a> <a href="/tags/dell/" style="font-size: 10px;">dell</a> <a href="/tags/dm/" style="font-size: 10px;">dm</a> <a href="/tags/driver/" style="font-size: 10px;">driver</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/ext4/" style="font-size: 10px;">ext4</a> <a href="/tags/fio/" style="font-size: 10px;">fio</a> <a href="/tags/fsck/" style="font-size: 10px;">fsck</a> <a href="/tags/ftrace/" style="font-size: 10px;">ftrace</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/gpt/" style="font-size: 10px;">gpt</a> <a href="/tags/ha/" style="font-size: 12px;">ha</a> <a href="/tags/hardware/" style="font-size: 10px;">hardware</a> <a href="/tags/ipmi/" style="font-size: 10px;">ipmi</a> <a href="/tags/irq/" style="font-size: 10px;">irq</a> <a href="/tags/isdct/" style="font-size: 10px;">isdct</a> <a href="/tags/kvm/" style="font-size: 10px;">kvm</a> <a href="/tags/lfs/" style="font-size: 12px;">lfs</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/lxc/" style="font-size: 10px;">lxc</a> <a href="/tags/megaraid/" style="font-size: 10px;">megaraid</a> <a href="/tags/mem/" style="font-size: 10px;">mem</a> <a href="/tags/memory/" style="font-size: 10px;">memory</a> <a href="/tags/multipath/" style="font-size: 10px;">multipath</a> <a href="/tags/network/" style="font-size: 12px;">network</a> <a href="/tags/nfs/" style="font-size: 12px;">nfs</a> <a href="/tags/nic/" style="font-size: 10px;">nic</a> <a href="/tags/pci/" style="font-size: 10px;">pci</a> <a href="/tags/perf/" style="font-size: 10px;">perf</a> <a href="/tags/posix/" style="font-size: 10px;">posix</a> <a href="/tags/postgresql/" style="font-size: 10px;">postgresql</a> <a href="/tags/privoxy/" style="font-size: 10px;">privoxy</a> <a href="/tags/process/" style="font-size: 10px;">process</a> <a href="/tags/proxy/" style="font-size: 12px;">proxy</a> <a href="/tags/racadm/" style="font-size: 10px;">racadm</a> <a href="/tags/raid/" style="font-size: 12px;">raid</a> <a href="/tags/ratio/" style="font-size: 10px;">ratio</a> <a href="/tags/sas/" style="font-size: 12px;">sas</a> <a href="/tags/sata/" style="font-size: 12px;">sata</a> <a href="/tags/schdule/" style="font-size: 10px;">schdule</a> <a href="/tags/scsi/" style="font-size: 14px;">scsi</a> <a href="/tags/smcli/" style="font-size: 10px;">smcli</a> <a href="/tags/sparse/" style="font-size: 10px;">sparse</a> <a href="/tags/ssd/" style="font-size: 10px;">ssd</a> <a href="/tags/system/" style="font-size: 10px;">system</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/test/" style="font-size: 18px;">test</a> <a href="/tags/topology/" style="font-size: 10px;">topology</a> <a href="/tags/trace/" style="font-size: 10px;">trace</a> <a href="/tags/ubuntu/" style="font-size: 12px;">ubuntu</a> <a href="/tags/virt/" style="font-size: 10px;">virt</a> <a href="/tags/virtualization/" style="font-size: 10px;">virtualization</a> <a href="/tags/xfs/" style="font-size: 10px;">xfs</a> <a href="/tags/zfs/" style="font-size: 20px;">zfs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/07/24/bpftrace/">bpftrace</a>
          </li>
        
          <li>
            <a href="/2020/07/22/network-benchmark-result/">Network bencharmk results</a>
          </li>
        
          <li>
            <a href="/2020/06/01/mdadm/">backup the mdraid info</a>
          </li>
        
          <li>
            <a href="/2020/03/24/syscall/">syscall</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Ginger<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>